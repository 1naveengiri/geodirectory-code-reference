<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652336158">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652336158">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-rest-fields-controller.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php

/**
 * Core class to access fields via the REST API.
 *
 * @since 2.0.0
 *
 * @see GeoDir_REST_Fields_Controller
 */
class GeoDir_REST_Fields_Controller extends WP_REST_Controller {

    /**
     * Constructor.
     *
     * @access public
     */
    public function __construct( $post_type = &#039;&#039; ) {
		$this-&gt;namespace = GEODIR_REST_SLUG . &#039;/v&#039; . GEODIR_REST_API_VERSION;
		$this-&gt;rest_base = &#039;fields&#039;;
		$this-&gt;object_type = &#039;field&#039;;

		$this-&gt;post_type    	= $post_type;
		$this-&gt;post_type_obj    = array();
		$this-&gt;post_type_slug	= &#039;&#039;;

		if ( ! empty( $this-&gt;post_type ) ) {
			$this-&gt;post_type_obj 	= get_post_type_object( $post_type );
			if ( ! empty( $this-&gt;post_type_obj ) ) {
				$this-&gt;post_type_slug = ! empty( $this-&gt;post_type_obj-&gt;rest_base ) ? $this-&gt;post_type_obj-&gt;rest_base : $this-&gt;post_type_obj-&gt;name;
				$this-&gt;rest_base = $this-&gt;post_type_slug . &#039;/fields&#039;;
			}
		}
    }

    /**
     * Registers the routes for the objects of the controller.
     *
     * @access public
     *
     * @see register_rest_route()
     */
    public function register_routes() {

		register_rest_route( $this-&gt;namespace, &#039;/&#039; . $this-&gt;rest_base, array(
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::READABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;get_items&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;get_items_permissions_check&#039; ),
				&#039;args&#039;                =&gt; $this-&gt;get_collection_params(),
			),
			&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
		) );

		$schema = $this-&gt;get_item_schema();
		$get_item_args = array(
			&#039;context&#039;  =&gt; $this-&gt;get_context_param( array( &#039;default&#039; =&gt; &#039;view&#039; ) ),
		);
		register_rest_route( $this-&gt;namespace, &#039;/&#039; . $this-&gt;rest_base . &#039;/(?P&lt;id&gt;[\d]+)&#039;, array(
			&#039;args&#039; =&gt; array(
				&#039;id&#039; =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Unique identifier for the object.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;integer&#039;,
				),
			),
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::READABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;get_item&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;get_item_permissions_check&#039; ),
				&#039;args&#039;                =&gt; $get_item_args,
			),
			&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
		) );
    }

    /**
     * Checks whether a given request has permission to read fields.
     *
     * @access public
     *
     * @param WP_REST_Request $request Full details about the request.
     * @return true|WP_Error True if the request has read access, WP_Error object otherwise.
     */
    public function get_items_permissions_check( $request ) {
        if ( ! $this-&gt;show_in_rest()) {
            return new WP_Error( &#039;rest_cannot_view&#039;, __( &#039;Sorry, you are not allowed to view fields.&#039;, &#039;geodirectory&#039; ), array( &#039;status&#039; =&gt; rest_authorization_required_code() ) );
        }
        return true;
    }

    /**
     * Retrieves all public countries.
     *
     * @access public
     *
     * @param WP_REST_Request $request Full details about the request.
     * @return WP_REST_Response Response object on success, or WP_Error object on failure.
     */
    public function get_items( $request ) {

        // Retrieve the list of registered collection query parameters.
        $registered = $this-&gt;get_collection_params();
        
        $args = array();

		/*
		 * This array defines mappings between public API query parameters whose
		 * values are accepted as-passed, and their internal WP_Query parameter
		 * name equivalents (some are the same). Only values which are also
		 * present in $registered will be set.
		 */
		$parameter_mappings = array(
			&#039;name&#039;           =&gt; &#039;htmlvar_name&#039;,
			&#039;post_type&#039;      =&gt; &#039;post_type&#039;,
			&#039;status&#039;         =&gt; &#039;is_active&#039;,
			&#039;post&#039;			 =&gt; &#039;post&#039;,
			&#039;package&#039;	     =&gt; &#039;packages&#039;,
			&#039;default&#039;		 =&gt; &#039;is_default&#039;,
			&#039;access&#039;		 =&gt; &#039;for_admin_use&#039;, // 1 = admin, 0 = public, NULL or all = all
			&#039;location&#039;		 =&gt; &#039;show_in&#039;,
			&#039;order&#039;          =&gt; &#039;order&#039;,
			&#039;orderby&#039;        =&gt; &#039;orderby&#039;,
			&#039;page&#039;           =&gt; &#039;paged&#039;,
			&#039;search&#039;         =&gt; &#039;search&#039;,
			&#039;per_page&#039;		 =&gt; &#039;per_page&#039;,
			&#039;country&#039;		 =&gt; &#039;country&#039;,
			&#039;region&#039;		 =&gt; &#039;region&#039;,
			&#039;city&#039;		     =&gt; &#039;city&#039;,
			&#039;neighbourhood&#039;  =&gt; &#039;neighbourhood&#039;,
		);

		/*
		 * For each known parameter which is both registered and present in the request,
		 * set the parameter&#039;s value on the query $args.
		 */
		foreach ( $parameter_mappings as $api_param =&gt; $wp_param ) {
			if ( isset( $registered[ $api_param ], $request[ $api_param ] ) ) {
				$args[ $wp_param ] = $request[ $api_param ];
			}
		}

	    

		if ( isset( $args[&#039;per_page&#039;] ) ) {
			$args[&#039;per_page&#039;] = absint( $args[&#039;per_page&#039;] );
		} else {
			$args[&#039;per_page&#039;] = $this-&gt;items_per_page();
		}

		if ( isset( $registered[&#039;offset&#039;] ) &amp;&amp; ! empty( $request[&#039;offset&#039;] ) ) {
			$args[&#039;offset&#039;] = $request[&#039;offset&#039;];
		} else {
			$args[&#039;offset&#039;]  = $args[&#039;per_page&#039;] &gt; 0 ? ( $request[&#039;page&#039;] - 1 ) * $args[&#039;per_page&#039;] : ( $request[&#039;page&#039;] - 1 );
		}

		if ( ! empty( $args[&#039;search&#039;] ) ) {
			$args[&#039;search&#039;] = &#039;*&#039; . $args[&#039;search&#039;] . &#039;*&#039;;
		}

		if ( empty( $args[&#039;packages&#039;] ) &amp;&amp; ! empty( $args[&#039;post&#039;] ) &amp;&amp; ( $package_id = geodir_get_post_package_id( $args[&#039;post&#039;], get_post_type( $this-&gt;post_type ) ) ) ) {
			$args[&#039;packages&#039;] = $package_id;
		}

		/**
		 * Filters the query arguments for a request.
		 *
		 * Enables adding extra arguments or setting defaults for a post collection request.
		 *
		 * @since 2.0.0
		 *
		 * @param array           $args    Key value array of query var to query value.
		 * @param WP_REST_Request $request The request used.
		 */
		$args = apply_filters( &quot;geodir_rest_fields_query&quot;, $args, $request );
		$query_args = $this-&gt;prepare_items_query( $args, $request );
		
		$query_args[&#039;count_total&#039;] = true;
		
        $results = $this-&gt;get_fields( $query_args );

        $fields = array();
		if ( ! empty( $results[&#039;results&#039;] ) ) {
			foreach ( $results[&#039;results&#039;] as $row ) {
				if ( ! $this-&gt;check_read_permission( $row ) ) {
					continue;
				}

				$item   = $this-&gt;prepare_item_for_response( $row, $request );
				$fields[] = $this-&gt;prepare_response_for_collection( $item );
			}
		}

        $page = (int) $query_args[&#039;paged&#039;];
		$total_fields = ! empty( $results[&#039;total_rows&#039;] ) ? $results[&#039;total_rows&#039;] : 0;

		$max_pages = $total_fields &gt; 0 ? ( ! empty( $args[&#039;per_page&#039;] ) ? ceil( $total_fields / $args[&#039;per_page&#039;] ) : 1 ) : 0;

		if ( $page &gt; $max_pages &amp;&amp; $total_fields &gt; 0 ) {
			return new WP_Error( &#039;geodir_rest_field_invalid_page_number&#039;, __( &#039;The page number requested is larger than the number of pages available.&#039;, &#039;geodirectory&#039; ), array( &#039;status&#039; =&gt; 400 ) );
		}

		$response  = rest_ensure_response( $fields );

		$response-&gt;header( &#039;X-WP-Total&#039;, (int) $total_fields );
		$response-&gt;header( &#039;X-WP-TotalPages&#039;, (int) $max_pages );

		$request_params = $request-&gt;get_query_params();
		$base = add_query_arg( $request_params, rest_url( sprintf( &#039;%s/%s&#039;, $this-&gt;namespace, $this-&gt;rest_base ) ) );

		if ( $page &gt; 1 ) {
			$prev_page = $page - 1;

			if ( $prev_page &gt; $max_pages ) {
				$prev_page = $max_pages;
			}

			$prev_link = add_query_arg( &#039;page&#039;, $prev_page, $base );
			$response-&gt;link_header( &#039;prev&#039;, $prev_link );
		}
		if ( $max_pages &gt; $page ) {
			$next_page = $page + 1;
			$next_link = add_query_arg( &#039;page&#039;, $next_page, $base );

			$response-&gt;link_header( &#039;next&#039;, $next_link );
		}

		return $response;
    }

	/**
	 * Determines the allowed query_vars for a get_items() response and prepares
	 * them for WP_Query.
	 *
	 * @since 2.0.0
	 *
	 * @param array           $prepared_args Optional. Prepared WP_Query arguments. Default empty array.
	 * @param WP_REST_Request $request       Optional. Full details about the request.
	 * @return array Items query arguments.
	 */
	protected function prepare_items_query( $prepared_args = array(), $request = null ) {
		$query_args = array();

		foreach ( $prepared_args as $key =&gt; $value ) {
			/**
			 * Filters the query_vars used in get_items() for the constructed query.
			 *
			 * The dynamic portion of the hook name, `$key`, refers to the query_var key.
			 *
			 * @since 2.0.0
			 *
			 * @param string $value The query_var value.
			 */
			$query_args[ $key ] = apply_filters( &quot;geodir_rest_field_query_var-{$key}&quot;, $value );
		}

		if ( isset( $query_args[&#039;orderby&#039;] ) &amp;&amp; isset( $request[&#039;orderby&#039;] ) ) {
			$orderby_mappings = $this-&gt;orderby_options();

			if ( isset( $orderby_mappings[ $request[&#039;orderby&#039;] ] ) ) {
				$query_args[&#039;orderby&#039;] = $orderby_mappings[ $request[&#039;orderby&#039;] ];
			}
		}

		return $query_args;
	}

    /**
     * Checks if a given request has access to a field.
     *
     * @access public
     *
     * @param  WP_REST_Request $request Full details about the request.
     * @return true|WP_Error True if the request has read access for the item, otherwise false or WP_Error object.
     */
    public function get_item_permissions_check( $request ) {

        if ( ! $this-&gt;show_in_rest() ) {
            return new WP_Error( &#039;rest_cannot_view&#039;, __( &#039;Sorry, you are not allowed to view countries.&#039;, &#039;geodirectory&#039; ), array( &#039;status&#039; =&gt; rest_authorization_required_code() ) );
        }

        return true;
    }

	/**
	 * Retrieves a single field.
	 *
	 * @since 2.0.0
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function get_item( $request ) {
		$field = $this-&gt;get_field( $request[&#039;id&#039;] );
		if ( is_wp_error( $field ) ) {
			return $field;
		}

		$data     = $this-&gt;prepare_item_for_response( $field, $request );
		$response = rest_ensure_response( $data );

		return $response;
	}

    /**
     * Prepares a field object for serialization.
     *
     * @access public
     *
     * @param stdClass        $field Field data.
     * @param WP_REST_Request $request  Full details about the request.
     * @return WP_REST_Response Response object.
     */
    public function prepare_item_for_response( $field, $request ) {
        $data   = array();
		$schema = $this-&gt;get_item_schema();

		$admin_title = trim( $field-&gt;admin_title );

		if ( ! empty( $schema[&#039;properties&#039;][&#039;id&#039;] ) ) {
			$data[&#039;id&#039;] = $field-&gt;id;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;type&#039;] ) ) {
			$data[&#039;type&#039;] = $field-&gt;post_type;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;name&#039;] ) ) {
			$data[&#039;name&#039;] = $field-&gt;htmlvar_name;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;title&#039;] ) ) {
			$title = trim( $field-&gt;frontend_title );
			if ( empty( $title ) ) {
				$title = $admin_title;
			}

			$data[&#039;title&#039;] = __( $title, &#039;geodirectory&#039; );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;admin_title&#039;] ) ) {
			$data[&#039;admin_title&#039;] = __( $admin_title, &#039;geodirectory&#039; );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;description&#039;] ) ) {
			$description = trim( $field-&gt;frontend_desc );
			$data[&#039;description&#039;] = ! empty( $description ) ? __( $description, &#039;geodirectory&#039; ) : $description;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;data_type&#039;] ) ) {
			$data[&#039;data_type&#039;] = $field-&gt;data_type;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;field_type&#039;] ) ) {
			$data[&#039;field_type&#039;] = $field-&gt;field_type;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;field_type_key&#039;] ) ) {
			$data[&#039;field_type_key&#039;] = $field-&gt;field_type_key;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;decimal_point&#039;] ) ) {
			$data[&#039;decimal_point&#039;] = $field-&gt;data_type == &#039;FLOAT&#039; ? absint( $field-&gt;decimal_point ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;default_value&#039;] ) ) {
			$data[&#039;default_value&#039;] = $field-&gt;default_value;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;placeholder&#039;] ) ) {
			$placeholder = trim( $field-&gt;placeholder_value );
			if ( ! empty( $placeholder ) ) {
				$placeholder = __( $placeholder, &#039;geodirectory&#039; );
			}
			$data[&#039;placeholder&#039;] = $placeholder;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;required&#039;] ) ) {
			$data[&#039;required&#039;] = (bool) $field-&gt;is_required;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;required_msg&#039;] ) ) {
			$data[&#039;required_msg&#039;] = ! empty( $field-&gt;required_msg ) ? __( $field-&gt;required_msg, &#039;geodirectory&#039; ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;validation_pattern&#039;] ) ) {
			$data[&#039;validation_pattern&#039;] = $field-&gt;validation_pattern;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;validation_msg&#039;] ) ) {
			$data[&#039;validation_msg&#039;] = ! empty( $field-&gt;validation_msg ) ? __( $field-&gt;validation_msg, &#039;geodirectory&#039; ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;option_values&#039;] ) ) {
			$data[&#039;option_values&#039;] = ! empty( $field-&gt;option_values ) ? stripslashes_deep( geodir_string_values_to_options( $field-&gt;option_values, true ) ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;location&#039;] ) ) {
			$data[&#039;location&#039;] = ! empty( $field-&gt;show_in ) ? explode( &#039;,&#039;, str_replace( array( &#039;[&#039;, &#039;]&#039; ), &#039;&#039;, $field-&gt;show_in ) ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;order&#039;] ) ) {
			$data[&#039;order&#039;] = absint( $field-&gt;sort_order );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;icon&#039;] ) ) {
			$data[&#039;icon&#039;] = $field-&gt;field_icon;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;class&#039;] ) ) {
			$data[&#039;class&#039;] = $field-&gt;css_class;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;default&#039;] ) ) {
			$data[&#039;default&#039;] = (bool) $field-&gt;is_default;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;private&#039;] ) ) {
			$data[&#039;private&#039;] = (bool) $field-&gt;for_admin_use;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;status&#039;] ) ) {
			$data[&#039;status&#039;] = absint( $field-&gt;is_active );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;packages&#039;] ) ) {
			$data[&#039;packages&#039;] = ! empty( $field-&gt;packages ) ? explode( &#039;,&#039;, $field-&gt;packages ) : &#039;&#039;;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;tab_parent&#039;] ) ) {
			$data[&#039;tab_parent&#039;] = $field-&gt;tab_parent;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;tab_level&#039;] ) ) {
			$data[&#039;tab_level&#039;] = absint( $field-&gt;tab_level );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;sorting&#039;] ) ) {
			$data[&#039;sorting&#039;] = (bool) $field-&gt;cat_sort;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;searching&#039;] ) ) {
			$data[&#039;searching&#039;] = (bool) $field-&gt;cat_filter;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;extra_fields&#039;] ) ) {
			$data[&#039;extra_fields&#039;] = ! empty( $field-&gt;extra_fields ) ? maybe_unserialize( $field-&gt;extra_fields ) : &#039;&#039;;
		}

        $context    = &#039;view&#039;;
        $data       = $this-&gt;add_additional_fields_to_object( $data, $request );
        $data       = $this-&gt;filter_response_by_context( $data, $context );

        // Wrap the data in a response object.
        $response = rest_ensure_response( $data );

        $response-&gt;add_links( $this-&gt;prepare_links( $field ) );

        /**
         * Filters a field returned from the REST API.
         *
         * @param WP_REST_Response $response The response object.
         * @param object           $field  The original field object.
         * @param WP_REST_Request  $request  Request used to generate the response.
         */
        return apply_filters( &#039;geodir_rest_prepare_field&#039;, $response, $field, $request );
    }

	/**
	 * Prepares links for the request.
	 *
	 * @since 2.0.0
	 *
	 * @param object $field Field object.
	 * @return array Links for the given field.
	 */
	protected function prepare_links( $field ) {
		$base = sprintf( &#039;%s/%s&#039;, $this-&gt;namespace, $this-&gt;rest_base );

		// Entity meta.
		$links = array(
            &#039;self&#039;	=&gt; array(
                &#039;href&#039;	=&gt; rest_url( sprintf( &#039;%s/%s/%d&#039;, $this-&gt;namespace, $this-&gt;rest_base, $field-&gt;id ) ),
            ),
            &#039;collection&#039; =&gt; array(
                &#039;href&#039; =&gt; rest_url( sprintf( &#039;%s/%s&#039;, $this-&gt;namespace, $this-&gt;rest_base ) ),
            ),
        );

		return $links;
	}

    /**
     * Retrieves the field&#039;s schema, conforming to JSON Schema.
     *
     * @access public
     *
     * @return array Item schema data.
     */
    public function get_item_schema() {
        $schema = array(
            &#039;$schema&#039;              =&gt; &#039;http://json-schema.org/schema#&#039;,
            &#039;title&#039;                =&gt; $this-&gt;object_type,
            &#039;type&#039;                 =&gt; &#039;object&#039;,
            &#039;properties&#039;           =&gt; array(
                &#039;id&#039;              =&gt; array(
					&#039;description&#039; =&gt; __( &#039;The field id.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;integer&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;type&#039;            =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field post type.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;name&#039;            =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field name. A unique identifier used in the database and HTML, it MUST NOT contain spaces or special characters.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;title&#039;            =&gt; array(
                    &#039;description&#039;  =&gt; __( &#039;Field title.&#039;, &#039;geodirectory&#039; ),
                    &#039;type&#039;         =&gt; &#039;string&#039;,
                    &#039;context&#039;      =&gt; array( &#039;view&#039; ),
                ),
                &#039;admin_title&#039;      =&gt; array(
                    &#039;description&#039;  =&gt; __( &#039;Field title for backend use.&#039;, &#039;geodirectory&#039; ),
                    &#039;type&#039;         =&gt; &#039;string&#039;,
                    &#039;context&#039;      =&gt; array( &#039;view&#039; ),
                ),
				&#039;description&#039;      =&gt; array(
                    &#039;description&#039;  =&gt; __( &#039;Field description displayed on add listing form.&#039;, &#039;geodirectory&#039; ),
                    &#039;type&#039;         =&gt; &#039;string&#039;,
                    &#039;context&#039;      =&gt; array( &#039;view&#039; ),
                ),
                &#039;data_type&#039;       =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field data type. Eg: VARCHAR, TEXT etc&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;field_type&#039;      =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field type. Eg: text, url, select, multiselect, radio, checkbox, etc&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;field_type_key&#039;  =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field type key. Eg: text, url, select, multiselect, radio, checkbox, etc&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;decimal_point&#039;       =&gt; array(
					&#039;description&#039; =&gt; __( &#039;The number of decimal points for float value.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;integer&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;default_value&#039;   =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field default value, usually blank&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;placeholder&#039;     =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field placeholder text.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;required&#039;        =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Is required field?&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;required_msg&#039;    =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Error message for required field.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;validation_pattern&#039;    =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Regex expression for HTML5 pattern validation.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;validation_msg&#039;    =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Validation message to show to the user if validation fails.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;option_values&#039;		  =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Option values for select, multiselect, radio, checkbox.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;location&#039;		  =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field output locations.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;order&#039;           =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field display order.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;integer&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;icon&#039;           =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field icon. Eg: &quot;fas fa-home&quot;&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;class&#039;           =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Custom css class for field custom style.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;default&#039;          =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Is GeoDirectory default field?&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;private&#039;         =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Is admin use only?&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;status&#039;          =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field status.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;integer&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;packages&#039;          =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field packages.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;sorting&#039;         =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Show field in post sorting?&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;searching&#039;       =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Show field in post search?&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
				&#039;extra_fields&#039;       =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field extra setting&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;tab_parent&#039;      =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field parent tab.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;string&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				),
                &#039;tab_level&#039;       =&gt; array(
					&#039;description&#039; =&gt; __( &#039;Field tab level.&#039;, &#039;geodirectory&#039; ),
					&#039;type&#039;        =&gt; &#039;interer&#039;,
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
				)
            ),
        );

		$schema = $this-&gt;add_additional_fields_schema( $schema );

        return apply_filters( &#039;geodir_rest_field_item_schema&#039;, $schema, $this );
    }

    /**
     * Retrieves the query params for collections.
     *
     * @access public
     *
     * @return array Collection parameters.
     */
    public function get_collection_params() {
        $query_params = parent::get_collection_params();

		$query_params[&#039;context&#039;][&#039;default&#039;] = &#039;view&#039;;

		$query_params[&#039;status&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Field status.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;1&#039;,
		);

		$query_params[&#039;name&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter by field key.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;&#039;,
		);

		if ( empty( $this-&gt;post_type ) ) {
			$query_params[&#039;post_type&#039;] = array(
				&#039;description&#039;        =&gt; __( &#039;Filter by post type.&#039;, &#039;geodirectory&#039; ),
				&#039;type&#039;               =&gt; &#039;string&#039;,
				&#039;default&#039;            =&gt; &#039;&#039;,
			);
		}

		$query_params[&#039;post&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter by post.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;integer&#039;,
			&#039;default&#039;            =&gt; &#039;0&#039;,
		);

		$query_params[&#039;package&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter by package.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;integer&#039;,
			&#039;default&#039;            =&gt; &#039;0&#039;,
		);

		$query_params[&#039;default&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter default fields.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;all&#039;,
			&#039;enum&#039;               =&gt; array( &#039;1&#039;, &#039;0&#039;, &#039;all&#039; ),
		);

		$query_params[&#039;access&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter by admin use only fields.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;all&#039;,
			&#039;enum&#039;               =&gt; array( &#039;1&#039;, &#039;0&#039;, &#039;all&#039; ),
		);

		$query_params[&#039;location&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Filter by fields location.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;none&#039;,
			&#039;enum&#039;               =&gt; array( &#039;detail&#039;, &#039;listing&#039;, &#039;mapbubble&#039;, &#039;none&#039; ),
		);

		$query_params[&#039;order&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Order sort attribute ascending or descending.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;asc&#039;,
			&#039;enum&#039;               =&gt; array( &#039;asc&#039;, &#039;desc&#039; ),
		);

		$query_params[&#039;orderby&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Sort collection by object attribute.&#039;, &#039;geodirectory&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;order&#039;,
			&#039;enum&#039;               =&gt; array_keys( $this-&gt;orderby_options() ),
		);

		/**
		 * Filter collection parameters for the fields controller.
		 *
		 * @since 2.0.0
		 *
		 * @param array        $query_params JSON Schema-formatted collection parameters.
		 */
		return apply_filters( &quot;geodir_rest_field_collection_params&quot;, $query_params );
    }

    /**
     * Show in rest.
     *
     * @since 2.0.0
     *
     * @return bool
     */
    public function show_in_rest() {
        return apply_filters( &#039;geodir_rest_fields_show_in_rest&#039;, true, $this );
    }

	/**
     * No. of fields per page.
     *
     * @since 2.0.0
     *
     * @return bool
     */
    public function items_per_page() {
        return (int) apply_filters( &#039;geodir_rest_fields_per_page&#039;, 10, $this );
    }

    /**
     * Get countries.
     *
     * @since 2.0.0
     *
     * @return array $countries.
     */
	public function get_fields( $args ) {
		global $wpdb;

		$query_fields = &#039;*&#039;;
		if ( isset( $args[&#039;count_total&#039;] ) &amp;&amp; $args[&#039;count_total&#039;] ) {
			$query_fields = &#039;SQL_CALC_FOUND_ROWS &#039; . $query_fields;
		}
		$query_from = &quot;FROM &quot; . GEODIR_CUSTOM_FIELDS_TABLE;
		$query_where = &quot;WHERE 1=1&quot;;
		
		// nicename
		if ( ! empty( $args[&#039;htmlvar_name&#039;] ) ) {
			$query_where .= $wpdb-&gt;prepare( &#039; AND htmlvar_name = %s&#039;, $args[&#039;htmlvar_name&#039;] );
		}

		if ( ! empty( $args[&#039;post_type&#039;] ) ) {
			$query_where .= $wpdb-&gt;prepare( &#039; AND post_type = %s&#039;, $args[&#039;post_type&#039;] );
		}

		if ( ! empty( $args[&#039;show_in&#039;] ) &amp;&amp; $args[&#039;show_in&#039;] != &#039;none&#039; ) {
			$query_where .= &quot; AND show_in LIKE &#039;%[&quot; . $args[&#039;show_in&#039;] . &quot;]%&#039;&quot;;
		}

		if ( ! empty( $args[&#039;packages&#039;] ) ) {
			$query_where .= $wpdb-&gt;prepare( &#039; FIND_IN_SET( %d, packages )&#039;, array( $args[&#039;packages&#039;] ) );
		}

		if ( isset( $args[&#039;is_active&#039;] ) &amp;&amp; $args[&#039;is_active&#039;] !== &#039;&#039; ) {
			$query_where .= $wpdb-&gt;prepare( &#039; AND is_active = %d&#039;, (int) $args[&#039;is_active&#039;] );
		}

		if ( isset( $args[&#039;is_default&#039;] ) &amp;&amp; $args[&#039;is_default&#039;] !== &#039;&#039; &amp;&amp; $args[&#039;is_default&#039;] != &#039;all&#039; ) {
			$query_where .= $wpdb-&gt;prepare( &#039; AND is_default = %d&#039;, (int) $args[&#039;is_default&#039;] );
		}

		if ( isset( $args[&#039;for_admin_use&#039;] ) &amp;&amp; $args[&#039;for_admin_use&#039;] !== &#039;&#039; &amp;&amp; $args[&#039;for_admin_use&#039;] !== &#039;all&#039; ) {
			$query_where .= $wpdb-&gt;prepare( &#039; AND for_admin_use = %d&#039;, (int) $args[&#039;for_admin_use&#039;] );
		}

		$orderby_array = array();
		if ( ! empty( $args[&#039;orderby&#039;] ) ) {
			$orderby_array[] = $args[&#039;orderby&#039;] . &#039; &#039; . ( ! empty( $args[&#039;order&#039;] ) &amp;&amp; strtolower( $args[&#039;order&#039;] ) == &#039;asc&#039; ? &#039;ASC&#039; : &#039;DESC&#039; );
		}
		$orderby_array[] = &#039;frontend_title ASC&#039;;
		$query_orderby = &#039;ORDER BY &#039; . implode( &#039;, &#039;, $orderby_array );
		
		// limit
		if ( isset( $args[&#039;per_page&#039;] ) &amp;&amp; $args[&#039;per_page&#039;] &gt; 0 ) {
			if ( $args[&#039;offset&#039;] ) {
				$query_limit = $wpdb-&gt;prepare(&quot;LIMIT %d, %d&quot;, $args[&#039;offset&#039;], $args[&#039;per_page&#039;]);
			} else {
				$query_limit = $wpdb-&gt;prepare( &quot;LIMIT %d, %d&quot;, $args[&#039;per_page&#039;] * ( $args[&#039;paged&#039;] - 1 ), $args[&#039;per_page&#039;] );
			}
		} else {
			$query_limit = &#039;&#039;;
		}

		$search = &#039;&#039;;
		if ( isset( $args[&#039;search&#039;] ) ) {
			$search = trim( $args[&#039;search&#039;] );
		}

		if ( $search ) {
			$leading_wild = ( ltrim($search, &#039;*&#039;) != $search );
			$trailing_wild = ( rtrim($search, &#039;*&#039;) != $search );
			if ( $leading_wild &amp;&amp; $trailing_wild )
				$wild = &#039;both&#039;;
			elseif ( $leading_wild )
				$wild = &#039;leading&#039;;
			elseif ( $trailing_wild )
				$wild = &#039;trailing&#039;;
			else
				$wild = false;
			if ( $wild )
				$search = trim($search, &#039;*&#039;);

			$search_columns = array();
			if ( is_numeric( $search ) ) {
				$search_columns = array( &#039;id&#039; );
			} else {
				$search_columns = array( &#039;id&#039;, &#039;frontend_title&#039;, &#039;htmlvar_name&#039;, &#039;frontend_desc&#039;, &#039;admin_title&#039;, &#039;post_type&#039; );
			}

			$query_where .= $this-&gt;get_search_sql( $search, $search_columns, $wild );
		}

		$sql = &quot;SELECT $query_fields $query_from $query_where $query_orderby $query_limit&quot;;

		$results = $wpdb-&gt;get_results( $sql );
		
		$total_rows = 0;
		if ( isset( $args[&#039;count_total&#039;] ) &amp;&amp; $args[&#039;count_total&#039;] ) {
			$total_rows = (int) $wpdb-&gt;get_var( &#039;SELECT FOUND_ROWS()&#039; );
		}

		return array( &#039;results&#039; =&gt; $results, &#039;total_rows&#039; =&gt; $total_rows );
	}

	protected function get_search_sql( $string, $cols, $wild = false ) {
		global $wpdb;

		$searches = array();
		$leading_wild = ( &#039;leading&#039; == $wild || &#039;both&#039; == $wild ) ? &#039;%&#039; : &#039;&#039;;
		$trailing_wild = ( &#039;trailing&#039; == $wild || &#039;both&#039; == $wild ) ? &#039;%&#039; : &#039;&#039;;
		$like = $leading_wild . $wpdb-&gt;esc_like( $string ) . $trailing_wild;

		foreach ( $cols as $col ) {
			if ( &#039;id&#039; == $col || &#039;htmlvar_name&#039; == $col ) {
				$searches[] = $wpdb-&gt;prepare( &quot;$col = %s&quot;, $string );
			} else {
				$searches[] = $wpdb-&gt;prepare( &quot;$col LIKE %s&quot;, $like );
			}
		}

		return &#039; AND (&#039; . implode(&#039; OR &#039;, $searches) . &#039;)&#039;;
	}

    /**
	 * Get the post, if the ID is valid.
	 *
	 * @since 2.0.0
	 *
	 * @param int $id Supplied ID.
	 * @return object|WP_Error Field object if ID is valid, WP_Error otherwise.
	 */
	protected function get_field( $id ) {
		global $wpdb;

		$error = new WP_Error( &#039;geodir_rest_field_invalid_id&#039;, __( &#039;Invalid field ID.&#039;, &#039;geodirectory&#039; ), array( &#039;status&#039; =&gt; 404 ) );
		if ( (int) $id &lt;= 0 ) {
			return $error;
		}

		$field = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT * FROM &quot; . GEODIR_CUSTOM_FIELDS_TABLE . &quot; WHERE id = %d&quot;, array( $id ) ) );
		if ( empty( $field ) ) {
			return $error;
		}

		return $field;
	}

	/**
	 * Checks if a field can be read.
	 *
	 *
	 * @since 2.0.0
	 *
	 * @param object $field Field object.
	 * @return bool Whether the field can be read.
	 */
	public function check_read_permission( $field ) {
		return true;
	}

	public function orderby_options() {
		return $orderby = array(
			&#039;id&#039;             =&gt; &#039;id&#039;,
			&#039;type&#039;      	 =&gt; &#039;post_type&#039;,
			&#039;title&#039; 		 =&gt; &#039;frontend_title&#039;,
			&#039;name&#039; 			 =&gt; &#039;htmlvar_name&#039;,
			&#039;order&#039;     	 =&gt; &#039;sort_order&#039;,
		);
	}

}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:15 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652336158"></script>
    <script src="../js/search.js?updated=1652336158"></script>
</body>
</html>
