<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337339">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337339">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">map-add-listing.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Display Add Listing Map
 *
 * This template can be overridden by copying it to yourtheme/geodirectory/bootstrap/map/map-add-listing.php.
 *
 * HOWEVER, on occasion GeoDirectory will need to update template files and you
 * (the theme developer) will need to copy the new files to your theme to
 * maintain compatibility. We try to do this as little as possible, but it does
 * happen. When this occurs the version of the template file will be bumped and
 * the readme will list any important changes.
 *
 * @see        https://docs.wpgeodirectory.com/article/346-customizing-templates/
 * @package    GeoDirectory
 * @version    2.2.6
 *
 * @global int $mapzoom Zoom level value for the map.
 * @global bool $geodir_manual_map Check if manual map.
 */

defined( &#039;ABSPATH&#039; ) || exit;

global $mapzoom, $geodir_manual_map, $geodir_label_type;

/**
 * Filter the map restriction for specific address only
 *
 * @since 1.0.0
 *
 * @param bool $var Whether to restrict the map for specific address only.
 */
$is_map_restrict = apply_filters(&#039;geodir_add_listing_map_restrict&#039;, true);

/**
 * Filter the auto change address fields values when moving the map pin
 *
 * @since 1.4.8
 *
 * @param bool $var Whether to change the country, state, city values in fields.
 */
$auto_change_address_fields_pin_move = apply_filters(&#039;geodir_auto_change_address_fields_pin_move&#039;, true);
global $geodirectory;
$default_location = $geodirectory-&gt;location-&gt;get_default_location();
$defaultcity = isset($default_location-&gt;city) ? $default_location-&gt;city : &#039;&#039;;
$lat_lng_blank = false;
if ( (!isset($lat) || $lat == &#039;&#039; ) &amp;&amp; (!isset($lat) || $lng == &#039;&#039;)) {
    $lat_lng_blank = true;
    $city = $defaultcity;
    $region = isset($default_location-&gt;region) ? $default_location-&gt;region : &#039;&#039;;
    $country = isset($default_location-&gt;country) ? $default_location-&gt;country : &#039;&#039;;
    $lng = isset($default_location-&gt;longitude) ? $default_location-&gt;longitude : &#039;&#039;;
    $lat = isset($default_location-&gt;latitude) ? $default_location-&gt;latitude : &#039;&#039;;
}
$default_lng = isset($default_location-&gt;longitude) ? $default_location-&gt;longitude : &#039;&#039;;
$default_lat = isset($default_location-&gt;latitude) ? $default_location-&gt;latitude : &#039;&#039;;
if (is_admin() &amp;&amp; isset($_REQUEST[&#039;tab&#039;]) &amp;&amp; $mapzoom == &#039;&#039;) {
    $mapzoom = 4;
    if (isset($_REQUEST[&#039;add_hood&#039;]))
        $mapzoom = 10;
}

/**
 * Filter the auto change address fields values
 *
 * @since 1.0.0
 *
 * @param bool $var Whether to auto fill country, state, city values in fields.
 */
$auto_change_map_fields = apply_filters(&#039;geodir_auto_change_map_fields&#039;, true);
$marker_icon = GeoDir_Maps::default_marker_icon( true );
$icon_size = GeoDir_Maps::get_marker_size($marker_icon, array(&#039;w&#039; =&gt; 20, &#039;h&#039; =&gt; 34));
?&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    /* &lt;![CDATA[ */
    &lt;?php 
	/**
	 * Fires at the start of the add javascript on the add listings map.
	 *
	 * @since 1.0.0
     * @param string $prefix The prefix for all elements.
	 */
	do_action(&#039;geodir_add_listing_js_start&#039;, $prefix);
	?&gt;
    if ((window.gdSetMap==&#039;google&#039; || window.gdSetMap==&#039;auto&#039;) &amp;&amp; window.google &amp;&amp; typeof google.maps!==&#039;undefined&#039;) {
        gdMaps = &#039;google&#039;;
    } else if ((window.gdSetMap==&#039;osm&#039; || window.gdSetMap==&#039;auto&#039;) &amp;&amp; typeof L!==&#039;undefined&#039; &amp;&amp; typeof L.version!==&#039;undefined&#039;) {
        gdMaps = &#039;osm&#039;;
    } else {
        gdMaps = null;
    }
    window.gdMaps = window.gdMaps || gdMaps;
    
    user_address = false;
    jQuery(&#039;#&lt;?php echo $prefix.&#039;street&#039;;?&gt;&#039;).on(&quot;keypress&quot;,function () {
        user_address = true;
    });

    baseMarker = &#039;&#039;;
    geocoder = &#039;&#039;;
    var &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LAT = &lt;?php echo ( $lat ? geodir_sanitize_float( $lat ) : &#039;39.952484&#039; ); ?&gt;;
    var &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LNG = &lt;?php echo ( $lng ? geodir_sanitize_float( $lng ) : &#039;-75.163786&#039; ); ?&gt;;
    &lt;?php if($lat_lng_blank){$lat=&#039;&#039;;$lng=&#039;&#039;;}?&gt;
    var &lt;?php echo $prefix;?&gt;CITY_MAP_ZOOMING_FACT = &lt;?php echo ($mapzoom) ? absint( $mapzoom ) : 12;?&gt;;
    var minZoomLevel = &lt;?php echo ($is_map_restrict) ? 5 : 0; ?&gt;;
    var mapLang = &#039;&lt;?php echo esc_js( GeoDir_Maps::map_language() ); ?&gt;&#039;;
    var oldstr_address;
    var oldstr_address2;
    var oldstr_zip;
    var strictBounds;
    var doingGeocode = false;
    var postal_town;
    var locality;
    function geocodePosition(latLon, address) {
        console.log(address);
        if (address &amp;&amp; (locality || postal_town) &amp;&amp; address.country!=&#039;TR&#039; &amp;&amp; address.country!=&#039;SG&#039; ) {// turkey select address does not return enough info so we get info from GPS only.
            doGeoCode = address;
        } else {
            doGeoCode = {
                latLng: baseMarker.getPosition()
            };
        }

        geocoder.geocode(doGeoCode, function (responses) {
            geocodeResponse(responses);
        });
    }

    function geocodeResponse(responses) {
        console.log(responses);//keep this for debugging
        if (responses &amp;&amp; responses.length &gt; 0) {
            var getAddress = &#039;&#039;;
            var getAddress2 = &#039;&#039;;
            var getZip = &#039;&#039;;
            var getCity = &#039;&#039;;
            var getState = &#039;&#039;;
            var getCountry = &#039;&#039;;

            getCountryISO = &#039;&#039;;

            formatted_address = &#039;&#039;;
            street_number = &#039;&#039;;
            premise = &#039;&#039;; // In Russian ;
            establishment = &#039;&#039;;
            route = &#039;&#039;;
            administrative_area_level_1 = &#039;&#039;;
            administrative_area_level_2 = &#039;&#039;;
            administrative_area_level_3 = &#039;&#039;;
            sublocality_level_1 = &#039;&#039;;
            postal_town = &#039;&#039;;
            locality = &#039;&#039;;
            country = &#039;&#039;;
            postal_code = &#039;&#039;;
            postal_code_prefix = &#039;&#039;;
            rr = &#039;&#039;;
            has_address_been_set = false;

            // get the proper response as sometimes the GPS results will return names in English when they should not.
            responses.forEach(function(response) {
                if(response.types[0] == &quot;locality&quot;){

                    for (var i = 0; i &lt; response.address_components.length; i++) {
                        var addr = response.address_components[i];
                        if (addr.types[0] == &#039;administrative_area_level_1&#039;) {
                            administrative_area_level_1 = addr;
                        }
                        if (addr.types[0] == &#039;administrative_area_level_2&#039;) {
                            administrative_area_level_2 = addr;
                        }
                        if (addr.types[0] == &#039;administrative_area_level_3&#039;) {
                            administrative_area_level_3 = addr;
                        }
                        if (addr.types[0] == &#039;sublocality_level_1&#039;) {
                            sublocality_level_1 = addr;
                        }
                        if (addr.types[0] == &#039;postal_town&#039;) {
                            postal_town = addr;
                        }
                        if (addr.types[0] == &#039;locality&#039;) {
                            locality = addr;
                        }
                        if (addr.types[0] == &#039;premise&#039;) {
                            premise = addr;alert(4);
                        }
                        if (addr.types[0] == &#039;establishment&#039;) {
                            establishment = addr;alert(5);
                        }
                    }
                }
            });



            
            for (var i = 0; i &lt; responses[0].address_components.length; i++) {
                var addr = responses[0].address_components[i];
                if (addr.types[0] == &#039;street_number&#039;) {
                    street_number = addr;
                }
                if (addr.types[0] == &#039;route&#039;) {
                    route = addr;
                }
                if (addr.types[0] == &#039;premise&#039;) {
                    premise = addr;
                }
                if (administrative_area_level_1 == &#039;&#039; &amp;&amp; addr.types[0] == &#039;administrative_area_level_1&#039;) {
                    administrative_area_level_1 = addr;
                }
                if (administrative_area_level_2 == &#039;&#039; &amp;&amp; addr.types[0] == &#039;administrative_area_level_2&#039;) {
                    administrative_area_level_2 = addr;
                }
                if (administrative_area_level_3 == &#039;&#039; &amp;&amp; addr.types[0] == &#039;administrative_area_level_3&#039;) {
                    administrative_area_level_3 = addr;
                }
                if (sublocality_level_1 == &#039;&#039; &amp;&amp; addr.types[0] == &#039;sublocality_level_1&#039;) {
                    sublocality_level_1 = addr;
                }
                if (postal_town == &#039;&#039; &amp;&amp; addr.types[0] == &#039;postal_town&#039;) {
                    postal_town = addr;
                }
                if (locality == &#039;&#039; &amp;&amp; addr.types[0] == &#039;locality&#039;) {
                    locality = addr;
                }
                if (addr.types[0] == &#039;country&#039;) {
                    country = addr;
                }
                if (addr.types[0] == &#039;postal_code&#039;) {
                    postal_code = addr;
                }
                if (addr.types[0] == &#039;postal_code_prefix&#039;) {
                    postal_code_prefix = addr;
                }

                if (addr.types[0] == &#039;establishment&#039;) {
                    establishment = addr;
                }

                if (postal_code == &#039;&#039;) {
                    postal_code = postal_code_prefix;
                }
                if (responses[0].formatted_address != &#039;&#039;) {
                    if (formatted_address == &#039;&#039;) {
                        formatted_address = responses[0].formatted_address;
                    }
                    address_array = responses[0].formatted_address.split(&quot;,&quot;, 2);
                    
                    if (address_array.length &gt; 1) {
                        if (!(typeof(street_number.long_name) == &#039;undefined&#039; || street_number.long_name == null) &amp;&amp; street_number.long_name.toLowerCase() == address_array[0].toLowerCase().trim()) {
                            getAddress = street_number.long_name + &#039;, &#039; + address_array[1];
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(street_number.long_name) == &#039;undefined&#039; || street_number.long_name == null) &amp;&amp; street_number.long_name.toLowerCase() == address_array[1].toLowerCase().trim()) {
                            getAddress = address_array[0] + &#039;, &#039; + street_number.long_name;
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(street_number.short_name) == &#039;undefined&#039; || street_number.short_name == null) &amp;&amp; street_number.short_name.toLowerCase() == address_array[0].toLowerCase().trim()) {
                            getAddress = street_number.short_name + &#039;, &#039; + address_array[1];
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(street_number.short_name) == &#039;undefined&#039; || street_number.short_name == null) &amp;&amp; street_number.short_name.toLowerCase() == address_array[1].toLowerCase().trim()) {
                            getAddress = address_array[0] + &#039;, &#039; + street_number.short_name;
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(premise.long_name) == &#039;undefined&#039; || premise.long_name == null) &amp;&amp; premise.long_name.toLowerCase() == address_array[0].toLowerCase().trim()) {
                            getAddress = premise.long_name + &#039;, &#039; + address_array[1];
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(premise.long_name) == &#039;undefined&#039; || premise.long_name == null) &amp;&amp; premise.long_name.toLowerCase() == address_array[1].toLowerCase().trim()) {
                            getAddress = address_array[0] + &#039;, &#039; + premise.long_name;
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(premise.short_name) == &#039;undefined&#039; || premise.short_name == null) &amp;&amp; premise.short_name.toLowerCase() == address_array[0].toLowerCase().trim()) {
                            getAddress = premise.short_name + &#039;, &#039; + address_array[1];
                        }

                        if (getAddress == &#039;&#039; &amp;&amp; !(typeof(premise.short_name) == &#039;undefined&#039; || premise.short_name == null) &amp;&amp; premise.short_name.toLowerCase() == address_array[1].toLowerCase().trim()) {
                            getAddress = address_array[0] + &#039;, &#039; + premise.short_name;
                        }

                        if (getAddress == &#039;&#039;) {
                            getAddress = &#039;none&#039;
                        }
                    }
                }
            }

            // if establishment then grab second arr
            if (getAddress == &#039;none&#039; &amp;&amp; typeof(establishment.long_name) !== &#039;undefined&#039; &amp;&amp; typeof(address_array[1]) !== &#039;undefined&#039;) {
                getAddress = address_array[1];
                getAddress2 = address_array[0];
            } else if(getAddress == &#039;none&#039; ) {/* added to fix street number for RU locations */
                getAddress = address_array[0];
            }

            // address2
            if(premise.long_name &amp;&amp; premise.long_name != getAddress){
                getAddress2 = premise.long_name;
            }

            if (getAddress == &#039;&#039;) {
                if (street_number.long_name)
                    getAddress += street_number.long_name + &#039; &#039;;//street_number
                if (route.long_name)
                    getAddress += route.long_name;//route
            }

            getZip = postal_code.long_name;//postal_code

            //getCountry
            if (country.long_name) {
                getCountry = country.long_name;
            }
            if (country.short_name) {
                getCountryISO = country.short_name;
            }

            //getState
            if (country.short_name) {
                rr = country.short_name;
            }
            //$country_arr = [&quot;US&quot;, &quot;CA&quot;, &quot;IN&quot;,&quot;DE&quot;,&quot;NL&quot;];
            // fix for regions in GB

            $country_arr = &lt;?php
            /**
             * Filter the regions array that uses administrative_area_level_2 instead of administrative_area_level_1.
             *
             * @since 1.6.16
             */
            echo apply_filters(&quot;geodir_geocode_region_level&quot;,&#039;[&quot;GB&quot;,&quot;ES&quot;]&#039;);?&gt;;
            if (jQuery.inArray(rr, $country_arr) !== -1) {
                if (administrative_area_level_2.long_name) {
                    getState = administrative_area_level_2.long_name;
                }
                else if (administrative_area_level_1.long_name) {
                    getState = administrative_area_level_1.long_name;
                }

                // fix some GB regions
                if( rr == &quot;GB&quot; ){
                    if(getState &amp;&amp; getState == &quot;Stoke-on-Trent&quot; ){
                        getState = &#039;Staffordshire&#039;;
                    }
                }

            } else {
                if (administrative_area_level_1.long_name) {
                    getState = administrative_area_level_1.long_name;
                }
                else if (administrative_area_level_2.long_name) {
                    getState = administrative_area_level_2.long_name;
                }
            }

            /* Fix some countries without regions, Isle of Man, Singapore, Greece. */
            if (getCountryISO==&#039;IM&#039;){
                getState = &quot;Isle of Man&quot;;
            }else if(getCountryISO==&#039;SG&#039;){
                getState = &quot;Singapore&quot;;
            } else if(getCountryISO == &#039;GR&#039; &amp;&amp; !getState &amp;&amp; administrative_area_level_3.long_name) {
                getState = administrative_area_level_3.long_name;
            }

            //getCity
            // fix for cities in Ireland
            $country_arr2 = [&quot;IE&quot;];
            if (jQuery.inArray(rr, $country_arr2) !== -1) {
                if (administrative_area_level_2.long_name &amp;&amp; administrative_area_level_2.long_name.indexOf(&quot; City&quot;) &gt;= 0) {
                    getCity = administrative_area_level_2.long_name;
                }
                else if (locality.long_name) {
                    getCity = locality.long_name;
                }
                else if (postal_town.long_name) {
                    getCity = postal_town.long_name;
                }
                else if (sublocality_level_1.long_name) {
                    getCity = sublocality_level_1.long_name;
                }
                else if (administrative_area_level_3.long_name) {
                    getCity = administrative_area_level_3.long_name;
                }
            } else if(rr==&quot;TR&quot;) {
                if (locality.long_name) {
                    getCity = locality.long_name;
                }else if (postal_town.long_name) {
                    getCity = postal_town.long_name;
                }
                else if (sublocality_level_1.long_name) {
                    getCity = sublocality_level_1.long_name;
                }
                else if (administrative_area_level_3.long_name) {
                    getCity = administrative_area_level_3.long_name;
                }
                else if (administrative_area_level_1.long_name) {
                    getCity = administrative_area_level_1.long_name;
                }
            }else if(rr==&quot;FR&quot;) {

                if (administrative_area_level_2.long_name==&#039;Paris&#039;) {
                    getCity = administrative_area_level_2.long_name;
                }else{
                    if (locality.long_name) {
                        getCity = locality.long_name;
                    }else if (postal_town.long_name) {
                        getCity = postal_town.long_name;
                    }
                    else if (sublocality_level_1.long_name) {
                        getCity = sublocality_level_1.long_name;
                    }
                    else if (administrative_area_level_3.long_name) {
                        getCity = administrative_area_level_3.long_name;
                    }
                    else if (administrative_area_level_1.long_name) {
                        getCity = administrative_area_level_1.long_name;
                    }
                }
            }else {
                if (locality.long_name) {
                    getCity = locality.long_name;
                }else if (postal_town.long_name) {
                    getCity = postal_town.long_name;
                }
                else if (sublocality_level_1.long_name) {
                    getCity = sublocality_level_1.long_name;
                }
                else if (administrative_area_level_3.long_name) {
                    getCity = administrative_area_level_3.long_name;
                }
            }

            //getCountry 
            if (country.long_name) {
                getCountry = country.long_name;
            }
            //getZip 
            if (postal_code.long_name) {
                getZip = postal_code.long_name;
            }

            // Adjust Japanese street address.
            if (getCountryISO == &#039;JP&#039; &amp;&amp; formatted_address != &#039;&#039; &amp;&amp; !getAddress &amp;&amp; mapLang == &#039;ja&#039;) {
                formatted_address = formatted_address.replace(getCountry + &quot;、&quot;, &quot;&quot;);
                if (getZip) {
                    formatted_address = formatted_address.replace(getCountry + &quot; 〒&quot; + getZip, &quot;〒&quot; + getZip);
                    formatted_address = formatted_address.replace(&quot;〒&quot; + getZip + &quot; &quot;, &quot;&quot;);
                }
                _formatted_address = &#039;&#039;;
                if (getCity &amp;&amp; formatted_address.indexOf(getCity) !== -1) {
                    _formatted_address = formatted_address.split(getCity);
                    
                } else if (getState &amp;&amp; formatted_address.indexOf(getState) !== -1) {
                    _formatted_address = formatted_address.split(getState);
                }
                getAddress = _formatted_address.length &gt; 1 ? _formatted_address[((_formatted_address.length)-1)] : formatted_address;
            }
            console.log(getAddress+&#039;, &#039;+getCity+&#039;, &#039;+getState+&#039;, &#039;+getCountry);
            &lt;?php 
            /**
             * Fires to add javascript variable to use in google map.
             *
             * @since 1.0.0
             */
            do_action(&#039;geodir_add_listing_geocode_js_vars&#039;);
            ?&gt;
            &lt;?php if ($is_map_restrict) { ?&gt;
            if (getCity.toLowerCase() != &#039;&lt;?php echo geodir_strtolower(addslashes_gpc($city));?&gt;&#039;) {
                alert(&#039;&lt;?php echo addslashes_gpc(wp_sprintf(__(&#039;Please choose any address of the (%s) city only.&#039;,&#039;geodirectory&#039;), $city));?&gt;&#039;);
                jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
                jQuery.goMap.map.setCenter(new google.maps.LatLng(&#039;&lt;?php echo $default_lat; ?&gt;&#039;, &#039;&lt;?php echo $default_lng; ?&gt;&#039;));
                baseMarker.setPosition(new google.maps.LatLng(&#039;&lt;?php echo $default_lat; ?&gt;&#039;, &#039;&lt;?php echo $default_lng; ?&gt;&#039;));
                updateMarkerPosition(baseMarker.getPosition());
                //geocodePosition(baseMarker.getPosition());
                setTimeout(function(){jQuery(&#039;#address_street,#address_zip&#039;).val(&#039;&#039;);}, 100);
            }
            &lt;?php } ?&gt;
            updateMarkerAddress(getAddress, getZip, getCity, getState, getCountry, getAddress2);
        } else {
            &lt;?php 
            /**
             * Fires to add javascript variable to use in google map.
             *
             * @since 1.0.0
             */
            do_action( &#039;geodir_add_listing_geocode_response_fail&#039; );
            ?&gt;
			updateMarkerAddress(&#039;&lt;?php echo addslashes_gpc(__(&#039;Cannot determine address at this location.&#039;,&#039;geodirectory&#039;));?&gt;&#039;);
        }
    }
    function centerMap(latlng) {
        jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
        if (window.gdMaps == &#039;google&#039;) {
            jQuery.goMap.map.panTo(baseMarker.getPosition());
        } else if (window.gdMaps == &#039;osm&#039;) {
            latlng = latlng ? latlng : baseMarker.getLatLng();
            jQuery.goMap.map.panTo(latlng);
        }
    }
    function centerMarker() {
        jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
        var center = jQuery.goMap.map.getCenter();
        if (window.gdMaps == &#039;google&#039;) {
            baseMarker.setPosition(center);
        } else if (window.gdMaps == &#039;osm&#039;) {
            baseMarker.setLatLng(center);
        }
    }
    function updateMapZoom(zoom) {
        jQuery(&#039;#&lt;?php echo $prefix.&#039;mapzoom&#039;;?&gt;&#039;).val(zoom);
    }
    function updateMarkerPosition(markerlatLng) {
        jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
        jQuery(&#039;#&lt;?php echo $prefix.&#039;latitude&#039;;?&gt;&#039;).val(markerlatLng.lat()).trigger(&#039;change&#039;);
        jQuery(&#039;#&lt;?php echo $prefix.&#039;longitude&#039;;?&gt;&#039;).val(markerlatLng.lng()).trigger(&#039;change&#039;);
    }
    function updateMarkerPositionOSM(markerlatLng) {
        jQuery(&#039;#&lt;?php echo $prefix.&#039;latitude&#039;;?&gt;&#039;).val(markerlatLng.lat).trigger(&#039;change&#039;);
        jQuery(&#039;#&lt;?php echo $prefix.&#039;longitude&#039;;?&gt;&#039;).val(markerlatLng.lng).trigger(&#039;change&#039;);
    }
    function updateMarkerAddress(getAddress, getZip, getCity, getState, getCountry, getAddress2) {
        var set_map_val_in_fields = &#039;&lt;?php echo addslashes_gpc($auto_change_map_fields);?&gt;&#039;;
        &lt;?php ob_start();?&gt;
        var old_country = jQuery(&quot;#&lt;?php echo $prefix.&#039;country&#039;;?&gt;&quot;).val();
        var old_region = jQuery(&quot;#&lt;?php echo $prefix.&#039;region&#039;;?&gt;&quot;).val();
        var old_city = jQuery(&quot;#&lt;?php echo $prefix.&#039;city&#039;;?&gt;&quot;).val();
        var old_zip = jQuery(&quot;#&lt;?php echo $prefix.&#039;zip&#039;;?&gt;&quot;).val();

        if (user_address == false || jQuery(&#039;#&lt;?php echo $prefix.&#039;street&#039;;?&gt;&#039;).val() == &#039;&#039;) {
            jQuery(&quot;#&lt;?php echo $prefix.&#039;street&#039;;?&gt;&quot;).val(getAddress).trigger(&quot;blur&quot;);
        }
        if (getAddress) {
            oldstr_address = getAddress;
        }
        if (getAddress2 &amp;&amp; (user_address == false || jQuery(&#039;#&lt;?php echo $prefix.&#039;street2&#039;;?&gt;&#039;).val() == &#039;&#039;)) {
            jQuery(&quot;#&lt;?php echo $prefix.&#039;street2&#039;;?&gt;&quot;).val(getAddress2);
        }
        if (getAddress2) {
            oldstr_address2 = getAddress2;
        }

        var updateZip = true;
        if (!getZip &amp;&amp; old_zip &amp;&amp; old_city &amp;&amp; old_city == getCity) {
            updateZip = false;
        }
        if (updateZip) {
            jQuery(&quot;#&lt;?php echo $prefix.&#039;zip&#039;;?&gt;&quot;).val(getZip);
        }
        if (getZip) {
            oldstr_zip = getZip;
        }
        if (set_map_val_in_fields) {
            if (getCountry) {
               setCountry = jQuery(&#039;#&lt;?php echo $prefix . &#039;country&#039;; ?&gt; option[data-country_code=&quot;&#039; + getCountryISO + &#039;&quot;]&#039;).val();
               if (!setCountry) {
                   setCountry = getCountry;
               } else {
                   getCountry = setCountry;
               }
               jQuery(&quot;#&lt;?php echo $prefix . &#039;country&#039;; ?&gt;&quot;).val(setCountry).trigger(&#039;change.select2&#039;);
            }
            if (getState) {
                if (jQuery(&quot;input#&lt;?php echo $prefix . &#039;region&#039;; ?&gt;&quot;).length) {
                    jQuery(&quot;#&lt;?php echo $prefix . &#039;region&#039;; ?&gt;&quot;).val(getState);
                }
            }
            if (getCity) {
                if (jQuery(&quot;input#&lt;?php echo $prefix . &#039;city&#039;; ?&gt;&quot;).length) {
                    jQuery(&quot;#&lt;?php echo $prefix . &#039;city&#039;; ?&gt;&quot;).val(getCity);
                }
            }
        }
        &lt;?php
        /**
         * Fires when marker address updated on map.
         *
         * @since 1.0.0
         * @param string $prefix Identifier used as a prefix for field name
         */
        do_action(&#039;geodir_update_marker_address&#039;, $prefix);
        echo $updateMarkerAddress = ob_get_clean();
        ?&gt;
    }
    function geodir_codeAddress(set_on_map) {
        var address = jQuery(&#039;#&lt;?php echo $prefix.&#039;street&#039;;?&gt;&#039;).val();
        var zip = jQuery(&#039;#&lt;?php echo $prefix.&#039;zip&#039;;?&gt;&#039;).val();
        var city = jQuery(&#039;#&lt;?php echo $prefix.&#039;city&#039;;?&gt;&#039;).val();
        var region = jQuery(&#039;#&lt;?php echo $prefix.&#039;region&#039;;?&gt;&#039;).val();
        var country = jQuery(&#039;#&lt;?php echo $prefix.&#039;country&#039;;?&gt;&#039;).val();
        var country_selected = jQuery(&#039;#&lt;?php echo $prefix.&#039;country&#039;;?&gt;&#039;).find(&#039;option:selected&#039;);
        var ISO2 = country_selected.data(&#039;country_code&#039;);
        if (!ISO2 &amp;&amp; jQuery(&#039;#&lt;?php echo $prefix.&#039;country&#039;;?&gt;&#039;).data(&#039;country_code&#039;)) {
            ISO2 = jQuery(&#039;#&lt;?php echo $prefix.&#039;country&#039;;?&gt;&#039;).data(&#039;country_code&#039;);
        }
        if(!ISO2){
            &lt;?php
            if(!defined(&#039;GEODIRLOCATION_TEXTDOMAIN&#039;)){
                global $wpdb;
                $location_result = $geodirectory-&gt;location-&gt;get_default_location();
                if(!empty($location_result)){
                    $ISO2 = wp_country_database()-&gt;get_country_iso2($location_result-&gt;country);
                    echo &quot;ISO2 = &#039;$ISO2&#039;;&quot;;
                }
            }


            ?&gt;
        }
        if (ISO2 == &#039;--&#039;) {
            ISO2 = &#039;&#039;;
        }
        
        if (typeof zip == &quot;undefined&quot;) {
            zip = &#039;&#039;;
        }
        if (typeof city == &quot;undefined&quot;) {
            city = &#039;&lt;?php echo addslashes_gpc($city);?&gt;&#039;;
        }
        if (typeof region == &quot;undefined&quot;) {
            region = &#039;&lt;?php echo addslashes_gpc($region);?&gt;&#039;;
        }
        if (typeof country == &quot;undefined&quot;) {
            country = &#039;&lt;?php echo addslashes_gpc($country);?&gt;&#039;;
        }
        var is_restrict = &#039;&lt;?php echo $is_map_restrict; ?&gt;&#039;;
        &lt;?php ob_start();
        $defaultregion = isset($default_location-&gt;region) ? $default_location-&gt;region : &#039;&#039;;
        $defaultcountry = isset($default_location-&gt;country) ? $default_location-&gt;country : &#039;&#039;;
        ?&gt;
        if (set_on_map &amp;&amp; is_restrict) {
            if (zip != &#039;&#039; &amp;&amp; address != &#039;&#039;) {
                address = address + &#039;,&#039; + zip;
            }
        } else {
            if (typeof address === &#039;undefined&#039;)
                address = &#039;&#039;;

            if( address == city || address == region || address == country || address == zip )
                address = &#039;&#039;;
            &lt;?php
            if(is_admin() &amp;&amp; isset($_REQUEST[&#039;tab&#039;])){?&gt;
            if (jQuery.trim(city) == &#039;&#039; || jQuery.trim(region) == &#039;&#039;) {
                address = &#039;&#039;;
            }
            &lt;?php
               }?&gt;

            if (ISO2 == &#039;GB&#039;) {
                address = address + &#039;,&#039; + city + &#039;,&#039; + country; // UK is funny with regions
            } else {
                address = address + &#039;,&#039; + city + &#039;,&#039; + region + &#039;,&#039; + country;
            }

            if(zip!=&#039;&#039;){
                address = address + &#039;,&#039; + zip;
            }

            // incase there are any null values
            address =  address.replace(&quot;,null,&quot;, &quot;,&quot;);
        }
        if (address) {
            address =  address.replace(&quot;,null,&quot;, &quot;,&quot;);
        }
        &lt;?php $codeAddress = ob_get_clean();
        /**
         * Filter the address variable
         *
         * @since 1.0.0
         *
         * @param string $codeAddress Row of address to use in google map.
         */
        echo apply_filters(&#039;geodir_codeaddress&#039;, $codeAddress);
        ?&gt;
        if (!window.gdMaps) { // No Google Map Loaded
            return;
        }
        if (address &amp;&amp; address != &#039;&#039;) {
            // Replace one or more commas in a row.
            address = address.replace(/,+/g,&#039;,&#039;);
            address = address.replace(/(^,)|(,$)/g, &quot;&quot;);
        }
        if ( window.gdMaps == &#039;osm&#039; ) {
            if (address != &#039;&#039;) {
                if (zip != &#039;&#039;) {
                    searchZip = &quot;,&quot; + zip;
                    var nAddress = address.toLowerCase().lastIndexOf(searchZip.toLowerCase());
                    address = address.slice(0, nAddress) + address.slice(nAddress).replace(new RegExp(searchZip, &#039;i&#039;), &quot;&quot;);
                }
				&lt;?php 
				/**
				 * Fires before set geocode position.
				 *
				 * @since 1.0.0
				 */
				do_action(&#039;geodir_add_listing_codeaddress_before_geocode&#039;);
				?&gt;
                geocodePositionOSM(&#039;&#039;, address, ISO2, true);
            }
        } else {
            geocoder.geocode({&#039;address&#039;: address, &#039;country&#039;: ISO2},
                function (results, status) {
                    console.log(status);
                    jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
                    if (status == google.maps.GeocoderStatus.OK) {
                        console.log(results[0]);
                        baseMarker.setPosition(results[0].geometry.location);
                        jQuery.goMap.map.setCenter(results[0].geometry.location);
                        updateMarkerPosition(baseMarker.getPosition());
                        //if(set_on_map &amp;&amp; is_restrict) {
                        &lt;?php 
                        /**
                         * Fires before set geocode position.
                         *
                         * @since 1.0.0
                         */
                        do_action(&#039;geodir_add_listing_codeaddress_before_geocode&#039;);
                        ?&gt;
                        geocodePosition(baseMarker.getPosition(), {&#039;address&#039;: address, &#039;country&#039;: ISO2});
                        //}
                    } else {
                        alert(&#039;&lt;?php echo addslashes_gpc(__(&#039;Geocode was not successful for the following reason:&#039;,&#039;geodirectory&#039;));?&gt; &#039; + status);
                    }
                });
        }
    }

    function gd_get_street2($response){
        var $street2 = &#039;&#039;;

        if($response.address.building){
            $street2 = $response.address.building;
        }else if($response.address.department_store){
            $street2 = $response.address.department_store;
        }else if($response.address.hotel){
            $street2 = $response.address.hotel;
        }

        return $street2;
    }
    
    function geocodeResponseOSM(response, updateMap) {
        console.log(response);
        if (response.display_address) {
            var getAddress = response.display_address;
            var getAddress2 = gd_get_street2(response);
            var getZip = response.postcode;
            var getCity = response.city;
            var getState = response.state;
            var getCountry = response.country;
            getCountryISO = response.country_code;
            
            if (updateMap &amp;&amp; response.lat &amp;&amp; response.lon) {
                var newLatLng = new L.latLng(response.lat, response.lon);
                baseMarker.setLatLng(newLatLng);
                centerMap(newLatLng);
                updateMarkerPositionOSM(baseMarker.getLatLng());
            }
            &lt;?php 
            /**
             * Fires to add javascript variable to use in google map.
             *
             * @since 1.0.0
             */
            do_action(&#039;geodir_add_listing_geocode_js_vars&#039;);
            ?&gt;
            &lt;?php if ($is_map_restrict) { ?&gt;
            if (getCity.toLowerCase() != &#039;&lt;?php echo geodir_strtolower(addslashes_gpc($city));?&gt;&#039;) {
                alert(&#039;&lt;?php echo addslashes_gpc(wp_sprintf(__(&#039;Please choose any address of the (%s) city only.&#039;,&#039;geodirectory&#039;), $city));?&gt;&#039;);
                jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
                centerMap(new L.latLng(&#039;&lt;?php echo $default_lat; ?&gt;&#039;, &#039;&lt;?php echo $default_lng; ?&gt;&#039;));
                baseMarker.setLatLng(new L.latLng(&#039;&lt;?php echo $default_lat; ?&gt;&#039;, &#039;&lt;?php echo $default_lng; ?&gt;&#039;));
                updateMarkerPositionOSM(baseMarker.getLatLng());
                geocodePositionOSM(baseMarker.getLatLng());
            }
            &lt;?php } ?&gt;
            updateMarkerAddress(getAddress, getZip, getCity, getState, getCountry,getAddress2);
        } else {
            &lt;?php 
            /**
             * Fires to add javascript variable to use in google map.
             *
             * @since 1.0.0
             */
            do_action( &#039;geodir_add_listing_geocode_response_fail&#039; );
            ?&gt;
			alert(&#039;&lt;?php echo addslashes_gpc(__(&#039;Cannot determine address at this location.&#039;,&#039;geodirectory&#039;));?&gt;&#039;);
        }
    }

    &lt;?php $geodir_map_name = GeoDir_Maps::active_map();
    if($geodir_map_name!=&#039;none&#039;){ ?&gt;
    jQuery(function ($) {
		&lt;?php if ( geodir_lazy_load_map() ) { ?&gt;
		jQuery(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).geodirLoadMap({
		loadJS: true,
		forceLoad: &lt;?php echo ( isset( $geodir_manual_map ) &amp;&amp; $geodir_manual_map ? &#039;true&#039; : &#039;false&#039; ); ?&gt;,
		callback: function() {&lt;?php } ?&gt;
        var $addressMap = $(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap({
            latitude: &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LAT,
            longitude: &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LNG,
            zoom: &lt;?php echo $prefix;?&gt;CITY_MAP_ZOOMING_FACT,
            maptype: &#039;ROADMAP&#039;, // Map type - HYBRID, ROADMAP, SATELLITE, TERRAIN
            streetViewControl: true,
            &lt;?php if(geodir_get_option(&#039;geodir_add_listing_mouse_scroll&#039;)) { echo &#039;scrollwheel: false,&#039;;}?&gt;
			&lt;?php do_action( &#039;geodir_template_render_map_js_params&#039; ); ?&gt;
        });

        if (window.gdMaps) {
            geocoder = window.gdMaps == &#039;google&#039; ? new google.maps.Geocoder() : [];

            baseMarker = $.goMap.createMarker({
                latitude: &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LAT,
                longitude: &lt;?php echo $prefix;?&gt;CITY_MAP_CENTER_LNG,
                id: &#039;baseMarker&#039;,
                icon: &#039;&lt;?php echo $marker_icon;?&gt;&#039;,
                draggable: true,
                addToMap: true, // For OSM
                w: parseFloat(&#039;&lt;?php echo $icon_size[&#039;w&#039;];?&gt;&#039;),
                h: parseFloat(&#039;&lt;?php echo $icon_size[&#039;h&#039;];?&gt;&#039;),
            });
            jQuery(&#039;#&lt;?php echo $prefix.&#039;map_loading_div&#039;;?&gt;&#039;).hide();

        } else {
            jQuery(&#039;#&lt;?php echo $prefix.&#039;map_nofound&#039;;?&gt;&#039;).hide();
            jQuery(&#039;#&lt;?php echo $prefix.&#039;map_notloaded&#039;;?&gt;&#039;).show();
        }
        
        $(&quot;#&lt;?php echo $prefix;?&gt;set_address_button&quot;).on(&quot;click&quot;,function () {
            var set_on_map = true;
            geodir_codeAddress(set_on_map);
        });
        
        if (window.gdMaps == &#039;google&#039;) {
            // Add dragging event listeners.
            google.maps.event.addListener(baseMarker, &#039;dragstart&#039;, function () {
            //updateMarkerAddress(&#039;Dragging...&#039;);
            });
            google.maps.event.addListener(baseMarker, &#039;drag&#039;, function () {
                // updateMarkerStatus(&#039;Dragging...&#039;);
                updateMarkerPosition(baseMarker.getPosition());
            });
            google.maps.event.addListener(baseMarker, &#039;dragend&#039;, function () {
                // updateMarkerStatus(&#039;Drag ended&#039;);
                centerMap();
                &lt;?php if ($auto_change_address_fields_pin_move) { ?&gt;
                geocodePosition(baseMarker.getPosition());
                &lt;?php } ?&gt;
                updateMarkerPosition(baseMarker.getPosition());
            });
            google.maps.event.addListener($.goMap.map, &#039;dragend&#039;, function () {
                // updateMarkerStatus(&#039;Drag ended&#039;);
                centerMarker();
                &lt;?php if ($auto_change_address_fields_pin_move) { ?&gt;
                geocodePosition(baseMarker.getPosition());
                &lt;?php } ?&gt;

                updateMarkerPosition(baseMarker.getPosition());
            });
            google.maps.event.addListener($.goMap.map, &#039;zoom_changed&#039;, function () {
				if (typeof $.goMap.map === &#039;undefined&#039;) {
					$.goMap.map = $addressMap;
				}
                updateMapZoom($.goMap.map.zoom);
            });

            //var maxMap = document.getElementById(&#039;&lt;?php echo $prefix;?&gt;triggermap&#039;);
            //google.maps.event.addDomListener(maxMap, &#039;click&#039;, gdMaxMap);

            &lt;?php if ($is_map_restrict) { ?&gt;
            var CITY_ADDRESS = &#039;&lt;?php echo addslashes_gpc($city).&#039;,&#039;.addslashes_gpc($region).&#039;,&#039;.addslashes_gpc($country);?&gt;&#039;;
            geocoder.geocode({&#039;address&#039;: CITY_ADDRESS},
                function (results, status) {
                    $(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
                    if (status == google.maps.GeocoderStatus.OK) {
                        // Bounds for North America
                        var bound_lat_lng = String(results[0].geometry.bounds);
                        bound_lat_lng = bound_lat_lng.replace(/[()]/g, &quot;&quot;);
                        bound_lat_lng = bound_lat_lng.split(&#039;,&#039;);
                        strictBounds = new google.maps.LatLngBounds(
                            new google.maps.LatLng(bound_lat_lng[0], bound_lat_lng[1]),
                            new google.maps.LatLng(bound_lat_lng[2], bound_lat_lng[3])
                        );
                    } else {
                        alert(&quot;&lt;?php _e(&#039;Geocode was not successful for the following reason:&#039;,&#039;geodirectory&#039;);?&gt; &quot; + status);
                    }
                });
            &lt;?php } ?&gt;
            // Limit the zoom level
            google.maps.event.addListener($.goMap.map, &#039;zoom_changed&#039;, function () {
                $(&quot;#&lt;?php echo $prefix.&#039;map&#039;;?&gt;&quot;).goMap();
                if ($.goMap.map.getZoom() &lt; minZoomLevel) $.goMap.map.setZoom(minZoomLevel);
            });
        } else if (window.gdMaps == &#039;osm&#039;) {
            // Add dragging event listeners.
            baseMarker.on(&#039;drag&#039;, function(e) {
                updateMarkerPositionOSM(baseMarker.getLatLng());
            });
            baseMarker.on(&#039;dragend&#039;, function(e) {
                centerMap();
                &lt;?php if ($auto_change_address_fields_pin_move) { ?&gt;
                geocodePositionOSM(baseMarker.getLatLng());
                &lt;?php } ?&gt;
                updateMarkerPositionOSM(baseMarker.getLatLng());
            });
            $.goMap.map.on(&#039;dragend&#039;, function(e) {
                &lt;?php if ($auto_change_address_fields_pin_move) { ?&gt;
                geocodePositionOSM(baseMarker.getLatLng());
                &lt;?php } ?&gt;
                centerMarker();
                updateMarkerPositionOSM(baseMarker.getLatLng());
            });
            $.goMap.map.on(&#039;zoom&#039;, function(e) {
				if (typeof $.goMap.map === &#039;undefined&#039;) {
					$.goMap.map = $addressMap;
				}
                updateMapZoom($.goMap.map.getZoom());
            });

            //L.DomEvent.addListener($(&#039;&lt;?php echo $prefix;?&gt;triggermap&#039;), &#039;click&#039;, gdMaxMap);

            &lt;?php if ($is_map_restrict) { ?&gt;
            var CITY_ADDRESS = &#039;&lt;?php echo addslashes_gpc($city).&#039;, &#039;.addslashes_gpc($region).&#039;, &#039;.addslashes_gpc($country);?&gt;&#039;;
            &lt;?php } ?&gt;
            // Limit the zoom level
            $.goMap.map.on(&#039;zoom&#039;, function(e) {
                if ($.goMap.map.getZoom() &lt; minZoomLevel) {
                    $.goMap.map.setZoom(minZoomLevel);
                }
            });
        }
		&lt;?php if ( geodir_lazy_load_map() ) { ?&gt;
		}
	});&lt;?php } ?&gt;
    });
    &lt;?php }?&gt;
    /* ]]&gt; */
&lt;/script&gt;

&lt;?php if(!wp_doing_ajax()){?&gt;
&lt;div class=&quot;form-group &lt;?php if($geodir_label_type==&#039;horizontal&#039;){ echo &quot;row&quot;;}?&gt;&quot;&gt;
    &lt;?php if($geodir_label_type==&#039;horizontal&#039;  ){ ?&gt;
    &lt;div class=&quot;col-sm-2 col-form-label&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;col-sm-10&quot;&gt;
        &lt;?php } ?&gt;
        &lt;input type=&quot;button&quot; id=&quot;&lt;?php echo $prefix; ?&gt;set_address_button&quot; class=&quot; btn btn-primary text-center mx-auto&quot; value=&quot;&lt;?php esc_attr_e($map_title, &#039;geodirectory&#039;); ?&gt;&quot; /&gt;
        &lt;?php
        aui();
        echo AUI_Component_Helper::help_text(stripslashes( __( &#039;Click on &quot;Set Address on Map&quot; and then you can also drag map marker to locate the correct address&#039;, &#039;geodirectory&#039; ) ));
        ?&gt;
        &lt;?php if($geodir_label_type==&#039;horizontal&#039;){ ?&gt;
    &lt;/div&gt;
&lt;?php } ?&gt;
&lt;/div&gt;
&lt;?php } ?&gt;
&lt;div class=&quot;form-group rowx&quot;&gt;

    &lt;?php
    /**
     * Variables.
     *
     * @var array $map_options The map settings options.
     * @var string $map_type The map type.
     * @var string $map_canvas The map canvas string.
     * @var string $height The map height setting.
     * @var string $width The map width setting.
     */
    $map_type = &#039;add_listing&#039;;
    $map_canvas = $prefix .&#039;map&#039; ;
    $height = &#039;350px&#039;;
    $width = &#039;100%&#039;;
    $wrap_class = &#039;&#039;;
    $hide_expand_map = true;
    $map_options = array(
        &#039;map_canvas&#039; =&gt; $map_canvas,
        &#039;map_type&#039; =&gt; $map_type,
        &#039;height&#039; =&gt; $height,
        &#039;width&#039; =&gt; $width
    );
    include( GEODIRECTORY_PLUGIN_DIR . &#039;templates/bootstrap/map/map.php&#039; );
    ?&gt;
&lt;/div&gt;</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337339"></script>
    <script src="../js/search.js?updated=1652337339"></script>
</body>
</html>
