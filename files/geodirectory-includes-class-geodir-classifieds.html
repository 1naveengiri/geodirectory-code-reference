<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337338">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337338">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-classifieds.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDir_Classifieds class
 *
 * @package GeoDirectory
 * @since   2.1.1.5
 */

// Exit if accessed directly
if ( ! defined( &#039;ABSPATH&#039; ) ) exit;

/**
 * GeoDir_Classifieds class.
 */
class GeoDir_Classifieds {

	/**
	 * Setup.
	 */
	public static function init() {
		// Admin CPT settings
		add_filter( &#039;geodir_get_settings_cpt&#039;, array( __CLASS__, &#039;get_settings_cpt&#039; ), 20, 3 );
		add_filter( &#039;geodir_custom_fields_predefined&#039;, array( __CLASS__, &#039;custom_fields_predefined&#039; ), 20, 2 );

		add_filter( &#039;geodir_save_post_type&#039;, array( __CLASS__, &#039;sanitize_post_type&#039; ), 10, 3 );
		add_action( &#039;geodir_post_type_saved&#039;, array( __CLASS__, &#039;post_type_saved&#039; ), 10, 3 );
		add_action( &#039;geodir_pt_classified_features_changed&#039;, array( __CLASS__, &#039;on_pt_classified_features_changed&#039; ), 10, 3 );
		add_filter( &#039;geodir_custom_field_input_select_sale_status&#039;, array( __CLASS__, &#039;input_sale_status&#039; ), 10, 2 );
		add_filter( &#039;geodir_custom_field_output_select_var_sale_status&#039;, array( __CLASS__, &#039;output_sale_status&#039; ), 10, 4 );

		add_filter( &#039;geodir_listing_custom_statuses&#039;, array( __CLASS__, &#039;set_custom_statuses&#039; ), 10, 2 );
		add_filter( &#039;geodir_register_post_statuses&#039;, array( __CLASS__, &#039;register_post_statuses&#039; ), 10, 1 );
		add_filter( &#039;geodir_get_publish_statuses&#039;, array( __CLASS__, &#039;filter_publish_statuses&#039; ), 10, 2 );
		add_filter( &#039;geodir_get_post_stati&#039;, array( __CLASS__, &#039;filter_post_stati&#039; ), 10, 3 );
		add_filter( &#039;geodir_author_actions&#039;, array( __CLASS__, &#039;author_actions&#039; ), 9, 2 );
		add_filter( &#039;wp_head&#039;, array( __CLASS__, &#039;show_notifications&#039; ) );
		add_filter( &#039;geodir_post_author_action_sale-agreed&#039;, array( __CLASS__, &#039;post_author_action&#039; ), 10, 3 );
		add_filter( &#039;geodir_post_author_action_under-offer&#039;, array( __CLASS__, &#039;post_author_action&#039; ), 10, 3 );
		add_filter( &#039;geodir_post_author_action_sold&#039;, array( __CLASS__, &#039;post_author_action&#039; ), 10, 3 );
		add_filter( &#039;geodir_post_status_author_page&#039;, array( __CLASS__, &#039;author_post_status_title&#039; ), 10, 3 );
		add_filter( &#039;geodir_post_status_icon_author_page&#039;, array( __CLASS__, &#039;author_post_status_icon&#039; ), 10, 3 );
		add_filter( &#039;geodir_ajax_update_post_data&#039;, array( __CLASS__, &#039;ajax_update_post_data&#039; ), 10, 2 );
	}

	public static function get_settings_cpt( $settings, $current_section = &#039;&#039;, $post_type_values = array() ) {
		$post_type = ! empty( $_GET[&#039;post_type&#039;] ) ? sanitize_text_field( $_GET[&#039;post_type&#039;] ) : &#039;&#039;;

		if ( ! empty( $settings ) ) {
			$new_settings = array();
			foreach ( $settings as $key =&gt; $setting ) {
				$new_settings[] = $setting;
				if ( ! empty( $setting[&#039;id&#039;] ) &amp;&amp; $setting[&#039;id&#039;] == &#039;cpt_settings_page&#039; &amp;&amp; $setting[&#039;type&#039;] == &#039;sectionend&#039; ) {
					$classified_features = ! empty( $post_type_values[&#039;classified_features&#039;] ) &amp;&amp; is_array( $post_type_values[&#039;classified_features&#039;] ) ? $post_type_values[&#039;classified_features&#039;] : array();

					$new_settings[] = array(
						&#039;title&#039; =&gt; __( &#039;Classifieds/Real-Estate Sold Settings&#039;, &#039;geodirectory&#039; ),
						&#039;type&#039; =&gt; &#039;title&#039;,
						&#039;desc&#039; =&gt; __( &#039;Add a sold functionality which would include the following listing statuses like sold, under offer, sale agreed etc.&#039;, &#039;geodirectory&#039; ),
						&#039;id&#039; =&gt; &#039;cpt_settings_classifieds&#039;,
						&#039;desc_tip&#039; =&gt; true,
					);
					$new_settings[] = array(
						&#039;type&#039; =&gt; &#039;multiselect&#039;,
						&#039;id&#039; =&gt; &#039;classified_features&#039;,
						&#039;name&#039; =&gt; __( &#039;Enable Classifieds Features&#039;, &#039;geodirectory&#039; ),
						&#039;desc&#039; =&gt; __( &#039;Select statuses to enable functionality for this post type. &lt;span style=&quot;color:red;&quot;&gt;(WARNING: disabling any status for the post type will move all existing posts to draft.)&lt;/span&gt;&#039;, &#039;geodirectory&#039; ),
						&#039;placeholder&#039; =&gt; __( &#039;Select features&amp;hellip;&#039;, &#039;geodirectory&#039; ),
						&#039;options&#039; =&gt; geodir_get_classified_statuses(),
						&#039;class&#039; =&gt; &#039;geodir-select&#039;,
						&#039;advanced&#039; =&gt; false,
						&#039;desc_tip&#039; =&gt; true,
						&#039;value&#039; =&gt; $classified_features
					);
					$new_settings[] = array(
						&#039;name&#039; =&gt; &#039;&#039;,
						&#039;desc&#039; =&gt; &#039;&#039;,
						&#039;id&#039; =&gt; &#039;prev_classified_features&#039;,
						&#039;type&#039; =&gt; &#039;hidden&#039;,
						&#039;value&#039; =&gt; implode( &#039;,&#039;, $classified_features )
					);
					$new_settings[] = array( 
						&#039;type&#039; =&gt; &#039;sectionend&#039;, 
						&#039;id&#039; =&gt; &#039;cpt_settings_classifieds&#039; 
					);
				}
			}
			$settings = $new_settings;
		}

		return $settings;
	}

	public static function sanitize_post_type( $data, $post_type, $request ) {
		if ( isset( $request[&#039;classified_features&#039;] ) ) {
			$data[ $post_type ][&#039;classified_features&#039;] = ! empty( $request[&#039;classified_features&#039;] ) &amp;&amp; is_array( $request[&#039;classified_features&#039;] ) ? geodir_clean( $request[&#039;classified_features&#039;] ) : array();
			$data[ $post_type ][&#039;prev_classified_features&#039;] = ! empty( $request[&#039;prev_classified_features&#039;] ) ? geodir_clean( $request[&#039;prev_classified_features&#039;] ) : &#039;&#039;;
		}

		return $data;
	}

	public static function post_type_saved( $post_type, $args, $new = false ) {
		if ( isset( $args[&#039;classified_features&#039;] ) &amp;&amp; isset( $args[&#039;prev_classified_features&#039;] ) ) {
			$previous_features = ! empty( $args[&#039;prev_classified_features&#039;] ) ? explode( &#039;,&#039;, $args[&#039;prev_classified_features&#039;] ) : array();
			$current_features = $args[&#039;classified_features&#039;];

			if ( $previous_features != $current_features ) {
				do_action( &#039;geodir_pt_classified_features_changed&#039;, $post_type, $current_features, $previous_features );
			}
		}
	}

	public static function on_pt_classified_features_changed( $post_type, $current, $previous ) {
		global $wpdb;

		// Create custom fields.
		if ( empty( $previous ) &amp;&amp; ! empty( $current ) ) {
			$fields = self::get_custom_fields( $post_type, 0 );

			if ( ! empty( $fields ) ) {
				$sort_order = (int) $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT MAX( sort_order ) FROM &quot; . GEODIR_CUSTOM_FIELDS_TABLE . &quot; WHERE post_type = %s LIMIT 1&quot;, array( $post_type ) ) );

				foreach ( $fields as $key =&gt; $field ) {
					$sort_order++;

					$field[&#039;sort_order&#039;] = $sort_order;

					geodir_custom_field_save( $field );
				}
			}
		}

		// Change post status to draft.
		if ( ! empty( $previous ) ) {
			$table = geodir_db_cpt_table( $post_type );

			$features = geodir_register_classified_statuses();
			if ( ! empty( $current ) ) {
				foreach ( $current as $_current ) {
					if ( isset( $features[ $_current ] ) ) {
						unset( $features[ $_current ] );
					}
				}
			}

			if ( ! empty( $features ) ) {
				$features = array_keys( $features );
				$where = count( $features ) &gt; 1 ? &quot;post_status IN( &#039;&quot; . implode( &quot;&#039;, &#039;&quot;, $features ) . &quot;&#039; )&quot; : &quot;post_status = &#039;&quot; . $features[0] . &quot;&#039;&quot;;

				$wpdb-&gt;query( $wpdb-&gt;prepare( &quot;UPDATE {$wpdb-&gt;posts} SET post_status = %s WHERE post_type = %s AND {$where}&quot;, array( &#039;draft&#039;, $post_type ) ) );
				$wpdb-&gt;query( $wpdb-&gt;prepare( &quot;UPDATE {$table} SET post_status = %s WHERE {$where}&quot;, array( &#039;draft&#039; ) ) );
			}
		}
	}

	public static function register_post_statuses( $statuses ) {
		$statuses = $statuses + geodir_register_classified_statuses();

		return $statuses;
	}

	public static function set_custom_statuses( $statuses, $post_type = &#039;&#039; ) {
		$statuses = $statuses + geodir_get_classified_statuses( $post_type );

		return $statuses;
	}

	public static function filter_publish_statuses( $statuses, $args ) {
		if ( ! empty( $args[&#039;post_type&#039;] ) ) {
			$active_statuses = geodir_classified_active_statuses( $args[&#039;post_type&#039;] );

			if ( ! empty( $active_statuses ) ) {
				$custom_statuses = geodir_register_classified_statuses();

				foreach ( $custom_statuses as $status =&gt; $data ) {
					if ( in_array( $status, $active_statuses ) &amp;&amp; ( isset( $data[&#039;public&#039;] ) &amp;&amp; $data[&#039;public&#039;] === true ) &amp;&amp; ( isset( $data[&#039;exclude_from_search&#039;] ) &amp;&amp; $data[&#039;exclude_from_search&#039;] !== true ) ) {
						$statuses[] = $status;
					}
				}
			}
		}

		return $statuses;
	}

	public static function filter_post_stati( $statuses, $context, $args ) {
		if ( ! empty( $args[&#039;post_type&#039;] ) ) {
			if ( ! empty( $statuses ) ) {
				$active_statuses = geodir_classified_active_statuses( $args[&#039;post_type&#039;] );
				$classified_statuses = array_keys( geodir_register_classified_statuses() );
				$_statuses = array();

				foreach ( $statuses as $status ) {
					if ( in_array( $status, $classified_statuses ) &amp;&amp; ! in_array( $status, $active_statuses ) ) {
						continue;
					}
	
					$_statuses[] = $status;
				}

				$statuses = $_statuses;
			}
		}

		return $statuses;
	}

	public static function author_actions( $author_actions, $post_id ) {
		$post_status = get_post_status( $post_id );

		if ( ! in_array( $post_status, geodir_get_post_stati( &#039;unpublished&#039;, array( &#039;post_type&#039; =&gt; get_post_type( $post_id ) ) ) ) ) {
			$features = geodir_classified_active_statuses( get_post_type( $post_id ) );

			if ( ! empty( $features ) ) {
				if ( in_array( &#039;gd-sale-agreed&#039;, $features ) &amp;&amp; $post_status != &#039;gd-sale-agreed&#039; ) {
					$author_actions[&#039;sale-agreed&#039;] = array(
						&#039;icon&#039; =&gt; &#039;fas fa-square&#039;,
						&#039;title&#039; =&gt; __( &#039;Mark as Sale Agreed&#039;, &#039;geodirectory&#039; ),
						&#039;url&#039; =&gt; &#039;javascript:void(0);&#039;,
						&#039;onclick&#039; =&gt; &#039;geodir_post_author_action(this, &#039; . absint( $post_id ) . &#039;, \&#039;sale-agreed\&#039;);&#039;
					);
				}

				if ( in_array( &#039;gd-under-offer&#039;, $features ) &amp;&amp; $post_status != &#039;gd-under-offer&#039; ) {
					$author_actions[&#039;under-offer&#039;] = array(
						&#039;icon&#039; =&gt; &#039;fas fa-square&#039;,
						&#039;title&#039; =&gt; __( &#039;Mark as Under Offer&#039;, &#039;geodirectory&#039; ),
						&#039;url&#039; =&gt; &#039;javascript:void(0);&#039;,
						&#039;onclick&#039; =&gt; &#039;geodir_post_author_action(this, &#039; . absint( $post_id ) . &#039;, \&#039;under-offer\&#039;);&#039;
					);
				}

				if ( in_array( &#039;gd-sold&#039;, $features ) &amp;&amp; $post_status != &#039;gd-sold&#039; ) {
					$author_actions[&#039;sold&#039;] = array(
						&#039;icon&#039; =&gt; &#039;fas fa-square&#039;,
						&#039;title&#039; =&gt; __( &#039;Mark as Sold&#039;, &#039;geodirectory&#039; ),
						&#039;url&#039; =&gt; &#039;javascript:void(0);&#039;,
						&#039;onclick&#039; =&gt; &#039;geodir_post_author_action(this, &#039; . absint( $post_id ) . &#039;, \&#039;sold\&#039;);&#039;
					);
				}
			}
		}

		return $author_actions;
	}

	public static function show_notifications() {
		global $geodirectory, $post, $gd_post;

		if ( empty( $geodirectory-&gt;notifications ) ) {
			return;
		}

		if ( geodir_is_page( &#039;single&#039; ) ) {
			$features = geodir_register_classified_statuses();

			if ( ! empty( $post ) &amp;&amp; ! empty( $post-&gt;post_status ) &amp;&amp; ! empty( $features[ $post-&gt;post_status ][&#039;notification&#039;] ) ) {
				$name = geodir_strtolower( geodir_post_type_singular_name( $post-&gt;post_type ) );

				$geodirectory-&gt;notifications-&gt;add(
					&#039;post_is_&#039; . sanitize_key( $post-&gt;post_status ),
					array(
						&#039;type&#039; =&gt; &#039;warning&#039;,
						&#039;note&#039; =&gt; wp_sprintf( __( $features[ $post-&gt;post_status ][&#039;notification&#039;], &#039;geodirectory&#039; ), $name )
					)
				);
			}
		}
	}

	public static function post_author_action( $data, $action, $gd_post ) {
		if ( ! geodir_listing_belong_to_current_user( $gd_post-&gt;ID ) ) {
			return new WP_Error( &#039;geodir-post-action-failed&#039;, __( &#039;You do not have permission to perform this action.&#039;, &#039;geodirectory&#039; ) );
		}

		switch ( $action ) {
			case &#039;sale-agreed&#039;:
				$result = self::set_post_status( $gd_post, &#039;gd-sale-agreed&#039; );

				if ( $result === false ) {
					$result = new WP_Error( &#039;geodir-post-action-failed&#039;, __( &#039;Failed to perform action &quot;Mark as Sale Agreed&quot;.&#039;, &#039;geodirectory&#039; ) );
				} else {
					$result = array(
						&#039;message&#039; =&gt; __( &#039;Post has been marked as Sale Agreed successfully.&#039;, &#039;geodirectory&#039; ),
						&#039;redirect_to&#039; =&gt; true
					);
				}
				break;
			case &#039;under-offer&#039;:
				$result = self::set_post_status( $gd_post, &#039;gd-under-offer&#039; );

				if ( $result === false ) {
					$result = new WP_Error( &#039;geodir-post-action-failed&#039;, __( &#039;Failed to perform action &quot;Mark as Under Offer&quot;.&#039;, &#039;geodirectory&#039; ) );
				} else {
					$result = array(
						&#039;message&#039; =&gt; __( &#039;Post has been marked as Under Offer successfully.&#039;, &#039;geodirectory&#039; ),
						&#039;redirect_to&#039; =&gt; true
					);
				}
				break;
			case &#039;sold&#039;:
				$result = self::set_post_status( $gd_post, &#039;gd-sold&#039; );

				if ( $result === false ) {
					$result = new WP_Error( &#039;geodir-post-action-failed&#039;, __( &#039;Failed to perform action &quot;Mark as Sold&quot;.&#039;, &#039;geodirectory&#039; ) );
				} else {
					$result = array(
						&#039;message&#039; =&gt; __( &#039;Post has been marked as Sold successfully.&#039;, &#039;geodirectory&#039; ),
						&#039;redirect_to&#039; =&gt; true
					);
				}
				break;
		}

		return $result;
	}

	public static function set_post_status( $gd_post, $post_status ) {
		if ( ! empty( $gd_post ) &amp;&amp; ! is_object( $gd_post ) ) {
			$gd_post = geodir_get_post_info( $gd_post );
		}

		if ( empty( $gd_post ) ) {
			return false;
		}

		// Check for revision post.
		if ( ! ( ! empty( $gd_post-&gt;post_type ) &amp;&amp; geodir_is_gd_post_type( $gd_post-&gt;post_type ) ) ) {
			return false;
		}

		$features = geodir_classified_active_statuses( get_post_type( $gd_post-&gt;ID ) );

		if ( ! ( ! empty( $features ) &amp;&amp; in_array( $post_status, $features ) ) ) {
			return false;
		}

		if ( ! empty( $post_status ) &amp;&amp; $post_status != $gd_post-&gt;post_status &amp;&amp; ! in_array( $post_status, geodir_get_post_stati( &#039;unpublished&#039;, (array) $gd_post ) ) ) {
			if ( apply_filters( &#039;geodir_skip_classified_set_status&#039;, false, $gd_post, $post_status ) ) {
				return false;
			}

			do_action( &#039;geodir_skip_classified_before_set_status&#039;, $gd_post, $post_status );

			$post_data = array();
			$post_data[&#039;ID&#039;] = $gd_post-&gt;ID;
			$post_data[&#039;post_status&#039;] = $post_status;

			$post_data = apply_filters( &#039;geodir_skip_classified_set_status_data&#039;, $post_data, $gd_post, $post_status );

			wp_update_post( $post_data );

			do_action( &#039;geodir_skip_classified_after_set_status&#039;, $gd_post, $post_status );

			return true;
		}

		return false;
	}

	public static function author_post_status_title( $status, $real_status, $post_ID ) {
		$features = geodir_register_classified_statuses();

		if ( ! empty( $features[ $real_status ][&#039;label&#039;] ) ) {
			$status = $features[ $real_status ][&#039;label&#039;];
		}

		return $status;
	}

	public static function author_post_status_icon( $status_icon, $real_status, $post_ID ) {
		$features = geodir_register_classified_statuses();

		if ( ! empty( $features[ $real_status ][&#039;icon&#039;] ) ) {
			$status_icon = $features[ $real_status ][&#039;icon&#039;];
		}

		return $status_icon;
	}

	public static function get_custom_fields( $post_type, $package_id ) {
		$package = is_array( $package_id ) &amp;&amp; ! empty( $package_id ) ? $package_id : ( $package_id !== &#039;&#039; ? array( $package_id ) : &#039;&#039; );

		$fields = array();
		// price
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;text&#039;,
			&#039;data_type&#039; =&gt; &#039;FLOAT&#039;,
			&#039;decimal_point&#039; =&gt; &#039;2&#039;,
			&#039;admin_title&#039; =&gt; &#039;Price&#039;,
			&#039;frontend_title&#039; =&gt; &#039;Price&#039;,
			&#039;frontend_desc&#039; =&gt; &#039;Enter the price in $ (no currency symbol)&#039;,
			&#039;htmlvar_name&#039; =&gt; &#039;price&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;option_values&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; false,
			&#039;validation_pattern&#039; =&gt; addslashes_gpc( &#039;\d+(\.\d{2})?&#039; ),
			&#039;validation_msg&#039; =&gt; &#039;Please enter number and decimal only ie: 100.50&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-dollar-sign&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;extra&#039; =&gt; array(
				&#039;is_price&#039; =&gt; 1,
				&#039;thousand_separator&#039; =&gt; &#039;comma&#039;,
				&#039;decimal_separator&#039; =&gt; &#039;period&#039;,
				&#039;decimal_display&#039; =&gt; &#039;if&#039;,
				&#039;currency_symbol&#039; =&gt; &#039;$&#039;,
				&#039;currency_symbol_placement&#039; =&gt; &#039;left&#039;
			),
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Price&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property status
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;field_type_key&#039; =&gt; &#039;select&#039;,
			&#039;is_active&#039; =&gt; 1,
			&#039;for_admin_use&#039; =&gt; 0,
			&#039;is_default&#039; =&gt; 0,
			&#039;admin_title&#039; =&gt; __( &#039;Property Status&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Enter the status of the property.&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Property Status&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_status&#039;,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;is_required&#039; =&gt; &#039;1&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;option_values&#039; =&gt; &#039;Select Status/,For Sale,Sold,Under Offer&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-home&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; 1,
			&#039;cat_filter&#039; =&gt; 1,
			&#039;clabels&#039; =&gt; &#039;Property Status&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property furnishing
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Furnishing&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Furnishing&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Enter the furnishing status of the property.&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_furnishing&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; true,
			&#039;option_values&#039; =&gt; &#039;Select Status/,Unfurnished,Furnished,Partially furnished,Optional&#039;,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-th-large&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Furnishing&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property type
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Property Type&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Property Type&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Select the property type.&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_type&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; true,
			&#039;option_values&#039; =&gt; &#039;Select Type/,Detached house,Semi-detached house,Apartment,Bungalow,Semi-detached bungalow,Chalet,Town House,End-terrace house,Terrace house,Cottage,Hotel,Land&#039;,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-home&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Property Type&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property bedrooms
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Property Bedrooms&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Bedrooms&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Select the number of bedrooms&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_bedrooms&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; true,
			&#039;option_values&#039; =&gt; &#039;Select Bedrooms/,1,2,3,4,5,6,7,8,9,10&#039;,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-bed&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Property Bedrooms&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property bathrooms
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Property Bathrooms&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Bathrooms&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Select the number of bathrooms&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_bathrooms&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; true,
			&#039;option_values&#039; =&gt; &#039;Select Bathrooms/,1,2,3,4,5,6,7,8,9,10&#039;,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-bold&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Property Bathrooms&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property area
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;text&#039;,
			&#039;data_type&#039; =&gt; &#039;INT&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Property Area&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Area (Sq Ft)&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Enter the Sq Ft value for the property&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_area&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; false,
			&#039;validation_pattern&#039; =&gt; addslashes_gpc(&#039;\d+(\.\d{2})?&#039; ), // add slashes required
			&#039;validation_msg&#039; =&gt; &#039;Please enter the property area in numbers only: 1500&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-chart-area&#039;,
			&#039;css_class&#039; =&gt; &#039;&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Property Area&#039;,
			&#039;single_use&#039; =&gt; true
		);

		// property features
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;multiselect&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Property Features&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Features&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Select the property features.&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;property_features&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; false,
			&#039;option_values&#039; =&gt; &#039;Gas Central Heating,Oil Central Heating,Double Glazing,Triple Glazing,Front Garden,Garage,Private driveway,Off Road Parking,Fireplace&#039;,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;fas fa-plus-square&#039;,
			&#039;css_class&#039; =&gt; &#039;gd-comma-list&#039;,
			&#039;cat_sort&#039; =&gt; true,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Property Features&#039;,
			&#039;single_use&#039; =&gt; true
		);

		$features = geodir_register_classified_statuses();
		$options = &#039;Select Status/&#039;;
		foreach ( $features as $value =&gt; $feature ) {
			$options .= &#039;,&#039; . $feature[&#039;label&#039;] . &#039;/&#039; . $value;
		}

		// sale_status
		$fields[] = array(
			&#039;post_type&#039; =&gt; $post_type,
			&#039;field_type&#039; =&gt; &#039;select&#039;,
			&#039;data_type&#039; =&gt; &#039;VARCHAR&#039;,
			&#039;admin_title&#039; =&gt; __( &#039;Sale Status&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_title&#039; =&gt; __( &#039;Sale Status&#039;, &#039;geodirectory&#039; ),
			&#039;frontend_desc&#039; =&gt; __( &#039;Select a sale status of the listing.&#039;, &#039;geodirectory&#039; ),
			&#039;placeholder_value&#039;  =&gt; __( &#039;Select Status&#039;, &#039;geodirectory&#039; ),
			&#039;htmlvar_name&#039; =&gt; &#039;sale_status&#039;,
			&#039;is_active&#039; =&gt; true,
			&#039;for_admin_use&#039; =&gt; false,
			&#039;default_value&#039; =&gt; &#039;&#039;,
			&#039;show_in&#039; =&gt; &#039;[detail],[listing]&#039;,
			&#039;is_required&#039; =&gt; false,
			&#039;option_values&#039; =&gt; $options,
			&#039;validation_pattern&#039; =&gt; &#039;&#039;,
			&#039;validation_msg&#039; =&gt; &#039;&#039;,
			&#039;required_msg&#039; =&gt; &#039;&#039;,
			&#039;field_icon&#039; =&gt; &#039;far fa-pause-circle&#039;,
			&#039;css_class&#039; =&gt; &#039;gd-sale-status&#039;,
			&#039;cat_sort&#039; =&gt; false,
			&#039;cat_filter&#039; =&gt; true,
			&#039;show_on_pkg&#039; =&gt; $package,
			&#039;clabels&#039; =&gt; &#039;Sale Status&#039;,
			&#039;single_use&#039; =&gt; true
		);

		return apply_filters( &#039;geodir_classified_custom_fields&#039;, $fields, $post_type, $package );
	}

	public static function ajax_update_post_data( $post_data, $update = false ) {
		if ( ! empty( $_POST[&#039;sale_status&#039;] ) ) {
			if ( isset( $post_data[&#039;post_status&#039;] ) &amp;&amp; $post_data[&#039;post_status&#039;] == $_POST[&#039;sale_status&#039;] ) {
				return $post_data;
			}

			if ( ! empty( $_POST[&#039;post_parent&#039;] ) &amp;&amp; ! empty( $post_data[&#039;post_parent&#039;] ) &amp;&amp; $_POST[&#039;post_parent&#039;] == $post_data[&#039;post_parent&#039;] ) {
				$post_type = get_post_type( absint( $_POST[&#039;post_parent&#039;] ) );
			} elseif ( ! empty( $_POST[&#039;ID&#039;] ) &amp;&amp; ! empty( $post_data[&#039;ID&#039;] ) &amp;&amp; $_POST[&#039;ID&#039;] == $post_data[&#039;ID&#039;] ) {
				$post_type = get_post_type( absint( $_POST[&#039;post_parent&#039;] ) );
			} else {
				$post_type = &#039;&#039;;
			}

			if ( $post_type &amp;&amp; ( $active_features = geodir_classified_active_statuses( $post_type ) ) ) {
				if ( in_array( $_POST[&#039;sale_status&#039;], $active_features ) ) {
					if ( isset( $post_data[&#039;post_status&#039;] ) ) {
						$post_data[&#039;_from_post_status&#039;] = $post_data[&#039;post_status&#039;];
					}

					$post_data[&#039;post_status&#039;] = sanitize_text_field( $_POST[&#039;sale_status&#039;] );
				}
			}
		}

		return $post_data;
	}

	public static function custom_fields_predefined( $custom_fields, $post_type ) {
		$active_features = geodir_get_classified_statuses( $post_type );

		if ( ! empty( $active_features ) ) {
			$features = geodir_register_classified_statuses();

			$options = &#039;Select Status/&#039;;
			foreach ( $features as $value =&gt; $feature ) {
				$options .= &#039;,&#039; . $feature[&#039;label&#039;] . &#039;/&#039; . $value;
			}

			$custom_fields[&#039;sale_status&#039;] = array(
				&#039;field_type&#039;  =&gt; &#039;select&#039;,
				&#039;class&#039;       =&gt; &#039;gd-sale-status&#039;,
				&#039;icon&#039;        =&gt; &#039;far fa-pause-circle&#039;,
				&#039;name&#039;        =&gt; __( &#039;Sale Status&#039;, &#039;geodirectory&#039; ),
				&#039;description&#039; =&gt; __( &#039;Adds a select input to set a sale status of the listing.&#039;, &#039;geodirectory&#039; ),
				&#039;defaults&#039;    =&gt; array(
					&#039;data_type&#039;          =&gt; &#039;VARCHAR&#039;,
					&#039;admin_title&#039;        =&gt; &#039;Sale Status&#039;,
					&#039;frontend_title&#039;     =&gt; &#039;Sale Status&#039;,
					&#039;frontend_desc&#039;      =&gt; &#039;Select a sale status of the listing.&#039;,
					&#039;placeholder_value&#039;  =&gt; &#039;Select Status&#039;,
					&#039;htmlvar_name&#039;       =&gt; &#039;sale_status&#039;,
					&#039;is_active&#039;          =&gt; true,
					&#039;for_admin_use&#039;      =&gt; false,
					&#039;default_value&#039;      =&gt; &#039;&#039;,
					&#039;show_in&#039;            =&gt; &#039;[detail],[listing]&#039;,
					&#039;is_required&#039;        =&gt; false,
					&#039;option_values&#039;      =&gt; $options,
					&#039;validation_pattern&#039; =&gt; &#039;&#039;,
					&#039;validation_msg&#039;     =&gt; &#039;&#039;,
					&#039;required_msg&#039;       =&gt; &#039;&#039;,
					&#039;field_icon&#039;         =&gt; &#039;far fa-pause-circle&#039;,
					&#039;css_class&#039;          =&gt; &#039;gd-sale-status&#039;,
					&#039;cat_sort&#039;           =&gt; false,
					&#039;cat_filter&#039;         =&gt; true,
					&#039;single_use&#039;         =&gt; true
				)
			);
		}

		return $custom_fields;
	}

	public static function input_sale_status( $output, $cf ) {
		global $post, $gd_post, $geodir_label_type;

		$features = geodir_get_classified_statuses( $cf[&#039;post_type&#039;] );

		if ( ! empty( $features ) ) {
			if ( is_admin() ) {
				return &#039;&lt;!-- --&gt;&#039;;
			}

			if ( empty( $gd_post ) &amp;&amp; ! empty( $post ) ) {
				$gd_post = geodir_get_post_info( $post-&gt;ID );
			}

			if ( ! empty( $gd_post-&gt;post_parent ) ) {
				$value = get_post_status( $gd_post-&gt;post_parent );
			} elseif ( ! empty( $gd_post-&gt;ID ) ) {
				$value = $gd_post-&gt;post_status;
			} else {
				$value = &#039;&#039;;
			}

			// placeholder
			$placeholder = ! empty( $cf[&#039;placeholder_value&#039;] ) ? __( $cf[&#039;placeholder_value&#039;], &#039;geodirectory&#039; ) : __( &#039;Select Status&#039;, &#039;geodirectory&#039; );

			$options = array_merge( array( &#039;&#039; =&gt; $placeholder ), $features );

			if ( geodir_design_style() ) {
				// validation message
				$title = ! empty( $cf[&#039;validation_msg&#039;] ) ? $cf[&#039;validation_msg&#039;] : &#039;&#039;;

				// required
				$required = ! empty( $cf[&#039;is_required&#039;] ) ? &#039; &lt;span class=&quot;text-danger&quot;&gt;*&lt;/span&gt;&#039; : &#039;&#039;;

				$extra_attributes = array();
				// validation
				if ( isset( $cf[&#039;validation_pattern&#039;] ) &amp;&amp; $cf[&#039;validation_pattern&#039;] ) {
					$extra_attributes[&#039;pattern&#039;] = $cf[&#039;validation_pattern&#039;];
				}

				// extra
				$extra_attributes[&#039;data-placeholder&#039;] = esc_attr( $placeholder );
				$extra_attributes[&#039;option-ajaxchosen&#039;] = &#039;false&#039;;

				// admin only
				$admin_only = geodir_cfi_admin_only( $cf );
				$conditional_attrs = geodir_conditional_field_attrs( $cf );

				$output .= aui()-&gt;select( array(
					&#039;id&#039;               =&gt; $cf[&#039;name&#039;],
					&#039;name&#039;             =&gt; $cf[&#039;name&#039;],
					&#039;title&#039;            =&gt; $title,
					&#039;placeholder&#039;      =&gt; $placeholder,
					&#039;value&#039;            =&gt; $value,
					&#039;required&#039;         =&gt; ! empty( $cf[&#039;is_required&#039;] ) ? true : false,
					&#039;label_show&#039;       =&gt; true,
					&#039;label_type&#039;       =&gt; ! empty( $geodir_label_type ) ? $geodir_label_type : &#039;horizontal&#039;,
					&#039;label&#039;            =&gt; __( $cf[&#039;frontend_title&#039;], &#039;geodirectory&#039; ) . $admin_only . $required,
					&#039;validation_text&#039;  =&gt; ! empty( $cf[&#039;validation_msg&#039;] ) ? $cf[&#039;validation_msg&#039;] : &#039;&#039;,
					&#039;validation_pattern&#039; =&gt; ! empty( $cf[&#039;validation_pattern&#039;] ) ? $cf[&#039;validation_pattern&#039;] : &#039;&#039;,
					&#039;help_text&#039;        =&gt; __( $cf[&#039;desc&#039;], &#039;geodirectory&#039; ),
					&#039;extra_attributes&#039; =&gt; $extra_attributes,
					&#039;options&#039;          =&gt; $options,
					&#039;select2&#039;          =&gt; true,
					&#039;data-allow-clear&#039; =&gt; true,
					&#039;wrap_attributes&#039;  =&gt; $conditional_attrs
				) );
			} else {
				$select_options = &#039;&#039;;
				foreach ( $options as $val =&gt; $label ) {
					$select_options .= &#039;&lt;option value=&quot;&#039; . esc_attr( $val ) . &#039;&quot; &#039; . selected( $val, $value, false ) . &#039;&gt;&#039; . $label . &#039;&lt;/option&gt;&#039;;
				}
ob_start();
?&gt;
&lt;div id=&quot;&lt;?php echo $cf[&#039;name&#039;];?&gt;_row&quot; class=&quot;&lt;?php echo ( ! empty( $cf[&#039;is_required&#039;] ) ? &#039;required_field&#039; : &#039;&#039; ); ?&gt; geodir_form_row geodir_custom_fields clearfix gd-fieldset-details&quot;&gt;
	&lt;label for=&quot;&lt;?php echo esc_attr( $cf[&#039;name&#039;] ); ?&gt;&quot;&gt;&lt;?php echo __( $cf[&#039;frontend_title&#039;], &#039;geodirectory&#039; ); ?&gt;&lt;?php if ( $cf[&#039;is_required&#039;] ) { echo &#039;&lt;span&gt;*&lt;/span&gt;&#039;; } ?&gt;&lt;/label&gt;
	&lt;select field_type=&quot;&lt;?php echo esc_attr( $cf[&#039;type&#039;] ); ?&gt;&quot; name=&quot;&lt;?php echo esc_attr( $cf[&#039;type&#039;] ); ?&gt;&quot; id=&quot;&lt;?php echo esc_attr( $cf[&#039;type&#039;] ); ?&gt;&quot; class=&quot;geodir_textfield textfield_x geodir-select&quot; data-placeholder=&quot;&lt;?php echo esc_attr( $placeholder ); ?&gt;&quot; option-ajaxchosen=&quot;false&quot; data-allow_clear=&quot;true&quot;&gt;&lt;?php echo $select_options;?&gt;&lt;/select&gt;
	&lt;span class=&quot;geodir_message_note&quot;&gt;&lt;?php _e( $cf[&#039;desc&#039;], &#039;geodirectory&#039; ); ?&gt;&lt;/span&gt;
	&lt;?php if ( ! empty( $cf[&#039;is_required&#039;] ) ) { ?&gt;&lt;span class=&quot;geodir_message_error&quot;&gt;&lt;?php _e( $cf[&#039;required_msg&#039;], &#039;geodirectory&#039; ); ?&gt;&lt;/span&gt;&lt;?php } ?&gt;
&lt;/div&gt;
&lt;?php
$output = ob_get_clean();
			}
		}

		return $output;
	}

	public static function output_sale_status( $html, $location, $cf, $output ) {
		global $post, $gd_post;

		$features = geodir_get_classified_statuses( $cf[&#039;post_type&#039;] );

		if ( ! empty( $features ) &amp;&amp; isset( $features[ $gd_post-&gt;post_status ] ) ) {
			$output = geodir_field_output_process( $output );
			$value = strip_tags( $gd_post-&gt;{$cf[&#039;htmlvar_name&#039;]} );

			// Database value.
			if ( ! empty( $output ) &amp;&amp; isset( $output[&#039;raw&#039;] ) ) {
				return $value;
			}

			$value = geodir_get_post_status_name( $gd_post-&gt;post_status );
			if ( ! empty( $output ) &amp;&amp; isset( $output[&#039;strip&#039;] ) ) {
				return stripslashes( $value );
			}

			$field_icon = geodir_field_icon_proccess( $cf );
			if ( strpos( $field_icon, &#039;http&#039; ) !== false ) {
				$field_icon_af = &#039;&#039;;
			} elseif ( $field_icon == &#039;&#039; ) {
				$field_icon_af = &#039;&#039;;
			} else {
				$field_icon_af = $field_icon;
				$field_icon = &#039;&#039;;
			}

			$html = &#039;&lt;div class=&quot;geodir_post_meta &#039; . $cf[&#039;css_class&#039;] . &#039; geodir-field-&#039; . $cf[&#039;htmlvar_name&#039;] . &#039;&quot;&gt;&#039;;

			$maybe_secondary_class = isset( $output[&#039;icon&#039;] ) ? &#039;gv-secondary&#039; : &#039;&#039;;

			if($output==&#039;&#039; || isset($output[&#039;icon&#039;])) $html .= &#039;&lt;span class=&quot;geodir_post_meta_icon geodir-i-select&quot; style=&quot;&#039; . $field_icon . &#039;&quot;&gt;&#039; . $field_icon_af;
			if($output==&#039;&#039; || isset($output[&#039;label&#039;]))$html .= $cf[&#039;frontend_title&#039;] ? &#039;&lt;span class=&quot;geodir_post_meta_title &#039; . $maybe_secondary_class . &#039;&quot; &gt;&#039; . __( $cf[&#039;frontend_title&#039;], &#039;geodirectory&#039; ) . &#039;: &#039;.&#039;&lt;/span&gt;&#039; : &#039;&#039;;
			if($output==&#039;&#039; || isset($output[&#039;icon&#039;]))$html .= &#039;&lt;/span&gt;&#039;;
			if($output==&#039;&#039; || isset($output[&#039;value&#039;]))$html .= stripslashes( $value );

			$html .= &#039;&lt;/div&gt;&#039;;
		}

		return $html;
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337338"></script>
    <script src="../js/search.js?updated=1652337338"></script>
</body>
</html>
