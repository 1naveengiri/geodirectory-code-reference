<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652341136">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652341136">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpgeodirectory.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://ayecode.io/careers/" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-email.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit; // Exit if accessed directly
}

/**
 * Transactional Emails Controller
 *
 * GeoDirectory Emails Class which handles the sending on transactional emails and email templates. This class loads in available emails.
 *
 * @class        GeoDir_Email
 * @version        2.0.0
 * @package        GeoDirectory/Classes/Emails
 * @category    Class
 * @author        GeoDIrectory
 */
class GeoDir_Email {

	/**
	 * Setup anything neded for later emails.
	 */
	public static function init() {
		// add the email header and footer
		add_action( &#039;geodir_email_header&#039;, array( __CLASS__, &#039;email_header&#039; ), 10, 5 );
		add_action( &#039;geodir_email_footer&#039;, array( __CLASS__, &#039;email_footer&#039; ), 10, 4 );

		// hooks email actions
		add_action( &#039;geodir_send_enquiry_email&#039;, array( __CLASS__, &#039;send_enquiry_email&#039; ), 10, 2 );

		// frontend post save emails
		add_action( &#039;geodir_ajax_post_saved&#039;, array( __CLASS__, &#039;send_email_on_post_saved&#039; ), 10, 2 );

		// Send post published email.
		add_action( &#039;geodir_post_published&#039;, array( __CLASS__, &#039;send_user_publish_post_email&#039; ), 999, 2 );
	}

	/**
	 * Get the email logo.
     *
     * @since 2.0.0
	 *
	 * @return string Logo url.
	 */
	public static function get_email_logo( $size = &#039;full&#039; ) {
		$attachment_id = geodir_get_option( &#039;email_logo&#039; );

		$email_logo = &#039;&#039;;
		if ( ! empty( $attachment_id ) ) {
			$email_logo = wp_get_attachment_image( $attachment_id, $size );
		}

		return apply_filters( &#039;geodir_get_email_logo&#039;, $email_logo, $attachment_id, $size );
	}

	/**
	 * The default email footer text.
	 *
	 * @since 2.0.0
	 * @return string
	 */
	public static function email_header_text(){
		$header_text = self::get_email_logo();

		if ( empty( $header_text ) ) {
			$header_text = geodir_get_blogname();
		}

		return apply_filters( &#039;geodir_email_header_text&#039;, $header_text );
	}
	
	/**
	 * Get the email header template.
	 *
     * @since 2.0.0
     *
	 * @param string $email_heading
	 * @param string $email_name
	 * @param array $email_vars
	 * @param bool $plain_text
	 * @param bool $sent_to_admin
	 */
	public static function email_header( $email_heading = &#039;&#039;, $email_name = &#039;&#039;, $email_vars = array(), $plain_text = false, $sent_to_admin = false ) {
		if ( ! $plain_text ) {
			$header_text = self::email_header_text();
			$header_text = $header_text ? wpautop( wp_kses_post( wptexturize( $header_text ) ) ) : &#039;&#039;;
		
			geodir_get_template( &#039;emails/geodir-email-header.php&#039;, array(
				&#039;email_heading&#039; =&gt; $email_heading,
				&#039;email_name&#039;    =&gt; $email_name,
				&#039;email_vars&#039;    =&gt; $email_vars,
				&#039;plain_text&#039;    =&gt; $plain_text,
				&#039;header_text&#039; 	=&gt; $header_text,
				&#039;sent_to_admin&#039; =&gt; $sent_to_admin
			) );
		}
	}
	
	/**
	 * The default email footer text.
	 *
	 * @since 2.0.0
	 * @return string
	 */
	public static function email_footer_text(){
		$footer_text = geodir_get_option( &#039;email_footer_text&#039; );

		if ( empty( $footer_text ) ) {
			$footer_text = wp_sprintf( __( &#039;%s - Powered by GeoDirectory&#039;, &#039;geodirectory&#039; ), get_bloginfo( &#039;name&#039;, &#039;display&#039; ) );
		}

		return apply_filters( &#039;geodir_email_footer_text&#039;, $footer_text );
	}

	/**
	 * Get the email footer template.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name
	 * @param array $email_vars
	 * @param bool $plain_text
	 * @param bool $sent_to_admin
	 */
	public static function email_footer( $email_name = &#039;&#039;, $email_vars = array(), $plain_text = false, $sent_to_admin = false ) {
		if ( ! $plain_text ) {
			$footer_text = self::email_footer_text();
			$footer_text = $footer_text ? wpautop( wp_kses_post( wptexturize( $footer_text ) ) ) : &#039;&#039;;

			geodir_get_template( &#039;emails/geodir-email-footer.php&#039;, array(
				&#039;email_name&#039;    =&gt; $email_name,
				&#039;email_vars&#039;    =&gt; $email_vars,
				&#039;email_heading&#039;	=&gt; &#039;&#039;,
				&#039;plain_text&#039;    =&gt; $plain_text,
				&#039;footer_text&#039; 	=&gt; $footer_text,
				&#039;sent_to_admin&#039; =&gt; $sent_to_admin
			) );
		}
	}

	/**
	 * Get the email message wraped in the header and footer.
     *
     * @since 2.0.0
	 *
	 * @param string $message Message.
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 * @param string $email_heading Optional. Email header. Default null.
	 * @param bool $plain_text Optional. Plain text. Default false.
	 * @param bool $sent_to_admin Optional. Send to admin. Default false.
	 *
	 * @return string $message.
	 */
	public static function email_wrap_message( $message, $email_name = &#039;&#039;, $email_vars = array(), $email_heading = &#039;&#039;, $plain_text = false, $sent_to_admin = false ) {
		// Buffer
		ob_start();

		if ( $plain_text ) {
			echo wp_strip_all_tags( $message );
		} else {
			do_action( &#039;geodir_email_header&#039;, $email_heading, $email_name, $email_vars, $plain_text, $sent_to_admin );

			echo wpautop( wptexturize( $message ) );

			do_action( &#039;geodir_email_footer&#039;, $email_name, $email_vars, $plain_text, $sent_to_admin );
		}

		// Get contents
		$message = ob_get_clean();

		return $message;
	}

	/**
	 * Check if the email is enabled for the email type.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name Email name.
	 *
	 * @return mixed|void
	 */
	public static function is_email_enabled( $email_name, $default = &#039;&#039; ) {
		switch ( $email_name ) {
			// TODO add some cases
			default:
				$active = geodir_get_option( &#039;email_&#039; . $email_name , $default);
				$active = $active === &#039;yes&#039; || $active == &#039;1&#039; ? true : false;
				break;
		}

		return apply_filters( &#039;geodir_email_is_enabled&#039;, $active, $email_name );
	}

	/**
	 * Get the email subject by type.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 *
	 * @return mixed|void
	 */
	public static function get_subject( $email_name = &#039;&#039;, $email_vars = array() ) {
		switch ( $email_name ) {
			// TODO some custom options
			default:
				$subject = geodir_get_option( &#039;email_&#039; . $email_name . &#039;_subject&#039; );
				break;

		}

		// Get the default text is empty
		if(!$subject &amp;&amp; method_exists(&#039;GeoDir_Defaults&#039;,&#039;email_&#039; . $email_name . &#039;_subject&#039;)){
			$method = &#039;email_&#039; . $email_name . &#039;_subject&#039;;
			$subject = GeoDir_Defaults::$method();
		}

		if ( $subject ) {
			$subject = self::replace_variables( __( $subject, &#039;geodirectory&#039; ), $email_name, $email_vars );
		}

		return apply_filters( &#039;geodir_email_subject&#039;, $subject, $email_name, $email_vars );
	}

	/**
	 * Replace variables in the email text.
     *
     * @since 2.0.0
	 *
	 * @param string $content Content.
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 *
	 * @return mixed|void
	 */
	public static function replace_variables( $content, $email_name = &#039;&#039;, $email_vars = array() ) {
		$site_url        = home_url();
		$blogname        = geodir_get_blogname();
		$email_from_anme = self::get_mail_from_name();
		$login_url       = geodir_login_url( false ); // &#039;false&#039; to prevent adding redirect_to to login url.
		$timestamp       = current_time( &#039;timestamp&#039; );
		$date            = date_i18n( get_option( &#039;date_format&#039; ), $timestamp );
		$time            = date_i18n( get_option( &#039;time_format&#039; ), $timestamp );
		$date_time       = $date . &#039; &#039; . $time;

		$replace_array = array(
			&#039;[#blogname#]&#039;      =&gt; $blogname,
			&#039;[#site_url#]&#039;      =&gt; $site_url,
			&#039;[#site_name_url#]&#039; =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( $site_url ) . &#039;&quot;&gt;&#039; . $site_url . &#039;&lt;/a&gt;&#039;,
			&#039;[#site_link#]&#039;     =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( $site_url ) . &#039;&quot;&gt;&#039; . $blogname . &#039;&lt;/a&gt;&#039;,
			&#039;[#site_name#]&#039;     =&gt; $email_from_anme,
			&#039;[#login_url#]&#039;     =&gt; $login_url,
			&#039;[#login_link#]&#039;    =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( $login_url ) . &#039;&quot;&gt;&#039; . __( &#039;Login&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/a&gt;&#039;,
			&#039;[#current_date#]&#039;  =&gt; date_i18n( &#039;Y-m-d H:i:s&#039;, $timestamp ),
			&#039;[#date#]&#039;          =&gt; $date,
			&#039;[#time#]&#039;          =&gt; $time,
			&#039;[#date_time#]&#039;     =&gt; $date_time,
			&#039;[#from_name#]&#039;     =&gt; self::get_mail_from_name(),
			&#039;[#from_email#]&#039;    =&gt; self::get_mail_from(),
		);

		$gd_post = ! empty( $email_vars[&#039;post&#039;] ) ? $email_vars[&#039;post&#039;] : null;
		if ( empty( $gd_post ) &amp;&amp; ! empty( $email_vars[&#039;post_id&#039;] ) ) {
			$gd_post = geodir_get_post_info( $email_vars[&#039;post_id&#039;] );
		}

		if ( ! empty( $gd_post ) ) {
			$post_id          = $gd_post-&gt;ID;
			$post_author_name = geodir_get_client_name( $gd_post-&gt;post_author );

			$replace_array[&#039;[#post_id#]&#039;]          = $post_id;
			$replace_array[&#039;[#post_status#]&#039;]      = $gd_post-&gt;post_status;
			$replace_array[&#039;[#post_date#]&#039;]        = $gd_post-&gt;post_date;
			$replace_array[&#039;[#posted_date#]&#039;]      = $gd_post-&gt;post_date;
			$replace_array[&#039;[#post_author_ID#]&#039;]   = $gd_post-&gt;post_author;
			$replace_array[&#039;[#post_author_name#]&#039;] = $post_author_name;
			$replace_array[&#039;[#client_name#]&#039;]      = $post_author_name;
			$replace_array[&#039;[#listing_title#]&#039;]    = html_entity_decode( get_the_title( $post_id ), ENT_COMPAT, &#039;UTF-8&#039; );
			$replace_array[&#039;[#listing_url#]&#039;]      = get_permalink( $post_id );
			$replace_array[&#039;[#listing_link#]&#039;]     = &#039;&lt;a href=&quot;&#039; . esc_url( $replace_array[&#039;[#listing_url#]&#039;] ) . &#039;&quot;&gt;&#039; . $replace_array[&#039;[#listing_title#]&#039;] . &#039;&lt;/a&gt;&#039;;
		}

		$comment = ! empty( $email_vars[&#039;comment&#039;] ) ? $email_vars[&#039;comment&#039;] : null;
		if ( empty( $comment ) &amp;&amp; ! empty( $email_vars[&#039;comment_ID&#039;] ) ) {
			$comment = get_comment( $email_vars[&#039;comment_ID&#039;] );
		}
		if ( ! empty( $comment ) ) {
			$comment_ID = (int) $comment-&gt;comment_ID;

			$replace_array[&#039;[#comment_ID#]&#039;]              = $comment_ID;
			$replace_array[&#039;[#comment_author#]&#039;]          = $comment-&gt;comment_author;
			$replace_array[&#039;[#comment_author_IP#]&#039;]       = $comment-&gt;comment_author_IP;
			$replace_array[&#039;[#comment_author_email#]&#039;]    = $comment-&gt;comment_author_email;
			$replace_array[&#039;[#comment_date#]&#039;]            = $comment-&gt;comment_date;
			$replace_array[&#039;[#comment_content#]&#039;]         = wp_specialchars_decode( $comment-&gt;comment_content );
			$replace_array[&#039;[#comment_post_ID#]&#039;]         = (int) $comment-&gt;comment_post_ID;
			$replace_array[&#039;[#comment_post_title#]&#039;]      = html_entity_decode( get_the_title( (int) $comment-&gt;comment_post_ID ), ENT_COMPAT, &#039;UTF-8&#039; );
			$replace_array[&#039;[#comment_post_url#]&#039;]        = get_permalink( (int) $comment-&gt;comment_post_ID );
			$replace_array[&#039;[#comment_approve_link#]&#039;]    = admin_url( &quot;comment.php?action=approve&amp;c={$comment_ID}#wpbody-content&quot; );
			$replace_array[&#039;[#comment_trash_link#]&#039;]      = admin_url( &quot;comment.php?action=trash&amp;c={$comment_ID}#wpbody-content&quot; );
			$replace_array[&#039;[#comment_spam_link#]&#039;]       = admin_url( &quot;comment.php?action=spam&amp;c={$comment_ID}#wpbody-content&quot; );
			$replace_array[&#039;[#comment_moderation_link#]&#039;] = admin_url( &quot;edit-comments.php?comment_status=moderated#wpbody-content&quot; );

			// Review Rating data
			if ( ! geodir_cpt_has_rating_disabled( get_post_type( (int) $comment-&gt;comment_post_ID ) ) &amp;&amp; ( $rating = GeoDir_Comments::get_review( $comment_ID ) ) ) {
				$rating_titles = GeoDir_Comments::rating_texts();
				$rating_star = absint( $rating-&gt;rating );

				$replace_array[&#039;[#review_rating_star#]&#039;]  = $rating_star;
				$replace_array[&#039;[#review_rating_title#]&#039;] = isset( $rating_titles[ $rating_star ] ) ? html_entity_decode( $rating_titles[ $rating_star ], ENT_COMPAT, &#039;UTF-8&#039; ) : &#039;&#039;;
				$replace_array[&#039;[#review_city#]&#039;]         = ! empty( $rating-&gt;city ) ? html_entity_decode( $rating-&gt;city, ENT_COMPAT, &#039;UTF-8&#039; ) : &#039;&#039;;
				$replace_array[&#039;[#review_region#]&#039;]       = ! empty( $rating-&gt;region ) ? html_entity_decode( $rating-&gt;region, ENT_COMPAT, &#039;UTF-8&#039; ) : &#039;&#039;;
				$replace_array[&#039;[#review_country#]&#039;]      = ! empty( $rating-&gt;country ) ? html_entity_decode( $rating-&gt;country, ENT_COMPAT, &#039;UTF-8&#039; ) : &#039;&#039;;
				$replace_array[&#039;[#review_latitude#]&#039;]     = ! empty( $rating-&gt;latitude ) ? $rating-&gt;latitude : &#039;&#039;;
				$replace_array[&#039;[#review_longitude#]&#039;]    = ! empty( $rating-&gt;longitude ) ? $rating-&gt;longitude : &#039;&#039;;

			} else {
				$replace_array[&#039;[#review_rating_star#]&#039;]  = &#039;&#039;;
				$replace_array[&#039;[#review_rating_title#]&#039;] = &#039;&#039;;
				$replace_array[&#039;[#review_city#]&#039;]         = &#039;&#039;;
				$replace_array[&#039;[#review_region#]&#039;]       = &#039;&#039;;
				$replace_array[&#039;[#review_country#]&#039;]      = &#039;&#039;;
				$replace_array[&#039;[#review_latitude#]&#039;]     = &#039;&#039;;
				$replace_array[&#039;[#review_longitude#]&#039;]    = &#039;&#039;;
			}
		}

		foreach ( $email_vars as $key =&gt; $value ) {
			if ( is_scalar( $value ) ) {
				$replace_array[ &#039;[#&#039; . $key . &#039;#]&#039; ] = $value;
			}
		}

		$replace_array = apply_filters( &#039;geodir_email_wild_cards&#039;, $replace_array, $content, $email_name, $email_vars );

		foreach ( $replace_array as $key =&gt; $value ) {
			$content = str_replace( $key, $value, $content );
		}

		return apply_filters( &#039;geodir_email_content_replace_vars&#039;, $content, $email_name, $email_vars );
	}

	/**
	 * Get the from name for outgoing emails.
     *
     * @since 2.0.0
	 *
	 * @return string Site name.
	 */
	public static function get_mail_from_name() {
		$mail_from_name = geodir_get_option( &#039;email_name&#039; );

		if ( ! $mail_from_name ) {
			$mail_from_name = GeoDir_Defaults::email_name();
		}

		return apply_filters( &#039;geodir_get_mail_from_name&#039;, stripslashes( $mail_from_name ) );
	}

	/**
	 * Get the from address for outgoing emails.
     *
     * @since 2.0.0
	 *
	 * @return string|mixed|void The email ID.
	 */
	public static function get_mail_from() {
		$mail_from = geodir_get_option( &#039;email_address&#039; );

		if ( ! $mail_from ) {
			$mail_from = GeoDir_Defaults::email_address();
		}

		return apply_filters( &#039;geodir_get_mail_from&#039;, $mail_from );
	}

	/**
	 * Get the site admin email.
     *
     * @since 2.0.0
	 *
	 * @return mixed|void
	 */
	public static function get_admin_email() {
		$admin_email = get_option( &#039;admin_email&#039; );

		return apply_filters( &#039;geodir_admin_email&#039;, $admin_email );
	}

	/**
	 * Get the email content by type.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 *
	 * @return mixed|void
	 */
	public static function get_content( $email_name = &#039;&#039;, $email_vars = array() ) {
		switch ( $email_name ) {
			// TODO some custom options
			default:
				$content = geodir_get_option( &#039;email_&#039; . $email_name . &#039;_body&#039; );
				break;
		}

		// Get the default text is empty
		if(!$content &amp;&amp; method_exists(&#039;GeoDir_Defaults&#039;,&#039;email_&#039; . $email_name . &#039;_body&#039;)){
			$method = &#039;email_&#039; . $email_name . &#039;_body&#039;;
			$content = GeoDir_Defaults::$method();
		}

		if ( $content ) {
			$content = self::replace_variables( __( $content, &#039;geodirectory&#039; ), $email_name, $email_vars );
		}

		return apply_filters( &#039;geodir_email_content&#039;, $content, $email_name, $email_vars );
	}

	/**
	 * Get the email headers for sending.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name Email name.
	 * @param array $email_vars Optional. Email vars. Default array.
	 * @param string $from_email Optional. From email. Default null.
	 * @param string $from_name Optional. From name. Default null.
	 *
	 * @return mixed|void
	 */
	public static function get_headers( $email_name, $email_vars = array(), $from_email = &#039;&#039;, $from_name = &#039;&#039; ) {
		$from_email = ! empty( $from_email ) ? $from_email : self::get_mail_from();
		$from_name  = ! empty( $from_name ) ? $from_name : self::get_mail_from_name();
		$reply_to   = ! empty( $email_vars[&#039;reply_to&#039;] ) ? $email_vars[&#039;reply_to&#039;] : $from_email;

		$headers = &quot;From: &quot; . stripslashes_deep( html_entity_decode( $from_name, ENT_COMPAT, &#039;UTF-8&#039; ) ) . &quot; &lt;$from_email&gt;\r\n&quot;;
		$headers .= &quot;Reply-To: &quot; . $reply_to . &quot;\r\n&quot;;
		$headers .= &quot;Content-Type: &quot; . self::get_content_type() . &quot;; charset=\&quot;&quot; . get_option( &#039;blog_charset&#039; ) . &quot;\&quot;\r\n&quot;;

		return apply_filters( &#039;geodir_email_headers&#039;, $headers, $email_name, $email_vars, $from_email, $from_name );
	}

	/**
	 * Get the content type of the email html or plain.
     *
     * @since 2.0.0
	 *
	 * @param string $content_type Optional. Content type. Default text/html.
	 * @param string $email_type Optional. Email type. Default null.
	 *
	 * @return string $content_type
	 */
	public static function get_content_type( $content_type = &#039;text/html&#039;, $email_type = &#039;&#039; ) {
		if ( empty( $email_type ) ) {
			$email_type = self::get_email_type();
		}

		switch ( $email_type ) {
			case &#039;plain&#039; :
				$content_type = &#039;text/plain&#039;;
				break;
			case &#039;multipart&#039; :
				$content_type = &#039;multipart/alternative&#039;;
				break;
		}

		return $content_type;
	}

	/**
	 * Get the email type from settings, html/plain.
     *
     * @since 2.0.0
	 *
	 * @return mixed|void
	 */
	public static function get_email_type() {
		$email_type = geodir_get_option( &#039;email_type&#039; );

		if ( empty( $email_type ) ) {
			$email_type = &#039;html&#039;;
		}

		return apply_filters( &#039;geodir_get_email_type&#039;, $email_type );
	}

	/**
	 * Get the email attachments per type.
     *
     * @since 2.0.0
	 *
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 *
	 * @return mixed|void
	 */
	public static function get_attachments( $email_name = &#039;&#039;, $email_vars = array() ) {
		$attachments = array();

		return apply_filters( &#039;geodir_email_attachments&#039;, $attachments, $email_name, $email_vars );
	}

	/**
     * Send email.
     *
     * @since 2.0.0
     *
	 * @param string $to To email address.
	 * @param string $subject Email subject.
	 * @param string $message Email message.
	 * @param string $headers Email Headers.
	 * @param array $attachments Optional. Email attachments. Default array.
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default null.
	 *
	 * @return bool
	 */
	public static function send( $to, $subject, $message, $headers, $attachments = array(), $email_name = &#039;&#039;, $email_vars = array() ) {
		add_filter( &#039;wp_mail_from&#039;, array( __CLASS__, &#039;get_mail_from&#039; ) );
		add_filter( &#039;wp_mail_from_name&#039;, array( __CLASS__, &#039;get_mail_from_name&#039; ) );
		add_filter( &#039;wp_mail_content_type&#039;, array( __CLASS__, &#039;get_content_type&#039; ) );

		$message = self::style_body( $message, $email_name, $email_vars );
		$message = apply_filters( &#039;geodir_mail_content&#039;, $message, $email_name, $email_vars );

		$sent = wp_mail( $to, $subject, $message, $headers, $attachments );

		if ( ! $sent ) {
			$log_message = wp_sprintf( __( &quot;\nTime: %s\nTo: %s\nSubject: %s\n&quot;, &#039;geodirectory&#039; ), date_i18n( &#039;F j Y H:i:s&#039;, current_time( &#039;timestamp&#039; ) ), ( is_array( $to ) ? implode( &#039;, &#039;, $to ) : $to ), $subject );
			geodir_error_log( $log_message, __( &quot;Email from GeoDirectory plugin failed to send&quot;, &#039;geodirectory&#039; ), __FILE__, __LINE__ );
		}

		remove_filter( &#039;wp_mail_from&#039;, array( __CLASS__, &#039;geodir_get_mail_from&#039; ) );
		remove_filter( &#039;wp_mail_from_name&#039;, array( __CLASS__, &#039;geodir_get_mail_from_name&#039; ) );
		remove_filter( &#039;wp_mail_content_type&#039;, array( __CLASS__, &#039;geodir_mail_get_content_type&#039; ) );

		return $sent;
	}

	/**
	 * Style the body of the email content.
     *
     * @since 2.0.0
	 *
	 * @param string $content Email content.
	 * @param string $email_name Optional. Email name. Default null.
	 * @param array $email_vars Optional. Email vars. Default array.
	 *
	 * @return string $content.
	 */
	public static function style_body( $content, $email_name = &#039;&#039;, $email_vars = array() ) {
		// make sure we only inline CSS for html emails
		if ( in_array( self::get_email_type(), array( &#039;html&#039;, &#039;multipart&#039; ) ) &amp;&amp; class_exists( &#039;DOMDocument&#039; ) ) {
			// include css inliner
			if ( ! class_exists( &#039;Emogrifier&#039; ) ) {
				include_once( GEODIRECTORY_PLUGIN_DIR . &#039;includes/libraries/class-emogrifier.php&#039; );
			}

			ob_start();
			geodir_get_template( &#039;emails/geodir-email-styles.php&#039;, array(
				&#039;email_name&#039; =&gt; $email_name,
				&#039;email_vars&#039; =&gt; $email_vars
			) );
			$css = apply_filters( &#039;geodir_email_styles&#039;, ob_get_clean() );

			// apply CSS styles inline for picky email clients
			try {
				$emogrifier = new Emogrifier( $content, $css );
				$content    = $emogrifier-&gt;emogrify();
			} catch ( Exception $e ) {
				geodir_error_log( $e-&gt;getMessage(), &#039;emogrifier&#039; );
			}
		}

		return $content;
	}



	/******************************************* Emails ***************************************/

	/**
	 * Check if the admin BCC is active for the email type.
	 *
     * @since 2.0.0
     *
	 * @param string $email_name Optional. Email name. Default null.
	 *
	 * @return mixed|void
	 */
	public static function is_admin_bcc_active( $email_name = &#039;&#039; ) {
		switch ( $email_name ) {
			// TODO add some cases
			default:
				$active = geodir_get_option( &#039;email_bcc_&#039; . $email_name );
				$active = $active === &#039;yes&#039; || $active == &#039;1&#039; ? true : false;
				break;
		}

		return apply_filters( &#039;geodir_mail_admin_bcc_active&#039;, $active, $email_name );
	}
	
	/**
	 * Send the user an email when their post is published.
     *
     * @since 2.0.0
	 *
	 * @param object $post Post data object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool
	 */
	public static function send_user_publish_post_email( $post, $data = array() ) {
		$email_name = &#039;user_publish_post&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$author_data = get_userdata( $post-&gt;post_author );
		if ( empty( $author_data ) ) {
			return false;
		}

		$recipient = ! empty( $author_data-&gt;user_email ) ? $author_data-&gt;user_email : &#039;&#039;;

		if ( empty( $post ) || ! is_email( $recipient ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $post;
		$email_vars[&#039;to_name&#039;]  = geodir_get_client_name( $post-&gt;post_author );
		$email_vars[&#039;to_email&#039;] = $recipient;

		do_action( &#039;geodir_pre_user_publish_post_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; false,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		if ( self::is_admin_bcc_active( $email_name ) ) {
			$recipient = self::get_admin_email();
			$subject .= &#039; - ADMIN BCC COPY&#039;;
			self::send( $recipient, $subject, $content, $headers, $attachments );
		}

		do_action( &#039;geodir_post_user_publish_post_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send some email on post save.
     *
     * @since 2.0.0
	 *
     * @global object $gd_notified_edited Geo Directory notified edited object.
     *
	 * @param array $post_data {
     *      An array for post data.
     *      @type int @ID Post ID.
     * }
     *
	 * @param bool $update Optional. Update value. Default false.
	 */
	public static function send_email_on_post_saved( $post_data, $update = false ) {
		global $gd_notified_edited;

		if ( empty( $post_data[&#039;ID&#039;] ) ) {
			return;
		}

		$post_ID = $post_data[&#039;ID&#039;];
		if ( wp_is_post_revision( $post_ID ) ) {
			$post_ID = wp_get_post_parent_id( $post_ID );
		}

		$gd_post = geodir_get_post_info( $post_ID );

		if ( empty( $gd_post ) ) {
			return;
		}

		if ( $update ) {
			$user_id = (int) get_current_user_id();

			if ( $user_id &gt; 0 &amp;&amp; ! empty( $gd_post-&gt;post_author ) &amp;&amp; $user_id == $gd_post-&gt;post_author &amp;&amp; ! current_user_can( &#039;manage_options&#039; ) &amp;&amp; empty( $gd_notified_edited[ $post_ID ] ) &amp;&amp; self::is_email_enabled( &#039;admin_post_edit&#039; ) ) {
				if ( empty( $gd_notified_edited ) ) {
					$gd_notified_edited = array();
				}
				$gd_notified_edited[ $post_ID ] = true;

				self::send_admin_post_edit_email( $gd_post );
			}
		}

		// is post status not set then get the real status
		if ( ! isset( $post_data[&#039;post_status&#039;] ) ) {
			$post_data[&#039;post_status&#039;] = get_post_status( $post_ID );
		}

		if ( isset( $post_data[&#039;post_status&#039;] ) &amp;&amp; $post_data[&#039;post_status&#039;] == &#039;pending&#039; ) {
			// Send email to admin
			self::send_admin_pending_post_email( $gd_post );

			// Send email to user
			self::send_user_pending_post_email( $gd_post );
		}
	}

	/**
	 * Send the admin an email when a post is edited.
     *
     * @since 2.0.0
	 *
	 * @param object $post Post data object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool|void
	 */
	public static function send_admin_post_edit_email( $post, $data = array() ) {
		$email_name = &#039;admin_post_edit&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$recipient = self::get_admin_email();

		if ( empty( $post ) || ! is_email( $recipient ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $post;
		$email_vars[&#039;to_email&#039;] = self::get_admin_email();

		do_action( &#039;geodir_pre_admin_post_edit_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; true,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		do_action( &#039;geodir_post_admin_post_edit_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send the admin the post pending review email.
     *
     * @since 2.0.0
	 *
	 * @param object $post Post data object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool|void
	 */
	public static function send_admin_pending_post_email( $post, $data = array() ) {
		$email_name = &#039;admin_pending_post&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$recipient = self::get_admin_email();

		if ( empty( $post ) || ! is_email( $recipient ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $post;
		$email_vars[&#039;to_email&#039;] = self::get_admin_email();

		do_action( &#039;geodir_pre_admin_pending_post_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; true,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		do_action( &#039;geodir_post_admin_pending_post_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send the user an email about their post pending review.
     *
     * @since 2.0.0
	 *
	 * @param object $post Post data object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool
	 */
	public static function send_user_pending_post_email( $post, $data = array() ) {
		$email_name = &#039;user_pending_post&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$author_data = get_userdata( $post-&gt;post_author );
		if ( empty( $author_data ) ) {
			return false;
		}

		$recipient = ! empty( $author_data-&gt;user_email ) ? $author_data-&gt;user_email : &#039;&#039;;

		if ( empty( $post ) || ! is_email( $recipient ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $post;
		$email_vars[&#039;to_name&#039;]  = geodir_get_client_name( $post-&gt;post_author );
		$email_vars[&#039;to_email&#039;] = $recipient;

		do_action( &#039;geodir_pre_user_pending_post_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; false,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		if ( self::is_admin_bcc_active( $email_name ) ) {
			$recipient = self::get_admin_email();
			$subject .= &#039; - ADMIN BCC COPY&#039;;
			self::send( $recipient, $subject, $content, $headers, $attachments );
		}

		do_action( &#039;geodir_post_user_pending_post_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send the listing owner a notification about a new comment.
     *
     * @since 2.0.0
	 *
	 * @param object $comment Comment object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool
	 */
	public static function send_owner_comment_submit_email( $comment, $data = array() ) {
		$email_name = &#039;owner_comment_submit&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		if ( empty( $comment ) || empty( $comment-&gt;comment_post_ID ) ) {
			return false;
		}

		if ( ! geodir_is_gd_post_type( get_post_type( $comment-&gt;comment_post_ID ) ) ) {
			return false;
		}

		$gd_post = geodir_get_post_info( $comment-&gt;comment_post_ID );
		if ( empty( $gd_post ) ) {
			return false;
		}

		$author = get_userdata( $gd_post-&gt;post_author );
		if ( empty( $author ) ) {
			return false;
		}

		$recipient = $author-&gt;user_email;
		$to_name   = geodir_get_client_name( $gd_post-&gt;post_author );

		if ( empty( $comment ) || ! is_email( $recipient ) ) {
			return;
		}
		$comment_ID = $comment-&gt;comment_ID;

		$email_vars              = $data;
		$email_vars[&#039;post&#039;]      = $gd_post;
		$email_vars[&#039;comment&#039;]   = $comment;
		$email_vars[&#039;to_name&#039;]   = $to_name;
		$email_vars[&#039;to_email&#039;]  = $recipient;
		$email_vars[&#039;from_name&#039;] = ! empty( $comment-&gt;comment_author ) ? $comment-&gt;comment_author : &#039;&#039;;
		$email_vars[&#039;reply_to&#039;]  = ! empty( $comment-&gt;comment_author_email ) ? $comment-&gt;comment_author_email : &#039;&#039;;

		// Author does not allowed to moderate comments.
		if ( ! $author-&gt;has_cap( &#039;moderate_comments&#039; ) ) {
			$home_url                              = trailingslashit( home_url() );
			$email_vars[&#039;comment_approve_link&#039;]    = add_query_arg( array(
				&#039;_gd_action&#039; =&gt; &#039;approve_comment&#039;,
				&#039;c&#039;          =&gt; $comment_ID,
				&#039;_nonce&#039;     =&gt; md5( &#039;approve_comment_&#039; . $comment_ID )
			), $home_url );
			$email_vars[&#039;comment_trash_link&#039;]      = add_query_arg( array(
				&#039;_gd_action&#039; =&gt; &#039;trash_comment&#039;,
				&#039;c&#039;          =&gt; $comment_ID,
				&#039;_nonce&#039;     =&gt; md5( &#039;trash_comment_&#039; . $comment_ID )
			), $home_url );
			$email_vars[&#039;comment_spam_link&#039;]       = add_query_arg( array(
				&#039;_gd_action&#039; =&gt; &#039;spam_comment&#039;,
				&#039;c&#039;          =&gt; $comment_ID,
				&#039;_nonce&#039;     =&gt; md5( &#039;spam_comment_&#039; . $comment_ID )
			), $home_url );
			$email_vars[&#039;comment_moderation_link&#039;] = &#039;&#039;;
		}

		do_action( &#039;geodir_pre_owner_comment_submit_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars, &#039;&#039;, $email_vars[&#039;from_name&#039;] );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; false,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		if ( self::is_admin_bcc_active( $email_name ) ) {
			$recipient = self::get_admin_email();
			$subject .= &#039; - ADMIN BCC COPY&#039;;
			self::send( $recipient, $subject, $content, $headers, $attachments );
		}

		do_action( &#039;geodir_post_owner_comment_submit_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send the listing owner notification when comment approved.
     *
     * @since 2.0.0
	 *
	 * @param object $comment Comment object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool
	 */
	public static function send_owner_comment_approved_email( $comment, $data = array() ) {
		$email_name = &#039;owner_comment_approved&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$gd_post = geodir_get_post_info( $comment-&gt;comment_post_ID );
		if ( empty( $gd_post ) || empty( $comment ) ) {
			return;
		}

		$author_data = get_userdata( $gd_post-&gt;post_author );
		if ( empty( $author_data ) ) {
			return false;
		}

		$recipient = ! empty( $author_data-&gt;user_email ) ? $author_data-&gt;user_email : &#039;&#039;;

		if ( empty( $gd_post ) || ! is_email( $recipient ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $gd_post;
		$email_vars[&#039;comment&#039;]  = $comment;
		$email_vars[&#039;to_name&#039;]  = geodir_get_client_name( $gd_post-&gt;post_author );
		$email_vars[&#039;to_email&#039;] = $recipient;

		do_action( &#039;geodir_pre_owner_comment_approved_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; false,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		if ( self::is_admin_bcc_active( $email_name ) ) {
			$recipient = self::get_admin_email();
			$subject .= &#039; - ADMIN BCC COPY&#039;;
			self::send( $recipient, $subject, $content, $headers, $attachments );
		}

		do_action( &#039;geodir_post_owner_comment_approved_email&#039;, $email_name, $email_vars );

		return $sent;
	}

	/**
	 * Send the comment author an email when their comment is approved.
     *
     * @since 2.0.0
	 *
	 * @param object $comment Comment object.
	 * @param array $data Optional. Data array. Default array.
	 *
	 * @return bool
	 */
	public static function send_author_comment_approved_email( $comment, $data = array() ) {
		$email_name = &#039;author_comment_approved&#039;;

		if ( ! self::is_email_enabled( $email_name ) ) {
			return false;
		}

		$recipient = ! empty( $comment-&gt;comment_author_email ) ? $comment-&gt;comment_author_email : &#039;&#039;;
		$to_name   = ! empty( $comment-&gt;comment_author ) ? $comment-&gt;comment_author : __( &#039;Author&#039;, &#039;geodirectory&#039; );

		if ( empty( $comment ) || ! is_email( $recipient ) ) {
			return;
		}

		$gd_post = geodir_get_post_info( $comment-&gt;comment_post_ID );
		if ( empty( $gd_post ) ) {
			return;
		}

		$email_vars             = $data;
		$email_vars[&#039;post&#039;]     = $gd_post;
		$email_vars[&#039;comment&#039;]  = $comment;
		$email_vars[&#039;to_name&#039;]  = $to_name;
		$email_vars[&#039;to_email&#039;] = $recipient;

		do_action( &#039;geodir_pre_author_comment_approved_email&#039;, $email_name, $email_vars );

		$subject      = self::get_subject( $email_name, $email_vars );
		$message_body = self::get_content( $email_name, $email_vars );
		$headers      = self::get_headers( $email_name, $email_vars );
		$attachments  = self::get_attachments( $email_name, $email_vars );

		$plain_text = self::get_email_type() != &#039;html&#039; ? true : false;
		$template   = $plain_text ? &#039;emails/plain/geodir-email-&#039; . $email_name . &#039;.php&#039; : &#039;emails/geodir-email-&#039; . $email_name . &#039;.php&#039;;

		$content = geodir_get_template_html( $template, array(
			&#039;email_name&#039;    =&gt; $email_name,
			&#039;email_vars&#039;    =&gt; $email_vars,
			&#039;email_heading&#039;	=&gt; &#039;&#039;,
			&#039;sent_to_admin&#039; =&gt; false,
			&#039;plain_text&#039;    =&gt; $plain_text,
			&#039;message_body&#039;  =&gt; $message_body,
		) );

		$sent = self::send( $recipient, $subject, $content, $headers, $attachments );

		if ( self::is_admin_bcc_active( $email_name ) ) {
			$recipient = self::get_admin_email();
			$subject .= &#039; - ADMIN BCC COPY&#039;;
			self::send( $recipient, $subject, $content, $headers, $attachments );
		}

		do_action( &#039;geodir_post_author_comment_approved_email&#039;, $email_name, $email_vars );

		return $sent;
	}

}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 07:38 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652341136"></script>
    <script src="../js/search.js?updated=1652341136"></script>
</body>
</html>
