<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337338">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337338">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-settings-cpt-tabs.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDirectory CPT Sorting Settings
 *
 * @author      AyeCode
 * @category    Admin
 * @package     GeoDirectory/Admin
 * @version     2.0.0
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit; // Exit if accessed directly
}

if ( ! class_exists( &#039;GeoDir_Settings_Cpt_Tabs&#039;, false ) ) :

	/**
	 * GeoDir_Admin_Settings_General.
	 */
	class GeoDir_Settings_Cpt_Tabs extends GeoDir_Settings_Page {

		/**
		 * Post type.
		 *
		 * @var string
		 */
		private static $post_type = &#039;&#039;;

		/**
		 * Sub tab.
		 *
		 * @var string
		 */
		private static $sub_tab = &#039;&#039;;

		/**
		 * Constructor.
		 */
		public function __construct() {

			self::$post_type = ( ! empty( $_REQUEST[&#039;post_type&#039;] ) &amp;&amp; is_scalar( $_REQUEST[&#039;post_type&#039;] ) ) ? sanitize_title( $_REQUEST[&#039;post_type&#039;] ) : &#039;gd_place&#039;;
			self::$sub_tab   = ! empty( $_REQUEST[&#039;tab&#039;] ) ? sanitize_title( $_REQUEST[&#039;tab&#039;] ) : &#039;general&#039;;


			$this-&gt;id    = &#039;cpt-tabs&#039;;
			$this-&gt;label = __( &#039;Tabs&#039;, &#039;geodirectory&#039; );

			add_filter( &#039;geodir_settings_tabs_array&#039;, array( $this, &#039;add_settings_page&#039; ), 20 );
			add_action( &#039;geodir_settings_&#039; . $this-&gt;id, array( $this, &#039;output&#039; ) );

			add_action( &#039;geodir_manage_tabs_available_fields&#039;, array( $this, &#039;output_standard_fields&#039; ) );
			add_action( &#039;geodir_manage_tabs_available_fields_predefined&#039;, array( $this, &#039;output_predefined_fields&#039; ), 1, 2 );
			add_action( &#039;geodir_manage_tabs_available_fields_custom&#039;, array( $this, &#039;output_custom_fields&#039; ),1,2 );


		}

		/**
		 * Get sections.
		 *
		 * @return array
		 */
		public function get_sections() {

			$sections = array(
				//&#039;&#039; =&gt; __( &#039;Custom Fields&#039;, &#039;geodirectory&#039; ),
				//	&#039;location&#039;       =&gt; __( &#039;Custom fields&#039;, &#039;geodirectory&#039; ),
				//	&#039;pages&#039; 	=&gt; __( &#039;Sorting options&#039;, &#039;geodirectory&#039; ),
				//&#039;dummy_data&#039; 	=&gt; __( &#039;Dummy Data&#039;, &#039;geodirectory&#039; ),
				//&#039;uninstall&#039; 	=&gt; __( &#039;Uninstall&#039;, &#039;geodirectory&#039; ),
			);

			return apply_filters( &#039;geodir_get_sections_&#039; . $this-&gt;id, $sections );
		}

		/**
		 * Output the settings.
		 */
		public function output() {
			global $hide_save_button;

			$hide_save_button = true;

			$listing_type = self::$post_type;

			$sub_tab = self::$sub_tab;

			include( dirname( __FILE__ ) . &#039;/../views/html-admin-settings-cpt-cf.php&#039; );


		}


		/**
		 * Returns heading for the CPT settings left panel.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 * @return string The page heading.
		 */
		public static function left_panel_title() {
			return sprintf( __( &#039;Fields&#039;, &#039;geodirectory&#039; ), geodir_get_post_type_singular_label( self::$post_type, false, true ) );

		}

		/**
		 * Returns description for given sub tab - available fields box.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 * @return string The box description.
		 */
		public function left_panel_note() {
			return sprintf( __( &#039;Fields that can be added to the %s tabs.&#039;, &#039;geodirectory&#039; ), geodir_get_post_type_singular_label( self::$post_type, false, true ) );
		}

		/**
		 * Output the admin settings cpt sorting left panel content.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 */
		public function left_panel_content() {
			?&gt;
			&lt;h3 class=&quot;h6 text-muted&quot;&gt;&lt;?php _e( &#039;Standard Fields&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h3&gt;

			&lt;div class=&quot;inside&quot;&gt;

				&lt;div id=&quot;gd-form-builder-tab&quot; class=&quot;gd-form-builder-tab gd-tabs-panel&quot;&gt;

					&lt;?php
					/**
					 * Adds the available fields to the custom fields settings page per post type.
					 *
					 * @since 1.0.0
					 *
					 * @param string $sub_tab The current settings tab name.
					 */
					do_action( &#039;geodir_manage_tabs_available_fields&#039;, self::$sub_tab, self::$post_type  ); ?&gt;

					&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
				&lt;/div&gt;

			&lt;/div&gt;

			&lt;h3 class=&quot;h6  text-muted&quot;&gt;&lt;?php _e( &#039;Predefined Fields&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h3&gt;
			&lt;div class=&quot;inside&quot;&gt;

				&lt;div id=&quot;gd-form-builder-tab-predefined&quot; class=&quot;gd-form-builder-tab gd-tabs-panel&quot;&gt;

					&lt;?php
					/**
					 * Adds the available fields to the custom fields predefined settings page per post type.
					 *
					 * @since 1.6.9
					 *
					 * @param string $sub_tab The current settings tab name.
					 */
					do_action( &#039;geodir_manage_tabs_available_fields_predefined&#039;, self::$sub_tab, self::$post_type ); ?&gt;

					&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
				&lt;/div&gt;

			&lt;/div&gt;

			&lt;h3 class=&quot;h6  text-muted&quot;&gt;&lt;?php _e( &#039;Custom Fields&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h3&gt;
			&lt;div class=&quot;inside&quot;&gt;

				&lt;div id=&quot;gd-form-builder-tab&quot; class=&quot;gd-tabs-panel&quot;&gt;

					&lt;?php
					/**
					 * Adds the available fields to the custom fields custom added settings page per post type.
					 *
					 * @since 1.6.9
					 *
					 * @param string $sub_tab The current settings tab name.
					 */
					do_action( &#039;geodir_manage_tabs_available_fields_custom&#039;, self::$sub_tab, self::$post_type  ); ?&gt;

					&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
				&lt;/div&gt;

			&lt;/div&gt;
			&lt;?php
		}


		/**
		 * Returns heading for the CPT settings left panel.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 * @return string The page heading.
		 */
		public static function right_panel_title() {
			return sprintf( __( &#039;%s Tabs&#039;, &#039;geodirectory&#039; ), geodir_get_post_type_singular_label( self::$post_type, false, true ) );
		}

		/**
		 * Returns description for given sub tab - available fields box.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 * @return string The box description.
		 */
		public function right_panel_note() {
			return sprintf( __( &#039;Drag and drop the items to create the %s tabs.&#039;, &#039;geodirectory&#039; ), geodir_get_post_type_singular_label( self::$post_type, false, true ) );
		}

        /**
         * Get tab fields.
         *
         * @since 2.0.0
         *
         * @param string $post_type Post type value.
         * @param string $type Optional. Tab layout values. .Default post.
         *
         * @global object $wpdb WordPress Database object.
         *
         * @return array|object.
         */
		public static function get_tabs_fields($post_type,$type=&#039;post&#039;){
			global $wpdb;
			return $wpdb-&gt;get_results($wpdb-&gt;prepare(&quot;SELECT * FROM &quot;.GEODIR_TABS_LAYOUT_TABLE.&quot; WHERE post_type=%s AND tab_layout=%s ORDER BY sort_order ASC&quot;,$post_type,$type));

		}
		/**
		 * Output the admin cpt settings fields left panel content.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 */
		public function right_panel_content() {

			$type = &quot;post&quot;;
			$post_type = self::$post_type;
			global $wpdb;
			$tabs = self::get_tabs_fields($post_type,$type);
			//print_r($tabs);
			?&gt;
			&lt;form&gt;&lt;/form&gt; &lt;!-- chrome removes the first form inside a form for some reason so we need this ?&gt; --&gt;
			&lt;div class=&quot;inside&quot;&gt;

				&lt;div id=&quot;gd-form-builder-tab&quot; class=&quot;gd-form-builder-tab gd-tabs-panel&quot;&gt;
					&lt;div class=&quot;field_row_main&quot;&gt;
						&lt;div class=&quot;dd gd-tabs-layout&quot; &gt;
							
							&lt;?php


							echo &#039;&lt;ul class=&quot;dd-list gd-tabs-sortable gd-tabs-layout-sortable&quot;&gt;&#039;;

							if ( ! empty( $tabs ) ) {

								echo self::loop_tabs_output($tabs);

							} else {
								_e( &#039;No tab items have been added yet.&#039;, &#039;geodirectory&#039; );
							}
							echo &#039;&lt;/ul&gt;&#039;;

							?&gt;

						&lt;/div&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
					
			&lt;?php
		}


		/**
		 * Loop through the base to output them with the different levels.
		 * @param $tabs
		 * @param bool $sub
		 */
		public static function loop_tabs_output($tabs,$tab_id = &#039;&#039;){
			ob_start();

			if(!empty($tabs)){
				foreach($tabs as $key =&gt; $tab){
					
					if($tab_id &amp;&amp; $tab-&gt;id!=$tab_id){
						continue;
					}elseif($tab_id &amp;&amp; $tab-&gt;id==$tab_id &amp;&amp; $tab-&gt;tab_level &gt; 0){
						echo self::get_tab_item($tab); break;
					}

					if($tab-&gt;tab_level==&#039;1&#039; ){continue;}


					$tab_rendered = self::get_tab_item($tab);
					$tab_rendered = str_replace(&quot;&lt;/li&gt;&quot;,&quot;&quot;,$tab_rendered);
					$child_tabs = &#039;&#039;;
					foreach($tabs as $child_tab){
						if($child_tab-&gt;tab_parent==$tab-&gt;id){
							$child_tabs .= self::get_tab_item($child_tab);
						}
					}

					if($child_tabs){
						$tab_rendered .= &quot;&lt;ul&gt;&quot;;
						$tab_rendered .= $child_tabs;
						$tab_rendered .= &quot;&lt;/ul&gt;&quot;;
					}

					echo $tab_rendered;
					echo &quot;&lt;/li&gt;&quot;;

					unset($tabs[$key]);

				}
			}
			return ob_get_clean();
		}

        /**
         * Delete loop tabs output.
         *
         * @since 2.0.0
         *
         * @param array $tabs Tab Fields information.
         * @param bool $sub Optional. Tab sub values. Default false.
         */
		public static function loop_tabs_output_delete_me($tabs,$sub = false){
			if(!empty($tabs)){
				foreach($tabs as $key =&gt; $tab){
					$tab_rendered = self::get_tab_item($tab);

					if($sub &amp;&amp; $tab-&gt;tab_level==&#039;1&#039;){
						echo $tab_rendered;
					}elseif($tab-&gt;tab_level==&#039;0&#039;){
						if($sub){break;}
						$tab_rendered = str_replace(&quot;&lt;/li&gt;&quot;,&quot;&quot;,$tab_rendered);
						echo $tab_rendered;
						unset($tabs[$key]);
						echo &quot;&lt;ul&gt;&quot;;
						self::loop_tabs_output($tabs,true);
						echo &quot;&lt;/ul&gt;&quot;;
						echo &quot;&lt;/li&gt;&quot;;
					}
					unset($tabs[$key]);

				}
			}
		}

		/**
		 * Check if the field already exists.
		 *
		 * @param $field
		 *
		 * @return WP_Error
		 */
		public static function field_exists( $htmlvar_name, $post_type ) {
			global $wpdb;

			$check_html_variable = $wpdb-&gt;get_var(
				$wpdb-&gt;prepare(
					&quot;SELECT htmlvar_name FROM &quot; . GEODIR_CUSTOM_SORT_FIELDS_TABLE . &quot; WHERE htmlvar_name = %s AND post_type = %s&quot;,
					array( $htmlvar_name, $post_type )
				)
			);

			return $check_html_variable;

		}


		/**
		 * Output the tab fields to be selected.
		 *
		 * @param $cfs
		 */
		public function output_fields($cfs) {
			if ( ! empty( $cfs ) ) {
				echo &#039;&lt;ul class=&quot;row row-cols-2 px-2&quot;&gt;&#039;;
				foreach ( $cfs as $id =&gt; $cf ) {
					$cf = stripslashes_deep( (array)$cf );
					// tab icon
					$icon = ! empty( $cf[&#039;tab_icon&#039;] ) ? $cf[&#039;tab_icon&#039;] : &#039;&#039;;

					// Set the field icon
					if ( geodir_is_fa_icon( $icon ) ) {
						$tab_icon = &#039;&lt;i class=&quot;&#039; . esc_attr( $icon ) . &#039;&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039;;
					} elseif ( geodir_is_icon_url( $icon ) ) {
						$tab_icon = &#039;&lt;b style=&quot;background-image: url(&quot;&#039; . $icon . &#039;&quot;)&quot;&gt;&lt;/b&gt;&#039;;
					} else {
						$tab_icon = &#039;&lt;i class=&quot;fas fa-cog&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039;;
					}
					?&gt;
					&lt;li class=&quot;col px-1&quot;&gt;
						&lt;a id=&quot;gd-&lt;?php echo esc_attr($cf[&#039;tab_key&#039;]); ?&gt;&quot;
						   class=&quot;gd-draggable-form-items gd-fieldset  btn btn-sm d-block m-0 btn-outline-gray text-dark text-left&quot;
						   href=&quot;javascript:void(0);&quot;
						   data-tab_layout=&quot;post&quot;
						   data-tab_type=&quot;&lt;?php echo esc_attr($cf[&#039;tab_type&#039;]); ?&gt;&quot;
						   data-tab_name=&quot;&lt;?php echo esc_attr($cf[&#039;tab_name&#039;]); ?&gt;&quot;
						   data-tab_icon=&quot;&lt;?php echo esc_attr($cf[&#039;tab_icon&#039;]); ?&gt;&quot;
						   data-tab_key=&quot;&lt;?php echo esc_attr($cf[&#039;tab_key&#039;]); ?&gt;&quot;
						   data-tab_content=&quot;&lt;?php echo esc_attr($cf[&#039;tab_content&#039;]); ?&gt;&quot;
						   onclick=&quot;gd_tabs_add_tab(this);return false;&quot;&gt;
							&lt;?php echo $tab_icon; ?&gt;
							&lt;?php echo esc_attr($cf[&#039;tab_name&#039;]); ?&gt;
						&lt;/a&gt;
					&lt;/li&gt;
					&lt;?php
				}
				echo &#039;&lt;/ul&gt;&#039;;
			} else {
				_e( &#039;There are no custom fields here yet.&#039;, &#039;geodirectory&#039; );
			}
		}

		/**
		 * Adds admin html for custom fields available fields.
		 *
		 * @since 1.0.0
		 * @since 1.6.9 Added
		 *
		 * @param string $type The custom field type, predefined, custom or blank for default
		 *
		 * @package GeoDirectory
		 */
		public function output_standard_fields() {
			$cfs = self::get_standard_fields();
			self::output_fields($cfs);

		}

        /**
         * Get standard fields.
         *
         * @since 2.0.0
         *
         * @global object $wpdb WordPress Database object.
         *
         * @return array $fields.
         */
		public function get_standard_fields(){
			global $wpdb;
			$fields = array();


			// shortcode
			$fields[] = array(
				&#039;tab_type&#039;   =&gt; &#039;fieldset&#039;,
				&#039;tab_name&#039;   =&gt; __(&#039;Fieldset&#039;,&#039;geodirectory&#039;),
				&#039;tab_icon&#039;   =&gt; &#039;fas fa-minus&#039;,
				&#039;tab_key&#039;    =&gt; &#039;&#039;,
				&#039;tab_content&#039;=&gt; &#039;&#039;
			);

			$table = GEODIR_CUSTOM_FIELDS_TABLE;
			$cfs = $wpdb-&gt;get_results($wpdb-&gt;prepare(&quot;SELECT * FROM $table WHERE post_type=%s&quot;,self::$post_type));
			if(!empty($cfs)){
				foreach($cfs as $cf){
					$cf = (array)$cf;
					$fields[] = array(
						&#039;tab_type&#039;   =&gt; &#039;meta&#039;,
						&#039;tab_name&#039;   =&gt; !empty($cf[&#039;admin_title&#039;]) ? esc_attr($cf[&#039;admin_title&#039;]) : esc_attr($cf[&#039;frontend_title&#039;]),
						&#039;tab_icon&#039;   =&gt; isset($cf[&#039;field_icon&#039;]) &amp;&amp; $cf[&#039;field_icon&#039;] ? $cf[&#039;field_icon&#039;] : &quot;fas fa-cog&quot;,
						&#039;tab_key&#039;    =&gt; esc_attr($cf[&#039;htmlvar_name&#039;]),
						&#039;tab_content&#039;=&gt; &#039;&#039;
					);
				}

			}


			return $fields;
		}

		/**
		 * Adds admin html for custom fields available fields.
		 *
		 * @since 1.0.0
		 * @since 1.6.9 Added
		 *
		 * @param string $type The custom field type, predefined, custom or blank for default
		 *
		 * @package GeoDirectory
		 */
		public function output_predefined_fields( $sub_tab, $post_type ) {
			$cfs = self::get_predefined_fields( $post_type );
			self::output_fields($cfs);
		}

        /**
         * Get predefined fields.
         *
         * @since 2.0.0
         *
         * @param string $post_type Posttype values.
         * @return array $fields.
         */
		public function get_predefined_fields( $post_type ){
			$fields = array();

			// Reviews
			$fields[] = array(
				&#039;tab_type&#039;   =&gt; &#039;standard&#039;,
				&#039;tab_name&#039;   =&gt; __(&#039;Reviews&#039;,&#039;geodirectory&#039;),
				&#039;tab_icon&#039;   =&gt; &#039;fas fa-comments&#039;,
				&#039;tab_key&#039;    =&gt; &#039;reviews&#039;,
				&#039;tab_content&#039;=&gt; &#039;&#039;
			);

			// Map
			$fields[] = array(
				&#039;tab_type&#039;   =&gt; &#039;standard&#039;,
				&#039;tab_name&#039;   =&gt; __(&#039;Map&#039;,&#039;geodirectory&#039;),
				&#039;tab_icon&#039;   =&gt; &#039;fas fa-globe-americas&#039;,
				&#039;tab_key&#039;    =&gt; &#039;post_map&#039;,
				&#039;tab_content&#039;=&gt; &#039;[gd_map width=&quot;100%&quot; height=&quot;425px&quot; maptype=&quot;ROADMAP&quot; zoom=&quot;0&quot; map_type=&quot;post&quot; map_directions=&quot;1&quot;]&#039;
			);

			// Photos
			$fields[] = array(
				&#039;tab_type&#039;   =&gt; &#039;standard&#039;,
				&#039;tab_name&#039;   =&gt; __(&#039;Photos&#039;,&#039;geodirectory&#039;),
				&#039;tab_icon&#039;   =&gt; &#039;fas fa-image&#039;,
				&#039;tab_key&#039;    =&gt; &#039;post_images&#039;,
				&#039;tab_content&#039;=&gt; &#039;[gd_post_images type=&quot;gallery&quot; ajax_load=&quot;1&quot; slideshow=&quot;1&quot; show_title=&quot;1&quot; animation=&quot;slide&quot; controlnav=&quot;1&quot; link_to=&quot;lightbox&quot;]&#039;
			);

			return apply_filters( &#039;geodir_cpt_settings_tabs_predefined_fields&#039;, $fields, $post_type );
		}

		/**
		 * Adds admin html for custom fields available fields.
		 *
		 * @since 1.0.0
		 * @since 1.6.9 Added
		 *
		 * @param string $type The custom field type, predefined, custom or blank for default
		 *
		 * @package GeoDirectory
		 */
		public function output_custom_fields($sub_tab = &#039;&#039;, $post_type =&#039;&#039; ) {

			// insert the required code for the SD button.
			$js_insert_function = &#039;&#039;;//self::insert_shortcode_function();
//			WP_Super_Duper::shortcode_insert_button(&#039;&#039;,$js_insert_function);
			add_thickbox();
			add_action( &#039;admin_footer&#039;, array( &#039;WP_Super_Duper&#039;, &#039;shortcode_insert_button_script&#039; ) );

			$cfs = self::get_custom_fields($post_type);
			self::output_fields($cfs);
		}

        /**
         * Insert the shortcode function.
         *
         * @since 2.0.0
         *
         * @return string
         */
		public function insert_shortcode_function(){
			ob_start();
			?&gt;
			function sd_insert_shortcode(){
				$shortcode = jQuery(&#039;#sd-shortcode-output&#039;).val();
				if($shortcode){
					jQuery(&#039;.gd-tab-settings-open textarea&#039;).val($shortcode);
					tb_remove();
				}
			}
			&lt;?php
			return ob_get_clean();

		}

        /**
         * Get shortcode custom fields.
         *
         * @since 2.0.0
         *
         * @return array $fields.
         */
		public function get_custom_fields($post_type){
			$fields = array();

			// shortcode
			$fields[] = array(
				&#039;tab_type&#039;   =&gt; &#039;shortcode&#039;,
				&#039;tab_name&#039;   =&gt; __(&#039;Shortcode&#039;,&#039;geodirectory&#039;),
				&#039;tab_icon&#039;   =&gt; &#039;fas fa-cubes&#039;,
				&#039;tab_key&#039;    =&gt; &#039;&#039;,
				&#039;tab_content&#039;=&gt; &#039;&#039;
				
			);

			return apply_filters( &#039;geodir_cpt_settings_tabs_custom_fields&#039;, $fields, $post_type );
		}

		/**
		 * Output the tab item.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 */
		public static function get_tab_item($tab) {
			ob_start();
			$tab = (object)$tab;
			if ( ! isset( $tab-&gt;id ) ) {
				$tab-&gt;id = &#039;&#039;;
			}
			$tab = stripslashes_deep( $tab );

			// tab icon
			$icon = ! empty( $tab-&gt;tab_icon ) ? $tab-&gt;tab_icon : &#039;&#039;;

			// Set the field icon
			if ( geodir_is_fa_icon( $icon ) ) {
				$tab_icon = &#039;&lt;i class=&quot;&#039; . esc_attr( $icon ) . &#039;&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039;;
			} elseif ( geodir_is_icon_url( $icon ) ) {
				$tab_icon = &#039;&lt;b style=&quot;background-image: url(&quot;&#039; . $icon . &#039;&quot;)&quot;&gt;&lt;/b&gt;&#039;;
			} else {
				$tab_icon = &#039;&lt;i class=&quot;fas fa-cog&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039;;
			}

			include( dirname( __FILE__ ) . &#039;/../views/html-admin-settings-cpt-tab-item.php&#039; );
			return ob_get_clean();
		}

		/**
		 * Savethe tab item.
		 *
		 * @since 2.0.0
		 * @package GeoDirectory
		 */
		public static function save_tab_item($tab) {
			global $wpdb;
			$tab = (object)$tab;

			$tab_id = isset($tab-&gt;id) &amp;&amp; $tab-&gt;id ? absint($tab-&gt;id) : &#039;&#039;;
			$table = GEODIR_TABS_LAYOUT_TABLE;

			// set the tab key
			$tab-&gt;tab_key = !empty($tab-&gt;tab_key) ? $tab-&gt;tab_key : sanitize_title( $tab-&gt;tab_name,&#039;tab-&#039;.$tab-&gt;tab_icon  );
			$postarr = array(
				&#039;post_type&#039;     =&gt; $tab-&gt;post_type,
				&#039;tab_layout&#039;    =&gt; $tab-&gt;tab_layout,
				&#039;tab_type&#039;      =&gt; $tab-&gt;tab_type,
				&#039;tab_name&#039;      =&gt; $tab-&gt;tab_name,
				&#039;tab_icon&#039;      =&gt; $tab-&gt;tab_icon,
				&#039;tab_key&#039;       =&gt; $tab-&gt;tab_key,
				&#039;tab_content&#039;   =&gt; $tab-&gt;tab_content,
			);

			// Check if tab already exists with post_type, tab_type, tab_name &amp; tab_key combine.
			if ( ! $tab_id &amp;&amp; $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(*) FROM {$table} WHERE post_type = %s AND tab_type = %s AND tab_name LIKE %s AND tab_key = %s LIMIT 1&quot;, array( $postarr[&#039;post_type&#039;], $postarr[&#039;tab_type&#039;], $postarr[&#039;tab_name&#039;], $postarr[&#039;tab_key&#039;] ) ) ) &gt; 0 ) {
				return new WP_Error( &#039;failed&#039;, wp_sprintf( __( &#039;Tab &quot;%s&quot; already exists!&#039;, &#039;geodirectory&#039; ), $postarr[&#039;tab_name&#039;] ) );
			}

			if(isset($tab-&gt;sort_order)){
				$postarr[&#039;sort_order&#039;] = $tab-&gt;sort_order;
			}
			if(isset($tab-&gt;tab_level)){
				$postarr[&#039;tab_level&#039;] = $tab-&gt;tab_level;
			}

			$format = array_fill( 0, count( $postarr ), &#039;%s&#039; );

			if ( $tab_id ) {// update
				$result = $wpdb-&gt;update(
					$table,
					$postarr,
					array( &#039;id&#039; =&gt; $tab_id ),
					$format
				);
			} else { // insert
				$result = $wpdb-&gt;insert(
					$table,
					$postarr,
					$format
				);
				$tab-&gt;id = $wpdb-&gt;insert_id;
			}

			if(false === $result){
				return new WP_Error( &#039;failed&#039;, __(&quot;Something went wrong!&quot;,&quot;geodirectory&quot;) );
			}else{
				$tabs = self::get_tabs_fields($tab-&gt;post_type,$tab-&gt;tab_layout);

				//print_r($tabs);
				//echo $tab-&gt;post_type.&#039;###&#039;.$tab-&gt;tab_layout;
				return self::loop_tabs_output($tabs,$tab-&gt;id);
				//return self::get_tab_item($tab);
			}


		}


        /**
         * Set the tabs order and count level.
         *
         * @since 2.0.0
         *
         * @param array $tabs Optional. Default array.
         *
         * @global object $wpdb WordPress Database object.
         *
         * @return bool|WP_Error.
         */
		public static function set_tabs_orders($tabs = array()){
			global $wpdb;

//			print_r($tabs);
			$count = 0;
			if (!empty($tabs)) {
				$result = false;
				foreach ( $tabs as $index =&gt; $info ) {
					$result = $wpdb-&gt;update(
						GEODIR_TABS_LAYOUT_TABLE,
						array(&#039;sort_order&#039; =&gt; $index,&#039;tab_level&#039; =&gt; $info[&#039;tab_level&#039;],&#039;tab_parent&#039; =&gt; $info[&#039;tab_parent&#039;]),
						array(&#039;id&#039; =&gt; absint($info[&#039;id&#039;])),
						array(&#039;%d&#039;,&#039;%d&#039;,&#039;%d&#039;)
					);
					$count ++;
				}
				if($result !== false){
					return true;
				}else{
					return new WP_Error( &#039;failed&#039;, __( &quot;Failed to sort tab items.&quot;, &quot;geodirectory&quot; ) );
				}
			}else{
				return new WP_Error( &#039;failed&#039;, __( &quot;Failed to sort tab items.&quot;, &quot;geodirectory&quot; ) );
			}
		}

        /**
         * Delete a tab.
         *
         * @since 2.0.0
         *
         * @global object $wpdb WordPress Database object.
         *
         * @param int $tab_id Tab id.
         * @param string $post_type posttype.
         * @return bool|WP_Error.
         */
		public static function delete_tab($tab_id,$post_type = &#039;&#039;){
			global $wpdb;
			if (!empty($tab_id)) {
				$where = array(&#039;id&#039;=&gt;$tab_id);
				$format = array( &#039;%d&#039; );
				if($post_type){
					$where[&#039;post_type&#039;] = $post_type;
					$format[] = &quot;%s&quot;;
				}
				$result = $wpdb-&gt;delete( GEODIR_TABS_LAYOUT_TABLE, $where, $format );
				if($result !== false){
					self::delete_tab_children($tab_id,$post_type);
					return true;
				}else{
					return new WP_Error( &#039;failed&#039;, __( &quot;Failed to delete tab item.&quot;, &quot;geodirectory&quot; ) );
				}
			}else{
				return new WP_Error( &#039;failed&#039;, __( &quot;Failed to delete tab item.&quot;, &quot;geodirectory&quot; ) );
			}
		}

        /**
         * Delete a tabs children.
         *
         * @since 2.0.0
         *
         * @param int $tab_id Tab id.
         * @param string $post_type Optional. Post type values. Default null.
         */
		public static function delete_tab_children($tab_id,$post_type = &#039;&#039;){
			global $wpdb;

			if (!empty($tab_id)) {
				if($post_type ){
					$children = $wpdb-&gt;get_results($wpdb-&gt;prepare( &quot;SELECT * FROM &quot;.GEODIR_TABS_LAYOUT_TABLE.&quot; WHERE tab_parent=%d AND post_type=%s&quot;,$tab_id,$post_type) );
				}else{
					$children = $wpdb-&gt;get_results($wpdb-&gt;prepare( &quot;SELECT * FROM &quot;.GEODIR_TABS_LAYOUT_TABLE.&quot; WHERE tab_parent=%d&quot;,$tab_id) );
				}
				if($children ){
					foreach($children as $child){
						$where = array(&#039;id&#039;=&gt;$child-&gt;id);
						$format = array( &#039;%d&#039; );
						if($post_type){
							$where[&#039;post_type&#039;] = $post_type;
							$format[] = &quot;%s&quot;;
						}
						$wpdb-&gt;delete( GEODIR_TABS_LAYOUT_TABLE, $where, $format );
					}
				}
			}
		}


	}

endif;

return new GeoDir_Settings_Cpt_Tabs();
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337338"></script>
    <script src="../js/search.js?updated=1652337338"></script>
</body>
</html>
