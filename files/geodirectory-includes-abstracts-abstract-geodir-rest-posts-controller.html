<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337337">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337337">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">abstract-geodir-rest-posts-controller.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * Abstract Rest Posts Controller Class
 *
 * @author   GeoDirectory
 * @category API
 * @package  GeoDirectory/Abstracts
 * @version  2.0.0
 */
class GeoDir_REST_Posts_Controller extends WP_REST_Posts_Controller {

	/**
	 * Post type.
	 *
	 * @access protected
	 * @var string
	 */
	protected $post_type;

	/**
	 * Instance of a post meta fields object.
	 *
	 * @access protected
	 * @var WP_REST_Post_Meta_Fields
	 */
	protected $meta;

	/**
	 * Constructor.
	 *
	 * @access public
	 *
	 * @param string $post_type Post type.
	 */

    public function __construct( $post_type ) {
        $this-&gt;post_type    = $post_type;
        $this-&gt;namespace    = GEODIR_REST_SLUG . &#039;/v&#039; . GEODIR_REST_API_VERSION;
        $obj                = get_post_type_object( $post_type );
        $this-&gt;rest_base    = ! empty( $obj-&gt;rest_base ) ? $obj-&gt;rest_base : $obj-&gt;name;
        
        $this-&gt;meta         = new WP_REST_Post_Meta_Fields( $this-&gt;post_type );
        
        $this-&gt;cat_taxonomy = $this-&gt;post_type . &#039;category&#039;;
        $this-&gt;tag_taxonomy = $this-&gt;post_type . &#039;_tags&#039;;
    }

	/**
	 * Registers the routes for the objects of the controller.
	 *
	 * @access public
	 *
	 * @see register_rest_route()
	 */
    public function register_routes() {

		register_rest_route( $this-&gt;namespace, &#039;/&#039; . $this-&gt;rest_base, array(
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::READABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;get_items&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;get_items_permissions_check&#039; ),
				&#039;args&#039;                =&gt; $this-&gt;get_collection_params(),
			),
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::CREATABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;create_item&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;create_item_permissions_check&#039; ),
				&#039;args&#039;                =&gt; $this-&gt;get_endpoint_args_for_item_schema( WP_REST_Server::CREATABLE ),
			),
			&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
		) );

		register_rest_route( $this-&gt;namespace, &#039;/&#039; . $this-&gt;rest_base . &#039;/(?P&lt;id&gt;[\d]+)&#039;, array(
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::READABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;get_item&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;get_item_permissions_check&#039; ),
				&#039;args&#039;                =&gt; array(
					&#039;context&#039;  =&gt; $this-&gt;get_context_param( array( &#039;default&#039; =&gt; &#039;view&#039; ) ),
					&#039;password&#039; =&gt; array(
						&#039;description&#039; =&gt; __( &#039;The password for the post if it is password protected.&#039; ),
						&#039;type&#039;        =&gt; &#039;string&#039;,
					),
				),
			),
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::EDITABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;update_item&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;update_item_permissions_check&#039; ),
				&#039;args&#039;                =&gt; $this-&gt;get_endpoint_args_for_item_schema( WP_REST_Server::EDITABLE ),
			),
			array(
				&#039;methods&#039;             =&gt; WP_REST_Server::DELETABLE,
				&#039;callback&#039;            =&gt; array( $this, &#039;delete_item&#039; ),
				&#039;permission_callback&#039; =&gt; array( $this, &#039;delete_item_permissions_check&#039; ),
				&#039;args&#039;                =&gt; array(
					&#039;force&#039; =&gt; array(
						&#039;type&#039;        =&gt; &#039;boolean&#039;,
						&#039;default&#039;     =&gt; false,
						&#039;description&#039; =&gt; __( &#039;Whether to bypass trash and force deletion.&#039; ),
					),
				),
			),
			&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
		) );
	}
    
	/**
	 * Checks if a given post type can be viewed or managed.
	 *
	 * @access protected
	 *
	 * @param object|string $post_type Post type name or object.
	 * @return bool Whether the post type is allowed in REST.
	 */
	protected function check_is_post_type_allowed( $post_type ) {
		if ( ! is_object( $post_type ) ) {
			$post_type = get_post_type_object( $post_type );
		}

		if ( ! empty( $post_type ) &amp;&amp; ! empty( $post_type-&gt;show_in_rest ) ) {
			return true;
		}

		return false;
	}
    
	/**
	 * Retrieves the query params for the posts collection.
	 *
	 * @access public
	 *
	 * @return array Collection parameters.
	 */
	public function get_collection_params() {
		$params = parent::get_collection_params();

		$params[&#039;context&#039;][&#039;default&#039;] = &#039;view&#039;;

		if ( post_type_supports( $this-&gt;post_type, &#039;author&#039; ) ) {
			$params[&#039;author&#039;] = array(
				&#039;description&#039;         =&gt; __( &#039;Limit result set to posts assigned to specific authors.&#039; ),
				&#039;type&#039;                =&gt; &#039;array&#039;,
				&#039;items&#039;               =&gt; array(
					&#039;type&#039;            =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;             =&gt; array(),
			);
			$params[&#039;author_exclude&#039;] = array(
				&#039;description&#039;         =&gt; __( &#039;Ensure result set excludes posts assigned to specific authors.&#039; ),
				&#039;type&#039;                =&gt; &#039;array&#039;,
				&#039;items&#039;               =&gt; array(
					&#039;type&#039;            =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;             =&gt; array(),
			);
		}

		$params[&#039;before&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Limit response to posts published before a given ISO8601 compliant date.&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;format&#039;             =&gt; &#039;date-time&#039;,
		);

		$params[&#039;exclude&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Ensure result set excludes specific IDs.&#039; ),
			&#039;type&#039;               =&gt; &#039;array&#039;,
			&#039;items&#039;              =&gt; array(
				&#039;type&#039;           =&gt; &#039;integer&#039;,
			),
			&#039;default&#039;            =&gt; array(),
		);

		$params[&#039;include&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Limit result set to specific IDs.&#039; ),
			&#039;type&#039;               =&gt; &#039;array&#039;,
			&#039;items&#039;              =&gt; array(
				&#039;type&#039;           =&gt; &#039;integer&#039;,
			),
			&#039;default&#039;            =&gt; array(),
		);

		if ( &#039;page&#039; === $this-&gt;post_type || post_type_supports( $this-&gt;post_type, &#039;page-attributes&#039; ) ) {
			$params[&#039;menu_order&#039;] = array(
				&#039;description&#039;        =&gt; __( &#039;Limit result set to posts with a specific menu_order value.&#039; ),
				&#039;type&#039;               =&gt; &#039;integer&#039;,
			);
		}

		$params[&#039;offset&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Offset the result set by a specific number of items.&#039; ),
			&#039;type&#039;               =&gt; &#039;integer&#039;,
		);

		$params[&#039;order&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Order sort attribute ascending or descending.&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;desc&#039;,
			&#039;enum&#039;               =&gt; array( &#039;asc&#039;, &#039;desc&#039; ),
		);

		$params[&#039;orderby&#039;] = array(
			&#039;description&#039;        =&gt; __( &#039;Sort collection by object attribute.&#039; ),
			&#039;type&#039;               =&gt; &#039;string&#039;,
			&#039;default&#039;            =&gt; &#039;date&#039;,
			&#039;enum&#039;               =&gt; array(
				&#039;date&#039;,
				&#039;relevance&#039;,
				&#039;id&#039;,
				&#039;include&#039;,
				&#039;title&#039;,
				&#039;slug&#039;,
			),
		);

		if ( &#039;page&#039; === $this-&gt;post_type || post_type_supports( $this-&gt;post_type, &#039;page-attributes&#039; ) ) {
			$params[&#039;orderby&#039;][&#039;enum&#039;][] = &#039;menu_order&#039;;
		}

		$post_type_obj = get_post_type_object( $this-&gt;post_type );

		if ( $post_type_obj-&gt;hierarchical || &#039;attachment&#039; === $this-&gt;post_type ) {
			$params[&#039;parent&#039;] = array(
				&#039;description&#039;       =&gt; __( &#039;Limit result set to those of particular parent IDs.&#039; ),
				&#039;type&#039;              =&gt; &#039;array&#039;,
				&#039;items&#039;             =&gt; array(
					&#039;type&#039;          =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;           =&gt; array(),
			);
			$params[&#039;parent_exclude&#039;] = array(
				&#039;description&#039;       =&gt; __( &#039;Limit result set to all items except those of a particular parent ID.&#039; ),
				&#039;type&#039;              =&gt; &#039;array&#039;,
				&#039;items&#039;             =&gt; array(
					&#039;type&#039;          =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;           =&gt; array(),
			);
		}

		$params[&#039;slug&#039;] = array(
			&#039;description&#039;       =&gt; __( &#039;Limit result set to posts with one or more specific slugs.&#039; ),
			&#039;type&#039;              =&gt; &#039;array&#039;,
			&#039;items&#039;             =&gt; array(
				&#039;type&#039;          =&gt; &#039;string&#039;,
			),
			&#039;sanitize_callback&#039; =&gt; &#039;wp_parse_slug_list&#039;,
		);

		$params[&#039;status&#039;] = array(
			&#039;default&#039;           =&gt; &#039;publish&#039;,
			&#039;description&#039;       =&gt; __( &#039;Limit result set to posts assigned one or more statuses.&#039; ),
			&#039;type&#039;              =&gt; &#039;array&#039;,
			&#039;items&#039;             =&gt; array(
				&#039;enum&#039;          =&gt; array_merge( array_keys( get_post_stati() ), array( &#039;any&#039; ) ),
				&#039;type&#039;          =&gt; &#039;string&#039;,
			),
			&#039;sanitize_callback&#039; =&gt; array( $this, &#039;sanitize_post_statuses&#039; ),
		);

		$taxonomies = wp_list_filter( get_object_taxonomies( $this-&gt;post_type, &#039;objects&#039; ), array( &#039;show_in_rest&#039; =&gt; true ) );

		foreach ( $taxonomies as $taxonomy ) {
			$base = ! empty( $taxonomy-&gt;rest_base ) ? $taxonomy-&gt;rest_base : $taxonomy-&gt;name;

			$params[ $base ] = array(
				/* translators: %s: taxonomy name */
				&#039;description&#039;       =&gt; sprintf( __( &#039;Limit result set to all items that have the specified term assigned in the %s taxonomy.&#039; ), $base ),
				&#039;type&#039;              =&gt; &#039;array&#039;,
				&#039;items&#039;             =&gt; array(
					&#039;type&#039;          =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;           =&gt; array(),
			);

			$params[ $base . &#039;_exclude&#039; ] = array(
				/* translators: %s: taxonomy name */
				&#039;description&#039; =&gt; sprintf( __( &#039;Limit result set to all items except those that have the specified term assigned in the %s taxonomy.&#039; ), $base ),
				&#039;type&#039;        =&gt; &#039;array&#039;,
				&#039;items&#039;       =&gt; array(
					&#039;type&#039;    =&gt; &#039;integer&#039;,
				),
				&#039;default&#039;           =&gt; array(),
			);
		}

		if ( &#039;post&#039; === $this-&gt;post_type ) {
			$params[&#039;sticky&#039;] = array(
				&#039;description&#039;       =&gt; __( &#039;Limit result set to items that are sticky.&#039; ),
				&#039;type&#039;              =&gt; &#039;boolean&#039;,
			);
		}

		/**
		 * Filter collection parameters for the posts controller.
		 *
		 * The dynamic part of the filter `$this-&gt;post_type` refers to the post
		 * type slug for the controller.
		 *
		 * This filter registers the collection parameter, but does not map the
		 * collection parameter to an internal WP_Query parameter. Use the
		 * `rest_{$this-&gt;post_type}_query` filter to set WP_Query parameters.
		 *
		 *
		 * @param $params JSON Schema-formatted collection parameters.
		 * @param WP_Post_Type $post_type_obj Post type object.
		 */
		return apply_filters( &quot;rest_{$this-&gt;post_type}_collection_params&quot;, $params, $post_type_obj );
	}
    
	/**
	 * Prepares links for the request.
	 *
	 * @since 4.7.0
	 * @access protected
	 *
	 * @param WP_Post $post Post object.
	 * @return array Links for the given post.
	 */
	protected function prepare_links( $post ) {
		$base = sprintf( &#039;%s/%s&#039;, $this-&gt;namespace, $this-&gt;rest_base );

		// Entity meta.
		$links = array(
			&#039;self&#039; =&gt; array(
				&#039;href&#039;   =&gt; rest_url( trailingslashit( $base ) . $post-&gt;ID ),
			),
			&#039;collection&#039; =&gt; array(
				&#039;href&#039;   =&gt; rest_url( $base ),
			),
			&#039;about&#039;      =&gt; array(
				&#039;href&#039;   =&gt; rest_url( $this-&gt;namespace . &#039;/types/&#039; . $this-&gt;post_type ),
			),
		);

		if ( ( in_array( $post-&gt;post_type, array( &#039;post&#039;, &#039;page&#039; ), true ) || post_type_supports( $post-&gt;post_type, &#039;author&#039; ) )
			&amp;&amp; ! empty( $post-&gt;post_author ) ) {
			$links[&#039;author&#039;] = array(
				&#039;href&#039;       =&gt; rest_url( &#039;wp/v2/users/&#039; . $post-&gt;post_author ),
				&#039;embeddable&#039; =&gt; true,
			);
		}

        if ( in_array( $post-&gt;post_type, array( &#039;post&#039;, &#039;page&#039; ), true ) || post_type_supports( $post-&gt;post_type, &#039;comments&#039; ) ) {
            $reviews_url = rest_url( $this-&gt;namespace . &#039;/reviews&#039; );
            $reviews_url = add_query_arg( &#039;post&#039;, $post-&gt;ID, $reviews_url );

            $links[&#039;reviews&#039;] = array(
                &#039;href&#039;       =&gt; $reviews_url,
                &#039;embeddable&#039; =&gt; true,
            );
        }

		if ( in_array( $post-&gt;post_type, array( &#039;post&#039;, &#039;page&#039; ), true ) || post_type_supports( $post-&gt;post_type, &#039;revisions&#039; ) ) {
			$links[&#039;version-history&#039;] = array(
				&#039;href&#039; =&gt; rest_url( trailingslashit( $base ) . $post-&gt;ID . &#039;/revisions&#039; ),
			);
		}

		$post_type_obj = get_post_type_object( $post-&gt;post_type );

		if ( $post_type_obj-&gt;hierarchical &amp;&amp; ! empty( $post-&gt;post_parent ) ) {
			$links[&#039;up&#039;] = array(
				&#039;href&#039;       =&gt; rest_url( trailingslashit( $base ) . (int) $post-&gt;post_parent ),
				&#039;embeddable&#039; =&gt; true,
			);
		}

		// If we have a featured media, add that.
		if ( $featured_media = get_post_thumbnail_id( $post-&gt;ID ) ) {
			$image_url = rest_url( &#039;wp/v2/media/&#039; . $featured_media );

			$links[&#039;https://api.w.org/featuredmedia&#039;] = array(
				&#039;href&#039;       =&gt; $image_url,
				&#039;embeddable&#039; =&gt; true,
			);
		}

		if ( ! in_array( $post-&gt;post_type, array( &#039;attachment&#039;, &#039;nav_menu_item&#039;, &#039;revision&#039; ), true ) ) {
			$attachments_url = rest_url( &#039;wp/v2/media&#039; );
			$attachments_url = add_query_arg( &#039;parent&#039;, $post-&gt;ID, $attachments_url );

			$links[&#039;https://api.w.org/attachment&#039;] = array(
				&#039;href&#039; =&gt; $attachments_url,
			);
		}

		$taxonomies = get_object_taxonomies( $post-&gt;post_type );

		if ( ! empty( $taxonomies ) ) {
			$links[&#039;https://api.w.org/term&#039;] = array();

			foreach ( $taxonomies as $tax ) {
				$taxonomy_obj = get_taxonomy( $tax );

				// Skip taxonomies that are not public.
				if ( empty( $taxonomy_obj-&gt;show_in_rest ) ) {
					continue;
				}

				$tax_base = ! empty( $taxonomy_obj-&gt;rest_base ) ? $taxonomy_obj-&gt;rest_base : $tax;

				$terms_url = add_query_arg(
					&#039;post&#039;,
					$post-&gt;ID,
					rest_url( $this-&gt;namespace . &#039;/&#039; . $tax_base )
				);

				$links[&#039;https://api.w.org/term&#039;][] = array(
					&#039;href&#039;       =&gt; $terms_url,
					&#039;taxonomy&#039;   =&gt; $tax,
					&#039;embeddable&#039; =&gt; true,
				);
			}
		}
        
        if ( !empty( $post-&gt;post_location_id ) &amp;&amp; geodir_rest_is_active( &#039;location&#039; ) &amp;&amp; $location = geodir_get_location_by_id( NULL, $post-&gt;post_location_id ) ) {
            $location_links = array();
            
            $location_links[] = array(
                &#039;href&#039;          =&gt; rest_url( sprintf( &#039;%s/%s/%s/%s&#039;, $this-&gt;namespace, &#039;locations&#039;, &#039;countries&#039;, $location-&gt;country_slug ) ),
                &#039;location&#039;      =&gt; &#039;country&#039;,
                &#039;embeddable&#039;    =&gt; true,
            );
            
            $add_query_args = array( &#039;country&#039; =&gt; $location-&gt;country_slug );
            
            $location_links[] = array(
                &#039;href&#039;          =&gt; add_query_arg( $add_query_args, rest_url( sprintf( &#039;%s/%s/%s/%s&#039;, $this-&gt;namespace, &#039;locations&#039;, &#039;regions&#039;, $location-&gt;region_slug ) ) ),
                &#039;location&#039;      =&gt; &#039;region&#039;,
                &#039;embeddable&#039;    =&gt; true,
            );
            
            $add_query_args[&#039;region&#039;] = $location-&gt;region_slug;
            
            $location_links[] = array(
                &#039;href&#039;          =&gt; add_query_arg( $add_query_args, rest_url( sprintf( &#039;%s/%s/%s/%s&#039;, $this-&gt;namespace, &#039;locations&#039;, &#039;cities&#039;, $location-&gt;city_slug ) ) ),
                &#039;location&#039;      =&gt; &#039;city&#039;,
                &#039;embeddable&#039;    =&gt; true,
            );
            
            if ( !empty( $post-&gt;gd_neighbourhood ) &amp;&amp; geodir_rest_is_active( &#039;neighbourhood&#039; ) ) {
                $add_query_args[&#039;city&#039;] = $location-&gt;city_slug;
                
                $location_links[] = array(
                    &#039;href&#039;          =&gt; add_query_arg( $add_query_args, rest_url( sprintf( &#039;%s/%s/%s/%s&#039;, $this-&gt;namespace, &#039;locations&#039;, &#039;neighbourhoods&#039;, $post-&gt;gd_neighbourhood ) ) ),
                    &#039;location&#039;      =&gt; &#039;neighbourhood&#039;,
                    &#039;embeddable&#039;    =&gt; true,
                );
            }
            
            $links[&#039;https://api.w.org/location&#039;] = $location_links;
        }

		return $links;
	}
    
	/**
	 * Creates a single post.
	 *
	 * @access public
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function create_item( $request ) {
        global $post, $wpdb, $gd_permalink_cache;
        
		if ( ! empty( $request[&#039;id&#039;] ) ) {
			return new WP_Error( &#039;rest_post_exists&#039;, __( &#039;Cannot create existing post.&#039; ), array( &#039;status&#039; =&gt; 400 ) );
		}

		$prepared_post = $this-&gt;prepare_item_for_database( $request );

		if ( is_wp_error( $prepared_post ) ) {
			return $prepared_post;
		}

		$prepared_post-&gt;post_type = $this-&gt;post_type;

		$post_id = wp_insert_post( wp_slash( (array) $prepared_post ), true );
        
        if ( !is_wp_error( $post_id ) ) {
            if ( !empty( $gd_permalink_cache ) &amp;&amp; isset( $gd_permalink_cache[$post_id] ) ) {
                unset( $gd_permalink_cache[$post_id] );
            }
            $post = get_post( $post_id );
            
            $gd_post = $this-&gt;prepare_item_for_geodir_database( $request, $post_id );
            
            $post_id = geodir_save_listing( $gd_post, null, true );
        }

		if ( is_wp_error( $post_id ) ) {

			if ( &#039;db_insert_error&#039; === $post_id-&gt;get_error_code() ) {
				$post_id-&gt;add_data( array( &#039;status&#039; =&gt; 500 ) );
			} else {
				$post_id-&gt;add_data( array( &#039;status&#039; =&gt; 400 ) );
			}

			return $post_id;
		} else {
            $wpdb-&gt;update( $wpdb-&gt;posts, array( &#039;guid&#039; =&gt; get_permalink( $post_id ) ), array( &#039;ID&#039; =&gt; $post_id ) );
            clean_post_cache( $post_id );
        }

		$post = get_post( $post_id );

		/**
		 * Fires after a single post is created or updated via the REST API.
		 *
		 * The dynamic portion of the hook name, `$this-&gt;post_type`, refers to the post type slug.
		 *
		 * @param WP_Post         $post     Inserted or updated post object.
		 * @param WP_REST_Request $request  Request object.
		 * @param bool            $creating True when creating a post, false when updating.
		 */
		do_action( &quot;rest_insert_{$this-&gt;post_type}&quot;, $post, $request, true );

		$schema = $this-&gt;get_item_schema();

		if ( ! empty( $schema[&#039;properties&#039;][&#039;sticky&#039;] ) ) {
			if ( ! empty( $request[&#039;sticky&#039;] ) ) {
				stick_post( $post_id );
			} else {
				unstick_post( $post_id );
			}
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;featured_media&#039;] ) &amp;&amp; isset( $request[&#039;featured_media&#039;] ) ) {
			$this-&gt;handle_featured_media( $request[&#039;featured_media&#039;], $post_id );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;format&#039;] ) &amp;&amp; ! empty( $request[&#039;format&#039;] ) ) {
			set_post_format( $post, $request[&#039;format&#039;] );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;template&#039;] ) &amp;&amp; isset( $request[&#039;template&#039;] ) ) {
			$this-&gt;handle_template( $request[&#039;template&#039;], $post_id );
		}

		$terms_update = $this-&gt;handle_terms( $post_id, $request );

		if ( is_wp_error( $terms_update ) ) {
			return $terms_update;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;meta&#039;] ) &amp;&amp; isset( $request[&#039;meta&#039;] ) ) {
			$meta_update = $this-&gt;meta-&gt;update_value( $request[&#039;meta&#039;], $post_id );

			if ( is_wp_error( $meta_update ) ) {
				return $meta_update;
			}
		}

		$post = get_post( $post_id );
		$fields_update = $this-&gt;update_additional_fields_for_object( $post, $request );

		if ( is_wp_error( $fields_update ) ) {
			return $fields_update;
		}

		$request-&gt;set_param( &#039;context&#039;, &#039;edit&#039; );

		$response = $this-&gt;prepare_item_for_response( $post, $request );
		$response = rest_ensure_response( $response );

		$response-&gt;set_status( 201 );
		$response-&gt;header( &#039;Location&#039;, rest_url( sprintf( &#039;%s/%s/%d&#039;, $this-&gt;namespace, $this-&gt;rest_base, $post_id ) ) );

		return $response;
	}
    
	/**
	 * Updates a single post.
	 *
	 * @access public
	 *
	 * @param WP_REST_Request $request Full details about the request.
	 * @return WP_REST_Response|WP_Error Response object on success, or WP_Error object on failure.
	 */
	public function update_item( $request ) {
        global $post, $wpdb;
        
		$id   = (int) $request[&#039;id&#039;];
		$post = get_post( $id );

		if ( empty( $id ) || empty( $post-&gt;ID ) || $this-&gt;post_type !== $post-&gt;post_type ) {
			return new WP_Error( &#039;rest_post_invalid_id&#039;, __( &#039;Invalid post ID.&#039; ), array( &#039;status&#039; =&gt; 404 ) );
		}

		$post = $this-&gt;prepare_item_for_database( $request );

		if ( is_wp_error( $post ) ) {
			return $post;
		}

		// convert the post object to an array, otherwise wp_update_post will expect non-escaped input.
		$post_id = wp_update_post( wp_slash( (array) $post ), true );
        
        if ( !is_wp_error( $post_id ) ) {
            $gd_post = $this-&gt;prepare_item_for_geodir_database( $request, $post_id );
            
            $post_id = geodir_save_listing( $gd_post, null, true );
        }

		if ( is_wp_error( $post_id ) ) {
			if ( &#039;db_update_error&#039; === $post_id-&gt;get_error_code() ) {
				$post_id-&gt;add_data( array( &#039;status&#039; =&gt; 500 ) );
			} else {
				$post_id-&gt;add_data( array( &#039;status&#039; =&gt; 400 ) );
			}
			return $post_id;
		} else {
            $wpdb-&gt;update( $wpdb-&gt;posts, array( &#039;guid&#039; =&gt; get_permalink( $post_id ) ), array( &#039;ID&#039; =&gt; $post_id ) );
            clean_post_cache( $post_id );
        }

		$post = get_post( $post_id );

		/* This action is documented in lib/endpoints/class-wp-rest-controller.php */
		do_action( &quot;rest_insert_{$this-&gt;post_type}&quot;, $post, $request, false );

		$schema = $this-&gt;get_item_schema();

		if ( ! empty( $schema[&#039;properties&#039;][&#039;format&#039;] ) &amp;&amp; ! empty( $request[&#039;format&#039;] ) ) {
			set_post_format( $post, $request[&#039;format&#039;] );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;featured_media&#039;] ) &amp;&amp; isset( $request[&#039;featured_media&#039;] ) ) {
			$this-&gt;handle_featured_media( $request[&#039;featured_media&#039;], $post_id );
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;sticky&#039;] ) &amp;&amp; isset( $request[&#039;sticky&#039;] ) ) {
			if ( ! empty( $request[&#039;sticky&#039;] ) ) {
				stick_post( $post_id );
			} else {
				unstick_post( $post_id );
			}
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;template&#039;] ) &amp;&amp; isset( $request[&#039;template&#039;] ) ) {
			$this-&gt;handle_template( $request[&#039;template&#039;], $post-&gt;ID );
		}

		$terms_update = $this-&gt;handle_terms( $post-&gt;ID, $request );

		if ( is_wp_error( $terms_update ) ) {
			return $terms_update;
		}

		if ( ! empty( $schema[&#039;properties&#039;][&#039;meta&#039;] ) &amp;&amp; isset( $request[&#039;meta&#039;] ) ) {
			$meta_update = $this-&gt;meta-&gt;update_value( $request[&#039;meta&#039;], $post-&gt;ID );

			if ( is_wp_error( $meta_update ) ) {
				return $meta_update;
			}
		}

		$post = get_post( $post_id );
		$fields_update = $this-&gt;update_additional_fields_for_object( $post, $request );

		if ( is_wp_error( $fields_update ) ) {
			return $fields_update;
		}

		$request-&gt;set_param( &#039;context&#039;, &#039;edit&#039; );

		$response = $this-&gt;prepare_item_for_response( $post, $request );

		return rest_ensure_response( $response );
	}
    
	/**
	 * Prepares a single post for create or update.
	 *
	 * @access protected
	 *
	 * @param WP_REST_Request $request Request object.
	 * @return stdClass|WP_Error Post object or WP_Error.
	 */
	protected function prepare_item_for_geodir_database( $request, $post_id = 0 ) {
        $prepared_post = $request-&gt;get_params();
        
        // Post ID.
        if ( isset( $request[&#039;id&#039;] ) ) {
            $prepared_post[&#039;post_id&#039;] = absint( $request[&#039;id&#039;] );
        }
        
        $schema = $this-&gt;get_item_schema();

        // Post title.
        if ( ! empty( $schema[&#039;properties&#039;][&#039;title&#039;] ) &amp;&amp; isset( $request[&#039;title&#039;] ) ) {
            if ( is_string( $request[&#039;title&#039;] ) ) {
                $prepared_post[&#039;post_title&#039;] = $request[&#039;title&#039;];
            } elseif ( ! empty( $request[&#039;title&#039;][&#039;raw&#039;] ) ) {
                $prepared_post[&#039;post_title&#039;] = $request[&#039;title&#039;][&#039;raw&#039;];
            }
        }

        // Post content.
        if ( ! empty( $schema[&#039;properties&#039;][&#039;content&#039;] ) &amp;&amp; isset( $request[&#039;content&#039;] ) ) {
            if ( is_string( $request[&#039;content&#039;] ) ) {
                $prepared_post[&#039;content&#039;] = $request[&#039;content&#039;];
            } elseif ( isset( $request[&#039;content&#039;][&#039;raw&#039;] ) ) {
                $prepared_post[&#039;content&#039;] = $request[&#039;content&#039;][&#039;raw&#039;];
            }
        }
        
        // Post category.
        if ( isset( $request[ $this-&gt;cat_taxonomy ] ) ) {
            if ( empty( $request[ $this-&gt;cat_taxonomy ] ) ) {
                $post_category = &#039;&#039;;
            } elseif ( is_array( $request[ $this-&gt;cat_taxonomy ] ) ) {
                $post_category = implode( &#039;,&#039;, $request[ $this-&gt;cat_taxonomy ] );
            } else {
                $post_category = $request[ $this-&gt;cat_taxonomy ];
            }
            
            $prepared_post[&#039;post_category&#039;][ $this-&gt;cat_taxonomy ] = $post_category;
        }
        
        // Post tags.
        if ( isset( $request[ $this-&gt;tag_taxonomy ] ) ) {
            $post_tags = empty( $request[ $this-&gt;tag_taxonomy ] ) || is_array( $request[ $this-&gt;tag_taxonomy ] ) ? $request[ $this-&gt;tag_taxonomy ] : explode( &#039;,&#039;, $request[ $this-&gt;tag_taxonomy ] );
            
            $prepared_post[&#039;post_tags&#039;] = $post_tags;
            
            wp_set_object_terms( $post_id, $prepared_post[&#039;post_tags&#039;], $this-&gt;tag_taxonomy );
        }

        /**
         * Filters a post before it is inserted via the REST API.
         *
         * The dynamic portion of the hook name, `$this-&gt;post_type`, refers to the post type slug.
         *
         *
         * @param array        $prepared_post An object representing a single post prepared
         *                                       for inserting or updating the database.
         * @param WP_REST_Request $request       Request object.
         */
        $prepared_post = apply_filters( &quot;geodir_rest_pre_insert_{$this-&gt;post_type}&quot;, $prepared_post, $request );

        /**
         * Filters a post before it is inserted via the REST API.
         *
         * The dynamic portion of the hook name, `$this-&gt;post_type`, refers to the post type slug.
         *
         *
         * @param array        $prepared_post An object representing a single post prepared
         *                                       for inserting or updating the database.
         * @param WP_REST_Request $request       Request object.
         */
        return apply_filters( &quot;geodir_rest_pre_insert_listing&quot;, $prepared_post, $this-&gt;post_type, $request );
	}

    /**
     * Register GeoDir listing fields.
     *
     * @since 2.0.0
     */
    public function register_listing_fields() {
        $listing_schema = $this-&gt;geodir_get_item_schema();
        
        foreach ( $listing_schema as $name =&gt; $schema ) {
            $args = array();
            //$args[&#039;get_callback&#039;]      = array( $this, &#039;geodir_get_callback&#039; );
            //$args[&#039;update_callback&#039;]   = array( $this, &#039;geodir_update_callback&#039; );
            $args[&#039;schema&#039;]            = $schema;
            
            register_rest_field( $this-&gt;post_type, $name, $args );
        }
    }

    /**
     * GeoDir get item schema.
     *
     * @since 2.0.0
     *
     * @param string $package_id Optional. Package id. Default null.
     * @param string $default Optional. Custom field default value. Default all.
     * @return array Item schema array values.
     */
    public function geodir_get_item_schema( $package_id = &#039;&#039;, $default = &#039;all&#039; ) {
	    global $geodirectory;
        $custom_fields  = geodir_post_custom_fields( $package_id, $default, $this-&gt;post_type );
        
        $schema = array();
        
        $schema[ &#039;post_images&#039; ] = array(
            &#039;type&#039;          =&gt; &#039;string&#039;,
            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
            &#039;title&#039;         =&gt; __( &#039;Listing images&#039;, &#039;geodirectory&#039; ),
            &#039;description&#039;   =&gt; __( &#039;Comma separated list of listing images urls. First image will be set as a featured image for the listing.&#039;, &#039;geodirectory&#039; ),
        );
        
        foreach ( $custom_fields as $id =&gt; $field ) {
            $admin_use              = (bool)$field[&#039;for_admin_use&#039;];
            
            if ( $admin_use ) {
                continue;
            }
            
            $name                   = $field[&#039;htmlvar_name&#039;];
            $data_type              = $field[&#039;data_type&#039;];
            $field_type             = $field[&#039;field_type&#039;];
            $title                  = $field[&#039;site_title&#039;] ? stripslashes( __( $field[&#039;site_title&#039;], &#039;geodirectory&#039; ) ) : stripslashes( __( $field[&#039;admin_title&#039;], &#039;geodirectory&#039; ) );
            $description            = stripslashes( __( $field[&#039;desc&#039;], &#039;geodirectory&#039; ) );
            $required               = $field[&#039;is_required&#039;];
            $default                = $field[&#039;default&#039;];
            $extra_fields           = !empty( $field[&#039;extra_fields&#039;] ) ? stripslashes_deep( maybe_unserialize( $field[&#039;extra_fields&#039;] ) ) : NULL;
            $options                = !empty( $field[&#039;option_values&#039;] ) ? stripslashes_deep( $field[&#039;options&#039;] ) : array();
            $rendered_options       = !empty( $field[&#039;option_values&#039;] ) ? stripslashes_deep( geodir_string_values_to_options( $field[&#039;option_values&#039;], true ) ) : array();
            $enum                   = $rendered_options ? geodir_rest_get_enum_values( $rendered_options ) : array();
            $arg_options            = array( 
                &#039;validate_callback&#039; =&gt; &#039;geodir_rest_validate_request_arg&#039; 
            );
            $prefix                 = &#039;&#039;;
            
            $args                   = array();
            $args[&#039;type&#039;]           = &#039;string&#039;;
            $args[&#039;context&#039;]        = array( &#039;view&#039;, &#039;edit&#039; );
            $args[&#039;title&#039;]          = $title;
            $args[&#039;description&#039;]    = !empty( $description ) ? $description : $title;
            $args[&#039;required&#039;]       = (bool)$required;
            $args[&#039;default&#039;]        = $default;
            
            $continue = false;
            
            switch ( $field_type ) {
                case &#039;address&#039;:
                    $prefix     = $name . &#039;_&#039;;
                    $name       = &#039;address&#039;;
                    $location   = $geodirectory-&gt;location-&gt;get_default_location();
                    $country    = !empty( $location-&gt;country ) ? $location-&gt;country : &#039;&#039;;
                    $region     = !empty( $location-&gt;region ) ? $location-&gt;region : &#039;&#039;;
                    $city       = !empty( $location-&gt;city ) ? $location-&gt;city : &#039;&#039;;
                    $latitude   = !empty( $location-&gt;latitude ) ? $location-&gt;latitude : &#039;&#039;;
                    $longitude  = !empty( $location-&gt;longitude ) ? $location-&gt;longitude : &#039;&#039;;
                    
                    $schema[ $prefix . $name ]    = $args;
                    
                    $schema[ $prefix . &#039;country&#039; ] = array(
                        &#039;type&#039;          =&gt; &#039;string&#039;,
                        &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        &#039;title&#039;         =&gt; __( &#039;Country&#039;, &#039;geodirectory&#039; ),
                        &#039;description&#039;   =&gt; __( &#039;Choose a country&#039;, &#039;geodirectory&#039; ),
                        &#039;required&#039;      =&gt; (bool)$required,
                        &#039;default&#039;       =&gt; $country,
                    );
                    
                    $schema[ $prefix . &#039;region&#039; ] = array(
                        &#039;type&#039;          =&gt; &#039;string&#039;,
                        &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        &#039;title&#039;         =&gt; __( &#039;Region&#039;, &#039;geodirectory&#039; ),
                        &#039;description&#039;   =&gt; __( &#039;Choose a region&#039;, &#039;geodirectory&#039; ),
                        &#039;required&#039;      =&gt; (bool)$required,
                        &#039;default&#039;       =&gt; $region,
                    );
                    
                    $schema[ $prefix . &#039;city&#039; ] = array(
                        &#039;type&#039;          =&gt; &#039;string&#039;,
                        &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        &#039;title&#039;         =&gt; __( &#039;City&#039;, &#039;geodirectory&#039; ),
                        &#039;description&#039;   =&gt; __( &#039;Choose a city&#039;, &#039;geodirectory&#039; ),
                        &#039;required&#039;      =&gt; (bool)$required,
                        &#039;default&#039;       =&gt; $city,
                    );
                    
                    if ( geodir_rest_is_active( &#039;neighbourhood&#039; ) ) {
                        $schema[ $prefix . &#039;neighbourhood&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; __( &#039;Neighbourhood&#039;, &#039;geodirectory&#039; ),
                            &#039;description&#039;   =&gt; __( &#039;Choose a neighbourhood&#039;, &#039;geodirectory&#039; ),
                            &#039;required&#039;      =&gt; (bool)$required,
                        );
                    }
                    
                    if ( !empty( $extra_fields[&#039;show_zip&#039;] ) ) {
                        $schema[ $prefix . &#039;zip&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; !empty( $extra_fields[&#039;zip_lable&#039;] ) ? __( $extra_fields[&#039;zip_lable&#039;], &#039;geodirectory&#039; ) : __( &#039;Zip/Post Code&#039;, &#039;geodirectory&#039; ),
                            &#039;required&#039;      =&gt; ! empty( $extra_fields[&#039;zip_required&#039;] ) ? true : false,
                        );
                    }
                    
                    if ( !empty( $extra_fields[&#039;show_map&#039;] ) ) {
                        $schema[ $prefix . &#039;map&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; !empty( $extra_fields[&#039;map_lable&#039;] ) ? __( $extra_fields[&#039;map_lable&#039;], &#039;geodirectory&#039; ) : __( &#039;Map&#039;, &#039;geodirectory&#039; ),
                            &#039;description&#039;   =&gt; __( &#039;Click on &quot;Set Address on Map&quot; and then you can also drag pinpoint to locate the correct address&#039;, &#039;geodirectory&#039; ),
                            &#039;readonly&#039;      =&gt; true,
                        );
                        
                        $schema[ $prefix . &#039;latitude&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; __( &#039;Address Latitude&#039;, &#039;geodirectory&#039; ),
                            &#039;description&#039;   =&gt; __( &#039;Please enter latitude for google map perfection. eg. : &lt;b&gt;39.955823048131286&lt;/b&gt;&#039;, &#039;geodirectory&#039; ),
                            &#039;required&#039;      =&gt; (bool)$required,
                            &#039;default&#039;       =&gt; $latitude,
                            &#039;readonly&#039;      =&gt; empty( $extra_fields[&#039;show_latlng&#039;] ) ? true : false,
                        );
                        
                        $schema[ $prefix . &#039;longitude&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; __( &#039;Address Longitude&#039;, &#039;geodirectory&#039; ),
                            &#039;description&#039;   =&gt; __( &#039;Please enter longitude for google map perfection. eg. : &lt;b&gt;-75.14408111572266&lt;/b&gt;&#039;, &#039;geodirectory&#039; ),
                            &#039;required&#039;      =&gt; (bool)$required,
                            &#039;default&#039;       =&gt; $longitude,
                            &#039;readonly&#039;      =&gt; empty( $extra_fields[&#039;show_latlng&#039;] ) ? true : false,
                        );
                    }
                    
                    if ( !empty( $extra_fields[&#039;show_mapview&#039;] ) ) {
                        $schema[ $prefix . &#039;mapview&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; !empty( $extra_fields[&#039;mapview_lable&#039;] ) ? __( $extra_fields[&#039;mapview_lable&#039;], &#039;geodirectory&#039; ) : __( &#039;Map View&#039;, &#039;geodirectory&#039; ),
                            &#039;default&#039;       =&gt; &#039;ROADMAP&#039;,
                            &#039;enum&#039;          =&gt; array( &#039;ROADMAP&#039;, &#039;SATELLITE&#039;, &#039;HYBRID&#039;, &#039;TERRAIN&#039; ),
                        );
                    }
                    
                    if ( !empty( $extra_fields[&#039;show_mapzoom&#039;] ) ) {
                        $schema[ $prefix . &#039;mapzoom&#039; ] = array(
                            &#039;type&#039;          =&gt; &#039;string&#039;,
                            &#039;context&#039;       =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;title&#039;         =&gt; __( &#039;Map Zoom&#039;, &#039;geodirectory&#039; ),
                            &#039;readonly&#039;      =&gt; true,
                        );
                    }
                    break;
                case &#039;checkbox&#039;:
                    $args[&#039;type&#039;]   = geodir_rest_data_type_to_field_type( $data_type );
                    break;
                case &#039;datepicker&#039;:
                    $args[&#039;type&#039;]       = &#039;object&#039;;
                    $args[&#039;format&#039;]     = &#039;date-time&#039;;
                    $args[&#039;properties&#039;] = array(
                        &#039;raw&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Date for the object, as it exists in the database.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        ),
                        &#039;rendered&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Date for the object, transformed for display.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;readonly&#039;    =&gt; true,
                        ),
                    );
                    if ( !empty( $extra_fields[&#039;date_format&#039;] ) ) {
                        $arg_options[&#039;date_format&#039;] = $extra_fields[&#039;date_format&#039;];
                    }
                    break;
                case &#039;email&#039;:
                    $args[&#039;format&#039;] = &#039;email&#039;;
                    break;
                case &#039;fieldset&#039;:
                    $args[&#039;readonly&#039;] = true;
                    break;
                case &#039;file&#039;:
                    $args[&#039;type&#039;]       = &#039;object&#039;;
                    $args[&#039;properties&#039;] = array(
                        &#039;raw&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;File for the object, as it exists in the database.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        ),
                        &#039;rendered&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;File for the object, transformed for display.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;readonly&#039;    =&gt; true,
                        ),
                    );
                    
                    if ( !empty( $extra_fields[&#039;gd_file_types&#039;] ) ) {
                        $arg_options[&#039;file_types&#039;] = $extra_fields[&#039;gd_file_types&#039;];
                    }
                    break;
                case &#039;html&#039;:
                    $args[&#039;type&#039;]       = &#039;object&#039;;
                    $args[&#039;properties&#039;] = array(
                        &#039;raw&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Content for the object, as it exists in the database.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        ),
                        &#039;rendered&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Content for the object, transformed for display.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;readonly&#039;    =&gt; true,
                        ),
                    );
                    break;
                case &#039;multiselect&#039;:
                    $args[&#039;type&#039;]       = &#039;array&#039;;
                    $args[&#039;enum&#039;]       = $enum;
                    $args[&#039;items&#039;]      = array( &#039;type&#039; =&gt; &#039;string&#039; );
                    $args[&#039;properties&#039;] = array(
                        &#039;raw&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Field for the object, as it exists in the database.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        ),
                        &#039;rendered&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Field for the object, transformed for display.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;readonly&#039;    =&gt; true,
                        ),
                    );
                    $arg_options[&#039;display_type&#039;]        = !empty( $extra_fields ) ? $extra_fields : &#039;select&#039;;
                    break;
                case &#039;radio&#039;:
                    $args[&#039;type&#039;]           = &#039;object&#039;;
                    $args[&#039;enum&#039;]           = $enum;
                    $args[&#039;items&#039;]          = array( &#039;type&#039; =&gt; &#039;string&#039; );
                    break;
                case &#039;select&#039;:
                    $args[&#039;type&#039;]       = &#039;object&#039;;
                    $args[&#039;enum&#039;]       = $enum;
                    $args[&#039;items&#039;]      = array( &#039;type&#039; =&gt; &#039;string&#039; );
                    $args[&#039;properties&#039;] = array(
                        &#039;raw&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Field for the object, as it exists in the database.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                        ),
                        &#039;rendered&#039; =&gt; array(
                            &#039;description&#039; =&gt; __( &#039;Field for the object, transformed for display.&#039; ),
                            &#039;type&#039;        =&gt; &#039;string&#039;,
                            &#039;context&#039;     =&gt; array( &#039;view&#039;, &#039;edit&#039; ),
                            &#039;readonly&#039;    =&gt; true,
                        ),
                    );
                    break;
                case &#039;taxonomy&#039;:
                    if ( $this-&gt;cat_taxonomy == $name ) {
                        $args[&#039;type&#039;]        = &#039;array&#039;;
                        $args[&#039;items&#039;]       = array( &#039;type&#039; =&gt; &#039;integer&#039; );
                    }
                    break;
                case &#039;phone&#039;:
                case &#039;text&#039;:
                    $args[&#039;type&#039;]   = geodir_rest_data_type_to_field_type( $data_type );
                    break;
                case &#039;textarea&#039;:
                    $args[&#039;type&#039;]   = &#039;string&#039;;
                    break;
                case &#039;time&#039;:
                    $args[&#039;type&#039;]   = &#039;string&#039;;
                    break;
                case &#039;url&#039;:
                    $args[&#039;format&#039;] = &#039;uri&#039;;
                    break;
                default:
                    $continue = true;
                    break;
            }
            
            if ( $continue ) {
                continue;
            }
            
            if ( !empty( $rendered_options ) ) {
                $arg_options[&#039;rendered_options&#039;]   = $rendered_options;
            }
            
            $args[&#039;field_type&#039;]     = $field_type;
            $args[&#039;data_type&#039;]      = $data_type;
            $args[&#039;extra_fields&#039;]   = $extra_fields;
            if ( !empty( $options ) ) {
                $args[&#039;field_options&#039;]   = $options;
            }
            
            $args[&#039;arg_options&#039;]   = $arg_options;
            
            $schema[ $prefix . $name ]    = apply_filters( &#039;geodir_listing_fields_args&#039;, $args, $field );
        }

        return apply_filters( &#039;geodir_listing_item_schema&#039;, $schema, $this-&gt;post_type, $package_id, $default );
    }

    /**
     * GeoDir get item callback.
     *
     * @since 2.0.0
     *
     * @param object $object Item object.
     * @param string $field_name Field name.
     * @param string $request Item request.
     * @param string $object_type Object type.
     * @return object $object.
     */
    public function geodir_get_callback( $object, $field_name, $request, $object_type ) {
        return $object;
    }

    /**
     * GeoDir update item callback.
     *
     * @param string $value Item value.
     * @param object $object Item object.
     * @param string $field_name Field name.
     * @param string $request Item request.
     * @param string $object_type Object type.
     * @return bool.
     */
    public function geodir_update_callback( $value, $object, $field_name, $request, $object_type ) {
        return true;
    }
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337337"></script>
    <script src="../js/search.js?updated=1652337337"></script>
</body>
</html>
