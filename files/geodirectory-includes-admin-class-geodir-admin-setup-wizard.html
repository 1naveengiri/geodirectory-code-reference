<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652341136">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652341136">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpgeodirectory.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://ayecode.io/careers/" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-admin-setup-wizard.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Setup Wizard Class
 *
 * Takes new users through some basic steps to setup their directory.
 *
 * @author      AyeCode
 * @category    Admin
 * @package     GeoDirectroy/Admin
 * @version     2.0.0
 * @info        GeoDirectory Class used as a base.
 */
if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * GeoDir_Admin_Setup_Wizard class.
 */
class GeoDir_Admin_Setup_Wizard {

	/** @var string Current Step */
	private $step = &#039;&#039;;

	/** @var array Steps for the setup wizard */
	private $steps = array();

	/**
	 * Hook in tabs.
	 */
	public function __construct() {
		if ( apply_filters( &#039;geodir_enable_setup_wizard&#039;, true ) &amp;&amp; current_user_can( &#039;manage_options&#039; ) ) {
			add_action( &#039;admin_menu&#039;, array( $this, &#039;admin_menus&#039; ) );
			add_action( &#039;current_screen&#039;, array( $this, &#039;setup_wizard&#039; ) );

			// add default content action
			add_action( &#039;geodir_wizard_content_dummy_data&#039;, array( __CLASS__, &#039;content_dummy_data&#039; ) );
			add_action( &#039;geodir_wizard_content_sidebars&#039;, array( __CLASS__, &#039;content_sidebars&#039; ) );
			add_action( &#039;geodir_wizard_content_menus&#039;, array( __CLASS__, &#039;content_menus&#039; ) );
		}
	}

	/**
	 * Add admin menus/screens.
	 */
	public function admin_menus() {
		add_dashboard_page( &#039;&#039;, &#039;&#039;, &#039;manage_options&#039;, &#039;gd-setup&#039;, &#039;&#039; );
	}

	/**
	 * Show the setup wizard.
	 *
	 * @since 2.0.0
	 */
	public function setup_wizard() {
		if ( empty( $_GET[&#039;page&#039;] ) || &#039;gd-setup&#039; !== $_GET[&#039;page&#039;] ) {
			return;
		}

		// skip intro
		if ( empty( $_GET[&#039;step&#039;] ) ) {
			$_GET[&#039;step&#039;] = &#039;maps&#039;;
		}

		$default_steps = array(
			&#039;introduction&#039;     =&gt; array(
				&#039;name&#039;    =&gt; __( &#039;Introduction&#039;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_introduction&#039; ),
				&#039;handler&#039; =&gt; &#039;&#039;,
			),

			&#039;maps&#039;             =&gt; array(
				&#039;name&#039;    =&gt; __( &quot;Map&#039;s&quot;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_maps&#039; ),
				&#039;handler&#039; =&gt; array( $this, &#039;setup_maps_save&#039; ),
			),
			&#039;default_location&#039; =&gt; array(
				&#039;name&#039;    =&gt; __( &#039;Default Location&#039;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_default_location&#039; ),
				&#039;handler&#039; =&gt; array( $this, &#039;setup_default_location_save&#039; ),
			),
			&#039;features&#039;             =&gt; array(
				&#039;name&#039;    =&gt; __( &quot;Extra Features&quot;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_features&#039; ),
				&#039;handler&#039; =&gt; array( $this, &#039;setup_features_save&#039; ),
			),
//			&#039;type&#039;             =&gt; array(
//				&#039;name&#039;    =&gt; __( &quot;Industry&quot;, &#039;geodirectory&#039; ),
//				&#039;view&#039;    =&gt; array( $this, &#039;setup_type&#039; ),
//				&#039;handler&#039; =&gt; array( $this, &#039;setup_type_save&#039; ),
//			),
//			&#039;type&#039;        =&gt; array(
//				&#039;name&#039;    =&gt; __( &#039;Directory&#039;, &#039;geodirectory&#039; ),
//				&#039;view&#039;    =&gt; array( $this, &#039;setup_recommend&#039; ),
//				&#039;handler&#039; =&gt; array( $this, &#039;setup_recommend_save&#039; ),
//			),
//			&#039;features&#039;        =&gt; array(
//				&#039;name&#039;    =&gt; __( &#039;Features&#039;, &#039;geodirectory&#039; ),
//				&#039;view&#039;    =&gt; array( $this, &#039;setup_recommend&#039; ),
//				&#039;handler&#039; =&gt; array( $this, &#039;setup_recommend_save&#039; ),
//			),
//			&#039;recommend&#039;        =&gt; array(
//				&#039;name&#039;    =&gt; __( &#039;Recommend&#039;, &#039;geodirectory&#039; ),
//				&#039;view&#039;    =&gt; array( $this, &#039;setup_recommend&#039; ),
//				&#039;handler&#039; =&gt; array( $this, &#039;setup_recommend_save&#039; ),
//			),
			&#039;content&#039;          =&gt; array(
				&#039;name&#039;    =&gt; __( &#039;Content&#039;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_content&#039; ),
				&#039;handler&#039; =&gt; array( $this, &#039;setup_content_save&#039; ),
			),
			&#039;next_steps&#039;       =&gt; array(
				&#039;name&#039;    =&gt; __( &#039;Ready!&#039;, &#039;geodirectory&#039; ),
				&#039;view&#039;    =&gt; array( $this, &#039;setup_ready&#039; ),
				&#039;handler&#039; =&gt; &#039;&#039;,
			),
		);


		// remove default location step if LM installed
		if ( defined( &#039;GEODIRLOCATION_VERSION&#039; ) ) {
			unset( $default_steps[&#039;default_location&#039;] );
		}

		$this-&gt;steps     = apply_filters( &#039;geodirectory_setup_wizard_steps&#039;, $default_steps );
		$this-&gt;step      = isset( $_GET[&#039;step&#039;] ) ? sanitize_key( $_GET[&#039;step&#039;] ) : current( array_keys( $this-&gt;steps ) );
		$suffix          = defined( &#039;SCRIPT_DEBUG&#039; ) &amp;&amp; SCRIPT_DEBUG ? &#039;&#039; : &#039;.min&#039;;
		$geodir_map_name = GeoDir_Maps::active_map();

		// AUI
		$design_style = geodir_design_style();
		// enqueue the script
		$aui_settings = AyeCode_UI_Settings::instance();
		$aui_settings-&gt;enqueue_scripts();
		$aui_settings-&gt;enqueue_style();
		

		// load OSM styles if needed.
		if ( $geodir_map_name == &#039;osm&#039; ) {
			wp_enqueue_style( &#039;geodir-leaflet-style&#039; );
		}


		// map arguments
		$map_lang = &quot;&amp;language=&quot; . GeoDir_Maps::map_language();
		$map_key  = GeoDir_Maps::google_api_key( true );
		/**
		 * Filter the variables that are added to the end of the google maps script call.
		 *
		 * This i used to change things like google maps language etc.
		 *
		 * @since 1.0.0
		 *
		 * @param string $var The string to filter, default is empty string.
		 */
		$map_extra = apply_filters( &#039;geodir_googlemap_script_extra&#039;, &#039;&#039; );

		wp_register_script( &#039;geodir-goMap&#039;, geodir_plugin_url() . &#039;/assets/js/goMap&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION, true );
		wp_register_script( &#039;geodir-google-maps&#039;, &#039;https://maps.google.com/maps/api/js?&#039; . $map_lang . $map_key . $map_extra, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-g-overlappingmarker-script&#039;, geodir_plugin_url() . &#039;/assets/jawj/oms&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-o-overlappingmarker-script&#039;, geodir_plugin_url() . &#039;/assets/jawj/oms-leaflet&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-leaflet-script&#039;, geodir_plugin_url() . &#039;/assets/leaflet/leaflet&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-leaflet-geo-script&#039;, geodir_plugin_url() . &#039;/assets/leaflet/osm.geocode&#039; . $suffix . &#039;.js&#039;, array( &#039;geodir-leaflet-script&#039; ), GEODIRECTORY_VERSION );
		wp_register_script( &#039;select2&#039;, geodir_plugin_url() . &#039;/assets/js/select2/select2.full&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-admin-script&#039;, geodir_plugin_url() . &#039;/assets/js/admin&#039; . $suffix . &#039;.js&#039;, array(
			&#039;jquery&#039;,
			&#039;jquery-ui-tooltip&#039;,
			&#039;thickbox&#039;
		), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-lity&#039;, geodir_plugin_url() . &#039;/assets/js/libraries/gd_lity&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_style( &#039;font-awesome&#039;, &#039;https://use.fontawesome.com/releases/v5.13.0/css/all.css&#039;, array( &#039;font-awesome-shim&#039; ), GEODIRECTORY_VERSION );
		wp_register_style( &#039;font-awesome-shim&#039;, &#039;https://use.fontawesome.com/releases/v5.13.0/css/v4-shims.css&#039;, array(), GEODIRECTORY_VERSION );
		wp_add_inline_script( &#039;geodir-admin-script&#039;, &quot;window.gdSetMap = window.gdSetMap || &#039;&quot; . GeoDir_Maps::active_map() . &quot;&#039;;&quot;, &#039;before&#039; );
		wp_add_inline_script( &#039;geodir-admin-script&#039;, &quot;var ajaxurl = &#039;&quot; . admin_url( &#039;admin-ajax.php&#039; ) . &quot;&#039;;&quot;, &#039;before&#039; );


		wp_register_script( &#039;geodir-google-maps&#039;, &#039;https://maps.google.com/maps/api/js?&#039; . $map_lang . $map_key . $map_extra, array(), GEODIRECTORY_VERSION );
		wp_register_script( &#039;geodir-leaflet-script&#039;, geodir_plugin_url() . &#039;/assets/leaflet/leaflet&#039; . $suffix . &#039;.js&#039;, array(), GEODIRECTORY_VERSION );


		$required_scripts = array(
			&#039;jquery&#039;,
			&#039;jquery-ui-tooltip&#039;,
			&#039;select2&#039;,
			&#039;geodir-admin-script&#039;,
			&#039;jquery-ui-progressbar&#039;,
			&#039;geodir-lity&#039;,
			&#039;bootstrap-js-bundle&#039;,
		);

		// add maps if needed
		if ( in_array( $geodir_map_name, array( &#039;auto&#039;, &#039;google&#039; ) ) ) {
			$required_scripts[] = &#039;geodir-google-maps&#039;;
			$required_scripts[] = &#039;geodir-g-overlappingmarker-script&#039;;
		} elseif ( $geodir_map_name == &#039;osm&#039; ) {
			$required_scripts[] = &#039;geodir-leaflet-script&#039;;
			$required_scripts[] = &#039;geodir-leaflet-geo-script&#039;;
			$required_scripts[] = &#039;geodir-o-overlappingmarker-script&#039;;
		}

		$osm_extra = GeoDir_Maps::footer_script();
		wp_add_inline_script( &#039;geodir-goMap&#039;, &quot;window.gdSetMap = window.gdSetMap || &#039;&quot; . GeoDir_Maps::active_map() . &quot;&#039;;&quot; . $osm_extra, &#039;before&#039; );
		$required_scripts[] = &#039;geodir-goMap&#039;;
		
		// demo import
		if ( defined( &#039;AYECODE_CONNECT_VERSION&#039; ) ) {
			global $ayecode_connect;


			if ( $ayecode_connect-&gt;is_registered() ) {
				$connected = true;

				if ( defined( &#039;AYECODE_CONNECT_PLUGIN_DIR&#039; ) ) {
					require_once AYECODE_CONNECT_PLUGIN_DIR . &#039;/includes/class-ayecode-demo-content.php&#039;;

					$demo_content = AyeCode_Demo_Content::instance();
					$demo_content-&gt;scripts();

					$required_scripts[] =&#039;ayecode-connect&#039;;

				}
			}
		}


		wp_register_script( &#039;geodir-setup&#039;, GEODIRECTORY_PLUGIN_URL . &#039;/assets/js/setup-wizard&#039; . $suffix . &#039;.js&#039;, $required_scripts, GEODIRECTORY_VERSION );


		wp_localize_script( &#039;geodir-setup&#039;, &#039;geodir_params&#039;, geodir_params() );

		wp_enqueue_style( &#039;geodir-admin-css&#039;, geodir_plugin_url() . &#039;/assets/css/admin.css&#039;, array(), GEODIRECTORY_VERSION );
		wp_enqueue_style( &#039;geodir-jquery-ui-css&#039;, geodir_plugin_url() . &#039;/assets/css/jquery-ui.css&#039;, array(), GEODIRECTORY_VERSION );
		wp_enqueue_style( &#039;jquery-ui-core&#039; );
		wp_enqueue_style( &#039;font-awesome&#039; );
		wp_enqueue_style( &#039;geodir-setup-wizard&#039;, GEODIRECTORY_PLUGIN_URL . &#039;/assets/css/setup-wizard.css&#039;, array(
			&#039;dashicons&#039;,
//			&#039;install&#039;,
			&#039;thickbox&#039;
		), GEODIRECTORY_VERSION );
		wp_enqueue_style( &#039;select2&#039;, GEODIRECTORY_PLUGIN_URL . &#039;/assets/css/select2/select2.css&#039;, array(), GEODIRECTORY_VERSION );
		wp_register_style( &#039;geodir-leaflet-style&#039;, geodir_plugin_url() . &#039;/assets/leaflet/leaflet.css&#039;, array(), GEODIRECTORY_VERSION );

		// load OSM styles if needed.
		if ( $geodir_map_name == &#039;osm&#039; ) {
			wp_enqueue_style( &#039;geodir-leaflet-style&#039;, geodir_plugin_url() . &#039;/assets/leaflet/leaflet.css&#039;, array(), GEODIRECTORY_VERSION );
		}


		if ( ! empty( $_POST[&#039;save_step&#039;] ) &amp;&amp; isset( $this-&gt;steps[ $this-&gt;step ][&#039;handler&#039;] ) ) {
			call_user_func( $this-&gt;steps[ $this-&gt;step ][&#039;handler&#039;], $this );
		}


		ob_start();
		$this-&gt;setup_wizard_header();
//		$this-&gt;setup_wizard_steps();
		$this-&gt;setup_wizard_content();
		$this-&gt;setup_wizard_footer();
		exit;
	}

	/**
	 * Setup Wizard Header.
	 *
	 * @since 2.0.0
	 */
public function setup_wizard_header() {
	?&gt;
	&lt;!DOCTYPE html&gt;
	&lt;html &lt;?php language_attributes(); ?&gt; class=&quot;bsui&quot;&gt;
	&lt;head&gt;
		&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;/&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;
		&lt;title&gt;&lt;?php esc_html_e( &#039;GeoDirectory &amp;rsaquo; Setup Wizard&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/title&gt;
		&lt;?php wp_print_scripts( &#039;geodir-setup&#039; ); ?&gt;
		&lt;?php do_action( &#039;admin_print_styles&#039; ); ?&gt;
		&lt;?php do_action( &#039;admin_head&#039; ); ?&gt;
		&lt;style&gt;
			body,p{
				font-size: 16px;
				font-weight: normal;
			}
			.gd-blur {
				filter: blur(2px);
			}
			.gd-blur:hover {
				filter: blur(0);
			}
		&lt;/style&gt;
	&lt;/head&gt;
	&lt;body class=&quot;modal-open &quot; style=&quot;background: #f1f1f1;&quot;&gt;
	

	&lt;div id=&quot;gd-setup-container&quot; class=&quot;gd-setup wp-core-ui bg-whitex mx-auto mt-4x modal fade show overflow-auto&quot;  style=&quot;display: block;z-index: inherit;&quot;&gt;

		&lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm&quot;&gt;
			&lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;
				&lt;h1 class=&quot;h5 p-0 m-0&quot;&gt;
					&lt;i class=&quot;fas fa-globe-americas text-primary bg-white rounded-circle&quot; style=&quot;color:#ff8333 !important;&quot;&gt;&lt;/i&gt;
							&lt;span class=&quot;&quot; style=&quot;color:#52565a;&quot;&gt;
								&lt;span class=&quot;&quot; style=&quot;color:#ff8333 !important;&quot;&gt;Geo&lt;/span&gt;Directory
							&lt;/span&gt;
				&lt;/h1&gt;
			&lt;/a&gt;
			&lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbarSupportedContent&quot; aria-controls=&quot;navbarSupportedContent&quot; aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;
				&lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;
			&lt;/button&gt;

			&lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;navbarSupportedContent&quot;&gt;
				&lt;?php $this-&gt;setup_wizard_steps();?&gt;

			&lt;/div&gt;
		&lt;/nav&gt;



		&lt;div class=&quot;modal-dialog flex-column modal-dialog-scrollablex modal-dialog-centered modal-lg&quot; style=&quot; padding-right: 15px;&quot;&gt;

			&lt;?php
			if(!empty($_GET[&#039;step&#039;]) &amp;&amp; $_GET[&#039;step&#039;]==&#039;maps&#039;){
				$this-&gt;setup_introduction();


			}
			?&gt;

			&lt;div class=&quot;modal-content border-0 shadow&quot;&gt;

				&lt;div class=&quot;modal-body p-5&quot;&gt;


	&lt;?php
	}

	/**
	 * Output the steps.
	 *
	 * @since 2.0.0
	 */
	public function setup_wizard_steps() {
		$ouput_steps = $this-&gt;steps;
		array_shift( $ouput_steps );
		/*?&gt;
		&lt;ol class=&quot;gd-setup-steps mb-0 pb-4 text-uppercase font-weight-bold small&quot;&gt;
			&lt;?php foreach ( $ouput_steps as $step_key =&gt; $step ) : ?&gt;
				&lt;li class=&quot;&lt;?php
				if ( $step_key === $this-&gt;step ) {
					echo &#039;active&#039;;
				} elseif ( array_search( $this-&gt;step, array_keys( $this-&gt;steps ) ) &gt; array_search( $step_key, array_keys( $this-&gt;steps ) ) ) {
					echo &#039;done&#039;;
				}
				?&gt;&quot;&gt;&lt;?php echo esc_html( $step[&#039;name&#039;] ); ?&gt;&lt;/li&gt;
			&lt;?php endforeach; ?&gt;
		&lt;/ol&gt;
		&lt;?php
*/

		$tick_class = &#039;text-black-50&#039;;
		?&gt;
		&lt;ol class=&quot;nav nav-pills nav-fill w-100 text-uppercase font-weight-bold small text-muted&quot;&gt;
			&lt;?php foreach ( $ouput_steps as $step_key =&gt; $step ) : ?&gt;
				&lt;li class=&quot;nav-link border-0 d-flex align-content-center justify-content-center &lt;?php
				if ( $step_key === $this-&gt;step ) {
					echo &#039;active&#039;;
					$tick_class = &#039;&#039;;
				} elseif ( array_search( $this-&gt;step, array_keys( $this-&gt;steps ) ) &gt; array_search( $step_key, array_keys( $this-&gt;steps ) ) ) {
					$tick_class = &#039;text-primary&#039;;
				}
				?&gt;&quot;&gt;&lt;span class=&quot;h5 p-0 m-0&quot;&gt;&lt;i class=&quot;fas fa-check-circle &lt;?php echo $tick_class;?&gt;&quot;&gt;&lt;/i&gt;&lt;/span&gt; &lt;span class=&quot;pl-1 align-self-center&quot;&gt;&lt;?php echo esc_html( $step[&#039;name&#039;] ); ?&gt;&lt;/span&gt;

				&lt;/li&gt;
			&lt;?php endforeach; ?&gt;
		&lt;/ol&gt;
		&lt;?php
	}

	/**
	 * Output the content for the current step.
	 *
	 * @since 2.0.0
	 */
	public function setup_wizard_content() {
		echo &#039;&lt;div class=&quot;gd-setup-content&quot;&gt;&#039;;
		call_user_func( $this-&gt;steps[ $this-&gt;step ][&#039;view&#039;], $this );
		echo &#039;&lt;/div&gt;&#039;;
	}

	/**
	 * Setup Wizard Footer.
	 *
	 * @since 2.0.0
	 */
	public function setup_wizard_footer() {
	?&gt;
	&lt;?php if ( &#039;next_steps&#039; === $this-&gt;step ) : ?&gt;
		&lt;p class=&quot;gd-return-to-dashboard-wrapper text-center mb-0 mt-5&quot;&gt;&lt;a class=&quot;gd-return-to-dashboard&quot;
		                                          href=&quot;&lt;?php echo esc_url( admin_url() ); ?&gt;&quot;&gt;&lt;?php esc_html_e( &#039;Return to the WordPress Dashboard&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
		&lt;/p&gt;
	&lt;?php endif; ?&gt;
	&lt;/div&gt;
	&lt;/div&gt;
	&lt;/div&gt;
	&lt;/div&gt;
	&lt;/body&gt;
	&lt;/html&gt;
	&lt;?php
}

	/**
	 * Introduction step.
	 *
	 * @since 2.0.0
	 */
	public function setup_introduction() {
		?&gt;

		&lt;div class=&quot;modal-content border-0 shadow mb-4 collapse show gd-setup-welcome&quot; data-toggle=&quot;collapse&quot;&gt;
			&lt;div class=&quot;modal-body p-5&quot;&gt;
				&lt;div class=&quot;gd-setup-content&quot;&gt;
					&lt;h1 class=&quot;h3&quot;&gt;&lt;?php esc_html_e( &#039;Welcome to the world of GeoDirectory!&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h1&gt;
					&lt;p class=&quot;mt-3&quot;&gt;&lt;?php _e( &quot;This quick setup wizard will help you &lt;b&gt;configure your directory&lt;/b&gt;. It&#039;s &lt;b&gt;completely optional&lt;/b&gt; and shouldn&#039;t take longer than &lt;b&gt;five minutes&lt;b/&gt;.&quot;, &#039;geodirectory&#039; ); ?&gt;&lt;/p&gt;
					&lt;p class=&quot;gd-setup-actions step text-right&quot;&gt;
						&lt;a href=&quot;&lt;?php echo esc_url( admin_url() ); ?&gt;&quot;
						   class=&quot;btn btn-link text-muted &quot;&gt;&lt;?php esc_html_e( &#039;Not right now&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
						&lt;a href=&quot;#&quot; onclick=&quot;jQuery(&#039;.gd-setup-welcome&#039;).collapse(&#039;hide&#039;);return false;&quot;
						   class=&quot;btn btn-primary button-next&quot;&gt;
							&lt;svg viewbox=&quot;0 0 250 250&quot; style=&quot;    height: auto;
    width: 20px;
    margin-left: -6px;
    margin-right: 4px;
    margin-top: -2px;
    transform: scaleX(-1);&quot;&gt;
								&lt;path id=&quot;loader&quot; transform=&quot;translate(125, 125) scale(.84)&quot; style=&quot;fill: #ffffff7d&quot;/&gt;
							&lt;/svg&gt;
							&lt;?php esc_html_e( &#039;Let\&#039;s go!&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;/p&gt;
					&lt;script&gt;

//						jQuery(&#039;.gd-setup-welcome&#039;).collapse(toggle: false);
						var loader = document.getElementById(&#039;loader&#039;)
							, α = 360
							, π = Math.PI
							, t = 30;

						(function draw() {
							α--;
							α %= 360;
							var r = ( α * π / 180 )
								, x = Math.sin(r) * 125
								, y = Math.cos(r) * -125
								, mid = ( α &gt; 180 ) ? 1 : 0
								, anim = &#039;M 0 0 v -125 A 125 125 1 &#039;
								+ mid + &#039; 1 &#039;
								+ x + &#039; &#039;
								+ y + &#039; z&#039;;

							loader.setAttribute(&#039;d&#039;, anim);

							if(α==0){
								jQuery(&#039;.gd-setup-welcome&#039;).collapse(&#039;hide&#039;);
							}else{
								setTimeout(draw, t); // Redraw
							}
						})();

					&lt;/script&gt;

				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/div&gt;
		&lt;?php
	}

	/**
	 * Get the URL for the next step&#039;s screen.
	 *
	 * @param string step   slug (default: current step)
	 *
	 * @return string       URL for next step if a next step exists.
	 *                      Admin URL if it&#039;s the last step.
	 *                      Empty string on failure.
	 * @since 3.0.0
	 */
	public function get_next_step_link( $step = &#039;&#039; ) {
		if ( ! $step ) {
			$step = $this-&gt;step;
		}

		$keys = array_keys( $this-&gt;steps );
		if ( end( $keys ) === $step ) {
			return admin_url();
		}

		$step_index = array_search( $step, $keys );
		if ( false === $step_index ) {
			return &#039;&#039;;
		}

		return add_query_arg( &#039;step&#039;, $keys[ $step_index + 1 ] );
	}

	public function get_ach(){
		$strings = array(
			&#039;connect_title&#039; =&gt; __(&quot;GeoDirectory - an AyeCode product!&quot;,&quot;geodirectory&quot;),
			&#039;connect_external&#039;  =&gt; __( &quot;Please confirm you wish to connect your site?&quot;,&quot;geodirectory&quot; ),
			&#039;connect&#039;           =&gt; sprintf( __( &quot;&lt;strong&gt;Have a license?&lt;/strong&gt; Forget about entering license keys or downloading zip files, connect your site for instant access. %slearn more%s&quot;,&quot;geodirectory&quot; ),&quot;&lt;a href=&#039;https://ayecode.io/introducing-ayecode-connect/&#039; target=&#039;_blank&#039;&gt;&quot;,&quot;&lt;/a&gt;&quot; ),
			&#039;connect_button&#039;    =&gt; __(&quot;Connect Site&quot;,&quot;geodirectory&quot;),
			&#039;connecting_button&#039;    =&gt; __(&quot;Connecting...&quot;,&quot;geodirectory&quot;),
			&#039;error_localhost&#039;   =&gt; __( &quot;This service will only work with a live domain, not a localhost.&quot;,&quot;geodirectory&quot; ),
			&#039;error&#039;             =&gt; __( &quot;Something went wrong, please refresh and try again.&quot;,&quot;geodirectory&quot; ),
		);
		$ach = new AyeCode_Connect_Helper($strings,array(&#039;gd-addons&#039;));

		return $ach;
	}

	public function setup_features() {

//		print_r(get_plugins());exit;

//		print_r( get_option( &#039;active_plugins&#039;, array() )); exit;

		include_once( ABSPATH . &#039;wp-admin/includes/plugin-install.php&#039; ); //for plugins_api..

		$recommend_wp_plugins = GeoDir_Admin_Addons::get_recommend_wp_plugins();

//		print_r(GeoDir_Admin_Addons::get_wizard_paid_addons_html());


		$paid_types = GeoDir_Admin_Addons::get_wizard_paid_addons();


		?&gt;



		&lt;div class=&quot;text-center mb-4&quot;&gt;
			&lt;h1 class=&quot;h3&quot;&gt;&lt;?php _e(&quot;What Directory features do you need?&quot;,&quot;geodirectory&quot;);?&gt;&lt;/h1&gt;
			&lt;small class=&quot;text-muted&quot;&gt;&lt;?php _e(&quot;Select any that apply&quot;,&quot;geodirectory&quot;);?&gt;&lt;/small&gt;
		&lt;/div&gt;

		&lt;div class=&quot;list-group mb-5&quot; &gt;
			
			&lt;?php

			$installed_text = &quot;&lt;i class=\&quot;fas fa-check-circle\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot; . __( &#039;Installed&#039;, &#039;geodirectory&#039; );
			echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installing-text&#039; value=&#039;&lt;i class=\&quot;fas fa-sync fa-spin\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot; . __( &#039;Installing&#039;, &#039;geodirectory&#039; ) . &quot;&#039; &gt;&quot;;
			echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installed-text&#039; value=&#039;$installed_text&#039; &gt;&quot;;

			// recommended
			foreach ( $recommend_wp_plugins as $product ) {

				$nonce = wp_create_nonce( &#039;updates&#039; );

				$title = esc_attr($product[&#039;name&#039;]);
				$slug = esc_attr($product[&#039;slug&#039;]);
				$file = esc_attr($product[&#039;file&#039;]);
				$selected = false;//!empty($type[&#039;selected&#039;]) ? true : false;
				$info_url = admin_url( &quot;plugin-install.php?gd_wizard_recommend=true&amp;tab=plugin-information&amp;plugin=&quot; . $slug );

				$status = install_plugin_install_status( array( &quot;slug&quot; =&gt; $slug, &quot;version&quot; =&gt; &quot;&quot; ) );
				//print_r($status);

				$plugin_status = isset( $status[&#039;status&#039;] ) ? $status[&#039;status&#039;] : &#039;&#039;;
				$url           = isset( $status[&#039;url&#039;] ) ? $status[&#039;url&#039;] : &#039;&#039;;

				$nonce = wp_create_nonce( &#039;updates&#039; );
				
				$active = false;
				$active_badge = &#039;&#039;;
				$activate_url = wp_nonce_url(admin_url(&#039;plugins.php?action=activate&amp;plugin=&#039;.$file), &#039;activate-plugin_&#039; . $file);
				$more_info = &#039; &lt;a href=&quot;#&quot; class=&quot;text-muted&quot; onclick=&quot;aui_modal_iframe(\&#039;&#039;.$title.&#039;\&#039;,\&#039;&#039;.$info_url.&#039;\&#039;,\&#039;\&#039;,true,\&#039;\&#039;,\&#039;modal-lg\&#039;)&quot;&gt;&lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#039;;

				if ( $plugin_status == &#039;install&#039; ) {// required installation
					$checked        = &quot;checked&quot;;
					$disabled       = &quot;&quot;;
					$checkbox_class = &quot;gd_install_plugins&quot;;
				} else {
					$active = is_plugin_active( $file );
					$checked        = &quot;checked&quot;;
					$disabled       = $active ? &quot;disabled&quot; : &#039;&#039;;
					$checkbox_class = $active ? &quot;&quot; : &#039;gd_install_plugins&#039;;
					$active_badge = $active ? &#039;&lt;span class=&quot;badge badge-pill badge-success&quot;&gt;&#039;.__(&quot;Active&quot;,&quot;geodirectory&quot;).&#039;&lt;/span&gt; &#039; : &#039;&#039;;

				}


				?&gt;
				&lt;div class=&quot;list-group-item gd-addon list-group-item-action &lt;?php echo $slug;?&gt; &lt;?php echo $selected ? &#039;active&#039; : &#039;&#039;;?&gt;&quot;&gt;
					&lt;div class=&quot;d-flex w-100 justify-content-between&quot;&gt;
						&lt;div class=&quot;custom-control custom-checkbox&quot;&gt;
							&lt;input type=&quot;checkbox&quot; class=&quot;custom-control-input &lt;?php echo $checkbox_class;?&gt;&quot; id=&quot;&lt;?php echo $slug;?&gt;&quot; &lt;?php echo $checked;?&gt; &lt;?php echo $disabled;?&gt; 
							       data-status=&quot;&lt;?php echo esc_attr($plugin_status);?&gt;&quot;
							       data-slug=&quot;&lt;?php echo esc_attr($slug);?&gt;&quot;
							       data-activateurl=&quot;&lt;?php echo esc_attr($activate_url);?&gt;&quot;
							&gt;
							&lt;label class=&quot;custom-control-label&quot; for=&quot;&lt;?php echo $slug;?&gt;&quot;&gt;&lt;?php echo $title.$more_info;?&gt;&lt;/label&gt;
						&lt;/div&gt;
						&lt;small class=&quot;&quot;&gt;
							&lt;span class=&quot;badge badge-pill badge-secondary gd-plugin-status d-none&quot;&gt;&lt;?php _e( &quot;Installing&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/span&gt;
							&lt;?php echo $active_badge;?&gt;
							&lt;span class=&quot;badge badge-pill badge-success&quot;&gt;&lt;?php _e(&quot;Free&quot;,&quot;geodirectory&quot;);?&gt;&lt;/span&gt;
						&lt;/small&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;?php
			}

			?&gt;

		&lt;/div&gt;

		&lt;?php

		$ach = self::get_ach();

		// scripts
		$ach-&gt;script();

		$is_local = $ach-&gt;is_localhost();

		if(!$is_local) {
			$connected = false;
			$all_licences    = get_option( &quot;ayecode_connect_licences&quot; );
			$actual_licences = get_option( &quot;exup_keys&quot; );
//			print_r($all_licences);exit;
			$membership_status = false;
			if ( isset( $actual_licences[&#039;wpgeodirectory.com&#039;]-&gt;status ) &amp;&amp; $actual_licences[&#039;wpgeodirectory.com&#039;]-&gt;status == &#039;active&#039; ) {
				$membership_status = &#039;active&#039;;
			}
			if ( defined( &#039;AYECODE_CONNECT_VERSION&#039; ) ) {
				global $ayecode_connect;


				if($ayecode_connect-&gt;is_registered()){
					$connected = true;
				}else{
					?&gt;
					&lt;div class=&quot;text-center pb-5&quot;&gt;
						&lt;button class=&quot;btn btn-primary&quot; data-connecting=&quot;&lt;?php echo esc_attr( $strings[&#039;connecting_button&#039;] ); ?&gt;&quot; onclick=&quot;ayecode_connect_helper(this);&quot;&gt;
							&lt;i class=&quot;fas fa-plug&quot;&gt;&lt;/i&gt; &lt;?php _e( &quot;Connect Site for more free and premium features&quot;, &quot;geodirectory&quot; ); ?&gt;
						&lt;/button&gt;
					&lt;/div&gt;
					&lt;?php
				}
			}
			?&gt;



			&lt;?php
			$blur_class = $connected ? &#039;&#039; : &#039;gd-blur&#039;;
			$disabled = $connected ? &#039;&#039; : &#039;disabled&#039;;
			?&gt;

			&lt;div class=&quot;&quot; style=&quot;&quot;&gt;
				&lt;div class=&quot;list-group pb-4&quot;&gt;

					&lt;?php
					if($membership_status == &#039;active&#039;) {
						echo aui()-&gt;alert(array(
								&#039;type&#039;=&gt; &#039;success&#039;,
								&#039;content&#039;=&gt; __(&quot;You have a valid Membership!&quot;,&quot;geodirectory&quot;)
							)
						);
					}else {
						$info_url = &#039;https://wpgeodirectory.com/checkout/?edd_action=add_to_cart&amp;download_id=66235&amp;edd_options[price_id]=1&#039;;

						//@todo we can&#039;t iframe this until we update our PHP version ont he server so we can allow CORS cookies.
						//$buy_now = &#039;&lt;span class=&quot;badge badge-pill badge-primary&quot; onclick=&quot;aui_modal_iframe(\&#039;&#039;.__(&quot;Buy membership&quot;,&quot;geodirectory&quot;).&#039;\&#039;,\&#039;&#039;.$info_url.&#039;\&#039;,\&#039;\&#039;,true,\&#039;\&#039;,\&#039;modal-lg\&#039;)&quot;&gt;&#039;.__(&quot;Buy now&quot;,&quot;geodirectory&quot;).&#039;&lt;/span&gt;&#039;;
						$buy_now = &#039;&lt;a class=&quot;&quot; href=&quot;&#039;.$info_url.&#039;&quot; target=&quot;_blank&quot;&gt;&lt;span class=&quot;badge badge-pill badge-primary&quot; href=&quot;&#039;.$info_url.&#039;&quot; target=&quot;_blank&quot;&gt;&#039;.__(&quot;Buy now&quot;,&quot;geodirectory&quot;).&#039;&lt;/span&gt;&lt;/a&gt;&#039;;
						?&gt;
						&lt;script&gt;
							function gd_ayecode_connect_licences($input){
								jQuery.ajax({
									url: ajaxurl,
									type: &#039;POST&#039;,
									dataType: &#039;json&#039;,
									data: {
										action: &#039;ayecode_connect_licences&#039;,
										security: &#039;&lt;?php echo wp_create_nonce( &#039;ayecode-connect&#039; );?&gt;&#039;,
										state: 1
									},
									beforeSend: function() {
										jQuery($input).replaceWith(&#039;&lt;div class=&quot;spinner-border spinner-border-sm&quot; role=&quot;status&quot;&gt;&lt;/div&gt;&#039;);

//										jQuery($input).closest(&#039;li&#039;).find(&#039;.spinner-border&#039;).toggleClass(&#039;d-none&#039;);
									},
									success: function(data, textStatus, xhr) {
										location.reload();
									},
									error: function(xhr, textStatus, errorThrown) {
										alert(textStatus);
									}
								}); // end of ajax
							}
						&lt;/script&gt;
						&lt;span  class=&quot;list-group-item list-group-item-action bg-light border-primary &quot;&gt;
							&lt;div class=&quot;d-flex w-100 justify-content-between &lt;?php echo $blur_class; ?&gt;&quot;&gt;
								&lt;div class=&quot;custom-control custom-checkbox c-pointer&quot;&gt;
									&lt;input type=&quot;checkbox&quot; class=&quot;custom-control-input&quot;
									       id=&quot;membership&quot; &lt;?php echo $disabled; ?&gt;&gt;
									&lt;label class=&quot;custom-control-label&quot;
									       for=&quot;membership&quot;&gt;&lt;?php _e( &quot;Membership (includes all extensions on unlimited sites)&quot;, &quot;geodirectory&quot; ); ?&gt;
									&lt;small class=&quot;d-block text-info&quot;&gt;&lt;?php _e( &quot;Recent purchase?&quot;, &quot;geodirectory&quot; ); ?&gt; &lt;span class=&quot;badge badge-pill badge-primary c-pointer&quot; onclick=&quot;gd_ayecode_connect_licences(this);&quot;&gt;&lt;?php _e( &quot;Refresh Licenses&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/span&gt;&lt;/small&gt;
									&lt;/label&gt;
								&lt;/div&gt;
								&lt;small class=&quot;gd-price-year d-none&quot;&gt;&lt;?php echo $buy_now;?&gt; &lt;span class=&quot;badge badge-pill badge-secondary&quot;&gt;$199 / year&lt;/span&gt;
								&lt;/small&gt;
								&lt;small class=&quot;gd-price-month&quot;&gt;&lt;?php echo $buy_now;?&gt; &lt;span
										class=&quot;badge badge-pill badge-secondary&quot;&gt;$16.59 / month&lt;/span&gt;&lt;/small&gt;
							&lt;/div&gt;
						&lt;/span&gt;

						&lt;?php
					}

					if ( ! empty( $paid_types ) ) {
//						print_r( $paid_types );exit;

						$count = 1;

						foreach ( $paid_types as $product ) {

							// skip free
							if ( empty( $product-&gt;pricing-&gt;singlesite ) ) {
								continue;
							}

							$id         = absint( $product-&gt;info-&gt;id );
							$has_license = false;
							if ($id &amp;&amp; !empty($all_licences) &amp;&amp; !empty($all_licences[&#039;wpgeodirectory.com&#039;][$id]-&gt;download_id) ) {
								$has_license = $all_licences[&#039;wpgeodirectory.com&#039;][$id]-&gt;key;
							}
							$title         = esc_attr( $product-&gt;info-&gt;title );
							$slug          = esc_attr( $product-&gt;info-&gt;slug );
							$selected      = false;//!empty($type[&#039;selected&#039;]) ? true : false;
							$price_single  = absint( $product-&gt;pricing-&gt;singlesite );
							$price_monthly = round( $price_single / 12, 2 );

							$hidden_class = $count &gt; 4 ? &#039;collapse gd-paid-product-collapse&#039; : &#039;&#039;;

							$url           = isset( $status[&#039;url&#039;] ) ? $status[&#039;url&#039;] : &#039;&#039;;

							$nonce = wp_create_nonce( &#039;updates&#039; );

							//=geodir_advance_search_filters/geodir_advance_search_filters.php&amp;width=600&amp;height=550&amp;update_url=https://wpgeodirectory.com&amp;item_id=65056&amp;TB_iframe=true
							$info_url = admin_url( &quot;plugin-install.php?gd_wizard_recommend=true&amp;tab=plugin-information&amp;plugin=&quot; . $slug . &quot;&amp;update_url=https://wpgeodirectory.com&amp;item_id=&quot;. $id );

							$status = GeoDir_Admin_Addons::install_plugin_install_status( $product );
							//print_r($status);

							$plugin_status = isset( $status[&#039;status&#039;] ) ? $status[&#039;status&#039;] : &#039;&#039;;
							$url           = isset( $status[&#039;url&#039;] ) ? $status[&#039;url&#039;] : &#039;&#039;;
							$file          = isset( $status[&#039;file&#039;] ) ? $status[&#039;file&#039;] : &#039;&#039;;

							$nonce = wp_create_nonce( &#039;updates&#039; );

							$active = false;
							$active_badge = &#039;&#039;;
							$more_info = &#039; &lt;a href=&quot;#&quot; class=&quot;text-muted&quot; onclick=&quot;aui_modal_iframe(\&#039;&#039;.$title.&#039;\&#039;,\&#039;&#039;.$info_url.&#039;\&#039;,\&#039;\&#039;,true,\&#039;\&#039;,\&#039;modal-lg\&#039;)&quot;&gt;&lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#039;;

							$activate_url = wp_nonce_url(admin_url(&#039;plugins.php?action=activate&amp;plugin=&#039;.$file), &#039;activate-plugin_&#039; . $file);
							if ( $plugin_status == &#039;install&#039; ) {// required installation
								$checked        = &quot;checked&quot;;
								$disabled       = &quot;&quot;;
								$checkbox_class = &quot;gd_install_plugins&quot;;
							} else {
								$active = is_plugin_active( $file );
								$checked        = &quot;checked&quot;;
								$disabled       = $active ? &quot;disabled&quot; : &#039;&#039;;
								$checkbox_class = $active ? &quot;&quot; : &#039;gd_install_plugins&#039;;
								$active_badge = $active ? &#039;&lt;small&gt;&lt;span class=&quot;badge badge-pill badge-success&quot;&gt;&#039;.__(&quot;Active&quot;,&quot;geodirectory&quot;).&#039;&lt;/span&gt;&lt;/small&gt; &#039; : &#039;&#039;;
							}
							?&gt;
							&lt;div
							   class=&quot;list-group-item gd-addon list-group-item-action &lt;?php echo $slug;?&gt; &lt;?php echo $hidden_class; ?&gt; &quot;&gt;
								&lt;div class=&quot;d-flex w-100 justify-content-between &lt;?php echo $blur_class; ?&gt;&quot;&gt;
									&lt;div class=&quot;custom-control custom-checkbox c-pointer&quot;&gt;
										&lt;input type=&quot;checkbox&quot; class=&quot;custom-control-input &lt;?php echo $checkbox_class;?&gt;&quot; id=&quot;&lt;?php echo $slug; ?&gt;&quot;  &lt;?php echo $disabled;?&gt;
										       data-status=&quot;&lt;?php echo esc_attr($plugin_status);?&gt;&quot;
										       data-slug=&quot;&lt;?php echo esc_attr($slug);?&gt;&quot;
										       data-activateurl=&quot;&lt;?php echo esc_attr($activate_url);?&gt;&quot;
										       data-id=&quot;&lt;?php echo absint($id);?&gt;&quot;
										       data-update_url=&quot;https://wpgeodirectory.com/&quot;
										       data-key=&quot;&lt;?php echo esc_attr($has_license);?&gt;&quot;
										&gt;
										&lt;label class=&quot;custom-control-label&quot;
										       for=&quot;&lt;?php echo $slug; ?&gt;&quot;&gt;&lt;?php echo $title.$more_info; ?&gt;&lt;/label&gt;
									&lt;/div&gt;

									&lt;?php
									if($active_badge ){
										echo $active_badge ;
									}elseif( $membership_status == &#039;active&#039; || $has_license) {
										?&gt;
										&lt;small class=&quot;gd-addon-valid&quot;&gt;
											&lt;span class=&quot;badge badge-pill badge-secondary gd-plugin-status d-none&quot;&gt;&lt;?php _e( &quot;Installing&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/span&gt;
											&lt;span class=&quot;badge badge-pill badge-success&quot;&gt;&lt;?php _e( &quot;Valid&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/span&gt;
										&lt;/small&gt;
										&lt;?php
									}else{
									?&gt;
									&lt;small class=&quot;gd-price-year d-none&quot;&gt;&lt;span
											class=&quot;badge badge-pill badge-secondary&quot;&gt;&lt;?php echo sprintf( __( &#039;$%s / year&#039;, &#039;geodirectory&#039; ), $price_single ); ?&gt;&lt;/span&gt;
									&lt;/small&gt;
									&lt;small class=&quot;gd-price-month&quot;&gt;&lt;span
											class=&quot;badge badge-pill badge-secondary&quot;&gt;&lt;?php echo sprintf( __( &#039;$%s / month&#039;, &#039;geodirectory&#039; ), $price_monthly ); ?&gt;&lt;/span&gt;
									&lt;/small&gt;
									&lt;small class=&quot;gd-price-included d-none&quot;&gt;&lt;span
											class=&quot;badge badge-pill badge-secondary&quot;&gt;&lt;?php _e( &quot;Included&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/span&gt;
									&lt;/small&gt;
									&lt;?php
									}
									?&gt;
								&lt;/div&gt;
							&lt;/div&gt;
							&lt;?php
							$count ++;
						}

						?&gt;
						&lt;a href=&quot;#&quot; class=&quot;list-group-item gd-addon list-group-item-action gd-addons-show-more&quot;
						   data-toggle=&quot;collapse&quot; role=&quot;button&quot; aria-expanded=&quot;false&quot;
						   data-target=&quot;.gd-paid-product-collapse&quot;
						   onclick=&quot;jQuery(this).find(&#039;span&#039;).toggleClass(&#039;d-none&#039;);&quot;&gt;
							&lt;div class=&quot; w-100  text-center&quot;&gt;
								&lt;span class=&quot;gd-show-more&quot;&gt;&lt;?php _e( &#039;Show more&#039;, &#039;geodirectory&#039; ); ?&gt; &lt;i
										class=&quot;fas fa-angle-down&quot;&gt;&lt;/i&gt;&lt;/span&gt;
								&lt;span class=&quot;gd-show-less d-none&quot;&gt;&lt;?php _e( &#039;Show less&#039;, &#039;geodirectory&#039; ); ?&gt; &lt;i
										class=&quot;fas fa-angle-up&quot;&gt;&lt;/i&gt;&lt;/span&gt;
							&lt;/div&gt;
						&lt;/a&gt;
						&lt;?php

					}

					?&gt;

				&lt;/div&gt;

				&lt;?php
				if($membership_status != &#039;active&#039;) {
					?&gt;

					&lt;div class=&quot;text-center&quot; onclick=&quot;gd_price_display()&quot;&gt;
						&lt;div class=&quot;custom-control custom-switch custom-switch-md &quot;&gt;
							&lt;input type=&quot;checkbox&quot; class=&quot;custom-control-input&quot; id=&quot;gd-price-show-month&quot; checked&gt;
							&lt;label class=&quot;custom-control-label c-pointer&quot;
							       for=&quot;gd-price-show-month&quot;&gt;&lt;?php _e( &#039;Display monthly prices&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/label&gt;
						&lt;/div&gt;
					&lt;/div&gt;
					&lt;?php
				}
				?&gt;


			&lt;/div&gt;

			&lt;?php
		}
		?&gt;

		&lt;form method=&quot;post&quot; &gt;
			&lt;?php
			//				echo aui()-&gt;alert(array(
			//						&#039;type&#039;=&gt; &#039;info&#039;,
			//						&#039;content&#039;=&gt; __(&quot;Open Street Maps will be used if no Google API key is added.&quot;,&quot;geodirectory&quot;)
			//					)
			//				);
			?&gt;


			&lt;div class=&quot;gd-setup-maps w-100 &lt;?php // if($active_map==&#039;osm&#039;) echo &#039;collapse&#039;;?&gt;&quot;&gt;


			&lt;/div&gt;


			&lt;p class=&quot;gd-setup-actions step text-right mt-4&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
				   class=&quot;btn btn-link text-muted gd-install-skip&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
				&lt;input type=&quot;submit&quot; class=&quot;btn btn-primary gd-install-recommend&quot;
				       value=&quot;&lt;?php esc_attr_e( &#039;Install&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;install_recommend&quot;
				       onclick=&quot;gd_wizard_install_plugins(&#039;&lt;?php echo $nonce; ?&gt;&#039;);return false;&quot;/&gt;
				&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next gd-continue-recommend&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
				        value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;
				&lt;button class=&quot;btn btn-primary d-none gd-installing&quot; type=&quot;button&quot; disabled&gt;
					&lt;span class=&quot;spinner-border spinner-border-sm&quot; role=&quot;status&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;
					&lt;?php esc_attr_e( &#039;Installing...&#039;, &#039;geodirectory&#039; ); ?&gt;
				&lt;/button&gt;
			&lt;/p&gt;
		&lt;/form&gt;

		&lt;script&gt;
			function gd_price_display(){


				if(jQuery(&#039;#membership&#039;).is(&#039;:checked&#039;)){

					if(jQuery(&#039;#gd-price-show-month&#039;).is(&#039;:checked&#039;)) {
						jQuery(&#039;.gd-price-year&#039;).addClass(&#039;d-none&#039;);
						jQuery(&#039;.gd-price-month&#039;).removeClass(&#039;d-none&#039;);
					}else{
						jQuery(&#039;.gd-price-year&#039;).removeClass(&#039;d-none&#039;);
						jQuery(&#039;.gd-price-month&#039;).addClass(&#039;d-none&#039;);
					}

					jQuery(&#039;.gd-addon .gd-price-year,.gd-addon .gd-price-month&#039;).addClass(&#039;d-none&#039;);
					jQuery(&#039;.gd-addon .gd-price-included&#039;).removeClass(&#039;d-none&#039;);


				}else{

					jQuery(&#039;.gd-addon .gd-price-included&#039;).addClass(&#039;d-none&#039;);

					if(jQuery(&#039;#gd-price-show-month&#039;).is(&#039;:checked&#039;)) {
						jQuery(&#039;.gd-price-year&#039;).addClass(&#039;d-none&#039;);
						jQuery(&#039;.gd-price-month&#039;).removeClass(&#039;d-none&#039;);
					}else{
						jQuery(&#039;.gd-price-year&#039;).removeClass(&#039;d-none&#039;);
						jQuery(&#039;.gd-price-month&#039;).addClass(&#039;d-none&#039;);
					}
				}



			}

			jQuery(&quot;input&quot;).change( function() {
				gd_price_display()
			});
		&lt;/script&gt;
		&lt;?php
	}

	public function setup_type() {

		$types = array(
			&#039;standard_places&#039;   =&gt; __(&quot;General Business&quot;,&quot;geodirectory&quot;),
			&#039;events&#039;   =&gt; __(&quot;Events&quot;,&quot;geodirectory&quot;),
			&#039;property_sale&#039;   =&gt; __(&quot;Property for Sale&quot;,&quot;geodirectory&quot;),
			&#039;property_rent&#039;   =&gt; __(&quot;Property for Rent&quot;,&quot;geodirectory&quot;),
			&#039;classifieds&#039;   =&gt; __(&quot;Classifieds&quot;,&quot;geodirectory&quot;),
			&#039;car_sales&#039;   =&gt; __(&quot;Car Sales&quot;,&quot;geodirectory&quot;),
			&#039;jobs&#039;   =&gt; __(&quot;Job Board&quot;,&quot;geodirectory&quot;),
			&#039;yoga_studios&#039;   =&gt; __(&quot;Yoga Studios&quot;,&quot;geodirectory&quot;),
			&#039;restaurants&#039;   =&gt; __(&quot;Restaurant Guide&quot;,&quot;geodirectory&quot;),
			&#039;doctors&#039;   =&gt; __(&quot;Doctors Directory&quot;,&quot;geodirectory&quot;),
			&#039;accommodation&#039;   =&gt; __(&quot;Accommodation&quot;,&quot;geodirectory&quot;),
			&#039;staff&#039;   =&gt; __(&quot;Staff Directory&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
//			&#039;&#039;   =&gt; __(&quot;&quot;,&quot;geodirectory&quot;),
		);

		?&gt;

		&lt;script&gt;
			function gd_setup_set_types($type){
				//jQuery($type).toggleClass(&#039;border-primary&#039;);//.find(&#039;input&#039;).click();
			}
		&lt;/script&gt;

		&lt;div class=&quot;text-center mb-4&quot;&gt;
			&lt;h1 class=&quot;h3&quot;&gt;&lt;?php _e(&quot;What Directory types are you setting up?&quot;,&quot;geodirectory&quot;);?&gt;&lt;/h1&gt;
			&lt;small class=&quot;text-muted&quot;&gt;&lt;?php _e(&quot;Select any that apply&quot;,&quot;geodirectory&quot;);?&gt;&lt;/small&gt;
		&lt;/div&gt;

		&lt;div class=&quot;row row-cols-2 justify-content-end pb-4&quot;&gt;
			&lt;?php
			foreach ( $types as $key =&gt; $type ) {
				$selected = $key==&#039;standard_places&#039; ? true : false;

				$disabled = $key==&#039;events&#039; &amp;&amp; !defined(&#039;GEODIR_EVENT_VERSION&#039;) ? &#039;disabled&#039; : &#039;&#039;;
				?&gt;
				&lt;div class=&quot;col&quot;&gt;
					&lt;div class=&quot;custom-control custom-radio border &lt;?php if($selected)echo &#039;border-primary&#039;; ?&gt; rounded-sm px-3 pl-5 py-2  mb-3 &lt;?php if($disabled)echo &#039;bg-light&#039;; ?&gt;&quot;
						&lt;?php if(!$disabled){ echo &#039;onclick=&quot;gd_setup_set_types(this);&quot;&#039;;}?&gt;
						&lt;?php if($disabled){ echo &#039;data-toggle=&quot;tooltip&quot; data-placement=&quot;top&quot; title=&quot;&#039;. __(&quot;Enable our Events addon to be able to use events&quot;,&quot;geodirectory&quot;).&#039;&quot;&#039;; ?&gt;&gt;
						&lt;input &lt;?php if($selected)echo &#039;checked&#039; ?&gt; type=&quot;radio&quot; class=&quot;custom-control-input&quot; name=&quot;&lt;?php echo esc_attr($key);?&gt;&quot; id=&quot;&lt;?php echo esc_attr($key);}?&gt;&quot;
							&lt;?php echo $disabled;?&gt; &gt;
						&lt;label class=&quot;custom-control-label c-pointer w-100&quot; for=&quot;&lt;?php echo esc_attr($key);?&gt;&quot; &lt;?php if(!$disabled){ echo &#039;onclick=&quot;jQuery(this).parent().toggleClass(\&#039;border-primary\&#039;);&quot;&#039;;}?&gt;&gt;&lt;?php echo esc_attr($type);?&gt;&lt;/label&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;?php
			}
			?&gt;

		&lt;/div&gt;


		&lt;form method=&quot;post&quot; &gt;
			&lt;?php
			//				echo aui()-&gt;alert(array(
			//						&#039;type&#039;=&gt; &#039;info&#039;,
			//						&#039;content&#039;=&gt; __(&quot;Open Street Maps will be used if no Google API key is added.&quot;,&quot;geodirectory&quot;)
			//					)
			//				);
			?&gt;


			&lt;div class=&quot;gd-setup-maps w-100 &lt;?php // if($active_map==&#039;osm&#039;) echo &#039;collapse&#039;;?&gt;&quot;&gt;


			&lt;/div&gt;


			&lt;p class=&quot;gd-setup-actions step text-right mt-4&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
				   class=&quot;btn btn-link text-muted&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
				&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
				        value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;
			&lt;/p&gt;
		&lt;/form&gt;
		&lt;?php
	}

	/**
	 * Setup maps api.
	 *
	 * @since 2.0.0
	 */
	public function setup_maps() {
		$active_class = &quot;border border-primary border-width-4 shadow pointer&quot;;
		$active_map = &#039;osm&#039;;
		$maps_api = geodir_get_option( &#039;maps_api&#039; );
		$maps_api_key = geodir_get_option( &#039;google_maps_api_key&#039; );
		if ( ( $maps_api == &#039;auto&#039; || $maps_api == &#039;google&#039;)  &amp;&amp; $maps_api_key ) {
			$active_map = &#039;google&#039;;
		}
//		$active_map = &#039;osm&#039;;

//echo &#039;###&#039;.$maps_api;

		?&gt;



		&lt;script&gt;
			$temp_map_key = jQuery(&#039;#google_maps_api_key&#039;).val();
			function gd_setup_wiz_map_select($type) {
				if ($type == &#039;google&#039;) {
					jQuery(&#039;.gd-wiz-map-osm&#039;).removeClass(&#039;&lt;?php echo $active_class;?&gt;&#039;);
					jQuery(&#039;.gd-wiz-map-google&#039;).addClass(&#039;&lt;?php echo $active_class;?&gt;&#039;);
					jQuery(&#039;.gd-setup-maps&#039;).collapse(&#039;show&#039;);
					jQuery(&#039;#google_maps_api_key&#039;).val($temp_map_key);
				} else if ($type == &#039;osm&#039;) {
					jQuery(&#039;.gd-wiz-map-osm&#039;).addClass(&#039;&lt;?php echo $active_class;?&gt;&#039;);
					jQuery(&#039;.gd-wiz-map-google&#039;).removeClass(&#039;&lt;?php echo $active_class;?&gt;&#039;);
					jQuery(&#039;.gd-setup-maps&#039;).collapse(&#039;hide&#039;);
					$temp_map_key = jQuery(&#039;#google_maps_api_key&#039;).val();
					jQuery(&#039;#google_maps_api_key&#039;).val(&#039;&#039;);
				}
			}
		&lt;/script&gt;

		&lt;div class=&quot;row row-cols-2 justify-content-end pb-4&quot;&gt;
			&lt;div class=&quot;col&quot;&gt;
				&lt;div class=&quot;gd-wiz-map-google rounded overflow-hidden position-relative  hover-shadow &lt;?php if($active_map==&#039;google&#039;) echo $active_class;?&gt;&quot; onclick=&quot;gd_setup_wiz_map_select(&#039;google&#039;);&quot;&gt;
					&lt;img class=&quot;img-fluid hover-zoom c-pointer&quot; src=&quot;&lt;?php echo geodir_plugin_url() . &#039;/assets/images/google-maps.jpg&#039;; ?&gt;&quot; &gt;
					&lt;h5 class=&quot;ab-top-right&quot;&gt;&lt;span class=&quot;badge badge-warning text-whitex shadow&quot;&gt;&lt;?php _e(&quot;Requires API key&quot;,&quot;geodirectory&quot;);?&gt;&lt;/span&gt; &lt;span class=&quot;badge badge-success shadow&quot;&gt;Free Quota&lt;/span&gt;&lt;/h5&gt;

				&lt;/div&gt;
				&lt;h5 class=&quot;text-center pt-3&quot;&gt;&lt;?php _e(&quot;Google Maps&quot;,&quot;geodirectory&quot;);?&gt;&lt;/h5&gt;
			&lt;/div&gt;
			&lt;div class=&quot;col&quot;&gt;
				&lt;div class=&quot;gd-wiz-map-osm rounded overflow-hidden position-relative  hover-shadow &lt;?php if($active_map==&#039;osm&#039;) echo $active_class;?&gt;&quot; onclick=&quot;gd_setup_wiz_map_select(&#039;osm&#039;);&quot;&gt;
					&lt;img class=&quot;img-fluid hover-zoom c-pointer&quot; src=&quot;&lt;?php echo geodir_plugin_url() . &#039;/assets/images/osm.jpg&#039;; ?&gt;&quot; &gt;
					&lt;h5 class=&quot;ab-top-right&quot;&gt;&lt;span class=&quot;badge badge-success shadow&quot;&gt;Free&lt;/span&gt;&lt;/h5&gt;
				&lt;/div&gt;
				&lt;h5 class=&quot;text-center pt-3&quot;&gt;&lt;?php _e(&quot;Open Street Maps&quot;,&quot;geodirectory&quot;);?&gt;&lt;/h5&gt;
			&lt;/div&gt;
		&lt;/div&gt;

&lt;!--		&lt;small class=&quot;text-center&quot;&gt;--&gt;&lt;?php //_e(&quot;* You can change maps later in settings.&quot;,&quot;geodirectory&quot;);?&gt;&lt;!--&lt;/small&gt;--&gt;

		&lt;form method=&quot;post&quot; id=&quot;gd-wizard-save-map-key&quot; &gt;
			&lt;?php
//				echo aui()-&gt;alert(array(
//						&#039;type&#039;=&gt; &#039;info&#039;,
//						&#039;content&#039;=&gt; __(&quot;Open Street Maps will be used if no Google API key is added.&quot;,&quot;geodirectory&quot;)
//					)
//				);
				?&gt;


			&lt;div class=&quot;gd-setup-maps w-100 collapse &lt;?php if($active_map==&#039;google&#039;) echo &#039;show&#039;;?&gt;&quot;&gt;

				&lt;?php
				$settings   = array();
				$settings[] = GeoDir_Settings_General::get_maps_api_setting();
				$settings[] = GeoDir_Settings_General::get_map_language_setting();
				$api_arr    = GeoDir_Settings_General::get_google_maps_api_key_setting();

				$api_arr[&#039;name&#039;] = &#039;&#039;;
				$api_arr[&#039;desc&#039;] = &#039;&#039;;
				$api_arr[&#039;desc_tip&#039;] = 0;
				$api_arr[&#039;placeholder&#039;] = __(&quot;Enter your Google Maps API key&quot;,&quot;geodirectory&quot;);
//				print_r($api_arr);exit;
				// change the tooltip description/
//				$api_arr[&#039;desc&#039;] = __( &#039;This is a requirement to use Google Maps. If you would prefer to use the Open Street Maps API then leave this blank.&#039;, &#039;geodirectory&#039; );

				$settings[] = $api_arr;

				ob_start();
				GeoDir_Admin_Settings::output_fields( $settings );
				$settings_output = ob_get_clean();

				$settings_output = str_replace(array(&#039;regular-text geodir-select&#039;),array(&#039;form-control w-100 mw-100&#039;),$settings_output );
				echo $settings_output;
				?&gt;

			&lt;/div&gt;


			&lt;p class=&quot;gd-setup-actions step text-right mt-4&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
				   class=&quot;btn btn-link text-muted&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
				&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next submit-btn&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
				   data-continue-text=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot;     value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;
			&lt;/p&gt;
		&lt;/form&gt;
		&lt;?php
	}

	/**
	 * Save Maps Settings.
	 *
	 * @since 2.0.0
	 */
	public function setup_maps_save() {
		check_admin_referer( &#039;gd-setup&#039; );

		$settings   = array();
		$settings[] = GeoDir_Settings_General::get_maps_api_setting();
		$settings[] = GeoDir_Settings_General::get_map_language_setting();
		$settings[] = GeoDir_Settings_General::get_google_maps_api_key_setting();

		GeoDir_Admin_Settings::save_fields( $settings );
		wp_redirect( esc_url_raw( $this-&gt;get_next_step_link() ) );
		exit;
	}

	/**
	 * Default Location settings.
	 *
	 * @since 2.0.0
	 */
	public function setup_default_location() {

		$this-&gt;google_maps_api_check();


		echo aui()-&gt;alert(array(
				&#039;type&#039;=&gt; &#039;info&#039;,
				&#039;content&#039;=&gt; __(&quot;Drag the map or marker to the center of your default town/city.&quot;,&quot;geodirectory&quot;)
			)
		);
		?&gt;

&lt;!--		&lt;h4 class=&quot;text-center&quot;&gt;--&gt;&lt;?php //_e( &quot;Drag the map or marker to your default location&quot;, &quot;geodirectory&quot; );?&gt;&lt;!--&lt;/h4&gt;--&gt;

		&lt;form id=&#039;geodir-set-default-location&#039; method=&quot;post&quot;&gt;
			&lt;?php
			$generalSettings = new GeoDir_Settings_General();
			$settings        = $generalSettings-&gt;get_settings( &#039;location&#039; );

			// Change the description
			foreach ( $settings as $key =&gt; $setting ) {
				if ( $setting[&#039;type&#039;] == &#039;title&#039; || $setting[&#039;type&#039;] == &#039;sectionend&#039; ) {
					unset( $settings[ $key ] );
				}elseif($setting[&#039;id&#039;]==&#039;multi_city&#039;){
					$settings[ $key ][&#039;desc&#039;] = __( &quot;Allow listings to be placed outside the default city?&quot;, &quot;geodirectory&quot; );
				}
			}
//			unset( $settings[0] );
//			unset( $settings[9] );
//			$settings[0][&#039;title&#039;] = &#039;&#039;;
//			$settings[0][&#039;desc&#039;]  = &#039;&#039;;//__( &#039;Drag the map or the marker to set the city/town you wish to use as the default location.&#039;, &#039;geodirectory&#039; );

//			print_r($settings);

			ob_start();
			GeoDir_Admin_Settings::output_fields( $settings );
			$settings_output = ob_get_clean();
//			echo $settings_output;
			$settings_output = str_replace(array(&#039;btn btn-primary&#039;),array(&#039;btn btn-primary mb-4&#039;),$settings_output );
			echo str_replace(array(&#039;regular-text&#039;,&#039;geodir-select&#039;,&#039;button-primary&#039;),array(&#039;form-control w-100 mw-100&#039;,&#039;form-control w-100 mw-100&#039;,&#039;btn btn-primary btn-sm mb-4&#039;),$settings_output );

			// check if there are already listing before saving new location
			global $wpdb;
			$post_types  = geodir_get_posttypes();
			$cpt_count   = count( $post_types );
			$cptp        = array_fill( 0, $cpt_count, &quot;%s&quot; );
			$cptp_string = implode( &quot;,&quot;, $cptp );
			$has_posts   = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT ID FROM $wpdb-&gt;posts WHERE post_type IN ($cptp_string) LIMIT 1&quot;, $post_types ) );
			if ( $has_posts ) {
				?&gt;
				&lt;script&gt;
					jQuery(function () {
						var default_location_city = jQuery(&quot;#default_location_city&quot;).val();
						jQuery(&quot;.button-next&quot;).on(&quot;click&quot;,function () {
							if (default_location_city &amp;&amp; default_location_city != jQuery(&quot;#default_location_city&quot;).val()) {
								return confirm(&quot;&lt;?php _e( &quot;Are you sure? This can break current listings.&quot;, &quot;geodirectory&quot; );?&gt;&quot;);
							}
						});
					});
				&lt;/script&gt;
				&lt;?php
			}


			?&gt;
			&lt;div class=&quot;gd-setup-actions step text-right d-flex justify-content-between mt-4&quot;&gt;
				&lt;div&gt;
					&lt;?php $generalSettings-&gt;output_toggle_advanced(); ?&gt;
				&lt;/div&gt;
				&lt;div&gt;
					&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
					   class=&quot;btn btn-link text-muted&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
					&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
					        value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;

				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/form&gt;

		&lt;?php
	}

	/**
	 * Shows an error message if there is a problem with the google maps api key settings.
	 *
	 * @since 2.0.0
	 */
	public function google_maps_api_check() {
		//maps_api

		$display  = &quot;display: none;&quot;;
		$maps_api = geodir_get_option( &#039;maps_api&#039; );
		if ( $maps_api == &#039;auto&#039; || $maps_api == &#039;google&#039; ) {
			$maps_api_key = geodir_get_option( &#039;google_maps_api_key&#039; );
			if ( $maps_api == &#039;google&#039; &amp;&amp; empty( $maps_api_key ) ) {
				$message = esc_html__( &#039;You have not set a Google Maps API key, please press the back button in your browser and add a key otherwise Open Street Maps (OSM) will be used instead.&#039;, &#039;geodirectory&#039; );
				$display = &#039;&#039;;
			} elseif ( empty( $maps_api_key ) ) {
				$message = esc_html__( &#039;You have not set a Google Maps API key, please press the back button in your browser and add a key.&#039;, &#039;geodirectory&#039; );
			} else {
				$message = esc_html__( &#039;There is a problem with the Google Maps API key you have set, please press the back button in your browser and add a valid key.&#039;, &#039;geodirectory&#039; );
			}

			?&gt;
			&lt;p class=&quot;gd-google-api-error&quot; style=&quot;&lt;?php echo $display; ?&gt;&quot;&gt;
				&lt;?php echo &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; &#039; . $message; ?&gt;
			&lt;/p&gt;
			&lt;script&gt;
				function gm_authFailure() {
					jQuery(&#039;.gd-google-api-error&#039;).show();
				}
			&lt;/script&gt;
			&lt;?php
		}
	}

	/**
	 * Save Default Location Settings.
	 *
	 * @since 2.0.0
	 */
	public function setup_default_location_save() {
		check_admin_referer( &#039;gd-setup&#039; );

		$generalSettings = new GeoDir_Settings_General();
		$settings        = $generalSettings-&gt;get_settings( &#039;location&#039; );
		GeoDir_Admin_Settings::save_fields( $settings );

		do_action( &#039;geodir_setup_wizard_default_location_saved&#039;, $settings );

		wp_redirect( esc_url_raw( $this-&gt;get_next_step_link() ) );
		exit;
	}

	public function setup_features_save() {
		check_admin_referer( &#039;gd-setup&#039; );

		do_action( &#039;geodir_setup_wizard_features_saved&#039; );

		wp_redirect( esc_url_raw( $this-&gt;get_next_step_link() ) );
		exit;
	}

	/**
	 * Dummy Data setup.
	 *
	 * @since 2.0.0
	 */
	public function setup_content() {

		$wizard_content = array(
			&#039;dummy_data&#039; =&gt; __( &quot;Dummy Data&quot;, &quot;geodirectory&quot; ),
			&#039;sidebars&#039;   =&gt; __( &quot;Sidebars&quot;, &quot;geodirectory&quot; ),
			&#039;menus&#039;   =&gt; __( &quot;Menus&quot;, &quot;geodirectory&quot; ),
		);

		$wizard_content = apply_filters( &#039;geodir_wizard_content&#039;, $wizard_content );

		$page_counts = wp_count_posts( &#039;page&#039; );
		$active_tab = !empty($page_counts-&gt;publish) &amp;&amp; $page_counts-&gt;publish &lt; 10 ? &#039;full&#039; : &#039;add&#039;;
		?&gt;

		&lt;div class=&quot;list-group list-group-horizontal-sm mb-4 text-center&quot; id=&quot;gd-import-tabs&quot; role=&quot;tablist&quot;&gt;
			&lt;a class=&quot;list-group-item w-50 &lt;?php if($active_tab==&#039;full&#039;){echo &#039;active&#039;;} ?&gt;&quot; data-toggle=&quot;tab&quot; href=&quot;#gd-import-site&quot; role=&quot;tab&quot; aria-controls=&quot;gd-import-site&quot;&gt;&lt;i class=&quot;fas fa-cloud-download-alt&quot;&gt;&lt;/i&gt; &lt;?php _e( &quot;Import full demo site&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/a&gt;
			&lt;a class=&quot;list-group-item w-50 &lt;?php if($active_tab==&#039;add&#039;){echo &#039;active&#039;;} ?&gt;&quot; data-toggle=&quot;tab&quot; href=&quot;#gd-import-bits&quot; role=&quot;tab&quot; aria-controls=&quot;gd-import-bits&quot;&gt;&lt;i class=&quot;fas fa-plus&quot;&gt;&lt;/i&gt; &lt;?php _e( &quot;Add to existing site&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/a&gt;
		&lt;/div&gt;

		&lt;div class=&quot;tab-content&quot; id=&quot;myTabContent&quot;&gt;
			&lt;div class=&quot;tab-pane fade &lt;?php if($active_tab==&#039;add&#039;){echo &#039;show active&#039;;} ?&gt;&quot; id=&quot;gd-import-bits&quot; role=&quot;tabpanel&quot; aria-labelledby=&quot;home-tab&quot;&gt;


				&lt;form method=&quot;post&quot;&gt;
					&lt;?php
					foreach ( $wizard_content as $slug =&gt; $title ) {
						echo &#039;&lt;h2 class=&quot;gd-settings-title h3 mt-4&quot;&gt;&lt;a id=&quot;&#039; . esc_attr( $slug ) . &#039;&quot;&gt;&lt;/a&gt;&#039; . esc_attr( $title ) . &#039;&lt;/h2&gt;&#039; . &quot; \n&quot;; // line break adds a nice spacing
						echo do_action( &quot;geodir_wizard_content_{$slug}&quot; );
					}
					?&gt;
				&lt;/form&gt;


			&lt;/div&gt;
			&lt;div class=&quot;tab-pane fade &lt;?php if($active_tab==&#039;full&#039;){echo &#039;show active&#039;;} ?&gt;&quot; id=&quot;gd-import-site&quot; role=&quot;tabpanel&quot; aria-labelledby=&quot;profile-tab&quot;&gt;

				&lt;?php
				$ach = self::get_ach();

				// scripts
				$ach-&gt;script();

				$is_local = $ach-&gt;is_localhost();

				if ( $is_local ) {
					echo aui()-&gt;alert(array(
							&#039;type&#039;=&gt; &#039;danger&#039;,
							&#039;content&#039;=&gt; __(&quot;This importer will not work on localhost&quot;,&quot;geodirectory&quot;)
						)
					);
				}else{
					if ( defined( &#039;AYECODE_CONNECT_VERSION&#039; ) ) {
						global $ayecode_connect;


						if($ayecode_connect-&gt;is_registered()){
							$connected = true;

							if ( defined( &#039;AYECODE_CONNECT_PLUGIN_DIR&#039; ) ) {
								require_once AYECODE_CONNECT_PLUGIN_DIR . &#039;/includes/class-ayecode-demo-content.php&#039;;
								
								$demo_content = AyeCode_Demo_Content::instance();
								$demo_content-&gt;scripts();
								ob_start();
								$demo_content-&gt;settings_page(true);
								$content = ob_get_clean();

								echo str_replace(
									array(
										&quot;card-title &quot;,
										&quot;card-footer &quot;,
										&quot;card &quot;,
										),
									array(
										&quot;card-title small &quot;,
										&quot;card-footer px-2 &quot;,
										&quot;card hover-shadow &quot;,
										),
									$content
								);
							}else{
								echo aui()-&gt;alert(array(
										&#039;type&#039;=&gt; &#039;danger&#039;,
										&#039;content&#039;=&gt; __(&quot;Please Update AyeCode Connect Plugin to Continue.&quot;,&quot;geodirectory&quot;)
									)
								);
							}


							
						}else{
							?&gt;
							&lt;div class=&quot;text-center pb-5&quot;&gt;
								&lt;button class=&quot;btn btn-primary&quot; data-connecting=&quot;&lt;?php echo esc_attr( $strings[&#039;connecting_button&#039;] ); ?&gt;&quot; onclick=&quot;ayecode_connect_helper(this);&quot;&gt;
									&lt;i class=&quot;fas fa-plug&quot;&gt;&lt;/i&gt; &lt;?php _e( &quot;Connect Site for more free and premium features&quot;, &quot;geodirectory&quot; ); ?&gt;
								&lt;/button&gt;
							&lt;/div&gt;
							&lt;?php
						}
					}
				}
				?&gt;

			&lt;/div&gt;
		&lt;/div&gt;


		&lt;form method=&quot;post&quot;&gt;
		&lt;p class=&quot;gd-setup-actions step text-right mt-4&quot;&gt;
			&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
			   class=&quot;btn btn-link text-muted&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
			&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
			&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
			        value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;
		&lt;/p&gt;
		&lt;/form&gt;



		&lt;?php
	}

	/**
	 * Dummy data save.
	 *
	 * This is done via ajax so we just pass onto the next step.
	 *
	 * @since 2.0.0
	 */
	public function setup_content_save() {
		check_admin_referer( &#039;gd-setup&#039; );
		wp_redirect( esc_url_raw( $this-&gt;get_next_step_link() ) );
		exit;
	}

	/**
	 * Dummy Data setup.
	 *
	 * @since 2.0.0
	 */
	public function setup_recommend() {
		?&gt;
		&lt;form method=&quot;post&quot;&gt;
			&lt;div class=&quot;gd-wizard-recommend&quot;&gt;

				&lt;h2 class=&quot;gd-settings-title h3 &quot;&gt;&lt;?php _e( &quot;Recommend Plugins&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/h2&gt;

				&lt;p&gt;&lt;?php _e( &quot;Below are a few recommend plugins that will help you with your directory.&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/p&gt;

				&lt;?php

				include_once( ABSPATH . &#039;wp-admin/includes/plugin-install.php&#039; ); //for plugins_api..

				$recommend_wp_plugins = GeoDir_Admin_Addons::get_recommend_wp_plugins();

				//			$status = install_plugin_install_status( array(&quot;slug&quot;=&gt;&quot;two-factor&quot;,&quot;version&quot;=&gt;&quot;&quot;));
				//			print_r($status);

				if ( ! empty( $recommend_wp_plugins ) ) {
					echo &quot;&lt;ul&gt;&quot;;
					$installed_text = &quot;&lt;i class=\&quot;fas fa-check-circle\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot; . __( &#039;Installed&#039;, &#039;geodirectory&#039; );
					echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installing-text&#039; value=&#039;&lt;i class=\&quot;fas fa-sync fa-spin\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot; . __( &#039;Installing&#039;, &#039;geodirectory&#039; ) . &quot;&#039; &gt;&quot;;
					echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installed-text&#039; value=&#039;$installed_text&#039; &gt;&quot;;
					foreach ( $recommend_wp_plugins as $plugin ) {
//					print_r($plugin);
						$status = install_plugin_install_status( array( &quot;slug&quot; =&gt; $plugin[&#039;slug&#039;], &quot;version&quot; =&gt; &quot;&quot; ) );
						//print_r($status);

						$plugin_status = isset( $status[&#039;status&#039;] ) ? $status[&#039;status&#039;] : &#039;&#039;;
						$url           = isset( $status[&#039;url&#039;] ) ? $status[&#039;url&#039;] : &#039;&#039;;

						$nonce = wp_create_nonce( &#039;updates&#039; );

						if ( $plugin_status == &#039;install&#039; ) {// required installation
							$checked        = &quot;checked&quot;;
							$disabled       = &quot;&quot;;
							$checkbox_class = &quot;class=&#039;gd_install_plugins&#039;&quot;;
						} else {
							$checked        = &quot;checked&quot;;
							$disabled       = &quot;disabled&quot;;
							$checkbox_class = &quot;&quot;;
						}


						echo &quot;&lt;li class=&#039;&quot; . $plugin[&#039;slug&#039;] . &quot;&#039;&gt;&quot;;
						echo &quot;&lt;input type=&#039;checkbox&#039; id=&#039;&quot; . $plugin[&#039;slug&#039;] . &quot;&#039; $checked $disabled $checkbox_class /&gt;&quot;;
						echo $plugin[&#039;name&#039;] . &quot; &quot; . geodir_help_tip( $plugin[&#039;desc&#039;] );
						echo &quot; | &lt;a href=&#039;&quot; . admin_url( &quot;plugin-install.php?gd_wizard_recommend=true&amp;tab=plugin-information&amp;plugin=&quot; . $plugin[&#039;slug&#039;] ) . &quot;&#039; data-lity&gt;more info&lt;/a&gt;&quot;;
						if ( $plugin_status == &#039;install&#039; &amp;&amp; $url ) {
							//echo &quot; | &lt;a href=&#039;#&#039; onclick=&#039;gd_wizard_install_plugin(\&quot;&quot;.$plugin[&#039;slug&#039;].&quot;\&quot;,\&quot;$nonce\&quot;);return false;&#039;&gt;install&lt;/a&gt;&quot;;
							echo &quot; | &lt;span class=&#039;gd-plugin-status&#039; &gt;( &quot; . __( &#039;Tick to install&#039;, &#039;geodirectory&#039; ) . &quot; )&lt;/span&gt;&quot;;
						} else {
							if ( ! empty( $plugin_status ) ) {
								$plugin_status = $installed_text;
							}
							echo &quot; | &lt;span class=&#039;gd-plugin-status&#039;&gt;$plugin_status&lt;/span&gt;&quot;;
						}
						echo &quot;&lt;/li&gt;&quot;;

					}
					echo &quot;&lt;/ul&gt;&quot;;
				}


				// GD addons
				/*
				?&gt;

					&lt;h2 class=&quot;gd-settings-title &quot;&gt;&lt;?php _e(&quot;GeoDirectory Addons&quot;,&quot;geodirectory&quot;);?&gt;&lt;/h2&gt;

					&lt;p&gt;&lt;?php _e(&quot;Below are the GeoDirectory addons that you may with to install at this point.&quot;,&quot;geodirectory&quot;);?&gt;&lt;/p&gt;

					&lt;?php

					$gd_plugins = GeoDir_Admin_Addons::get_section_data( &#039;addons&#039; );

					//print_r($addons);

					//			$status = install_plugin_install_status( array(&quot;slug&quot;=&gt;&quot;two-factor&quot;,&quot;version&quot;=&gt;&quot;&quot;));
					//			print_r($status);

					if(!empty($gd_plugins)){
						echo &quot;&lt;ul&gt;&quot;;
						$installed_text = &quot;&lt;i class=\&quot;fas fa-check-circle\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot;.__(&#039;Installed&#039;,&#039;geodirectory&#039;);
						echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installing-text&#039; value=&#039;&lt;i class=\&quot;fas fa-sync fa-spin\&quot; aria-hidden=\&quot;true\&quot;&gt;&lt;/i&gt; &quot;.__(&#039;Installing&#039;,&#039;geodirectory&#039;).&quot;&#039; &gt;&quot;;
						echo &quot;&lt;input type=&#039;hidden&#039; id=&#039;gd-installed-text&#039; value=&#039;$installed_text&#039; &gt;&quot;;
						foreach ($gd_plugins  as $plugin){

							// convert to array
							$plugin = (array)$plugin-&gt;info;
							$plugin[&#039;name&#039;] = $plugin[&#039;title&#039;];

	//						print_r($plugin);exit;

							$status = install_plugin_install_status( array(&quot;slug&quot;=&gt;$plugin[&#039;slug&#039;],&quot;version&quot;=&gt;&quot;&quot;));
							//print_r($status);


							$all_plugins = get_plugins();
							//print_r($gd_plugins);
	//						echo &#039;###&#039;;
	//						print_r($all_plugins);exit;


							$plugin_status = isset($status[&#039;status&#039;]) ? $status[&#039;status&#039;] : &#039;&#039;;
							$url = isset($status[&#039;url&#039;]) ? $status[&#039;url&#039;] : &#039;&#039;;

							$nonce = wp_create_nonce( &#039;updates&#039; );

							if($plugin_status==&#039;install&#039;){// required installation
								$checked = &quot;checked&quot;;
								$disabled = &quot;&quot;;
								$checkbox_class = &quot;class=&#039;gd_install_plugins&#039;&quot;;
							}else{
								$checked = &quot;checked&quot;;
								$disabled = &quot;disabled&quot;;
								$checkbox_class = &quot;&quot;;
							}

	//http://localhost/wp-admin/plugin-install.php?gd_wizard_recommend=true&amp;tab=plugin-information&amp;plugin=list-manager&amp;item_id=69994&amp;update_url=https://wpgeodirectory.com
							echo &quot;&lt;li class=&#039;&quot;.$plugin[&#039;slug&#039;].&quot;&#039;&gt;&quot;;
							echo &quot;&lt;input type=&#039;checkbox&#039; id=&#039;&quot;.$plugin[&#039;slug&#039;].&quot;&#039; $checked $disabled $checkbox_class /&gt;&quot;;
							echo $plugin[&#039;name&#039;].&quot; &quot;; echo !empty($plugin[&#039;desc&#039;]) ? geodir_help_tip($plugin[&#039;desc&#039;]) : &#039;&#039;;
							echo &quot; | &lt;a href=&#039;&quot;.admin_url( &quot;plugin-install.php?gd_wizard_recommend=true&amp;tab=plugin-information&amp;plugin=&quot;.$plugin[&#039;slug&#039;]).&quot;&amp;item_id=&quot;.$plugin[&#039;id&#039;].&quot;&amp;update_url=https://wpgeodirectory.com&#039; data-lity&gt;more info&lt;/a&gt;&quot;;
							if($plugin_status==&#039;install&#039; &amp;&amp; $url){
								//echo &quot; | &lt;a href=&#039;#&#039; onclick=&#039;gd_wizard_install_plugin(\&quot;&quot;.$plugin[&#039;slug&#039;].&quot;\&quot;,\&quot;$nonce\&quot;);return false;&#039;&gt;install&lt;/a&gt;&quot;;
								echo &quot; | &lt;span class=&#039;gd-plugin-status&#039; &gt;( &quot;.__(&#039;Tick to install&#039;,&#039;geodirectory&#039;).&quot; )&lt;/span&gt;&quot;;
							}else{
								if(!empty($plugin_status)){
									$plugin_status = $installed_text;
								}
								echo &quot; | &lt;span class=&#039;gd-plugin-status&#039;&gt;$plugin_status&lt;/span&gt;&quot;;
							}
							echo &quot;&lt;/li&gt;&quot;;

						}
						echo &quot;&lt;/ul&gt;&quot;;
					}

				*/
				?&gt;


			&lt;/div&gt;

			&lt;p class=&quot;gd-setup-actions step text-right mt-4&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( $this-&gt;get_next_step_link() ); ?&gt;&quot;
				   class=&quot;btn btn-link text-muted&quot;&gt;&lt;?php esc_html_e( &#039;Skip this step&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;?php wp_nonce_field( &#039;gd-setup&#039; ); ?&gt;
				&lt;input type=&quot;submit&quot; class=&quot;btn btn-primary gd-install-recommend&quot;
				       value=&quot;&lt;?php esc_attr_e( &#039;Install&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;install_recommend&quot;
				       onclick=&quot;gd_wizard_install_plugins(&#039;&lt;?php echo $nonce; ?&gt;&#039;);return false;&quot;/&gt;
				&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary button-next gd-continue-recommend&quot; onclick=&quot;jQuery(this).html(&#039;&lt;span class=\&#039;spinner-border spinner-border-sm\&#039; role=\&#039;status\&#039;&gt;&lt;/span&gt; &lt;?php esc_attr_e( &#039;Saving&#039;, &#039;geodirectory&#039; ); ?&gt;&#039;).addClass(&#039;disabled&#039;);&quot;
				        value=&quot;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&quot; name=&quot;save_step&quot; &gt;&lt;?php esc_attr_e( &#039;Continue&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/button&gt;

			&lt;/p&gt;
		&lt;/form&gt;
		&lt;?php
	}

	/**
	 * Dummy data save.
	 *
	 * This is done via ajax so we just pass onto the next step.
	 *
	 * @since 2.0.0
	 */
	public function setup_recommend_save() {
		check_admin_referer( &#039;gd-setup&#039; );
		wp_redirect( esc_url_raw( $this-&gt;get_next_step_link() ) );
		exit;
	}

	/**
	 * Final step.
	 *
	 * @since 2.0.0
	 */
	public function setup_ready() {
		$this-&gt;setup_ready_actions();
		?&gt;

		&lt;div class=&quot;text-center mb-3&quot;&gt;
			&lt;h1 class=&quot;h2&quot;&gt;&lt;?php esc_html_e( &#039;Awesome, your directory is ready!&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h1&gt;
			&lt;div class=&quot;geodirectory-message geodirectory-tracker&quot;&gt;
				&lt;p&gt;&lt;?php _e( &#039;Thank you for using GeoDirectory!&#039;, &#039;geodirectory&#039; ); ?&gt; 😃&lt;/p&gt;
			&lt;/div&gt;

		&lt;/div&gt;

		&lt;?php if ( &#039;unknown&#039; === geodir_get_option( &#039;usage_tracking&#039;, &#039;unknown&#039; ) || &#039;&#039; === geodir_get_option( &#039;usage_tracking&#039; ) ) { ?&gt;
			&lt;div class=&quot;geodirectory-message geodirectory-tracker mb-3&quot;&gt;
				&lt;p&gt;&lt;?php printf( __( &#039;Want to help make GeoDirectory even more awesome? Allow GeoDirectory to collect non-sensitive diagnostic data and usage information. %1$sFind out more%2$s.&#039;, &#039;geodirectory&#039; ), &#039;&lt;a href=&quot;https://wpgeodirectory.com/usage-tracking/&quot; target=&quot;_blank&quot;&gt;&#039;, &#039;&lt;/a&gt;&#039; ); ?&gt;&lt;/p&gt;
				&lt;p class=&quot;&quot;&gt;
					&lt;a class=&quot;btn btn-primary btn-sm&quot;
					   href=&quot;&lt;?php echo esc_url( wp_nonce_url( remove_query_arg( &#039;gd_tracker_optout&#039;, add_query_arg( &#039;gd_tracker_optin&#039;, &#039;true&#039; ) ), &#039;gd_tracker_optin&#039;, &#039;gd_tracker_nonce&#039; ) ); ?&gt;&quot;&gt;&lt;?php esc_html_e( &#039;Allow&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;a class=&quot;btn btn-link btn-sm&quot;
					   href=&quot;&lt;?php echo esc_url( wp_nonce_url( remove_query_arg( &#039;gd_tracker_optin&#039;, add_query_arg( &#039;gd_tracker_optout&#039;, &#039;true&#039; ) ), &#039;gd_tracker_optout&#039;, &#039;gd_tracker_nonce&#039; ) ); ?&gt;&quot;&gt;&lt;?php esc_html_e( &#039;No thanks&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;/p&gt;
			&lt;/div&gt;
		&lt;?php } ?&gt;

		&lt;div class=&quot;gd-setup-next-steps&quot;&gt;
			&lt;div class=&quot;gd-setup-next-steps-first mb-4&quot;&gt;
				&lt;h2 class=&quot;h3&quot;&gt;&lt;?php esc_html_e( &#039;Next steps&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h2&gt;
				&lt;ul&gt;
					&lt;li class=&quot;setup-listing&quot;&gt;&lt;a class=&quot;btn btn-primary btn-sm&quot;
					                             href=&quot;&lt;?php echo esc_url( admin_url( &#039;post-new.php?post_type=gd_place&#039; ) ); ?&gt;&quot;&gt;&lt;?php esc_html_e( &#039;Create your first listing!&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
			&lt;/div&gt;
			&lt;div class=&quot;gd-setup-next-steps-last&quot;&gt;
				&lt;h2 class=&quot;h3&quot;&gt;&lt;?php _e( &#039;Learn more&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/h2&gt;
				&lt;div&gt;
					&lt;a
						class=&quot;btn btn-sm btn-outline-primary gd-getting-started&quot;
						href=&quot;https://docs.wpgeodirectory.com/collection/1-getting-started?utm_source=setupwizard&amp;utm_medium=product&amp;utm_content=getting-started&amp;utm_campaign=geodirectoryplugin&quot;
						target=&quot;_blank&quot;&gt;&lt;?php esc_html_e( &#039;Getting started guide&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;a
						class=&quot;btn btn-sm btn-outline-primary gd-newsletter&quot;
						href=&quot;https://wpgeodirectory.com/newsletter-signup/?utm_source=setupwizard&amp;utm_medium=product&amp;utm_content=newsletter&amp;utm_campaign=geodirectoryplugin&quot;
						target=&quot;_blank&quot;&gt;&lt;?php esc_html_e( &#039;Get GeoDirectory advice in your inbox&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
					&lt;a
						class=&quot;btn btn-sm btn-outline-primary gd-get-help&quot;
						href=&quot;https://wpgeodirectory.com/support/?utm_source=setupwizard&amp;utm_medium=product&amp;utm_content=docs&amp;utm_campaign=geodirectoryplugin&quot;
						target=&quot;_blank&quot;&gt;&lt;?php esc_html_e( &#039;Have questions? Get help.&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/a&gt;
				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/div&gt;
		&lt;?php
	}

	/**
	 * Actions on the final step.
	 *
	 * @since 2.0.0
	 */
	private function setup_ready_actions() {
		GeoDir_Admin_Notices::remove_notice( &#039;install&#039; );
		geodir_update_option( &#039;wizard_complete&#039;, time() );

		if ( isset( $_GET[&#039;gd_tracker_optin&#039;] ) &amp;&amp; isset( $_GET[&#039;gd_tracker_nonce&#039;] ) &amp;&amp; wp_verify_nonce( $_GET[&#039;gd_tracker_nonce&#039;], &#039;gd_tracker_optin&#039; ) ) {
			geodir_update_option( &#039;usage_tracking&#039;, true );
			GeoDir_Admin_Tracker::send_tracking_data( true );

		} elseif ( isset( $_GET[&#039;gd_tracker_optout&#039;] ) &amp;&amp; isset( $_GET[&#039;gd_tracker_nonce&#039;] ) &amp;&amp; wp_verify_nonce( $_GET[&#039;gd_tracker_nonce&#039;], &#039;gd_tracker_optout&#039; ) ) {
			geodir_update_option( &#039;usage_tracking&#039;, false );
		}
	}

	/**
	 * Output the setup wizard content dummy data settings.
	 */
	public static function content_dummy_data() {

		$generalSettings = new GeoDir_Settings_General();
		$settings        = $generalSettings-&gt;get_settings( &#039;dummy_data&#039; );

		// Change the description
		$settings[0][&#039;title&#039;] = &#039;&#039;;//__(&quot;Demo content&quot;,&quot;geodirectory&quot;);
		$settings[0][&#039;desc&#039;]  = &#039;&#039;;//__( &#039;Drag the map or the marker to set the city/town you wish to use as the default location.&#039;, &#039;geodirectory&#039; );

		ob_start();
		GeoDir_Admin_Settings::output_fields( $settings );
		$settings_output = ob_get_clean();
		echo str_replace(
			array(
				&#039;gd-dummy-table&#039;,
				&#039;regular-text&#039;,
				&#039;geodir-select&#039;,
				&#039;gd-dummy-table &#039;,
				&#039;card p-0 &#039;,
				&#039;card-body&#039;,
				&#039; shadow-sm&#039;,
				&#039;accordion&#039;,
			),
			array(
				&#039;gd-dummy-table gd-dummy-data&#039;,
				&#039;form-control w-100 mw-100&#039;,
				&#039;form-control form-control-sm w-100 mw-100&#039;,
				&#039;gd-dummy-table table table-borderless table-sm &#039;,
				&#039;p-0 &#039;,
				&#039;&#039;,
				&#039;&#039;,
				&#039;accordion mx-n1&#039;,
			),
			$settings_output
		);

	}

	/**
	 * Output the setup wizard content sidebars settings.
	 */
	public static function content_sidebars() {

		$gd_sidebar_top = get_theme_support( &#039;geodirectory-sidebar-top&#039; );
		if ( isset( $gd_sidebar_top[0] ) ) {
			?&gt;
			&lt;div class=&quot;form-table gd-dummy-table gd-dummy-widgets&quot;&gt;
				&lt;div class=&quot;d-flex justify-content-between&quot;&gt;
					&lt;div class=&quot;pb-1 flex-fill&quot;&gt;
						&lt;div class=&quot;form-group&quot;&gt;
							&lt;label for=&quot;geodir-wizard-widgets-top&quot;&gt;&lt;?php _e( &quot;Select the theme top sidebar&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
							&lt;select id=&#039;geodir-wizard-widgets-top&#039; class=&quot;geodir-select form-control form-control-sm w-100 mw-100 &quot;&gt;
								&lt;?php
								$is_sidebar    = &#039;&#039;;
								$maybe_sidebar = &#039;&#039;;
								$gd_sidebar    = get_theme_support( &#039;geodirectory-sidebar-top&#039; );
								if ( isset( $gd_sidebar[0] ) ) {
									$gd_sidebar = $gd_sidebar[0];
								}

								// get the sidebars
								foreach ( $GLOBALS[&#039;wp_registered_sidebars&#039;] as $sidebar ) {

									if ( $gd_sidebar &amp;&amp; $gd_sidebar == strtolower( $sidebar[&#039;id&#039;] ) ) {
										$is_sidebar = $sidebar[&#039;id&#039;];
										break;
									}
									// Check if its called &#039;sidebar&#039; by name or id.
									if ( strtolower( $sidebar[&#039;id&#039;] ) == &#039;sidebar&#039; || strtolower( $sidebar[&#039;name&#039;] ) == __( &#039;sidebar&#039;, &#039;geodirectory&#039; ) ) {
										$is_sidebar = $sidebar[&#039;id&#039;];
										break;
									}

									if ( ! $maybe_sidebar &amp;&amp; strpos( strtolower( $sidebar[&#039;name&#039;] ), __( &#039;sidebar&#039;, &#039;geodirectory&#039; ) ) !== false ) {
										$maybe_sidebar = $sidebar[&#039;id&#039;];
									}

									if ( strpos( strtolower( $sidebar[&#039;name&#039;] ), __( &#039;sidebar page&#039;, &#039;geodirectory&#039; ) ) !== false ) {
										$maybe_sidebar = $sidebar[&#039;id&#039;];
									}
								}

								// set if we have a guess
								if ( ! $is_sidebar &amp;&amp; $maybe_sidebar ) {
									$is_sidebar = $maybe_sidebar;
								}

								foreach ( $GLOBALS[&#039;wp_registered_sidebars&#039;] as $sidebar ) { ?&gt;
									&lt;option
										value=&quot;&lt;?php echo esc_attr( $sidebar[&#039;id&#039;] ); ?&gt;&quot; &lt;?php selected( $is_sidebar, $sidebar[&#039;id&#039;] ); ?&gt;&gt;
										&lt;?php echo esc_attr( ucwords( $sidebar[&#039;name&#039;] ) );
										if ( $is_sidebar == $sidebar[&#039;id&#039;] ) {
											echo &#039; &#039;;
											_e( &#039;( Auto detected )&#039;, &#039;geodirectory&#039; );
										} ?&gt;
									&lt;/option&gt;
								&lt;?php }

								?&gt;
							&lt;/select&gt;
						&lt;/div&gt;
					&lt;/div&gt;
					&lt;div class=&quot;pl-2 pb-1&quot;&gt;
						&lt;div class=&quot;form-group text-right&quot;&gt;
							&lt;label
								for=&quot;geodir-wizard-widgets-top-submit&quot; class=&quot;invisible&quot;&gt;&lt;?php _e( &quot;Action&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
							&lt;input type=&quot;button&quot; id=&quot;geodir-wizard-widgets-top-submit&quot;
							       value=&quot;&lt;?php _e( &quot;Insert widgets&quot;, &quot;geodirectory&quot; ); ?&gt;&quot;
							       class=&quot;btn btn-primary btn-sm geodir_dummy_button d-block&quot;
							       onclick=&quot;gd_wizard_add_widgets_top(&#039;&lt;?php echo wp_create_nonce( &quot;geodir-wizard-widgets-top&quot; ); ?&gt;&#039;);return false;&quot;&gt;
						&lt;/div&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div class=&quot;geodir-wizard-widgets-top-result w-100&quot;&gt;&lt;/div&gt;
			&lt;/div&gt;



			&lt;?php
		}
		?&gt;

		&lt;div class=&quot;form-table gd-dummy-table gd-dummy-widgets&quot;&gt;
			&lt;div class=&quot;d-flex justify-content-between&quot;&gt;
				&lt;div class=&quot;pb-1 flex-fill&quot;&gt;
					&lt;div class=&quot;form-group&quot;&gt;
						&lt;label for=&quot;geodir-wizard-widgets&quot;&gt;&lt;?php _e( &quot;Select the theme sidebar&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
						&lt;select id=&#039;geodir-wizard-widgets&#039; class=&quot;geodir-select form-control form-control-sm w-100 mw-100&quot;&gt;
							&lt;?php
							$is_sidebar    = &#039;&#039;;
							$maybe_sidebar = &#039;&#039;;
							$gd_sidebar    = get_theme_support( &#039;geodirectory-sidebar&#039; );
							if ( isset( $gd_sidebar[0] ) ) {
								$gd_sidebar = $gd_sidebar[0];
							}
							//							print_r($gd_sidebar);
							//							echo &#039;###&#039;;exit;
							// get the sidebars
							foreach ( $GLOBALS[&#039;wp_registered_sidebars&#039;] as $sidebar ) {

								if ( $gd_sidebar &amp;&amp; $gd_sidebar == strtolower( $sidebar[&#039;id&#039;] ) ) {
									$is_sidebar = $sidebar[&#039;id&#039;];
									break;
								}
								// Check if its called &#039;sidebar&#039; by name or id.
								if ( strtolower( $sidebar[&#039;id&#039;] ) == &#039;sidebar&#039; || strtolower( $sidebar[&#039;name&#039;] ) == __( &#039;sidebar&#039;, &#039;geodirectory&#039; ) ) {
									$is_sidebar = $sidebar[&#039;id&#039;];
									break;
								}

								if ( ! $maybe_sidebar &amp;&amp; strpos( strtolower( $sidebar[&#039;name&#039;] ), __( &#039;sidebar&#039;, &#039;geodirectory&#039; ) ) !== false ) {
									$maybe_sidebar = $sidebar[&#039;id&#039;];
								}

								if ( strpos( strtolower( $sidebar[&#039;name&#039;] ), __( &#039;sidebar page&#039;, &#039;geodirectory&#039; ) ) !== false ) {
									$maybe_sidebar = $sidebar[&#039;id&#039;];
								}
							}

							// set if we have a guess
							if ( ! $is_sidebar &amp;&amp; $maybe_sidebar ) {
								$is_sidebar = $maybe_sidebar;
							}

							foreach ( $GLOBALS[&#039;wp_registered_sidebars&#039;] as $sidebar ) { ?&gt;
								&lt;option
									value=&quot;&lt;?php echo esc_attr( $sidebar[&#039;id&#039;] ); ?&gt;&quot; &lt;?php selected( $is_sidebar, $sidebar[&#039;id&#039;] ); ?&gt;&gt;
									&lt;?php echo esc_attr( ucwords( $sidebar[&#039;name&#039;] ) );
									if ( $is_sidebar == $sidebar[&#039;id&#039;] ) {
										echo &#039; &#039;;
										_e( &#039;( Auto detected )&#039;, &#039;geodirectory&#039; );
									} ?&gt;
								&lt;/option&gt;
							&lt;?php }

							?&gt;
						&lt;/select&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div class=&quot;pl-2 pb-1&quot;&gt;
					&lt;div class=&quot;form-group text-right&quot;&gt;
						&lt;label
							for=&quot;geodir-wizard-widgets-top-submit&quot; class=&quot;invisible&quot;&gt;&lt;?php _e( &quot;Action&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
						&lt;input type=&quot;button&quot; id=&quot;geodir-wizard-widgets-submit&quot; value=&quot;&lt;?php _e( &quot;Insert widgets&quot;, &quot;geodirectory&quot; ); ?&gt;&quot;
						       class=&quot;btn btn-primary btn-sm geodir_dummy_button d-block&quot;
						       onclick=&quot;gd_wizard_add_widgets(&#039;&lt;?php echo wp_create_nonce( &quot;geodir-wizard-widgets&quot; ); ?&gt;&#039;);return false;&quot;&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
			&lt;div class=&quot;geodir-wizard-widgets-result w-100&quot;&gt;&lt;/div&gt;
		&lt;/div&gt;
		&lt;?php
	}

	/**
	 * Output the setup wizard content menu settings.
	 */
	public static function content_menus() {

		?&gt;
		&lt;div class=&quot;form-table gd-dummy-table gd-dummy-widgets gd-dummy-posts&quot;&gt;
			&lt;div class=&quot;d-flex justify-content-between&quot;&gt;
				&lt;div class=&quot;pb-1 flex-fill&quot;&gt;
					&lt;div class=&quot;form-group&quot;&gt;
						&lt;label for=&quot;geodir-wizard-menus&quot;&gt;&lt;?php _e( &quot;Select the theme main menu&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
						&lt;?php

						$set_menus = get_nav_menu_locations();
						$set_menus = array_filter( $set_menus );
						//echo &#039;##&#039;;
						//print_r($set_menus);

						if ( ! empty( $set_menus ) ) {
							//echo &#039;##1&#039;;
							echo &quot;&lt;select id=&#039;geodir-wizard-menu-id&#039; data-type=&#039;add&#039; class=&#039;geodir-select form-control form-control-sm w-100 mw-100&#039; &gt;&quot;;

							foreach ( $set_menus as $menu_location =&gt; $menu_id ) {
								$selected = &#039;&#039;;

								if ( strpos( strtolower( $menu_location ), &#039;primary&#039; ) !== false || strpos( strtolower( $menu_location ), &#039;main&#039; ) !== false ) {
									$selected = &#039;selected=&quot;selected&quot;&#039;;
								}

								$menu_item = wp_get_nav_menus( $menu_id )[0];

								?&gt;
								&lt;option value=&quot;&lt;?php echo esc_attr( $menu_id ); ?&gt;&quot; &lt;?php echo $selected; ?&gt;&gt;
									&lt;?php echo esc_attr( $menu_item-&gt;name );
									if ( $selected ) {
										echo &#039; &#039;;
										_e( &#039;( Auto detected )&#039;, &#039;geodirectory&#039; );
									} ?&gt;
								&lt;/option&gt;
								&lt;?php
							}

							echo &quot;&lt;/select&gt;&quot;;


						} else {//echo &#039;##2&#039;;
							// add new menu to a menu location.
							$menus = get_registered_nav_menus();

							//print_r($menus );

							if ( ! empty( $menus ) ) {
								echo &quot;&lt;select id=&#039;geodir-wizard-menu-location&#039; data-type=&#039;create&#039; class=&#039;geodir-select form-control form-control-sm w-100 mw-100&#039; &gt;&quot;;

								foreach ( $menus as $menu_slug =&gt; $menu_name ) {
									$selected = &#039;&#039;;

									if ( strpos( strtolower( $menu_slug ), &#039;primary&#039; ) !== false || strpos( strtolower( $menu_slug ), &#039;main&#039; ) !== false ) {
										$selected = &#039;selected=&quot;selected&quot;&#039;;
									}
									?&gt;
									&lt;option value=&quot;&lt;?php echo esc_attr( $menu_slug ); ?&gt;&quot; &lt;?php echo $selected; ?&gt;&gt;
										&lt;?php _e( &#039;Create new menu in:&#039;, &#039;geodirectory&#039; );
										echo &#039; &#039; . esc_attr( $menu_name );
										if ( $selected ) {
											echo &#039; &#039;;
											_e( &#039;( Auto detected )&#039;, &#039;geodirectory&#039; );
										} ?&gt;
									&lt;/option&gt;
									&lt;?php
								}
								echo &quot;&lt;/select&gt;&quot;;

							}

							//print_r($menus);
						}

						//					echo geodir_notification( array( &#039;geodir-wizard-menu-result&#039; =&gt; &#039;&#039; ) );

						?&gt;
					&lt;/div&gt;
				&lt;/div&gt;
				&lt;div class=&quot;pl-2 pb-1&quot;&gt;
					&lt;div class=&quot;form-group text-right&quot;&gt;
						&lt;label
							for=&quot;geodir-wizard-menu-submit&quot;
							class=&quot;invisible&quot;&gt;&lt;?php _e( &quot;Action&quot;, &quot;geodirectory&quot; ); ?&gt;&lt;/label&gt;
						&lt;input type=&quot;button&quot; id=&quot;geodir-wizard-menu-submit&quot; value=&quot;&lt;?php _e( &quot;Insert menu items&quot;, &quot;geodirectory&quot; ); ?&gt;&quot;
						       class=&quot;btn btn-primary btn-sm geodir_dummy_button d-block&quot;
						       onclick=&quot;gd_wizard_setup_menu(&#039;&lt;?php echo wp_create_nonce( &quot;geodir-wizard-setup-menu&quot; ); ?&gt;&#039;);return false;&quot;&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
			&lt;div class=&quot;geodir-wizard-menu-result w-100&quot;&gt;&lt;/div&gt;
		&lt;/div&gt;


		&lt;?php

	}

}

new GeoDir_Admin_Setup_Wizard();
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 07:38 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652341136"></script>
    <script src="../js/search.js?updated=1652341136"></script>
</body>
</html>
