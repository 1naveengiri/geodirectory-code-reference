<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337338">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337338">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-widget-listings.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDirectory GeoDirectory Popular Post View Widget
 *
 * @since 1.0.0
 *
 * @package GeoDirectory
 */

/**
 * GeoDirectory listings widget class.
 *
 * @since 1.0.0
 */
class GeoDir_Widget_Listings extends WP_Super_Duper {

	public $post_title_tag;

    /**
     * Register the popular posts widget.
     *
     * @since 1.0.0
     * @since 1.5.1 Changed from PHP4 style constructors to PHP5 __construct.
     */
    public function __construct() {

        $options = array(
            &#039;textdomain&#039;    =&gt; GEODIRECTORY_TEXTDOMAIN,
            &#039;block-icon&#039;    =&gt; &#039;fas fa-th-list&#039;,
            &#039;block-category&#039;=&gt; &#039;geodirectory&#039;,
	        &#039;block-supports&#039;=&gt; array(
		      //  &#039;customClassName&#039;   =&gt; false
	        ),
            &#039;block-keywords&#039;=&gt; &quot;[&#039;listings&#039;,&#039;posts&#039;,&#039;geo&#039;]&quot;,
            &#039;class_name&#039;    =&gt; __CLASS__,
            &#039;base_id&#039;       =&gt; &#039;gd_listings&#039;, // this us used as the widget id and the shortcode id.
            &#039;name&#039;          =&gt; __(&#039;GD &gt; Listings&#039;,&#039;geodirectory&#039;), // the name of the widget.
            &#039;widget_ops&#039;    =&gt; array(
                &#039;classname&#039;   =&gt; &#039;geodir-listings &#039;.geodir_bsui_class(), // widget class
                &#039;description&#039; =&gt; esc_html__(&#039;Shows the GD listings filtered by your choices.&#039;,&#039;geodirectory&#039;), // widget description
                &#039;customize_selective_refresh&#039; =&gt; true,
                &#039;geodirectory&#039; =&gt; true,
            ),
        );

        parent::__construct( $options );
    }

    /**
     * Set the arguments later.
     *
     * @return array
     */
    public function set_arguments(){

	    $design_style = geodir_design_style();

	    $post_types = geodir_get_posttypes(&#039;options-plural&#039;);

        $arguments = array(
            &#039;title&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Title:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;The widget title.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;text&#039;,
                &#039;default&#039;  =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false
            ),
            &#039;post_type&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Default Post Type:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;The custom post types to show by default. Only used when there are multiple CPTs.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039;   =&gt;  $post_types,
                &#039;default&#039;  =&gt; &#039;gd_place&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false,
	            &#039;onchange_rest&#039; =&gt; array(
		            &#039;path&#039;  =&gt; &#039;/geodir/v2/&quot;+$value+&quot;/categories/?per_page=100&#039;,
		            &#039;values&#039;    =&gt; $this-&gt;get_rest_slugs_array()
	            ),
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;category&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Categories:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;The categories to show.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;multiple&#039; =&gt; true,
                &#039;options&#039;   =&gt;  $this-&gt;get_categories(),
                &#039;default&#039;  =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false,
	            &#039;post_type_linked&#039;  =&gt; count($post_types) &gt; 1 ? true : false,
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;related_to&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Filter listings related to:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;Select to filter the listings related to current listing categories/tags on detail page.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039;   =&gt;  array(
                    &#039;&#039; =&gt; __(&#039;No filter&#039;, &#039;geodirectory&#039;),
                    &#039;default_category&#039; =&gt; __(&#039;Default Category only&#039;, &#039;geodirectory&#039;),
                    &#039;category&#039; =&gt; __(&#039;Categories&#039;, &#039;geodirectory&#039;),
					&#039;tags&#039; =&gt; __(&#039;Tags&#039;, &#039;geodirectory&#039;)
                ),
                &#039;default&#039;  =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;tags&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Filter by tags:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;Insert separate tags with commas to filter listings by tags.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;text&#039;,
                &#039;default&#039; =&gt; &#039;&#039;,
	            &#039;placeholder&#039; =&gt; __(&#039;garden,dinner,pizza&#039;, &#039;geodirectory&#039;),
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;post_author&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Filter by author:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;Filter by current_user, current_author or ID (default = unfiltered). current_user: Filters the listings by author id of the logged in user. current_author: Filters the listings by author id of current viewing post/listing. 11: Filters the listings by author id = 11. Leave blank to show posts from all authors.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;text&#039;,
                &#039;default&#039; =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;post_limit&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&#039;Posts to show:&#039;, &#039;geodirectory&#039;),
	            &#039;desc&#039; =&gt; __(&#039;The number of posts to show by default.&#039;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;number&#039;,
	            &#039;default&#039;  =&gt; &#039;5&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;advanced&#039; =&gt; false,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;post_ids&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&#039;Posts IDs:&#039;, &#039;geodirectory&#039;),
	            &#039;desc&#039; =&gt; __(&#039;Enter a comma separated list of post ids (1,2,3) to limit the listing to these posts only, or a negative list (-1,-2,-3) to exclude those post IDs (negative and positive IDs can not be mixed) &#039;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;text&#039;,
	            &#039;default&#039;  =&gt; &#039;&#039;,
	            &#039;placeholder&#039; =&gt; &#039;1,2,3&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;add_location_filter&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Enable location filter?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;1&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;show_featured_only&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Show featured only?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;show_special_only&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Only show listings with special offers?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;with_pics_only&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Only show listings with pictures?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;with_videos_only&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Only show listings with videos?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;show_favorites_only&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Show favorited by user?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; true,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;favorites_by_user&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&#039;Favorited by user:&#039;, &#039;geodirectory&#039;),
	            &#039;desc&#039; =&gt; __(&#039;Display listings favorited by current_user, current_author or ID (default = unfiltered). current_user: Display listings favorited by author id of the logged in user. current_author: Display listings favorited by author id of current viewing post/listing. 11: Display listings favorited author id = 11. Leave blank to show listings favorited by logged user.&#039;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;text&#039;,
	            &#039;default&#039; =&gt; &#039;&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;advanced&#039; =&gt; true,
	            &#039;element_require&#039; =&gt; &#039;[%show_favorites_only%]==&quot;1&quot;&#039;,
	            &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;use_viewing_post_type&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&quot;Use current viewing post type?&quot;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039;  =&gt; &#039;1&#039;,
                &#039;default&#039;  =&gt; &#039;0&#039;,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039;     =&gt; __(&quot;Filters&quot;,&quot;geodirectory&quot;)
            ),
            &#039;use_viewing_term&#039; =&gt; array(
                &#039;title&#039; =&gt; __( &#039;Filter by current viewing category/tag?&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039; =&gt; &#039;1&#039;,
                &#039;default&#039; =&gt; &#039;0&#039;,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039; =&gt; __( &#039;Filters&#039;, &#039;geodirectory&#039; )
            ),
            &#039;sort_by&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Sort by:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;How the listings should be sorted.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039;   =&gt;  $this-&gt;get_sort_options(),
                &#039;default&#039;  =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false,
                &#039;post_type_linked&#039;  =&gt; count($post_types) &gt; 1 ? true : false,
                &#039;group&#039;     =&gt; __(&quot;Sorting&quot;,&quot;geodirectory&quot;)
            ),
            &#039;title_tag&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Title tag:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;The title tag used for the listings.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039;   =&gt;  array(
                    &quot;h3&quot;        =&gt;  __(&#039;h3 (default)&#039;, &#039;geodirectory&#039;),
                    &quot;h2&quot;        =&gt;  __(&#039;h2 (if main content of page)&#039;, &#039;geodirectory&#039;),
                ),
                &#039;default&#039;  =&gt; &#039;h3&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false,
                &#039;group&#039;     =&gt; __(&quot;SEO&quot;,&quot;geodirectory&quot;)
            ),
            &#039;layout&#039;  =&gt; array(
                &#039;title&#039; =&gt; __(&#039;Layout:&#039;, &#039;geodirectory&#039;),
                &#039;desc&#039; =&gt; __(&#039;How the listings should laid out by default.&#039;, &#039;geodirectory&#039;),
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039;   =&gt;  geodir_get_layout_options(),
                &#039;default&#039;  =&gt; &#039;2&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;advanced&#039; =&gt; false,
	            &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
			&#039;view_all_link&#039;  =&gt; array(
                &#039;title&#039; =&gt; __( &#039;Show view all link?&#039;, &#039;geodirectory&#039; ),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039;  =&gt; &#039;1&#039;,
                &#039;default&#039;  =&gt; &#039;1&#039;,
                &#039;advanced&#039; =&gt; false,
                &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
            &#039;with_pagination&#039;  =&gt; array(
                &#039;title&#039; =&gt; __( &quot;Show pagination?&quot;, &#039;geodirectory&#039; ),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039;  =&gt; &#039;1&#039;,
                &#039;default&#039;  =&gt; &#039;0&#039;,
                &#039;advanced&#039; =&gt; true,
                &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
            &#039;top_pagination&#039;  =&gt; array(
                &#039;title&#039; =&gt; __( &quot;Show pagination on top of the listings?&quot;, &#039;geodirectory&#039; ),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039;  =&gt; &#039;1&#039;,
                &#039;default&#039;  =&gt; &#039;0&#039;,
                &#039;advanced&#039; =&gt; true,
				&#039;element_require&#039; =&gt; &#039;[%with_pagination%]==&quot;1&quot;&#039;,
                &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
            &#039;bottom_pagination&#039;  =&gt; array(
                &#039;title&#039; =&gt; __( &quot;Show pagination at bottom of the listings?&quot;, &#039;geodirectory&#039; ),
                &#039;type&#039; =&gt; &#039;checkbox&#039;,
                &#039;desc_tip&#039; =&gt; true,
                &#039;value&#039;  =&gt; &#039;1&#039;,
                &#039;default&#039;  =&gt; &#039;1&#039;,
                &#039;advanced&#039; =&gt; true,
				&#039;element_require&#039; =&gt; &#039;[%with_pagination%]==&quot;1&quot;&#039;,
                &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
            &#039;pagination_info&#039;  =&gt; array(
                &#039;title&#039; =&gt; __( &quot;Show advance pagination info?&quot;, &#039;geodirectory&#039; ),
                &#039;desc&#039; =&gt; &#039;&#039;,
                &#039;type&#039; =&gt; &#039;select&#039;,
                &#039;options&#039; =&gt;  array(
                    &quot;&quot; =&gt; __( &#039;Never display&#039;, &#039;geodirectory&#039; ),
                    &quot;before&quot; =&gt; __( &#039;Before pagination&#039;, &#039;geodirectory&#039; ),
                    &quot;after&quot; =&gt; __( &#039;After pagination&#039;, &#039;geodirectory&#039; ),
                ),
                &#039;default&#039;  =&gt; &#039;&#039;,
                &#039;desc_tip&#039; =&gt; false,
                &#039;advanced&#039; =&gt; true,
				&#039;element_require&#039; =&gt; &#039;[%with_pagination%]==&quot;1&quot;&#039;,
                &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
            ),
            &#039;hide_if_empty&#039;  =&gt; array(
	            &#039;title&#039; =&gt; __(&quot;Hide widget if no posts?&quot;, &#039;geodirectory&#039;),
	            &#039;type&#039; =&gt; &#039;checkbox&#039;,
	            &#039;desc_tip&#039; =&gt; true,
	            &#039;value&#039;  =&gt; &#039;1&#039;,
	            &#039;default&#039;  =&gt; &#039;0&#039;,
	            &#039;advanced&#039; =&gt; false,
	            &#039;group&#039;     =&gt; __(&quot;General&quot;,&quot;geodirectory&quot;)
            ),
        );

	    if ( $design_style ) {

		    $arguments[&#039;row_gap&#039;] = array(
			    &#039;title&#039; =&gt; __( &quot;Card row gap&quot;, &#039;geodirectory&#039; ),
			    &#039;desc&#039; =&gt; __(&#039;This adjusts the spacing between the cards horizontally.&#039;,&#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;select&#039;,
			    &#039;options&#039; =&gt;  array(
				    &#039;&#039;  =&gt;  __(&quot;Default&quot;,&quot;geodirectory&quot;),
				    &#039;1&#039;  =&gt;  &#039;1&#039;,
				    &#039;2&#039;  =&gt;  &#039;2&#039;,
				    &#039;3&#039;  =&gt;  &#039;3&#039;,
				    &#039;4&#039;  =&gt;  &#039;4&#039;,
				    &#039;5&#039;  =&gt;  &#039;5&#039;,
			    ),
			    &#039;default&#039;  =&gt; &#039;&#039;,
			    &#039;desc_tip&#039; =&gt; false,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Card Design&quot;,&quot;geodirectory&quot;)
		    );

		    $arguments[&#039;column_gap&#039;] = array(
			    &#039;title&#039; =&gt; __( &quot;Card column gap&quot;, &#039;geodirectory&#039; ),
			    &#039;desc&#039; =&gt; __(&#039;This adjusts the spacing between the cards vertically.&#039;,&#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;select&#039;,
			    &#039;options&#039; =&gt;  array(
				    &#039;&#039;  =&gt;  __(&quot;Default&quot;,&quot;geodirectory&quot;),
				    &#039;1&#039;  =&gt;  &#039;1&#039;,
				    &#039;2&#039;  =&gt;  &#039;2&#039;,
				    &#039;3&#039;  =&gt;  &#039;3&#039;,
				    &#039;4&#039;  =&gt;  &#039;4&#039;,
				    &#039;5&#039;  =&gt;  &#039;5&#039;,
			    ),
			    &#039;default&#039;  =&gt; &#039;&#039;,
			    &#039;desc_tip&#039; =&gt; false,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Card Design&quot;,&quot;geodirectory&quot;)
		    );

		    $arguments[&#039;card_border&#039;] = array(
			    &#039;title&#039; =&gt; __( &quot;Card border&quot;, &#039;geodirectory&#039; ),
			    &#039;desc&#039; =&gt; __(&#039;Set the border style for the card.&#039;,&#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;select&#039;,
			    &#039;options&#039; =&gt;  array(
				                  &#039;&#039;  =&gt;  __(&quot;Default&quot;,&quot;geodirectory&quot;),
				                  &#039;none&#039;  =&gt;  __(&quot;None&quot;,&quot;geodirectory&quot;),
			    ) + geodir_aui_colors(),
			    &#039;default&#039;  =&gt; &#039;&#039;,
			    &#039;desc_tip&#039; =&gt; false,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Card Design&quot;,&quot;geodirectory&quot;)
		    );

		    $arguments[&#039;card_shadow&#039;] = array(
			    &#039;title&#039; =&gt; __( &quot;Card shadow&quot;, &#039;geodirectory&#039; ),
			    &#039;desc&#039; =&gt; __(&#039;Set the card shadow style.&#039;,&#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;select&#039;,
			    &#039;options&#039; =&gt;  array(
				    &#039;&#039;  =&gt;  __(&quot;None&quot;,&quot;geodirectory&quot;),
				    &#039;small&#039;  =&gt;  __(&quot;Small&quot;,&quot;geodirectory&quot;),
				    &#039;medium&#039;  =&gt;  __(&quot;Medium&quot;,&quot;geodirectory&quot;),
				    &#039;large&#039;  =&gt;  __(&quot;Large&quot;,&quot;geodirectory&quot;),
			    ),
			    &#039;default&#039;  =&gt; &#039;&#039;,
			    &#039;desc_tip&#039; =&gt; false,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Card Design&quot;,&quot;geodirectory&quot;)
		    );

		    // background
		    $arguments[&#039;bg&#039;]  = geodir_get_sd_background_input(&#039;mt&#039;);

		    // margins
		    $arguments[&#039;mt&#039;]  = geodir_get_sd_margin_input(&#039;mt&#039;);
		    $arguments[&#039;mr&#039;]  = geodir_get_sd_margin_input(&#039;mr&#039;);
		    $arguments[&#039;mb&#039;]  = geodir_get_sd_margin_input(&#039;mb&#039;,array(&#039;default&#039;=&gt;3));
		    $arguments[&#039;ml&#039;]  = geodir_get_sd_margin_input(&#039;ml&#039;);

		    // padding
		    $arguments[&#039;pt&#039;]  = geodir_get_sd_padding_input(&#039;pt&#039;);
		    $arguments[&#039;pr&#039;]  = geodir_get_sd_padding_input(&#039;pr&#039;);
		    $arguments[&#039;pb&#039;]  = geodir_get_sd_padding_input(&#039;pb&#039;);
		    $arguments[&#039;pl&#039;]  = geodir_get_sd_padding_input(&#039;pl&#039;);

		    // border
		    $arguments[&#039;border&#039;]  = geodir_get_sd_border_input(&#039;border&#039;);
		    $arguments[&#039;rounded&#039;]  = geodir_get_sd_border_input(&#039;rounded&#039;);
		    $arguments[&#039;rounded_size&#039;]  = geodir_get_sd_border_input(&#039;rounded_size&#039;);

		    // shadow
		    $arguments[&#039;shadow&#039;]  = geodir_get_sd_shadow_input(&#039;shadow&#039;);
	    }

		// Carousel
		$arguments[&#039;with_carousel&#039;] = array(
			&#039;type&#039; =&gt; &#039;select&#039;,
			&#039;title&#039; =&gt; __( &#039;With Carousel:&#039;, &#039;geodirectory&#039; ),
			&#039;desc&#039; =&gt; __( &#039;Enable carousel to show listings slideshow.&#039;, &#039;geodirectory&#039; ),
			&#039;options&#039; =&gt; array(
				&#039;&#039; =&gt; __( &#039;No&#039;, &#039;geodirectory&#039; ),
				&#039;1&#039; =&gt; __( &#039;Yes&#039;, &#039;geodirectory&#039; )
			),
			&#039;default&#039; =&gt; &#039;&#039;,
			&#039;desc_tip&#039; =&gt; false,
			&#039;advanced&#039; =&gt; false,
			&#039;group&#039; =&gt; __( &#039;Carousel&#039;, &#039;geodirectory&#039; )
		);

		$arguments[&#039;with_indicators&#039;] = array(
			&#039;type&#039; =&gt; &#039;select&#039;,
			&#039;title&#039; =&gt; __( &#039;With Indicators:&#039;, &#039;geodirectory&#039; ),
			&#039;desc&#039; =&gt; __( &#039;Show the previous/next navigation indicators to the carousel.&#039;, &#039;geodirectory&#039; ),
			&#039;options&#039; =&gt; array(
				&#039;&#039; =&gt; __( &#039;No&#039;, &#039;geodirectory&#039; ),
				&#039;1&#039; =&gt; __( &#039;Yes&#039;, &#039;geodirectory&#039; )
			),
			&#039;default&#039; =&gt; &#039;&#039;,
			&#039;desc_tip&#039; =&gt; false,
			&#039;advanced&#039; =&gt; false,
			&#039;element_require&#039; =&gt; &#039;[%with_carousel%]==&quot;1&quot;&#039;,
			&#039;group&#039; =&gt; __( &#039;Carousel&#039;, &#039;geodirectory&#039; )
		);

		$arguments[&#039;with_controls&#039;] = array(
			&#039;type&#039; =&gt; &#039;select&#039;,
			&#039;title&#039; =&gt; __( &#039;With Controls:&#039;, &#039;geodirectory&#039; ),
			&#039;desc&#039; =&gt; __( &#039;Show the paging control of each slide to the carousel.&#039;, &#039;geodirectory&#039; ),
			&#039;options&#039; =&gt; array(
				&#039;&#039; =&gt; __( &#039;No&#039;, &#039;geodirectory&#039; ),
				&#039;1&#039; =&gt; __( &#039;Yes&#039;, &#039;geodirectory&#039; )
			),
			&#039;default&#039; =&gt; &#039;&#039;,
			&#039;desc_tip&#039; =&gt; false,
			&#039;advanced&#039; =&gt; false,
			&#039;element_require&#039; =&gt; &#039;[%with_carousel%]==&quot;1&quot;&#039;,
			&#039;group&#039; =&gt; __( &#039;Carousel&#039;, &#039;geodirectory&#039; )
		);

		$arguments[&#039;slide_interval&#039;] = array(
			&#039;type&#039; =&gt; &#039;number&#039;,
			&#039;title&#039; =&gt; __( &#039;Interval:&#039;, &#039;geodirectory&#039; ),
			&#039;desc&#039; =&gt; __( &#039;The amount of time in seconds to delay between automatically cycling an listing item. If 0, carousel will not automatically cycle.&#039;, &#039;geodirectory&#039; ),
			&#039;default&#039; =&gt; &#039;5&#039;,
			&#039;desc_tip&#039; =&gt; false,
			&#039;advanced&#039; =&gt; false,
			&#039;element_require&#039; =&gt; &#039;[%with_carousel%]==&quot;1&quot;&#039;,
			&#039;group&#039; =&gt; __( &#039;Carousel&#039;, &#039;geodirectory&#039; )
		);

		$arguments[&#039;slide_ride&#039;] = array(
			&#039;type&#039; =&gt; &#039;select&#039;,
			&#039;title&#039; =&gt; __( &#039;Autoplay:&#039;, &#039;geodirectory&#039; ),
			&#039;desc&#039; =&gt; __( &#039;Autoplays the carousel after the user manually cycles the first slide. If &quot;carousel&quot;, autoplays the carousel on page load automatically.&#039;, &#039;geodirectory&#039; ),
			&#039;options&#039; =&gt; array(
				&#039;&#039; =&gt; __( &#039;Default (Auto)&#039;, &#039;geodirectory&#039; ),
				&#039;click&#039; =&gt; __( &#039;On Click&#039;, &#039;geodirectory&#039; ),
				&#039;auto&#039; =&gt; __( &#039;Auto&#039;, &#039;geodirectory&#039; )
			),
			&#039;default&#039; =&gt; &#039;&#039;,
			&#039;desc_tip&#039; =&gt; false,
			&#039;advanced&#039; =&gt; false,
			&#039;element_require&#039; =&gt; &#039;[%with_carousel%]==&quot;1&quot;&#039;,
			&#039;group&#039; =&gt; __( &#039;Carousel&#039;, &#039;geodirectory&#039; )
		);

	    /*
		 * Elementor Pro features below here
		 */
	    if(defined( &#039;ELEMENTOR_PRO_VERSION&#039; )){
		    $arguments[&#039;skin_id&#039;] = array(
			    &#039;title&#039; =&gt; __( &quot;Elementor Skin&quot;, &#039;geodirectory&#039; ),
			    &#039;desc&#039; =&gt; &#039;&#039;,
			    &#039;type&#039; =&gt; &#039;select&#039;,
			    &#039;options&#039; =&gt;  GeoDir_Elementor::get_elementor_pro_skins(),
			    &#039;default&#039;  =&gt; &#039;&#039;,
			    &#039;desc_tip&#039; =&gt; false,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
		    );

		    $arguments[&#039;skin_column_gap&#039;] = array(
			    &#039;title&#039; =&gt; __(&#039;Skin column gap&#039;, &#039;geodirectory&#039;),
			    &#039;desc&#039; =&gt; __(&#039;The px value for the column gap.&#039;, &#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;number&#039;,
			    &#039;default&#039;  =&gt; &#039;30&#039;,
			    &#039;desc_tip&#039; =&gt; true,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
		    );
		    $arguments[&#039;skin_row_gap&#039;] = array(
			    &#039;title&#039; =&gt; __(&#039;Skin row gap&#039;, &#039;geodirectory&#039;),
			    &#039;desc&#039; =&gt; __(&#039;The px value for the row gap.&#039;, &#039;geodirectory&#039;),
			    &#039;type&#039; =&gt; &#039;number&#039;,
			    &#039;default&#039;  =&gt; &#039;35&#039;,
			    &#039;desc_tip&#039; =&gt; true,
			    &#039;advanced&#039; =&gt; false,
			    &#039;group&#039;     =&gt; __(&quot;Design&quot;,&quot;geodirectory&quot;)
		    );
	    }
	    
	    return $arguments;
    }


    /**
     * The Super block output function.
     *
     * @param array $instance Settings for the current widget instance.
     * @param array $widget_args
     * @param string $content
     *
     * @return mixed|string|void
     */
    public function output( $instance = array(), $widget_args = array(), $content = &#039;&#039; ) {
        $instance = wp_parse_args(
			(array)$instance,
            array(&#039;title&#039; =&gt; &#039;&#039;,
                  &#039;post_type&#039; =&gt; &#039;&#039;,
                  &#039;category&#039; =&gt; array(),
				  &#039;related_to&#039; =&gt; &#039;&#039;,
				  &#039;tags&#039; =&gt; &#039;&#039;,
				  &#039;post_author&#039; =&gt; &#039;&#039;,
                  &#039;category_title&#039; =&gt; &#039;&#039;,
                  &#039;sort_by&#039; =&gt; &#039;az&#039;,
                  &#039;title_tag&#039; =&gt; &#039;h3&#039;,
                  &#039;list_order&#039; =&gt; &#039;&#039;,
                  &#039;post_limit&#039; =&gt; &#039;5&#039;,
                  &#039;post_ids&#039; =&gt; &#039;&#039;,
                  &#039;layout&#039; =&gt; &#039;2&#039;,
                  &#039;listing_width&#039; =&gt; &#039;&#039;,
                  &#039;add_location_filter&#039; =&gt; &#039;1&#039;,
                  &#039;character_count&#039; =&gt; &#039;20&#039;,
                  &#039;show_featured_only&#039; =&gt; &#039;&#039;,
                  &#039;show_special_only&#039; =&gt; &#039;&#039;,
                  &#039;with_pics_only&#039; =&gt; &#039;&#039;,
                  &#039;with_videos_only&#039; =&gt; &#039;&#039;,
                  &#039;show_favorites_only&#039; =&gt; &#039;&#039;,
                  &#039;favorites_by_user&#039; =&gt; &#039;&#039;,
                  &#039;use_viewing_post_type&#039; =&gt; &#039;&#039;,
                  &#039;use_viewing_term&#039; =&gt; &#039;&#039;,
                  &#039;hide_if_empty&#039; =&gt; &#039;&#039;,
				  &#039;view_all_link&#039; =&gt; &#039;1&#039;,
				  &#039;with_pagination&#039; =&gt; &#039;0&#039;,
				  &#039;top_pagination&#039; =&gt; &#039;0&#039;,
				  &#039;bottom_pagination&#039; =&gt; &#039;1&#039;,
				  &#039;pagination_info&#039; =&gt; &#039;&#039;,
	            // elementor settings
	              &#039;skin_id&#039; =&gt; &#039;&#039;,
	              &#039;skin_column_gap&#039; =&gt; &#039;&#039;,
	              &#039;skin_row_gap&#039; =&gt; &#039;&#039;,
	            // AUI settings
	              &#039;column_gap&#039;  =&gt; &#039;&#039;,
	              &#039;row_gap&#039;  =&gt; &#039;&#039;,
	              &#039;card_border&#039;  =&gt; &#039;&#039;,
	              &#039;card_shadow&#039;  =&gt; &#039;&#039;,
	              &#039;bg&#039;    =&gt; &#039;&#039;,
	              &#039;mt&#039;    =&gt; &#039;&#039;,
	              &#039;mb&#039;    =&gt; &#039;3&#039;,
	              &#039;mr&#039;    =&gt; &#039;&#039;,
	              &#039;ml&#039;    =&gt; &#039;&#039;,
	              &#039;pt&#039;    =&gt; &#039;&#039;,
	              &#039;pb&#039;    =&gt; &#039;&#039;,
	              &#039;pr&#039;    =&gt; &#039;&#039;,
	              &#039;pl&#039;    =&gt; &#039;&#039;,
	              &#039;border&#039;    =&gt; &#039;&#039;,
	              &#039;rounded&#039;    =&gt; &#039;&#039;,
	              &#039;rounded_size&#039;    =&gt; &#039;&#039;,
	              &#039;shadow&#039;    =&gt; &#039;&#039;,
				  &#039;with_carousel&#039; =&gt; &#039;&#039;,
				  &#039;with_controls&#039; =&gt; &#039;&#039;,
				  &#039;with_indicators&#039; =&gt; &#039;&#039;,
				  &#039;slide_interval&#039; =&gt; &#039;5&#039;,
				  &#039;slide_ride&#039; =&gt; &#039;&#039;
            )
        );

        ob_start();

        $this-&gt;output_html( $widget_args, $instance );

        return ob_get_clean();
    }


    /**
     * Generates popular postview HTML.
     *
     * @since   1.0.0
     * @since   1.5.1 View all link fixed for location filter disabled.
     * @since   1.6.24 View all link should go to search page with near me selected.
     * @package GeoDirectory
     * @global object $post                    The current post object.
     * @global string $gd_layout_class The girdview style of the listings for widget.
     * @global bool $geodir_is_widget_listing  Is this a widget listing?. Default: false.
     * @global bool $geodir_carousel_open  Check whether widget has carousel or not.
     *
     * @param array|string $args               Display arguments including before_title, after_title, before_widget, and
     *                                         after_widget.
     * @param array|string $instance           The settings for the particular instance of the widget.
     */
    public function output_html( $args = &#039;&#039;, $instance = &#039;&#039; ) {
        global $wp, $geodirectory, $gd_post, $post, $gd_advanced_pagination, $posts_per_page, $paged, $geodir_ajax_gd_listings, $geodir_carousel_open;

		$is_single = ( geodir_is_page( &#039;single&#039; ) || ! empty( $instance[&#039;set_post&#039;] ) ) &amp;&amp; ! empty( $gd_post ) ? true : false;

		// Prints the widget
		extract( $args, EXTR_SKIP );

		/** This filter is documented in includes/widget/class-geodir-widget-advance-search.php.php */
		$title = empty( $instance[&#039;title&#039;] ) ? geodir_ucwords( $instance[&#039;category_title&#039;] ) : apply_filters( &#039;widget_title&#039;, __( $instance[&#039;title&#039;], &#039;geodirectory&#039; ) );
		/**
		 * Filter the widget post type.
		 *
		 * @since 1.0.0
		 *
		 * @param string $instance [&#039;post_type&#039;] Post type of listing.
		 */
		$post_type = empty( $instance[&#039;post_type&#039;] ) ? &#039;gd_place&#039; : apply_filters( &#039;widget_post_type&#039;, $instance[&#039;post_type&#039;] );
		/**
		 * Filter the widget&#039;s term.
		 *
		 * @since 1.0.0
		 *
		 * @param string $instance [&#039;category&#039;] Filter by term. Can be any valid term.
		 */
		$category = empty( $instance[&#039;category&#039;] ) ? &#039;0&#039; : apply_filters( &#039;widget_category&#039;, $instance[&#039;category&#039;] );
		/**
		 * Filter the widget related_to param.
		 *
		 * @since 2.0.0
		 *
		 * @param string $instance [&#039;related_to&#039;] Filter by related to categories/tags.
		 */
		$related_to = empty( $instance[&#039;related_to&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_related_to&#039;, ( $is_single ? $instance[&#039;related_to&#039;] : &#039;&#039; ), $instance, $this-&gt;id_base );
		/**
		 * Filter the widget tags param.
		 *
		 * @since 2.0.0
		 *
		 * @param string $instance [&#039;tags&#039;] Filter by tags.
		 */
		$tags = empty( $instance[&#039;tags&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_tags&#039;, $instance[&#039;tags&#039;], $instance, $this-&gt;id_base );
		/**
         * Filter the widget post_author param.
         *
         * @since 2.0.0
         *
         * @param string $instance [&#039;post_author&#039;] Filter by author.
         */
        $post_author = empty( $instance[&#039;post_author&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_post_author&#039;, $instance[&#039;post_author&#039;], $instance, $this-&gt;id_base );
        /**
         * Filter the widget listings limit.
         *
         * @since 1.0.0
         *
         * @param string $instance [&#039;post_number&#039;] Number of listings to display.
         */
        $post_number = empty( $instance[&#039;post_limit&#039;] ) ? &#039;5&#039; : apply_filters( &#039;widget_post_number&#039;, $instance[&#039;post_limit&#039;] );
	    /**
	     * Filter the widget listings post ids.
	     *
	     * @since 1.0.0
	     *
	     * @param string $instance [&#039;post_ids&#039;] Post ids to include or exclude.
	     */
	    $post_ids = empty( $instance[&#039;post_ids&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_post_ids&#039;, $instance[&#039;post_ids&#039;] );
        /**
         * Filter widget&#039;s &quot;layout&quot; type.
         *
         * @since 1.0.0
         *
         * @param string $instance [&#039;layout&#039;] Widget layout type.
         */
        $layout = !isset( $instance[&#039;layout&#039;] )  ? geodir_grid_view_class(0) : apply_filters( &#039;widget_layout&#039;, $instance[&#039;layout&#039;] );
        /**
         * Filter widget&#039;s &quot;add_location_filter&quot; value.
         *
         * @since 1.0.0
         *
         * @param string|bool $instance [&#039;add_location_filter&#039;] Do you want to add location filter? Can be 1 or 0.
         */
        $add_location_filter = empty( $instance[&#039;add_location_filter&#039;] ) ? &#039;0&#039; : apply_filters( &#039;widget_add_location_filter&#039;, $instance[&#039;add_location_filter&#039;] );
        /**
         * Filter widget&#039;s listing width.
         *
         * @since 1.0.0
         *
         * @param string $instance [&#039;listing_width&#039;] Listing width.
         */
        $listing_width = empty( $instance[&#039;listing_width&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_listing_width&#039;, $instance[&#039;listing_width&#039;] );
        /**
         * Filter widget&#039;s &quot;list_sort&quot; type.
         *
         * @since 1.0.0
         *
         * @param string $instance [&#039;list_sort&#039;] Listing sort by type.
         */
        $list_sort             = empty( $instance[&#039;sort_by&#039;] ) ? &#039;latest&#039; : apply_filters( &#039;widget_list_sort&#039;, $instance[&#039;sort_by&#039;] );
		/**
		 * Filter widget&#039;s &quot;title_tag&quot; type.
		 *
		 * @since 1.6.26
		 *
		 * @param string $instance [&#039;title_tag&#039;] Listing title tag.
		 */
		$title_tag            = empty( $instance[&#039;title_tag&#039;] ) ? &#039;h3&#039; : apply_filters( &#039;widget_title_tag&#039;, $instance[&#039;title_tag&#039;] );
		/**
		 * Filter widget&#039;s &quot;show_favorites_only&quot; type.
		 *
		 * @since 1.6.26
		 *
		 * @param string $instance [&#039;show_favorites_only&#039;] Listing show favorites only.
		 */
		$show_favorites_only = empty( $instance[&#039;show_favorites_only&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_show_favorites_only&#039;, absint( $instance[&#039;show_favorites_only&#039;] ), $instance, $this-&gt;id_base );
		/**
		 * Filter the widget favorites_by_user param.
		 *
		 * @since 2.0.0
		 *
		 * @param string $instance [&#039;favorites_by_user&#039;] Filter favorites by user.
		 */
		$favorites_by_user = empty( $instance[&#039;favorites_by_user&#039;] ) || empty( $show_favorites_only ) ? &#039;&#039; : apply_filters( &#039;widget_favorites_by_user&#039;, $instance[&#039;favorites_by_user&#039;], $instance, $this-&gt;id_base );

		/**
		 * Filter the widget skin_id param.
		 *
		 * @since 2.0.0.86
		 *
		 * @param string $instance [&#039;skin_id&#039;] Filter skin_id.
		 */
		$skin_id = empty( $instance[&#039;skin_id&#039;] ) ? &#039;&#039; : apply_filters( &#039;widget_skin_id&#039;, $instance[&#039;skin_id&#039;], $instance, $this-&gt;id_base );

	    $design_style = !empty($args[&#039;design_style&#039;]) ? esc_attr($args[&#039;design_style&#039;]) : geodir_design_style();

		if ( ! empty( $instance[&#039;with_carousel&#039;] ) ) {
			$instance[&#039;with_pagination&#039;] = false;
			$instance[&#039;view_all_link&#039;] = false;
		}

	    $view_all_link = ! empty( $instance[&#039;view_all_link&#039;] ) ? true : false;
        $use_viewing_post_type = ! empty( $instance[&#039;use_viewing_post_type&#039;] ) ? true : false;
		$use_viewing_term = ! empty( $instance[&#039;use_viewing_term&#039;] ) ? true : false;
		$shortcode_atts = ! empty( $instance[&#039;shortcode_atts&#039;] ) ? $instance[&#039;shortcode_atts&#039;] : array();
		$top_pagination = ! empty( $instance[&#039;with_pagination&#039;] ) &amp;&amp; ! empty( $instance[&#039;top_pagination&#039;] ) ? true : false;
		$bottom_pagination = ! empty( $instance[&#039;with_pagination&#039;] ) &amp;&amp; ! empty( $instance[&#039;bottom_pagination&#039;] ) ? true : false;
		$pagination_info = ! empty( $instance[&#039;with_pagination&#039;] ) &amp;&amp; ! empty( $instance[&#039;pagination_info&#039;] ) ? $instance[&#039;pagination_info&#039;] : &#039;&#039;;
		$pageno = ! empty( $instance[&#039;pageno&#039;] ) ? absint( $instance[&#039;pageno&#039;] ) : 1;
		if ( $pageno &lt; 1 ) {
			$pageno = 1;
		}

		// set post type to current viewing post type
		if ( $use_viewing_post_type ) {
			$current_post_type = geodir_get_current_posttype();
			if ( $current_post_type != &#039;&#039; &amp;&amp; $current_post_type != $post_type ) {
				$post_type = $current_post_type;
				$category  = array(); // old post type category will not work for current changed post type
			}
		}
		if ( ( $related_to == &#039;default_category&#039; || $related_to == &#039;category&#039; || $related_to == &#039;tags&#039; ) &amp;&amp; ! empty( $gd_post-&gt;ID ) ) {
			if ( $post_type != $gd_post-&gt;post_type ) {
				$post_type = $gd_post-&gt;post_type;
				$category = array();
			}
		}

		// check its a GD post type, if not then bail
		if ( ! geodir_is_gd_post_type( $post_type ) ) {
			return &#039;&#039;;
		}

		// Filter posts by current terms on category/tag/search archive pages.
		if ( $use_viewing_term ) {
			if ( is_tax() &amp;&amp; ( $queried_object = get_queried_object() ) ) {
				if ( ! empty( $queried_object-&gt;taxonomy ) ) {
					if ( $queried_object-&gt;taxonomy == $post_type . &#039;category&#039; ) {
						$category = $queried_object-&gt;term_id;
						$instance[&#039;category&#039;] = $category;
					} elseif ( $queried_object-&gt;taxonomy == $post_type . &#039;_tags&#039; ) {
						$tags = $queried_object-&gt;name;
						$instance[&#039;tags&#039;] = $tags;
					}
				}
			}

			if ( geodir_is_page( &#039;search&#039; ) &amp;&amp; ! empty( $_REQUEST[&#039;stype&#039;] ) &amp;&amp; $_REQUEST[&#039;stype&#039;] == $post_type &amp;&amp; isset( $_REQUEST[&#039;spost_category&#039;] ) &amp;&amp; ( ( is_array( $_REQUEST[&#039;spost_category&#039;] ) &amp;&amp; ! empty( $_REQUEST[&#039;spost_category&#039;][0] ) ) || ( ! is_array( $_REQUEST[&#039;spost_category&#039;] ) &amp;&amp; ! empty( $_REQUEST[&#039;spost_category&#039;] ) ) ) ) {
				if ( is_array( $_REQUEST[&#039;spost_category&#039;] ) ) {
					$_post_category = array_map( &#039;absint&#039;, $_REQUEST[&#039;spost_category&#039;] );
				} else {
					$_post_category = array( absint( $_REQUEST[&#039;spost_category&#039;] ) );
				}
				$category = implode( &#039;,&#039;, $_post_category );
				$instance[&#039;category&#039;] = $category;
			}
		}

		// replace widget title dynamically
		$posttype_plural_label   = __( geodir_get_post_type_plural_label( $post_type ), &#039;geodirectory&#039; );
		$posttype_singular_label = __( geodir_get_post_type_singular_label( $post_type ), &#039;geodirectory&#039; );

		$title = str_replace( &quot;%posttype_plural_label%&quot;, $posttype_plural_label, $title );
		$title = str_replace( &quot;%posttype_singular_label%&quot;, $posttype_singular_label, $title );

		$category_taxonomy = $post_type . &#039;category&#039;;
		$category = is_array( $category ) ? $category : explode( &quot;,&quot;, $category ); // convert to array
		$category = apply_filters( &#039;geodir_filter_query_var_categories&#039;, $category, $post_type );
		$categories = $category;

		if ( isset( $instance[&#039;character_count&#039;] ) ) {
			/**
			 * Filter the widget&#039;s excerpt character count.
			 *
			 * @since 1.0.0
			 *
			 * @param int $instance [&#039;character_count&#039;] Excerpt character count.
			 */
			$character_count = apply_filters( &#039;widget_list_character_count&#039;, $instance[&#039;character_count&#039;] );
		} else {
			$character_count = &#039;&#039;;
		}

		if ( empty( $title ) || $title == &#039;All&#039; ) {
			$title .= &#039; &#039; . __( geodir_get_post_type_plural_label( $post_type ), &#039;geodirectory&#039; );
		}

		$location_allowed = GeoDir_Post_types::supports( $post_type, &#039;location&#039; );

		if ( $location_allowed &amp;&amp; $add_location_filter &amp;&amp; ( $user_lat = get_query_var( &#039;user_lat&#039; ) ) &amp;&amp; ( $user_lon = get_query_var( &#039;user_lon&#039; ) ) &amp;&amp; geodir_is_page( &#039;location&#039; ) ) {
			$viewall_url = add_query_arg( array(
				&#039;geodir_search&#039; =&gt; 1,
				&#039;stype&#039; =&gt; $post_type,
				&#039;s&#039; =&gt; &#039;&#039;,
				&#039;snear&#039; =&gt; __( &#039;Near:&#039;, &#039;geodirectory&#039; ) . &#039; &#039; . __( &#039;Me&#039;, &#039;geodirectory&#039; ),
				&#039;sgeo_lat&#039; =&gt; $user_lat,
				&#039;sgeo_lon&#039; =&gt; $user_lon
			), geodir_search_page_base_url() );

			if ( ! empty( $category ) &amp;&amp; !in_array( &#039;0&#039;, $category ) ) {
				$viewall_url = add_query_arg( array( &#039;s&#039; . $post_type . &#039;category&#039; =&gt; $category ), $viewall_url );
			}
		} else {
			$viewall_url = get_post_type_archive_link( $post_type );

			if ( ! empty( $category ) &amp;&amp; $category[0] != &#039;0&#039; ) {
				global $geodir_add_location_url;

				$geodir_add_location_url = &#039;0&#039;;

				if ( $add_location_filter != &#039;0&#039; ) {
					$geodir_add_location_url = &#039;1&#039;;
				}

				$viewall_url = get_term_link( (int) $category[0], $post_type . &#039;category&#039; );

				$geodir_add_location_url = null;
			}
		}

		if ( is_wp_error( $viewall_url ) ) {
			$viewall_url = &#039;&#039;;
		}

		$distance_to_post = $list_sort == &#039;distance_asc&#039; &amp;&amp; ! empty( $gd_post-&gt;latitude ) &amp;&amp; ! empty( $gd_post-&gt;longitude ) &amp;&amp; $is_single ? true : false;

		if ( $list_sort == &#039;distance_asc&#039; &amp;&amp; ! $distance_to_post ) {
			$list_sort = geodir_get_posts_default_sort( $post_type );
		}

		 $query_args = array(
			&#039;posts_per_page&#039; =&gt; $post_number,
			&#039;is_geodir_loop&#039; =&gt; true,
			&#039;gd_location&#039;    =&gt; $add_location_filter ? true : false,
			&#039;post_type&#039;      =&gt; $post_type,
			&#039;order_by&#039;       =&gt; $list_sort,
			&#039;distance_to_post&#039; =&gt; $distance_to_post,
			&#039;pageno&#039;         =&gt; $pageno,
			&#039;is_gd_author&#039;   =&gt; ! empty( $instance[&#039;is_gd_author&#039;] ) || geodir_is_page( &#039;author&#039; )
		);

		// Post_number needs to be a positive integer
		if ( ! empty( $post_author ) ) {
			// &#039;current&#039; left for backwards compatibility
			if ( $post_author == &#039;current&#039; || $post_author == &#039;current_author&#039; ) {
				if ( ! empty( $post ) &amp;&amp; $post-&gt;post_type != &#039;page&#039; &amp;&amp; isset( $post-&gt;post_author ) ) {
					$query_args[&#039;post_author&#039;] = $post-&gt;post_author;
				} else {
					$query_args[&#039;post_author&#039;] = -1; // Don&#039;t show any listings.
				}
			} else if ( $post_author == &#039;current_user&#039; ) {
				if ( is_user_logged_in() &amp;&amp; ( $current_user_id = get_current_user_id() ) ) {
					$query_args[&#039;post_author&#039;] = $current_user_id;
				} else {
					$query_args[&#039;post_author&#039;] = -1; // If not logged in then don&#039;t show any listings.
				}
			} else if ( absint( $post_author ) &gt; 0) {
				$query_args[&#039;post_author&#039;] = absint( $post_author );
			} else {
				$query_args[&#039;post_author&#039;] = -1; // Don&#039;t show any listings.
			}
		}

		// Posts favorited by user.
		if ( ! empty( $show_favorites_only ) ) {
			if ( empty( $favorites_by_user ) ) {
				$favorites_by_user = &#039;current_user&#039;;
			}

			// &#039;current&#039; left for backwards compatibility
			if ( $favorites_by_user == &#039;current&#039; || $favorites_by_user == &#039;current_author&#039; ) {
				if ( ! empty( $post ) &amp;&amp; $post-&gt;post_type != &#039;page&#039; &amp;&amp; isset( $post-&gt;post_author ) ) {
					$query_args[&#039;favorites_by_user&#039;] = $post-&gt;post_author;
				} else {
					$query_args[&#039;favorites_by_user&#039;] = -1; // Don&#039;t show any listings.
				}
			} else if ( $favorites_by_user == &#039;current_user&#039; ) {
				if ( is_user_logged_in() &amp;&amp; ( $current_user_id = get_current_user_id() ) ) {
					$query_args[&#039;favorites_by_user&#039;] = $current_user_id;
				} else {
					$query_args[&#039;favorites_by_user&#039;] = -1; // If not logged in then don&#039;t show any listings.
				}
			} else if ( absint( $favorites_by_user ) &gt; 0) {
				$query_args[&#039;favorites_by_user&#039;] = absint( $favorites_by_user );
			} else {
				$query_args[&#039;favorites_by_user&#039;] = -1; // Don&#039;t show any listings.
			}
		}

		if ( $character_count ) {
			$query_args[&#039;excerpt_length&#039;] = $character_count;
		}

		if ( ! empty( $instance[&#039;show_featured_only&#039;] ) ) {
			$query_args[&#039;show_featured_only&#039;] = 1;
		}

		if ( ! empty( $instance[&#039;show_special_only&#039;] ) ) {
			$query_args[&#039;show_special_only&#039;] = 1;
		}

		if ( ! empty( $instance[&#039;with_pics_only&#039;] ) || ! empty( $instance[&#039;featured_image_only&#039;] ) ) {
			$query_args[&#039;with_pics_only&#039;]      = 0;
			$query_args[&#039;featured_image_only&#039;] = 1;
		}

		if ( ! empty( $instance[&#039;with_videos_only&#039;] ) ) {
			$query_args[&#039;with_videos_only&#039;] = 1;
		}
		$hide_if_empty = ! empty( $instance[&#039;hide_if_empty&#039;] ) ? true : false;

		if ( ! empty( $categories ) &amp;&amp; $categories[0] != &#039;0&#039; ) {
			$tax_query = array(
				&#039;taxonomy&#039; =&gt; $category_taxonomy,
				&#039;field&#039;    =&gt; &#039;id&#039;,
				&#039;terms&#039;    =&gt; $category
			);

			$query_args[&#039;tax_query&#039;] = array( $tax_query );
		}

		if ( ( $related_to == &#039;default_category&#039; || $related_to == &#039;category&#039; || $related_to == &#039;tags&#039; ) &amp;&amp; ! empty( $gd_post-&gt;ID ) ) {
			$terms = array();
			$term_field = &#039;id&#039;;
			$term_taxonomy = $post_type . &#039;category&#039;; 
			if ( $related_to == &#039;category&#039; &amp;&amp; ! empty( $gd_post-&gt;post_category ) ) {
				$terms = explode( &#039;,&#039;, trim( $gd_post-&gt;post_category, &#039;,&#039; ) );
			} else if ( $related_to == &#039;tags&#039; &amp;&amp; ! empty( $gd_post-&gt;post_tags ) ) {
				$term_taxonomy = $post_type . &#039;_tags&#039;; 
				$term_field = &#039;name&#039;;
				$terms = explode( &#039;,&#039;, trim( $gd_post-&gt;post_tags, &#039;,&#039; ) );
			}elseif($related_to == &#039;default_category&#039; &amp;&amp; !empty($gd_post-&gt;default_category)){
				$terms = absint($gd_post-&gt;default_category);
			}
			$query_args[&#039;post__not_in&#039;] = $gd_post-&gt;ID;

			$query_args[&#039;tax_query&#039;] = array( 
				array(
					&#039;taxonomy&#039; =&gt; $term_taxonomy,
					&#039;field&#039;    =&gt; $term_field,
					&#039;terms&#039;    =&gt; $terms
				)
			);
		} elseif ( $is_single &amp;&amp; empty( $instance[&#039;franchise_of&#039;] ) ) { 
			$query_args[&#039;post__not_in&#039;] = $gd_post-&gt;ID;
		}

		// Clean tags
		if ( ! empty( $tags ) ) {
			if ( ! is_array( $tags ) ) {
				$comma = _x( &#039;,&#039;, &#039;tag delimiter&#039; );

				if ( &#039;,&#039; !== $comma ) {
					$tags = str_replace( $comma, &#039;,&#039;, $tags );
				}
				$tags = explode(&#039;,&#039;, trim( $tags, &quot; \n\t\r\0\x0B,&quot; ) );
				$tags = array_map( &#039;trim&#039;, $tags );
			}

			if ( ! empty( $tags ) ) {
				$tag_query = array(
					&#039;taxonomy&#039; =&gt; $post_type . &#039;_tags&#039;,
					&#039;field&#039; =&gt; &#039;name&#039;,
					&#039;terms&#039; =&gt; $tags
				);

				if ( ! empty( $query_args[&#039;tax_query&#039;] ) ) {
					$query_args[&#039;tax_query&#039;][] = $tag_query;
				} else {
					$query_args[&#039;tax_query&#039;] = array( $tag_query );
				}
			}
		}

		// $post_ids, include or exclude post ids
		if ( ! empty( $post_ids ) ) {
			$post__not_in = array();
			$post__in = array();
			$post_ids = explode( &quot;,&quot;, $post_ids );

			foreach ( $post_ids as $pid ) {
				$tmp_id = trim( $pid );
				if ( abs( $tmp_id ) != $tmp_id ) {
					$post__not_in[] = absint( $tmp_id );
				} else {
					$post__in[] = absint( $tmp_id );
				}
			}

			if ( ! empty( $post__in ) ) {
				$query_args[&#039;post__in&#039;] = implode( &quot;,&quot;, $post__in );
			} elseif ( ! empty( $post__not_in ) ) {
				if ( ! empty( $query_args[&#039;post__not_in&#039;] ) ) {
					$post__not_in[] = $query_args[&#039;post__not_in&#039;];
				}
				$query_args[&#039;post__not_in&#039;] = implode( &quot;,&quot;, $post__not_in );
			}
		}

		global $geodir_widget_cpt, $gd_layout_class, $geodir_is_widget_listing;

		/*
		 * Filter widget listings query args.
		 */
		$query_args = apply_filters( &#039;geodir_widget_listings_query_args&#039;, $query_args, $instance );

		$query_args[&#039;country&#039;] = isset($instance[&#039;country&#039;]) ? $instance[&#039;country&#039;] : &#039;&#039;;
		$query_args[&#039;region&#039;] = isset($instance[&#039;region&#039;]) ? $instance[&#039;region&#039;] : &#039;&#039;;
		$query_args[&#039;city&#039;] = isset($instance[&#039;city&#039;]) ? $instance[&#039;city&#039;] : &#039;&#039;;

		$post_count = geodir_get_widget_listings( $query_args, true );

		if ( $hide_if_empty &amp;&amp; empty( $post_count ) ) {
			return;
		}

		$widget_listings = geodir_get_widget_listings( $query_args );

		// Filter post title tag.
		$this-&gt;post_title_tag = $title_tag;
		add_filter( &#039;geodir_widget_gd_post_title_tag&#039;, array( $this, &#039;filter_post_title_tag&#039; ), 10, 4 );

		$gd_layout_class = geodir_convert_listing_view_class( $layout );

		$class = $top_pagination || $bottom_pagination ? &#039; geodir-wgt-pagination&#039; : &#039;&#039;;
		if ( $top_pagination ) {
			$class .= &#039; geodir-wgt-pagination-top&#039;;
		}
		if ( $bottom_pagination ) {
			$class .= &#039; geodir-wgt-pagination-bottom&#039;;
		}

	    // card border class
	    $card_border_class = &#039;&#039;;
	    if(!empty($instance[&#039;card_border&#039;])){
		    if($instance[&#039;card_border&#039;]==&#039;none&#039;){
			    $card_border_class = &#039;border-0&#039;;
		    }else{
			    $card_border_class = &#039;border-&#039;.sanitize_html_class($instance[&#039;card_border&#039;]);
		    }
	    }

	    // card shadow
	    $card_shadow_class = &#039;&#039;;
	    if(!empty($instance[&#039;card_shadow&#039;])){
		    if($instance[&#039;card_shadow&#039;]==&#039;small&#039;){
			    $card_shadow_class = &#039;shadow-sm&#039;;
		    }elseif($instance[&#039;card_shadow&#039;]==&#039;medium&#039;){
			    $card_shadow_class = &#039;shadow&#039;;
		    }elseif($instance[&#039;card_shadow&#039;]==&#039;large&#039;){
			    $card_shadow_class = &#039;shadow-lg&#039;;
		    }
	    }

		$backup_posts_per_page = $posts_per_page;
		$backup_paged = $paged;
		$backup_gd_advanced_pagination = $gd_advanced_pagination;

		$geodir_widget_cpt = $post_type;
		$posts_per_page = $post_number;
		$paged = $pageno;
		$gd_advanced_pagination = $pagination_info;
		$unique_id = &#039;geodir_&#039; . uniqid();
		$wrapper_attrs = &#039;&#039;;

		// Carousel
		$carousel_items = absint( $layout );
		$carousel_row = &#039;#&#039; . $unique_id . &#039; .row&#039;;
		$geodir_carousel_open = ! empty( $instance[&#039;with_carousel&#039;] ) ? true : false;
		if ( ! empty( $instance[&#039;with_carousel&#039;] ) &amp;&amp; ! empty( $widget_listings ) ) {
			if ( ! geodir_design_style() ) {
				// Enqueue flexslider script.
				GeoDir_Frontend_Scripts::enqueue_script( &#039;jquery-flexslider&#039; );
			}

			$class .= &#039; geodir-posts-carousel&#039;;

			if ( ! empty( $instance[&#039;with_controls&#039;] ) ) {
				$wrapper_attrs .= &#039; data-with-controls=&quot;1&quot;&#039;;
			}

			if ( ! empty( $instance[&#039;with_indicators&#039;] ) ) {
				$wrapper_attrs .= &#039; data-with-indicators=&quot;1&quot;&#039;;
			}

			// Interval
			if ( $instance[&#039;slide_interval&#039;] === &quot;0&quot; ) {
				$slide_interval = &quot;false&quot;;
			} else {
				$slide_interval = ! empty( $instance[&#039;slide_interval&#039;] ) ? geodir_sanitize_float( $instance[&#039;slide_interval&#039;] ) * 1000 : 5000;
			}
			$wrapper_attrs .= &#039; data-interval=&quot;&#039; . $slide_interval . &#039;&quot;&#039;;
			$wrapper_attrs .= &#039; data-ride=&quot;&#039; . ( $instance[&#039;slide_ride&#039;] == &#039;click&#039; ? &#039;false&#039; : &#039;carousel&#039; ) . &#039;&quot;&#039;;

			if ( $carousel_items &lt; 1 ) {
				$carousel_items = 1;
			}

			$wrapper_attrs .= &#039; data-with-items=&quot;&#039; . $carousel_items . &#039;&quot;&#039;;
		}

		// Elementor
		$skin_active = false;
		$elementor_wrapper_class = &#039;&#039;;
		if ( defined( &#039;ELEMENTOR_PRO_VERSION&#039; )  &amp;&amp; $skin_id ) {
			if ( get_post_status ( $skin_id ) == &#039;publish&#039; ) {
				$skin_active = true;
			}

			if ( $skin_active ) {
				$columns = isset( $layout ) ? absint( $layout ) : 1;
				if ( $columns == &#039;0&#039; ) {
					$columns = 6; // we have no 6 row option to lets use list view
				}
				$elementor_wrapper_class = &#039; elementor-element elementor-element-9ff57fdx elementor-posts--thumbnail-top elementor-grid-&#039; . $columns . &#039; elementor-grid-tablet-2 elementor-grid-mobile-1 elementor-widget elementor-widget-posts &#039;;
			}
			$carousel_row = &#039;#&#039; . $unique_id . &#039; .elementor-posts&#039;;
		}

	    // wrap class
	    $class .= &quot; &quot; .geodir_build_aui_class($instance);

	    // preview message
	    $is_preview = $this-&gt;is_preview();
	    if($is_preview &amp;&amp; $design_style){
		    echo aui()-&gt;alert(array(
				    &#039;type&#039;=&gt; &#039;info&#039;,
				    &#039;content&#039;=&gt; __(&quot;This preview shows all content items to give an idea of layout. Dummy data is used in places.&quot;,&quot;geodirectory&quot;)
			    )
		    );
	    }

        ?&gt;
        &lt;div id=&quot;&lt;?php echo $unique_id; ?&gt;&quot; class=&quot;geodir_locations geodir_location_listing&lt;?php echo $class; echo $elementor_wrapper_class; ?&gt; position-relative&quot;&lt;?php echo $wrapper_attrs; ?&gt;&gt;
            &lt;?php
            if ( ! isset( $character_count ) ) {
                /**
                 * Filter the widget&#039;s excerpt character count.
                 *
                 * @since 1.0.0
                 *
                 * @param int $instance [&#039;character_count&#039;] Excerpt character count.
                 */
                $character_count = $character_count == &#039;&#039; ? 50 : apply_filters( &#039;widget_character_count&#039;, $character_count );
            }

			if ( isset( $post ) ) {
				$reset_post = $post;
			}
			if ( isset( $gd_post ) ) {
				$reset_gd_post = $gd_post;
			}
			$geodir_is_widget_listing = true;

			if ( ! empty( $widget_listings ) &amp;&amp; $top_pagination ) {
				self::get_pagination( &#039;top&#039;, $post_count, $post_number, $pageno, $pagination_info );
			}

		    if($skin_active){
			    $column_gap = !empty($instance[&#039;skin_column_gap&#039;]) ? absint($instance[&#039;skin_column_gap&#039;]) : &#039;&#039;;
			    $row_gap = !empty($instance[&#039;skin_row_gap&#039;]) ? absint($instance[&#039;skin_row_gap&#039;]) : &#039;&#039;;
			    geodir_get_template( &#039;elementor/content-widget-listing.php&#039;, array( &#039;widget_listings&#039; =&gt; $widget_listings,&#039;skin_id&#039; =&gt; $skin_id,&#039;columns&#039;=&gt;$columns,&#039;column_gap&#039;=&gt; $column_gap,&#039;row_gap&#039;=&gt;$row_gap ) );
		    }else{

			    $template = $design_style ? $design_style.&quot;/content-widget-listing.php&quot; : &quot;content-widget-listing.php&quot;;

			    echo geodir_get_template_html( $template, array(
				    &#039;widget_listings&#039; =&gt; $widget_listings,
				    &#039;column_gap_class&#039;   =&gt; $instance[&#039;column_gap&#039;] ? &#039;mb-&#039;.absint($instance[&#039;column_gap&#039;]) : &#039;mb-4&#039;,
				    &#039;row_gap_class&#039;   =&gt; $instance[&#039;row_gap&#039;] ? &#039;px-&#039;.absint($instance[&#039;row_gap&#039;]) : &#039;&#039;,
				    &#039;card_border_class&#039;   =&gt; $card_border_class,
				    &#039;card_shadow_class&#039;  =&gt;  $card_shadow_class,
			    ) );
		    }


			if ( ! empty( $widget_listings ) &amp;&amp; ( $bottom_pagination || $top_pagination ) ) {
				if($design_style){
					echo &#039;&lt;div class=&quot;geodir-ajax-listings-loader loading_div overlay overlay-black position-absolute row m-0 z-index-1 w-100 h-100 rounded overflow-hidden&quot; style=&quot;display: none;z-index: 3;top:0;&quot;&gt;
								&lt;div class=&quot;spinner-border mx-auto align-self-center text-white&quot; role=&quot;status&quot;&gt;
									&lt;span class=&quot;sr-only&quot;&gt;&#039;.__(&quot;Loading...&quot;,&quot;geodirectory&quot;).&#039;&lt;/span&gt;
								&lt;/div&gt;
							&lt;/div&gt;&#039;;
				}else{
					echo &#039;&lt;div class=&quot;geodir-ajax-listings-loader&quot; style=&quot;display:none&quot;&gt;&lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;/div&gt;&#039;;
				}

				if ( $bottom_pagination ) {
					self::get_pagination( &#039;bottom&#039;, $post_count, $post_number, $pageno, $pagination_info );
				}
			}

			if ( ! empty( $widget_listings ) &amp;&amp; $view_all_link &amp;&amp; $viewall_url ) {
				/**
				 * Filter view all url.
				 *
				 * @since 2.0.0
				 *
				 * @param string $viewall_url View all url.
				 * @param array $query_args WP_Query args.
				 * @param array $instance Widget settings.
				 * @param array $args Widget arguments.
				 * @param object $this The GeoDir_Widget_Listings object.
				 */
				$viewall_url = apply_filters( &#039;geodir_widget_gd_listings_view_all_url&#039;, $viewall_url, $query_args, $instance, $args, $this );

				if ( $viewall_url ) {
					$view_all_link = &#039;&lt;a href=&quot;&#039; . esc_url( $viewall_url ) .&#039;&quot; class=&quot;geodir-all-link&quot;&gt;&#039; . __( &#039;View all&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/a&gt;&#039;;

					/**
					 * Filter view all link content.
					 *
					 * @since 2.0.0
					 *
					 * @param string $view_all_link View all listings link content.
					 * @param string $viewall_url View all url.
					 * @param array $query_args WP_Query args.
					 * @param array $instance Widget settings.
					 * @param array $args Widget arguments.
					 * @param object $this The GeoDir_Widget_Listings object.
					 */
					$view_all_link = apply_filters( &#039;geodir_widget_gd_listings_view_all_link&#039;, $view_all_link, $viewall_url, $query_args, $instance, $args, $this );

					if($design_style){
						$view_all_link = str_replace(&quot;geodir-all-link&quot;,&quot;geodir-all-link btn btn-outline-primary&quot;,$view_all_link);
						echo &#039;&lt;div class=&quot;geodir-widget-bottom text-center&quot;&gt;&#039; . $view_all_link . &#039;&lt;/div&gt;&#039;;
					}else{
						echo &#039;&lt;div class=&quot;geodir-widget-bottom&quot;&gt;&#039; . $view_all_link . &#039;&lt;/div&gt;&#039;;
					}
				}
			}

			$geodir_is_widget_listing = false;

			if ( isset( $reset_post ) ) {
				if ( ! empty( $reset_post ) ) {
					setup_postdata( $reset_post );
				}
				$post = $reset_post;
			}
			if ( isset( $reset_gd_post ) ) {
				$gd_post = $reset_gd_post;
			}
			if ( ! empty( $widget_listings ) &amp;&amp; ( $top_pagination || $bottom_pagination ) ) {
				$params = array_merge( $instance, $query_args );

				$set_query_vars = (array) $wp-&gt;query_vars;
				if ( isset( $query_args[&#039;tax_query&#039;] ) ) {
					$set_query_vars[&#039;tax_query&#039;] = $query_args[&#039;tax_query&#039;];
				}

				if ( isset( $query_args[&#039;post__in&#039;] ) ) {
					$set_query_vars[&#039;post__in&#039;] = $query_args[&#039;post__in&#039;];
				}

				if ( isset( $query_args[&#039;post__not_in&#039;] ) ) {
					$set_query_vars[&#039;post__not_in&#039;] = $query_args[&#039;post__not_in&#039;];
				}

				$params[&#039;set_query_vars&#039;] = $set_query_vars;

				if ( $is_single ) {
					$params[&#039;set_post&#039;] = $gd_post-&gt;ID;
				}

				if ( ! empty( $_REQUEST[&#039;sgeo_lat&#039;] ) &amp;&amp; ! empty( $_REQUEST[&#039;sgeo_lon&#039;] ) ) {
					$params[&#039;sgeo_lat&#039;] = isset( $_REQUEST[&#039;sgeo_lat&#039;] ) ? filter_var( $_REQUEST[&#039;sgeo_lat&#039;], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION ) : &#039;&#039;;
					$params[&#039;sgeo_lon&#039;] = isset( $_REQUEST[&#039;sgeo_lon&#039;] ) ? filter_var( $_REQUEST[&#039;sgeo_lon&#039;], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION ) : &#039;&#039;;
				}

				foreach ( $params as $key =&gt; $value ) {
					if ( is_scalar( $value ) &amp;&amp; ( $value === true || $value === false ) ) {
						$value = (int) $value;
					}
					$params[ $key ] = $value;
				}

				$params = apply_filters( &#039;geodir_widget_listings_pagination_set_params&#039;, $params, $instance, $this-&gt;id_base );
				?&gt;
				&lt;script type=&quot;text/javascript&quot;&gt;
					/* &lt;![CDATA[ */
					jQuery(function() {try {
						var params = &lt;?php echo json_encode( $params ); ?&gt;;
						params[&#039;action&#039;] = &#039;geodir_widget_listings&#039;;
						params[&#039;widget_args&#039;] = &lt;?php echo json_encode( $args ); ?&gt;;
						params[&#039;security&#039;] = geodir_params.basic_nonce;
						geodir_widget_listings_pagination(&#039;&lt;?php echo $unique_id; ?&gt;&#039;, params);
					} catch (err) {
						console.log(err.message);
					}});
					/* ]]&gt; */
				&lt;/script&gt;
			&lt;?php 
		}
		?&gt;
		&lt;/div&gt;
		&lt;?php 
		if ( $design_style &amp;&amp; ! empty( $instance[&#039;with_carousel&#039;] ) &amp;&amp; ! empty( $widget_listings ) ) { ?&gt;&lt;style&gt;&lt;?php echo $carousel_row; ?&gt;.carousel-item.active,&lt;?php echo $carousel_row; ?&gt;.carousel-item-left,&lt;?php echo $carousel_row; ?&gt;.carousel-item-right{display:flex;}&lt;?php echo $carousel_row; ?&gt;.carousel-item{margin-left:auto;}&lt;/style&gt;
		&lt;?php }

		$geodir_widget_cpt = false;
		$posts_per_page = $backup_posts_per_page;
		$paged = $backup_paged;
		$gd_advanced_pagination = $backup_gd_advanced_pagination;
		$geodir_carousel_open = false;

		remove_filter( &#039;geodir_widget_gd_post_title_tag&#039;, array( $this, &#039;filter_post_title_tag&#039; ), 10, 2 );
	}

    /**
     * Get categories.
     *
     * @since 2.0.0
     *
     * @param string $post_type Optional. Post type. Default gd_place0
     * @return array $options.s
     */
    public function get_categories($post_type = &#039;gd_place&#039;){
	    return geodir_category_options($post_type);
    }

    /**
     * Get sort options.
     *
     * @since 2.0.0
     *
     * @param string $post_type Optional. Post type. Default gd_place.
     * @return array $options.
     */
    public function get_sort_options($post_type = &#039;gd_place&#039;){
        return geodir_sort_by_options($post_type);
    }

	/**
     * Post title tag filter.
     *
     * @since 2.0.0
     *
     * @param string $tag Optional. Title tag.
     * @param array $instance Widget settings.
     * @param array $rags Optional. Widget arguments.
	 * @param object $widget Widget object.
     * @return string $title
     */
	public function filter_post_title_tag( $tag, $instance = array(), $rags = array(), $widget = array() ) {
		if ( ! empty( $this-&gt;post_title_tag ) ) {
			$tag = $this-&gt;post_title_tag;
		}

		return $tag;
	}

	public function ajax_listings( $data = array() ) {
		global $wp, $geodirectory, $post, $gd_post, $geodir_ajax_gd_listings;

		$backup_wp = $wp;
		$geodir_ajax_gd_listings = true;

		$data = apply_filters( &#039;geodir_widget_listings_ajax_listings&#039;, $data );
		
		if ( ! empty( $data[&#039;set_post&#039;] ) ) {
			$post = get_post( absint( $data[&#039;set_post&#039;] ) );
			$gd_post = geodir_get_post_info( absint( $data[&#039;set_post&#039;] ) );
		}

		if ( ! empty( $data[&#039;set_query_vars&#039;] ) &amp;&amp; is_array( $data[&#039;set_query_vars&#039;] ) ) {
			$set_query_vars = array();
			foreach ( $data[&#039;set_query_vars&#039;] as $_key =&gt; $_value ) {
				if ( ! empty( $_key ) &amp;&amp; ( is_scalar( $_value ) || ( ! is_object( $_value ) &amp;&amp; ! is_array( $_value ) ) ) ) {
					$set_query_vars[ sanitize_text_field( $_key ) ] = sanitize_text_field( stripslashes( $_value ) );
				}
			}
			$wp-&gt;query_vars = $set_query_vars;

			add_filter( &#039;geodir_location_set_current_check_404&#039;, array( $this, &#039;set_current_check_404&#039; ), 999, 1 );

			$geodirectory-&gt;location-&gt;set_current();
		}

		ob_start();

		do_action( &#039;geodir_widget_ajax_listings_before&#039;, $data );

		if ( isset( $data[&#039;widget_args&#039;] ) ) {
			$widget_args = (array)$data[&#039;widget_args&#039;];
			unset( $data[&#039;widget_args&#039;] );
		} else {
			$widget_args = array();
		}

		echo $this-&gt;output( $data, $widget_args );

		do_action( &#039;geodir_widget_ajax_listings_after&#039;, $data );

		$output = ob_get_clean();

		$wp = $backup_wp;
		$geodir_ajax_gd_listings = false;

		wp_send_json_success( array( &#039;content&#039; =&gt; trim( $output ) ) );
	}

	public static function get_pagination( $position, $post_count, $post_number, $pageno = 1, $show_advanced = &#039;&#039; ) {
		global $wp_query;

		$backup_wp_query = $wp_query;
		if ( isset( $wp_query-&gt;paged ) ) {
			$backup_paged = $wp_query-&gt;paged;
		}
		if ( isset( $wp_query-&gt;max_num_pages ) ) {
			$backup_max_num_pages = $wp_query-&gt;max_num_pages;
		}
		if ( isset( $wp_query-&gt;found_posts ) ) {
			$backup_found_posts = $wp_query-&gt;found_posts;
		}
		if ( isset( $wp_query-&gt;is_paged ) ) {
			$backup_is_paged = $wp_query-&gt;is_paged;
		}

		$max_num_pages = ceil( $post_count / $post_number );
		set_query_var( &#039;paged&#039;, $pageno );
		$wp_query-&gt;max_num_pages = $max_num_pages;
		$wp_query-&gt;found_posts = $post_count;
		$wp_query-&gt;is_paged = true;

		add_filter( &#039;geodir_pagination_args&#039;, array( __CLASS__, &#039;filter_pagination_args&#039; ), 999999, 1 );

		$shortcode = &#039;[gd_loop_paging mid_size=0 show_advanced=&quot;&#039;.$show_advanced.&#039;&quot;]&#039;;

		$shortcode = apply_filters( &#039;geodir_widget_listings_pagination_shortcode&#039;, $shortcode, $wp_query, $position, $post_number, $show_advanced );

		ob_start();

		echo do_shortcode( $shortcode );

		$pagination = ob_get_clean();

		echo $pagination;

		remove_filter( &#039;geodir_pagination_args&#039;, array( __CLASS__, &#039;filter_pagination_args&#039; ), 999999, 1 );

		$wp_query = $backup_wp_query;
		if ( isset( $backup_paged ) ) {
			set_query_var( &#039;paged&#039;, $backup_paged );
		}
		if ( isset( $backup_max_num_pages ) ) {
			$wp_query-&gt;max_num_pages = $backup_max_num_pages;
		}
		if ( isset( $backup_found_posts ) ) {
			$wp_query-&gt;found_posts = $backup_found_posts;
		}
		if ( isset( $backup_is_paged ) ) {
			$wp_query-&gt;is_paged = $backup_is_paged;
		}
	}

	public static function filter_pagination_args( $pagination_args ) {
		$pagination_args[&#039;base&#039;] = &#039;%_%&#039;;
		$pagination_args[&#039;format&#039;] = &#039;#%#%#&#039;;

		return $pagination_args;
	}

	/**
	 * Get the rest API slug values.
	 *
	 * @return array
	 */
	public function get_rest_slugs_array(){
		$post_types = geodir_get_posttypes(&#039;array&#039;);

//		print_r($post_types);exit;

		$options = array();
		if (!empty($post_types)) {
			foreach ($post_types as $key =&gt; $info) {
				$options[$key] = $info[&#039;rewrite&#039;][&#039;slug&#039;];
			}
		}

		return $options;
	}

	public function set_current_check_404( $check_404 ) {
		return false;
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337338"></script>
    <script src="../js/search.js?updated=1652337338"></script>
</body>
</html>
