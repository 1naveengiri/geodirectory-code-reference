<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652341136">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652341136">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpgeodirectory.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://ayecode.io/careers/" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-admin-report-post-list-table.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDir_Admin_Report_Post_List_Table class
 *
 * @author   AyeCode
 * @package  GeoDirectory
 * @since    2.1.1.12
 */

/**
 * Core class used to implement displaying report posts in a list table.
 *
 *
 * @see WP_List_Table
 */
class GeoDir_Admin_Report_Post_List_Table extends WP_List_Table {

	public $checkbox = true;

	private $user_can;

	/**
	 * Constructor.
	 *
	 * @global int $post_id
	 *
	 * @param array $args An associative array of arguments.
	 */
	public function __construct( $args = array() ) {
		global $post_id;

		$post_id = isset( $_REQUEST[&#039;p&#039;] ) ? absint( $_REQUEST[&#039;p&#039;] ) : 0;

		parent::__construct(
			array(
				&#039;plural&#039;   =&gt; &#039;report-posts&#039;,
				&#039;singular&#039; =&gt; &#039;report-post&#039;,
				&#039;ajax&#039;     =&gt; true
			)
		);
	}

	/**
	 * @return bool
	 */
	public function ajax_user_can() {
		return current_user_can( &#039;manage_options&#039; );
	}

	/**
	 * @global int $post_id
	 *
	 * @return array
	 */
	public function get_columns() {
		$columns = GeoDir_Report_Post::get_admin_columns();

		return $columns;
	}

	/**
	 * Returns the list of columns.
	 *
	 * @access protected
	 *
	 * @return array An associative array containing all the columns that should be sortable.
	 */
	protected function get_sortable_columns() {
		$sortable_columns = array(
			&#039;post_title&#039; =&gt; array( &#039;post_title&#039;, false ),
			&#039;post_author&#039; =&gt; array( &#039;post_author&#039;, false ),
			&#039;post_date&#039; =&gt; array( &#039;post_date&#039;, true ),
			&#039;user_name&#039; =&gt; array( &#039;user_name&#039;, false ),
			&#039;report_date&#039; =&gt; array( &#039;report_date&#039;, true ),
		);
		return $sortable_columns;
	}

	/**
	 * @global int    $post_id
	 * @global string $status
	 * @global string $reason
	 * @global string $search
	 */
	public function prepare_items() {
		global $wpdb, $post_id, $status, $reason, $search;

		$table = GEODIR_POST_REPORTS_TABLE;

		$status = isset( $_REQUEST[&#039;status&#039;] ) ? sanitize_text_field( $_REQUEST[&#039;status&#039;] ) : &#039;pending&#039;;
		if ( ! in_array( $status, array( &#039;all&#039;, &#039;resolved&#039;, &#039;pending&#039;, &#039;rejected&#039; ), true ) ) {
			$status = &#039;pending&#039;;
		}

		$reason = ! empty( $_REQUEST[&#039;reason&#039;] ) ? sanitize_text_field( $_REQUEST[&#039;reason&#039;] ) : &#039;&#039;;
		$search = ( isset( $_REQUEST[&#039;s&#039;] ) ) ? sanitize_text_field( $_REQUEST[&#039;s&#039;] ) : &#039;&#039;;
		$reason = ( isset( $_REQUEST[&#039;reason&#039;] ) ) ? sanitize_text_field( $_REQUEST[&#039;reason&#039;] ) : &#039;&#039;;
		$user_id = ( isset( $_REQUEST[&#039;user_id&#039;] ) ) ? absint( $_REQUEST[&#039;user_id&#039;] ) : &#039;&#039;;
		$orderby = ( isset( $_REQUEST[&#039;orderby&#039;] ) ) ? esc_sql( $_REQUEST[&#039;orderby&#039;] ) : &#039;report_date&#039;;
		$order   = ( isset( $_REQUEST[&#039;order&#039;] ) ) ? esc_sql( $_REQUEST[&#039;order&#039;] ) : &#039;DESC&#039;;

		$reports_per_page = $this-&gt;get_per_page( $status );

		$doing_ajax = wp_doing_ajax();

		$number = ! empty( $_REQUEST[&#039;number&#039;] ) ? absint( $_REQUEST[&#039;number&#039;] ) : $reports_per_page;
		$page = $this-&gt;get_pagenum();

		if ( isset( $_REQUEST[&#039;start&#039;] ) ) {
			$start = absint( $_REQUEST[&#039;start&#039;] );
		} else {
			$start = ( $page - 1 ) * $reports_per_page;
		}

		if ( $doing_ajax &amp;&amp; isset( $_REQUEST[&#039;offset&#039;] ) ) {
			$start += absint( $_REQUEST[&#039;offset&#039;] );
		}

		$args = array(
			&#039;status&#039;    =&gt; $status,
			&#039;search&#039;    =&gt; $search,
			&#039;user_id&#039;   =&gt; $user_id,
			&#039;offset&#039;    =&gt; $start,
			&#039;number&#039;    =&gt; $number,
			&#039;post_id&#039;   =&gt; $post_id,
			&#039;type&#039;      =&gt; $reason,
			&#039;orderby&#039;   =&gt; $orderby,
			&#039;order&#039;     =&gt; $order,
			&#039;reason&#039;    =&gt; $reason,
		);

		/**
		 * Filters the arguments for the report query in the reports list table.
		 *
		 * @since 2.1.1.12
		 *
		 * @param array $args An array of arguments.
		 */
		$args = apply_filters( &#039;geodir_admin_post_reports_list_table_query_args&#039;, $args );

		$where = &quot;&quot;;
		// post_id
		if ( ! empty( $args[&#039;post_id&#039;] ) ) {
			$where .= $wpdb-&gt;prepare( &quot; AND r.post_id = %d&quot;, array( absint( $args[&#039;post_id&#039;] ) ) );
		}

		// status
		if ( ! empty( $args[&#039;status&#039;] ) &amp;&amp; $args[&#039;status&#039;] != &#039;all&#039; ) {
			if ( $args[&#039;status&#039;] == &#039;pending&#039; ) {
				$args[&#039;status&#039;] = &#039;&#039;;
			}
			$where .= $wpdb-&gt;prepare( &quot; AND r.status = %s&quot;, array( $args[&#039;status&#039;] ) );
		}

		// reason
		if ( ! empty( $args[&#039;reason&#039;] ) ) {
			$where .= $wpdb-&gt;prepare( &quot; AND r.reason LIKE %s&quot;, array( $args[&#039;reason&#039;] ) );
		}

		if ( ! empty( $args[&#039;search&#039;] ) ) {
			if ( is_email( $args[&#039;search&#039;] ) ) {
				$where .= $wpdb-&gt;prepare( &quot; AND r.user_email LIKE %s&quot;, array( $args[&#039;search&#039;] ) );
			} else {
				$keyword = &#039;%&#039; . $wpdb-&gt;esc_like( $args[&#039;search&#039;] ) . &#039;%&#039;;
				$where .= $wpdb-&gt;prepare( &quot; AND ( r.user_ip = %s OR r.user_name LIKE %s OR p.post_title LIKE %s OR r.user_email LIKE %s OR r.message LIKE %s )&quot;, array( $args[&#039;search&#039;], $keyword, $keyword, $keyword, $keyword ) );
			}
		}

		$count_sql = &quot;SELECT COUNT(*)&quot;;
		$sql = &quot;SELECT p.post_title, p.post_author, p.post_status, p.post_date, r.*&quot;;
		
		$commmon_sql = &quot;FROM {$table} AS r LEFT JOIN {$wpdb-&gt;posts} AS p ON p.ID = r.post_id WHERE p.ID IS NOT NULL {$where}&quot;;

		$total_items = $wpdb-&gt;get_var( &quot;SELECT COUNT(*) {$commmon_sql}&quot; );

		$_orderby = ! empty( $orderby ) &amp;&amp; ! empty( $order ) ? &quot;ORDER BY {$orderby} {$order}&quot; : &#039;&#039;;
		$_limit = $wpdb-&gt;prepare( &quot;LIMIT %d, %d&quot;, array( $args[&#039;offset&#039;], $args[&#039;number&#039;] ) );

		$this-&gt;items = $wpdb-&gt;get_results( &quot;SELECT p.post_title, p.post_author, p.post_status, p.post_date, r.* {$commmon_sql} {$_orderby} {$_limit}&quot; );

		$this-&gt;set_pagination_args(
			array(
				&#039;total_items&#039; =&gt; $total_items,
				&#039;per_page&#039;    =&gt; $reports_per_page,
			)
		);
	}

	/**
	 * Handles bulk actions.
	 *
	 * @see $this-&gt;prepare_items()
	 */
	public function process_bulk_action() {
		global $wpdb;

		$doaction = $this-&gt;current_action();
		
		if ( ! $doaction || ! current_user_can( &#039;manage_options&#039; ) ) {
			return;
		}

		check_admin_referer( &#039;bulk-&#039; . $this-&gt;_args[&#039;plural&#039;] );

		$report_posts = isset( $_REQUEST[&#039;report_posts&#039;] ) ? wp_parse_id_list( wp_unslash( $_REQUEST[&#039;report_posts&#039;] ) ) : array();

		if ( empty( $report_posts ) ) {
			return;
		}

		$resolved = 0;
		$rejected = 0;
		$deleted_ = 0;
		$pending = 0;
		$draft = 0;
		$trash = 0;
		$deleted = 0;

		$pagenum = $this-&gt;get_pagenum();

		$redirect_to = remove_query_arg( array( &#039;resolved&#039;, &#039;rejected&#039;, &#039;deleted_&#039;, &#039;deleted&#039;, &#039;pending&#039;, &#039;draft&#039;, &#039;trash&#039;, &#039;report_posts&#039; ), wp_get_referer() );
		$redirect_to = add_query_arg( &#039;paged&#039;, $pagenum, $redirect_to );

		foreach ( $report_posts as $id ) {
			switch ( $doaction ) {
				case &#039;resolved&#039;:
					$resolved += (int) GeoDir_Report_Post::set_status( &#039;resolved&#039;, (int) $id );
					break;
				case &#039;rejected&#039;:
					$rejected += (int) GeoDir_Report_Post::set_status( &#039;rejected&#039;, (int) $id );
					break;
				case &#039;delete-reports&#039;:
					$deleted_ += (int) GeoDir_Report_Post::delete( (int) $id );
					break;
				case &#039;pending&#039;:
					$pending += (int) GeoDir_Report_Post::set_post_status( &#039;pending&#039;, (int) $id );
					break;
				case &#039;draft&#039;:
					$draft += (int) GeoDir_Report_Post::set_post_status( &#039;draft&#039;, (int) $id );
					break;
				case &#039;trash&#039;:
					$trash += (int) GeoDir_Report_Post::delete_post( (int) $id );
					break;
				case &#039;delete&#039;:
					$deleted += (int) GeoDir_Report_Post::delete_post( (int) $id, true );
					break;
			}
		}

		if ( $resolved ) {
			$redirect_to = add_query_arg( &#039;resolved&#039;, $resolved, $redirect_to );
		}
		if ( $rejected ) {
			$redirect_to = add_query_arg( &#039;rejected&#039;, $rejected, $redirect_to );
		}
		if ( $deleted_ ) {
			$redirect_to = add_query_arg( &#039;deleted_&#039;, $deleted_, $redirect_to );
		}
		if ( $pending ) {
			$redirect_to = add_query_arg( &#039;pending&#039;, $pending, $redirect_to );
		}
		if ( $deleted ) {
			$redirect_to = add_query_arg( &#039;deleted&#039;, $deleted, $redirect_to );
		}
		if ( $draft ) {
			$redirect_to = add_query_arg( &#039;draft&#039;, $draft, $redirect_to );
		}
		if ( $trash ) {
			$redirect_to = add_query_arg( &#039;trash&#039;, $trash, $redirect_to );
		}

		wp_safe_redirect( $redirect_to );
		exit;
	}

	/**
	 * @param string $status
	 * @return int
	 */
	public function get_per_page( $status = &#039;all&#039; ) {
		$reports_per_page = 10;

		/**
		 * Filters the number of reports listed per page in the reports list table.
		 *
		 * @since 2.1.1.12
		 *
		 * @param int    $reports_per_page The number of reports to list per page.
		 * @param string $status    The report status name. Default &#039;All&#039;.
		 */
		return apply_filters( &#039;geodir_admin_post_reports_per_page&#039;, $reports_per_page, $status );
	}

	/**
	 * @global string $status
	 */
	public function no_items() {
		global $status;

		if ( &#039;pending&#039; === $status ) {
			_e( &#039;No items awaiting moderation.&#039;, &#039;geodirectory&#039; );
		} else {
			_e( &#039;No items found.&#039;, &#039;geodirectory&#039; );
		}
	}

	/**
	 * @global int $post_id
	 * @global string $status
	 * @global string $reason
	 */
	protected function get_views() {
		global $post_id, $status, $reason;

		$status_links = array();
		$post_id = ! empty( $post_id ) ? absint( $post_id ) : 0;
		$num_reports = GeoDir_Report_Post::get_counts( $post_id );
		if ( empty( $status ) ) {
			$status = &#039;all&#039;;
		}

		$stati = array(
			&#039;all&#039;       =&gt; _nx_noop(
				&#039;All &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;All &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;reported posts&#039;,
				&#039;geodirectory&#039;
			),
			&#039;pending&#039;  =&gt; _nx_noop(
				&#039;Pending &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;Pending &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;reported posts&#039;,
				&#039;geodirectory&#039;
			),
			&#039;resolved&#039;  =&gt; _nx_noop(
				&#039;Resolved &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;Resolved &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;reported posts&#039;,
				&#039;geodirectory&#039;
			),
			&#039;rejected&#039; =&gt; _nx_noop(
				&#039;Rejected &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;Rejected &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;&#039;,
				&#039;reported posts&#039;,
				&#039;geodirectory&#039;
			)
		);

		$link = admin_url( &#039;admin.php?page=gd-settings&amp;tab=general&amp;section=report_post&#039; );

		if ( ! empty( $reason ) &amp;&amp; &#039;all&#039; !== $reason ) {
			$link = add_query_arg( &#039;reason&#039;, $reason, $link );
		}

		foreach ( $stati as $_status =&gt; $label ) {
			$current_link_attributes = &#039;&#039;;

			if ( empty( $_status ) ) {
				$_status = &#039;pending&#039;;
			}

			if ( $_status === $status ) {
				$current_link_attributes = &#039; class=&quot;current&quot; aria-current=&quot;page&quot;&#039;;
			}

			if ( ! isset( $num_reports-&gt;{$_status} ) ) {
				$num_reports-&gt;{$_status} = 10;
			}

			if ( empty( $num_reports-&gt;{$_status} ) ) {
				continue;
			}

			$link = add_query_arg( &#039;status&#039;, $_status, $link );

			if ( $post_id ) {
				$link = add_query_arg( &#039;p&#039;, absint( $post_id ), $link );
			}

			$status_links[ $_status ] = &quot;&lt;a href=&#039;$link&#039;$current_link_attributes&gt;&quot; . wp_sprintf( translate_nooped_plural( $label, $num_reports-&gt;{$_status} ), wp_sprintf( &#039;&lt;span class=&quot;%s-count&quot;&gt;%s&lt;/span&gt;&#039;, &#039;pending&#039;, number_format_i18n( $num_reports-&gt;{$_status} ) )
			) . &#039;&lt;/a&gt;&#039;;
		}

		return apply_filters( &#039;geodir_report_post_status_links&#039;, $status_links );
	}

	/**
	 * @global string $status
	 *
	 * @return array
	 */
	protected function get_bulk_actions() {
		global $status;

		$actions = array(
			&#039;pending&#039; =&gt; __( &#039;Unpublish&#039;, &#039;geodirectory&#039; ),
			&#039;draft&#039; =&gt; __( &#039;Move to Draft&#039;, &#039;geodirectory&#039; ),
			&#039;trash&#039; =&gt; __( &#039;Move to Trash&#039;, &#039;geodirectory&#039; ),
			&#039;delete&#039; =&gt; __( &#039;Delete Permanently&#039;, &#039;geodirectory&#039; ),
			&#039;resolved&#039; =&gt; __( &#039;Mark as Resolved&#039;, &#039;geodirectory&#039; ),
			&#039;rejected&#039; =&gt; __( &#039;Mark as Rejected&#039;, &#039;geodirectory&#039; ),
			&#039;delete-reports&#039; =&gt; __( &#039;Delete Reports&#039;, &#039;geodirectory&#039; )
		);

		return $actions;
	}

	/**
	 * @global string $status
	 * @global string $reason
	 *
	 * @param string $which
	 */
	protected function extra_tablenav( $which ) {
		global $status, $reason;
		static $has_items;

		if ( ! isset( $has_items ) ) {
			$has_items = $this-&gt;has_items();
		}

		echo &#039;&lt;div class=&quot;alignleft actions&quot;&gt;&#039;;

		if ( &#039;top&#039; === $which ) {
			ob_start();

			$this-&gt;reason_dropdown( $reason );

			/**
			 * Fires just before the Filter submit button for reasons.
			 *
			 * @since 2.1.1.12
			 */
			do_action( &#039;geodir_admin_restrict_manage_report_posts&#039; );

			$output = ob_get_clean();

			if ( ! empty( $output ) &amp;&amp; $this-&gt;has_items() ) {
				echo $output;
				submit_button( __( &#039;Filter&#039;, &#039;geodirectory&#039; ), &#039;&#039;, &#039;filter_action&#039;, false, array( &#039;id&#039; =&gt; &#039;post-query-submit&#039; ) );
			}
		}

		/**
		 * Fires after the Filter submit button for reasons.
		 *
		 * @since 2.1.1.12
		 *
		 * @param string $status The reason name. Default &#039;All&#039;.
		 * @param string $which          The location of the extra table nav markup: &#039;top&#039; or &#039;bottom&#039;.
		 */
		do_action( &#039;geodir_admin_manage_report_posts_nav&#039;, $status, $which );

		echo &#039;&lt;/div&gt;&#039;;
	}

	/**
	 * @return string|false
	 */
	public function current_action() {
		return parent::current_action();
	}

	/**
	 * Displays a reason drop-down for filtering on the reports list table.
	 *
	 * @since 2.1.1.12
	 *
	 * @param string $reason The current reason slug.
	 */
	protected function reason_dropdown( $reason ) {
		$reasons = GeoDir_Report_Post::get_reasons();

		if ( $reasons &amp;&amp; is_array( $reasons ) ) {
			printf( &#039;&lt;label class=&quot;screen-reader-text&quot; for=&quot;filter-by-reason&quot;&gt;%s&lt;/label&gt;&#039;, __( &#039;Filter by reason&#039;, &#039;geodirectory&#039;, &#039;geodirectory&#039; ) );

			echo &#039;&lt;select id=&quot;filter-by-reason&quot; name=&quot;reason&quot;&gt;&#039;;

			printf( &quot;\t&lt;option value=&#039;&#039;&gt;%s&lt;/option&gt;&quot;, __( &#039;All reasons&#039;, &#039;geodirectory&#039; ) );

			foreach ( $reasons as $type =&gt; $label ) {
				printf(
					&quot;\t&lt;option value=&#039;%s&#039;%s&gt;%s&lt;/option&gt;\n&quot;,
					esc_attr( $type ),
					selected( $reason, $type, false ),
					esc_html( $label )
				);
			}

			echo &#039;&lt;/select&gt;&#039;;
		}
	}

	/**
	 * Get the name of the default primary column.
	 *
	 *
	 * @return string Name of the default primary column, in this case, &#039;post&#039;.
	 */
	protected function get_default_primary_column_name() {
		return &#039;report-post&#039;;
	}

	/**
	 * Displays the comments table.
	 *
	 * Overrides the parent display() method to render extra comments.
	 *
	 * @since 3.1.0
	 */
	public function display() {
		static $has_items;

		if ( ! isset( $has_items ) ) {
			$has_items = $this-&gt;has_items();

			if ( $has_items ) {
				$this-&gt;display_tablenav( &#039;top&#039; );

				wp_nonce_field( &#039;bulk-&#039; . $this-&gt;_args[&#039;plural&#039;] );
			}
		}

		$this-&gt;screen-&gt;render_screen_reader_content( &#039;heading_list&#039; );

		?&gt;
&lt;input type=&quot;hidden&quot; name=&quot;_wp_http_referer&quot; value=&quot;&lt;?php echo esc_attr( remove_query_arg( &#039;_wp_http_referer&#039;, wp_unslash( $_SERVER[&#039;REQUEST_URI&#039;] ) ) ); ?&gt;&quot; /&gt;
&lt;table class=&quot;wp-list-table &lt;?php echo implode( &#039; &#039;, $this-&gt;get_table_classes() ); ?&gt;&quot;&gt;
	&lt;thead&gt;
	&lt;tr&gt;
		&lt;?php $this-&gt;print_column_headers(); ?&gt;
	&lt;/tr&gt;
	&lt;/thead&gt;

	&lt;tbody id=&quot;the-report-post-list&quot; data-wp-lists=&quot;list:report-post&quot;&gt;
		&lt;?php $this-&gt;display_rows_or_placeholder(); ?&gt;
	&lt;/tbody&gt;

	&lt;tbody id=&quot;the-extra-report-post-list&quot; data-wp-lists=&quot;list:report-post&quot; style=&quot;display: none;&quot;&gt;
		&lt;?php
			$items       = $this-&gt;items;
			$this-&gt;display_rows_or_placeholder();
			$this-&gt;items = $items;
		?&gt;
	&lt;/tbody&gt;

	&lt;tfoot&gt;
	&lt;tr&gt;
		&lt;?php $this-&gt;print_column_headers( false ); ?&gt;
	&lt;/tr&gt;
	&lt;/tfoot&gt;

&lt;/table&gt;
		&lt;?php

		$this-&gt;display_tablenav( &#039;bottom&#039; );
	}

	/**
	 * @global WP_Post $post    Global post object.
	 * @global object  $report_item Global report item object.
	 *
	 * @param WP_Comment $item
	 */
	public function single_row( $item ) {
		global $post, $report_item;

		$report_item = $item;

		$the_report_class = $report_item-&gt;status;

		if ( empty( $the_report_class ) ) {
			$the_report_class = &#039;pending&#039;;
		}

		$the_report_class = implode( &#039; &#039;, $this-&gt;get_item_class( $the_report_class, $report_item, $report_item-&gt;post_id ) );

		if ( $report_item-&gt;post_id &gt; 0 ) {
			$post = get_post( $report_item-&gt;post_id );
		}

		$this-&gt;user_can = current_user_can( &#039;manage_options&#039; );

		echo &quot;&lt;tr id=&#039;report-post-$report_item-&gt;id&#039; class=&#039;$the_report_class&#039;&gt;&quot;;
		$this-&gt;single_row_columns( $report_item );
		echo &quot;&lt;/tr&gt;\n&quot;;

		unset( $GLOBALS[&#039;post&#039;], $GLOBALS[&#039;report_item&#039;] );
	}

	public function get_item_class( $class = &#039;&#039;, $item = null, $post_id = null ) {
		global $report_post_alt;

		$classes = array();

		if ( empty( $report_post_alt ) ) {
			$report_post_alt = 0;
		}

		if ( $report_post_alt % 2 ) {
			$classes[] = &#039;odd&#039;;
			$classes[] = &#039;alt&#039;;
		} else {
			$classes[] = &#039;even&#039;;
		}

		$report_post_alt++;

		if ( ! empty( $class ) ) {
			if ( ! is_array( $class ) ) {
				$class = preg_split( &#039;#\s+#&#039;, $class );
			}
			$classes = array_merge( $classes, $class );
		}

		$classes = array_map( &#039;esc_attr&#039;, $classes );

		/**
		 * Filters the returned CSS classes for the current report item.
		 *
		 * @since 2.1.1.12
		 *
		 * @param string[]    $classes An array of report item classes.
		 * @param string[]    $class An array of additional classes added to the list.
		 * @param int         $item_id The report ID.
		 * @param object      $item The report item object.
		 * @param int|WP_Post $post_id The post ID or WP_Post object.
		 */
		return apply_filters( &#039;geodir_admin_report_post_class&#039;, $classes, $class, $item-&gt;id, $item, $post_id );
	}

	/**
	 * Generate and display row actions links.
	 *
	 * @since 2.1.1.12
	 *
	 * @global string $status Status for the current listed reports.
	 *
	 * @param object     $item     The item object.
	 * @param string     $column_name Current column name.
	 * @param string     $primary     Primary column name.
	 * @return string Row actions output for comments. An empty string
	 *                if the current column is not the primary column,
	 *                or if the current user cannot edit the item.
	 */
	protected function handle_row_actions( $item, $column_name, $primary ) {
		global $status;

		if ( $primary !== $column_name ) {
			return &#039;&#039;;
		}

		if ( ! $this-&gt;user_can ) {
			return &#039;&#039;;
		}

		$post = get_post( (int) $item-&gt;post_id );

		$out = &#039;&#039;;

		$actions = array(
			&#039;id&#039; =&gt; &#039;&#039;,
			&#039;view&#039; =&gt; &#039;&#039;,
		);

		// Not looking at all comments.
		if ( $post-&gt;post_status != &#039;trash&#039; ) {
			$actions[&#039;id&#039;] = wp_sprintf( __( &#039;ID: %s&#039;, &#039;geodirectory&#039; ), $post-&gt;ID );
			$actions[&#039;view&#039;] = wp_sprintf( &#039;&lt;a href=&quot;%s&quot; rel=&quot;bookmark&quot; aria-label=&quot;%s&quot;&gt;%s&lt;/a&gt;&#039;, get_permalink( $post-&gt;ID ), esc_attr( wp_sprintf( __( &#039;View &amp;#8220;%s&amp;#8221;&#039;, &#039;geodirectory&#039; ), _draft_or_post_title( (int) $post-&gt;ID ) ) ), wp_sprintf( __( &#039;View %s&#039;, &#039;geodirectory&#039; ), geodir_post_type_singular_name( $post-&gt;post_type, true ) ) );
		}

		$actions = apply_filters( &#039;geodir_report_post_row_actions&#039;, array_filter( $actions ), $item );

		$out .= &#039;&lt;div class=&quot;row-actions&quot;&gt;&#039;;

		$i = 0;

		foreach ( $actions as $action =&gt; $link ) {
			++$i;

			if ( 1 === $i ) {
				$sep = &#039;&#039;;
			} else {
				$sep = &#039; | &#039;;
			}

			$out .= &quot;&lt;span class=&#039;$action&#039;&gt;$sep$link&lt;/span&gt;&quot;;
		}

		$out .= &#039;&lt;/div&gt;&#039;;

		$out .= &#039;&lt;button type=&quot;button&quot; class=&quot;toggle-row&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&#039; . __( &#039;Show more details&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/span&gt;&lt;/button&gt;&#039;;

		return $out;
	}

	/**
	 * @param WP_Comment $comment The item object.
	 */
	public function column_cb( $item ) {
		if ( $this-&gt;user_can ) {
			?&gt;
		&lt;label class=&quot;screen-reader-text&quot; for=&quot;cb-select-&lt;?php echo $item-&gt;id; ?&gt;&quot;&gt;&lt;?php _e( &#039;Select item&#039; ); ?&gt;&lt;/label&gt;
		&lt;input id=&quot;cb-select-&lt;?php echo $item-&gt;id; ?&gt;&quot; type=&quot;checkbox&quot; name=&quot;report_posts[]&quot; value=&quot;&lt;?php echo $item-&gt;id; ?&gt;&quot; /&gt;
			&lt;?php
		}
	}

	public function column_post_title( $item ) {
		$title = _draft_or_post_title( (int) $item-&gt;post_id );
		$post = get_post( (int) $item-&gt;post_id );
		$can_edit_post = current_user_can( &#039;edit_post&#039;, $post-&gt;ID );

		$value = &#039;&lt;strong&gt;&#039;;

		if ( $can_edit_post &amp;&amp; &#039;trash&#039; !== $post-&gt;post_status ) {
			$value .= wp_sprintf( &#039;&lt;a class=&quot;row-title&quot; href=&quot;%s&quot; aria-label=&quot;%s&quot;&gt;%s&lt;/a&gt;&#039;, get_edit_post_link( $post-&gt;ID ), esc_attr( sprintf( __( &#039;&amp;#8220;%s&amp;#8221; (Edit)&#039;, &#039;geodirectory&#039; ), $title ) ), $title );
		} else {
			$value .=wp_sprintf( &#039;&lt;span&gt;%s&lt;/span&gt;&#039;, $title );
		}

		$value .= &quot;&lt;/strong&gt;\n&quot;;

		return $value;
	}

	public function column_post_author( $item ) {
		$post = get_post( (int) $item-&gt;post_id );

		$label = get_the_author_meta( &#039;display_name&#039;, $post-&gt;post_author );

		if ( current_user_can( &#039;edit_user&#039;, $post-&gt;post_author ) ) {
			$edit_link = get_edit_user_link( $post-&gt;post_author );
			$value = &quot;&lt;strong&gt;&lt;a href=\&quot;{$edit_link}\&quot;&gt;{$label}&lt;/a&gt;&lt;/strong&gt;&quot;;
		} else {
			$value = &quot;&lt;strong&gt;{$label}&lt;/strong&gt;&quot;;
		}

		return $value;
	}

	public function column_post_date( $item ) {
		$post = get_post( (int) $item-&gt;post_id );

		$value = &#039;&#039;;

		if ( &#039;0000-00-00 00:00:00&#039; === $post-&gt;post_date ) {
			$t_time    = __( &#039;Unpublished&#039;, &#039;geodirectory&#039; );
			$time_diff = 0;
		} else {
			$t_time = date_i18n( geodir_date_time_format(), strtotime( $post-&gt;post_date ) );

			$time      = get_post_timestamp( $post );
			$time_diff = time() - $time;
		}

		if ( &#039;publish&#039; === $post-&gt;post_status ) {
			$status = __( &#039;Published&#039;, &#039;geodirectory&#039; );
		} elseif ( &#039;future&#039; === $post-&gt;post_status ) {
			if ( $time_diff &gt; 0 ) {
				$status = &#039;&lt;strong class=&quot;error-message&quot;&gt;&#039; . __( &#039;Missed schedule&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/strong&gt;&#039;;
			} else {
				$status = __( &#039;Scheduled&#039;, &#039;geodirectory&#039; );
			}
		} else {
			$status = geodir_get_post_status_name( $post-&gt;post_status );
		}

		if ( $status ) {
			$value .= $status . &#039;&lt;br /&gt;&#039;;
		}

		$value .= $t_time;

		return $value;
	}

	public function column_user_name( $item ) {
		$label = esc_html( wp_unslash( $item-&gt;user_name ) );

		if ( ! empty( $item-&gt;user_id ) &amp;&amp; current_user_can( &#039;edit_user&#039;, (int) $item-&gt;user_id ) ) {
			$edit_link = get_edit_user_link( (int) $item-&gt;user_id );
			$value = &quot;&lt;strong&gt;&lt;a href=\&quot;{$edit_link}\&quot;&gt;{$label}&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;&quot;;
		} else {
			$value = &quot;&lt;strong&gt;{$label}&lt;/strong&gt;&lt;br&gt;&quot;;
		}
		$value .= $item-&gt;user_email;

		if ( ! empty( $item-&gt;user_email ) ) {
			$value .= &#039;&lt;br&gt;&#039; . $item-&gt;user_ip;
		}

		return $value;
	}

	public function column_report_date( $item ) {
		$post = get_post( (int) $item-&gt;post_id );

		$value = &#039;&#039;;

		$t_time = date_i18n( geodir_date_time_format(), strtotime( $item-&gt;report_date ) );

		if ( &#039;resolved&#039; === $item-&gt;status ) {
			$status = __( &#039;Resolved&#039;, &#039;geodirectory&#039; );
		} elseif ( &#039;rejected&#039; === $item-&gt;status ) {
			$status = __( &#039;Rejected&#039;, &#039;geodirectory&#039; );
		} else {
			$status = __( &#039;Pending&#039;, &#039;geodirectory&#039; );
		}

		if ( $status ) {
			$value .= $status . &#039;&lt;br /&gt;&#039;;
		}

		$value .= $t_time;

		return $value;
	}

	public function column_reports( $item ) {
		$post = get_post( (int) $item-&gt;post_id );

		$value = __( esc_html( $item-&gt;reason ), &#039;geodirectory&#039; );
		if ( ! empty( $item-&gt;message ) ) {
			$value .= &#039;&lt;br&gt;&lt;a href=&quot;javascipt:void(0)&quot; class=&quot;geodir-report-view&quot;&gt;&#039; . __( &#039;View Message&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/a&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;div class=&quot;lity-show&quot; id=&quot;geodir-view-report-post-&#039; . $item-&gt;id . &#039;&quot; style=&quot;white-space:pre-wrap;&quot;&gt;&lt;strong class=&quot;gd-settings-title &quot;&gt;&#039; . __( &#039;Message:&#039;, &#039;geodirectory&#039; ) . &#039;&lt;/strong&gt;&lt;br&gt;&lt;hr&gt;&#039; . esc_html( $item-&gt;message ) . &#039;&lt;/div&gt;&lt;/div&gt;&#039;;
		}

		return $value;
	}

	/**
	 * @param object $item     The item object.
	 * @param string $column_name The custom column&#039;s name.
	 */
	public function column_default( $item, $column_name ) {
		/**
		 * Fires when the default column output is displayed for a single row.
		 *
		 * @since 2.1.1.12
		 *
		 * @param string $column_name The custom column&#039;s name.
		 * @param int    $comment_id  The custom column&#039;s unique ID number.
		 */
		do_action( &#039;geodir_admin_manage_report_posts_custom_column&#039;, $column_name, $item );
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 07:38 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652341136"></script>
    <script src="../js/search.js?updated=1652341136"></script>
</body>
</html>
