<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652341136">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652341136">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpgeodirectory.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://ayecode.io/careers/" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-settings-import-export.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDirectory Import/Export Settings
 *
 * @author   GeoDirectory
 * @category Admin
 * @package  GeoDirectory/Admin
 * @version  2.0.0
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit; // Exit if accessed directly
}

if ( ! class_exists( &#039;GD_Settings_Import_Export&#039;, false ) ) :

	/**
	 * GeoDir_Settings_Products.
	 */
	class GeoDir_Settings_Import_Export extends GeoDir_Settings_Page {

		/**
		 * Constructor.
		 */
		public function __construct() {

			$this-&gt;id    = &#039;import-export&#039;;
			$this-&gt;label = __( &#039;Import/Export&#039;, &#039;geodirectory&#039; );

			add_filter( &#039;geodir_settings_tabs_array&#039;, array( $this, &#039;add_settings_page&#039; ), 20 );
			add_action( &#039;geodir_settings_&#039; . $this-&gt;id, array( $this, &#039;output&#039; ) );
			add_action( &#039;geodir_settings_save_&#039; . $this-&gt;id, array( $this, &#039;save&#039; ) );
			add_action( &#039;geodir_sections_&#039; . $this-&gt;id, array( $this, &#039;output_sections&#039; ) );
		}

		/**
		 * Get sections.
		 *
		 * @return array
		 */
		public function get_sections() {

			$sections = array(
				&#039;&#039;				=&gt; __( &#039;Listings&#039;, &#039;geodirectory&#039; ),
				&#039;categories&#039;    =&gt; __( &#039;Categories&#039;, &#039;geodirectory&#039; ),
				&#039;reviews&#039;    	=&gt; __( &#039;Reviews&#039;, &#039;geodirectory&#039; ),
				&#039;settings&#039; 		=&gt; __( &#039;Settings&#039;, &#039;geodirectory&#039; ),
			);

			return apply_filters( &#039;geodir_get_sections_&#039; . $this-&gt;id, $sections );
		}

		/**
		 * Output the settings.
		 */
		public function output() {
			global $current_section,$hide_save_button;

			$hide_save_button = true; // hide the save button

			$settings = $this-&gt;get_settings( $current_section );

			GeoDir_Admin_Settings::output_fields( $settings );
		}

		/**
		 * Save settings.
		 */
		public function save() {
			global $current_section;

			$settings = $this-&gt;get_settings( $current_section );
			GeoDir_Admin_Settings::save_fields( $settings );
		}

		/**
		 * Get settings array.
		 *
		 * @return array
		 */
		public function get_settings( $current_section = &#039;&#039; ) {
			if ( $current_section == &#039;categories&#039; ) {
				$settings = apply_filters( &#039;geodir_import_export_listings_settings&#039;, array(
//					array(
//						&#039;title&#039; 	=&gt; &#039;&#039;,//__( &#039;Import &amp; Export Categories&#039;, &#039;geodirectory&#039; ),
//						&#039;type&#039; 		=&gt; &#039;title&#039;,
//						&#039;id&#039; 		=&gt; &#039;import_export_options&#039;,
//					),

					array(
						&#039;id&#039;       =&gt; &#039;import_export_categories&#039;,
						&#039;type&#039;     =&gt; &#039;import_export_categories&#039;,
					),

//					array(
//						&#039;type&#039; 	=&gt; &#039;sectionend&#039;,
//						&#039;id&#039; 	=&gt; &#039;import_export_options&#039;,
//					),

				));

			} elseif ( $current_section == &#039;reviews&#039; ) {
				$settings = apply_filters( &#039;geodir_import_export_reviews_settings&#039;, array(
//					array(
//						&#039;title&#039; 	=&gt; &#039;&#039;,
//						&#039;type&#039; 		=&gt; &#039;title&#039;,
//						&#039;id&#039; 		=&gt; &#039;import_export_options&#039;,
//					),

					array(
						&#039;id&#039;       =&gt; &#039;import_export_reviews&#039;,
						&#039;type&#039;     =&gt; &#039;import_export_reviews&#039;,
					),

//					array(
//						&#039;type&#039; 	=&gt; &#039;sectionend&#039;,
//						&#039;id&#039; 	=&gt; &#039;import_export_options&#039;,
//					),

				));

			} elseif ( &#039;settings&#039; == $current_section ) {

				$settings = apply_filters( &#039;geodir_import_export_geodirectory_settings&#039;, array(
//					array(
//						&#039;title&#039; 	=&gt; &#039;&#039;,//__( &#039;Import &amp; Export Categories&#039;, &#039;geodirectory&#039; ),
//						&#039;type&#039; 		=&gt; &#039;title&#039;,
//						&#039;id&#039; 		=&gt; &#039;import_export_options&#039;,
//					),

					array(
						&#039;id&#039;       =&gt; &#039;import_export_settings&#039;,
						&#039;type&#039;     =&gt; &#039;import_export_settings&#039;,
					),

//					array(
//						&#039;type&#039; 	=&gt; &#039;sectionend&#039;,
//						&#039;id&#039; 	=&gt; &#039;import_export_options&#039;,
//					),

				));

			} else {
				$settings = apply_filters( &#039;geodir_import_export_listings_settings&#039;, array(
//					array(
//						&#039;title&#039; 	=&gt; &#039;&#039;,//__( &#039;Import &amp; Export Listings&#039;, &#039;geodirectory&#039; ),
//						&#039;type&#039; 		=&gt; &#039;title&#039;,
//						&#039;id&#039; 		=&gt; &#039;import_export_options&#039;,
//					),

					array(
						&#039;id&#039;       =&gt; &#039;import_export_listings&#039;,
						&#039;type&#039;     =&gt; &#039;import_export_listings&#039;,
					),

//					array(
//						&#039;type&#039; 	=&gt; &#039;sectionend&#039;,
//						&#039;id&#039; 	=&gt; &#039;import_export_options&#039;,
//					),

				));
			}

			return apply_filters( &#039;geodir_get_settings_&#039; . $this-&gt;id, $settings, $current_section );
		}

		/**
		 * JS code for import/export view.
		 * 
		 * @param $nonce
		 */
		public static function get_import_export_js($nonce){
			$uploads = wp_upload_dir();
			$upload_dir = wp_sprintf( __( &quot;Please transfer all new images to &lt;b&gt;&#039;%s&#039;&lt;/b&gt; folder.&quot;, &#039;geodirectory&#039; ), str_replace( ABSPATH, &#039;&#039;, $uploads[&#039;path&#039;] ) );
			?&gt;
			&lt;script type=&quot;text/javascript&quot;&gt;
				var timoutC, timoutP, timoutR;

				function gd_imex_PrepareImport(el, type) {
					var cont = jQuery(el).closest(&#039;.card-body&#039;);
					var gd_prepared = jQuery(&#039;#gd_prepared&#039;, cont).val();
					var uploadedFile = jQuery(&#039;#gd_im_&#039; + type, cont).val();
					jQuery(&#039;gd-import-msg&#039;, cont).hide();
					jQuery(&#039;#gd-import-errors&#039;).hide();
					jQuery(&#039;#gd-import-errors #gd-csv-errors&#039;).html(&#039;&#039;);

					if(gd_prepared == uploadedFile) {
						gd_imex_ContinueImport(el, type);
						jQuery(&#039;#gd_import_data&#039;, cont).attr(&#039;disabled&#039;, &#039;disabled&#039;);
					} else {
						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=prepare_import&amp;_pt=&#039; + type + &#039;&amp;_file=&#039; + uploadedFile + &#039;&amp;_nonce=&lt;?php echo $nonce;?&gt;&#039;,
							dataType: &#039;json&#039;,
							cache: false,
							success: function(data) {
								if(typeof data == &#039;object&#039;) {
									if(data.success == false) {
										jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;updated&#039;).addClass(&#039;error&#039;).html(&#039;&lt;p&gt;&#039; + data.data + &#039;&lt;/p&gt;&#039;);
										jQuery(&#039;#gd-import-msg&#039;, cont).show();
									} else if(!data.error &amp;&amp; typeof data.rows != &#039;undefined&#039;) {
										jQuery(&#039;#gd_total&#039;, cont).val(data.rows);
										jQuery(&#039;#gd_prepared&#039;, cont).val(uploadedFile);
										jQuery(&#039;#gd_processed&#039;, cont).val(&#039;0&#039;);
										jQuery(&#039;#gd_created&#039;, cont).val(&#039;0&#039;);
										jQuery(&#039;#gd_updated&#039;, cont).val(&#039;0&#039;);
										jQuery(&#039;#gd_skipped&#039;, cont).val(&#039;0&#039;);
										jQuery(&#039;#gd_invalid&#039;, cont).val(&#039;0&#039;);
										jQuery(&#039;#gd_images&#039;, cont).val(&#039;0&#039;);
										if(type == &#039;post&#039;) {
											jQuery(&#039;#gd_invalid_addr&#039;, cont).val(&#039;0&#039;);
										}
										gd_imex_StartImport(el, type);
									}
								}
							},
							error: function(errorThrown) {
								console.log(errorThrown);
							}
						});
					}
				}

				function gd_imex_StartImport(el, type) {
					var cont = jQuery(el).closest(&#039;.card-body&#039;);

					var limit = 1;
					var total = parseInt(jQuery(&#039;#gd_total&#039;, cont).val());
					var total_processed = parseInt(jQuery(&#039;#gd_processed&#039;, cont).val());
					var uploadedFile = jQuery(&#039;#gd_im_&#039; + type, cont).val();
					var choice = jQuery(&#039;#gd_im_choice&#039; + type, cont).val();

					if (!uploadedFile) {
						jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
						jQuery(&#039;#gd_stop_import&#039;, cont).hide();
						jQuery(&#039;#gd_process_data&#039;, cont).hide();
						jQuery(&#039;#gd-import-progress&#039;, cont).hide();
						jQuery(&#039;.gd-fileprogress&#039;, cont).width(0);
						jQuery(&#039;#gd-import-done&#039;, cont).text(&#039;0&#039;);
						jQuery(&#039;#gd-import-total&#039;, cont).text(&#039;0&#039;);
						jQuery(&#039;#gd-import-perc&#039;, cont).text(&#039;0%&#039;);

						jQuery(cont).find(&#039;.filelist .file&#039;).remove();

						jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;updated&#039;).addClass(&#039;error&#039;).html(&quot;&lt;p&gt;&lt;?php esc_attr_e( &#039; Please select csv file.&#039;, &#039;geodirectory&#039; ); ?&gt;&lt;/p&gt;&quot;);
						jQuery(&#039;#gd-import-msg&#039;, cont).show();

						return false;
					}

					jQuery(&#039;#gd-import-total&#039;, cont).text(total);
					jQuery(&#039;#gd_stop_import&#039;, cont).show();
					jQuery(&#039;#gd_process_data&#039;, cont).css({
						&#039;display&#039;: &#039;inline-block&#039;
					});
					jQuery(&#039;#gd-import-progress&#039;, cont).show();
					if ((parseInt(total) / 100) &gt; 0) {
						limit = parseInt(parseInt(total) / 100);
					}
					if (limit == 1) {
						if (parseInt(total) &gt; 50) {
							limit = 5;
						} else if (parseInt(total) &gt; 10 &amp;&amp; parseInt(total) &lt; 51) {
							limit = 2;
						}
					}
					if (limit &gt; 10) {
						limit = 10;
					}
					if (limit &lt; 1) {
						limit = 1;
					}

					if ( parseInt(limit) &gt; parseInt(total) )
						limit = parseInt(total);
					if (total_processed &gt;= total) {
						jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
						jQuery(&#039;#gd_stop_import&#039;, cont).hide();
						jQuery(&#039;#gd_process_data&#039;, cont).hide();

						gd_imex_showStatusMsg(el, type);

						jQuery(&#039;#gd_im_&#039; + type, cont).val(&#039;&#039;);
						jQuery(&#039;#gd_prepared&#039;, cont).val(&#039;&#039;);

						return false;
					}
					jQuery(&#039;#gd-import-msg&#039;, cont).hide();

					var gd_processed = parseInt(jQuery(&#039;#gd_processed&#039;, cont).val());
					var gd_created = parseInt(jQuery(&#039;#gd_created&#039;, cont).val());
					var gd_updated = parseInt(jQuery(&#039;#gd_updated&#039;, cont).val());
					var gd_skipped = parseInt(jQuery(&#039;#gd_skipped&#039;, cont).val());
					var gd_invalid = parseInt(jQuery(&#039;#gd_invalid&#039;, cont).val());
					var gd_images = parseInt(jQuery(&#039;#gd_images&#039;, cont).val());
					if (type==&#039;post&#039;) {
						var gd_invalid_addr = parseInt(jQuery(&#039;#gd_invalid_addr&#039;, cont).val());
					}

					var gddata = &#039;&amp;limit=&#039; + limit + &#039;&amp;processed=&#039; + gd_processed;
					jQuery.ajax({
						url: ajaxurl,
						type: &quot;POST&quot;,
						data: &#039;action=geodir_import_export&amp;task=import_&#039; + type + &#039;&amp;_pt=&#039; + type + &#039;&amp;_file=&#039; + uploadedFile + gddata + &#039;&amp;_ch=&#039; + choice + &#039;&amp;_nonce=&lt;?php echo $nonce;?&gt;&#039;,
						dataType : &#039;json&#039;,
						cache: false,
						success: function (data) {

							// log any errors
							if(data.errors){
								gd_imex_log_errors(data.errors);
							}


							if (typeof data == &#039;object&#039;) {
								if(data.success == false) {
									jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
									jQuery(&#039;#gd_stop_import&#039;, cont).hide();
									jQuery(&#039;#gd_process_data&#039;, cont).hide();
									jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;updated&#039;).addClass(&#039;error&#039;).html(&#039;&lt;p&gt;&#039; + data.data + &#039;&lt;/p&gt;&#039;);
									jQuery(&#039;#gd-import-msg&#039;, cont).show();
								} else {
									gd_created = gd_created + parseInt(data.created);
									gd_updated = gd_updated + parseInt(data.updated);
									gd_skipped = gd_skipped + parseInt(data.skipped);
									gd_invalid = gd_invalid + parseInt(data.invalid);
									gd_images = gd_images + parseInt(data.images);
									if (type==&#039;post&#039; &amp;&amp; typeof data.invalid_addr != &#039;undefined&#039;) {
										gd_invalid_addr = gd_invalid_addr + parseInt(data.invalid_addr);
									}

									jQuery(&#039;#gd_processed&#039;, cont).val(gd_processed);
									jQuery(&#039;#gd_created&#039;, cont).val(gd_created);
									jQuery(&#039;#gd_updated&#039;, cont).val(gd_updated);
									jQuery(&#039;#gd_skipped&#039;, cont).val(gd_skipped);
									jQuery(&#039;#gd_invalid&#039;, cont).val(gd_invalid);
									jQuery(&#039;#gd_images&#039;, cont).val(gd_images);
									if (type==&#039;post&#039;) {
										jQuery(&#039;#gd_invalid_addr&#039;, cont).val(gd_invalid_addr);
									}

									if (parseInt(gd_processed) == parseInt(total)) {
										jQuery(&#039;#gd-import-done&#039;, cont).text(total);
										jQuery(&#039;#gd-import-perc&#039;, cont).text(&#039;100%&#039;);
										jQuery(&#039;.gd-fileprogress&#039;, cont).css({
											&#039;width&#039;: &#039;100%&#039;
										});
										jQuery(&#039;#gd_im_&#039; + type, cont).val(&#039;&#039;);
										jQuery(&#039;#gd_prepared&#039;, cont).val(&#039;&#039;);

										gd_imex_showStatusMsg(el, type);
										gd_imex_FinishImport(el, type);

										jQuery(&#039;#gd_stop_import&#039;, cont).hide();
									}
									if (parseInt(gd_processed) &lt; parseInt(total)) {
										var terminate_action = jQuery(&#039;#gd_terminateaction&#039;, cont).val();
										if (terminate_action == &#039;continue&#039;) {
											var nTmpCnt = parseInt(total_processed) + parseInt(limit);
											nTmpCnt = nTmpCnt &gt; total ? total : nTmpCnt;

											jQuery(&#039;#gd_processed&#039;, cont).val(nTmpCnt);

											jQuery(&#039;#gd-import-done&#039;, cont).text(nTmpCnt);
											if (parseInt(total) &gt; 0) {
												var percentage = ((parseInt(nTmpCnt) / parseInt(total)) * 100);
												percentage = percentage &gt; 100 ? 100 : percentage;
												jQuery(&#039;#gd-import-perc&#039;, cont).text(parseInt(percentage) + &#039;%&#039;);
												jQuery(&#039;.gd-fileprogress&#039;, cont).css({
													&#039;width&#039;: percentage + &#039;%&#039;
												});
											}

											if (type==&#039;cat&#039;) {
												clearTimeout(timoutC);
												timoutC = setTimeout(function () {
													gd_imex_StartImport(el, type);
												}, 0);
											}
											if (type==&#039;post&#039;) {
												clearTimeout(timoutP);
												timoutP = setTimeout(function () {
													gd_imex_StartImport(el, type);
												}, 0);
											}
											if (type==&#039;review&#039;) {
												clearTimeout(timoutR);
												timoutR = setTimeout(function () {
													gd_imex_StartImport(el, type);
												}, 0);
											}
										} else {
											jQuery(&#039;#gd_import_data&#039;, cont).hide();
											jQuery(&#039;#gd_stop_import&#039;, cont).hide();
											jQuery(&#039;#gd_process_data&#039;, cont).hide();
											jQuery(&#039;#gd_continue_data&#039;, cont).show();
											return false;
										}
									} else {
										jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
										jQuery(&#039;#gd_stop_import&#039;, cont).hide();
										jQuery(&#039;#gd_process_data&#039;, cont).hide();
										return false;
									}
								}
							} else {
								jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
								jQuery(&#039;#gd_stop_import&#039;, cont).hide();
								jQuery(&#039;#gd_process_data&#039;, cont).hide();
							}
						},
						error: function (errorThrown) {
							jQuery(&#039;#gd_import_data&#039;, cont).removeAttr(&#039;disabled&#039;).show();
							jQuery(&#039;#gd_stop_import&#039;, cont).hide();
							jQuery(&#039;#gd_process_data&#039;, cont).hide();
							console.log(errorThrown);
						}
					});
				}


				function gd_imex_log_errors(errors){
						jQuery.each(errors, function( index, value ) {
							jQuery( &quot;#gd-csv-errors&quot; ).append( &quot;&lt;p&gt;&quot;+value+&quot;&lt;/p&gt;&quot; );
							jQuery( &quot;#gd-csv-errors&quot; ).addClass(&#039;error&#039;);
							jQuery( &quot;#gd-import-errors&quot; ).show();
						});
				}

				function gd_imex_TerminateImport(el, type) {
					var cont = jQuery(el).closest(&#039;.gd-imex-box&#039;);
					if (!cont.length) {
						cont = jQuery(&#039;#gd_importer&#039;).parent();
					}
					jQuery(&#039;#gd_terminateaction&#039;, cont).val(&#039;terminate&#039;);
					jQuery(&#039;#gd_import_data&#039;, cont).hide();
					jQuery(&#039;#gd_stop_import&#039;, cont).hide();
					jQuery(&#039;#gd_process_data&#039;, cont).hide();
					jQuery(&#039;#gd_continue_data&#039;, cont).show();
				}

				function gd_imex_ContinueImport(el, type) {
					var cont = jQuery(el).closest(&#039;.gd-imex-box&#039;);
					if (!cont.length) {
						cont = jQuery(&#039;#gd_importer&#039;).parent();
					}
					var processed = jQuery(&#039;#gd_processed&#039;, cont).val();
					var total = jQuery(&#039;#gd_total&#039;, cont).val();
					if (parseInt(processed) &gt; parseInt(total)) {
						jQuery(&#039;#gd_stop_import&#039;, cont).hide();
					} else {
						jQuery(&#039;#gd_stop_import&#039;, cont).show();
					}
					jQuery(&#039;#gd_import_data&#039;, cont).show();
					jQuery(&#039;#gd_import_data&#039;, cont).attr(&#039;disabled&#039;, &#039;disabled&#039;);
					jQuery(&#039;#gd_process_data&#039;, cont).css({
						&#039;display&#039;: &#039;inline-block&#039;
					});
					jQuery(&#039;#gd_continue_data&#039;, cont).hide();
					jQuery(&#039;#gd_terminateaction&#039;, cont).val(&#039;continue&#039;);

					if (type==&#039;cat&#039;) {
						clearTimeout(timoutC);
						timoutC = setTimeout(function () {
							gd_imex_StartImport(el, type);
						}, 0);
					}

					if (type==&#039;post&#039;) {
						clearTimeout(timoutP);
						timoutP = setTimeout(function () {
							gd_imex_StartImport(el, type);
						}, 0);
					}
					if (type==&#039;review&#039;) {
						clearTimeout(timoutR);
						timoutR = setTimeout(function () {
							gd_imex_StartImport(el, type);
						}, 0);
					}
				}

				function gd_imex_showStatusMsg(el, type) {
					var cont = jQuery(el).closest(&#039;.gd-imex-box&#039;);
					if (!cont.length) {
						cont = jQuery(&#039;#gd_importer&#039;).parent();
					}

					var total = parseInt(jQuery(&#039;#gd_total&#039;, cont).val());
					var processed = parseInt(jQuery(&#039;#gd_processed&#039;, cont).val());
					var created = parseInt(jQuery(&#039;#gd_created&#039;, cont).val());
					var updated = parseInt(jQuery(&#039;#gd_updated&#039;, cont).val());
					var skipped = parseInt(jQuery(&#039;#gd_skipped&#039;, cont).val());
					var invalid = parseInt(jQuery(&#039;#gd_invalid&#039;, cont).val());
					var images = parseInt(jQuery(&#039;#gd_images&#039;, cont).val());
					if (type==&#039;post&#039;) {
						var invalid_addr = parseInt(jQuery(&#039;#gd_invalid_addr&#039;, cont).val());
					}

					var gdMsg = &#039;&lt;p&gt;&lt;/p&gt;&#039;;
					if ( processed &gt; 0 ) {
						var msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;Total %s item(s) found.&#039;, &#039;geodirectory&#039; ), &#039;%s&#039; ) );?&gt;&lt;/p&gt;&#039;;
						msgParse = msgParse.replace(&quot;%s&quot;, processed);
						gdMsg += msgParse;
					}

					if ( updated &gt; 0 ) {
						var msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) updated.&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						msgParse = msgParse.replace(&quot;%s&quot;, updated);
						msgParse = msgParse.replace(&quot;%d&quot;, processed);
						gdMsg += msgParse;
					}

					if ( created &gt; 0 ) {
						var msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) added.&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						msgParse = msgParse.replace(&quot;%s&quot;, created);
						msgParse = msgParse.replace(&quot;%d&quot;, processed);
						gdMsg += msgParse;
					}

					if ( skipped &gt; 0 ) {
						var msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) ignored due to already exists.&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						msgParse = msgParse.replace(&quot;%s&quot;, skipped);
						msgParse = msgParse.replace(&quot;%d&quot;, processed);
						gdMsg += msgParse;
					}

					if (type==&#039;post&#039; &amp;&amp; invalid_addr &gt; 0) {
						var msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) could not be added due to blank/invalid address(city, region, country, latitude, longitude).&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						msgParse = msgParse.replace(&quot;%s&quot;, invalid_addr);
						msgParse = msgParse.replace(&quot;%d&quot;, total);
						gdMsg += msgParse;
					}

					if (invalid &gt; 0) {
						var msgParse;

						if (type==&#039;review&#039;) {
							msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) could not be added due to invalid comment content / post ID / rating / user details(user id or author name, author email).&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						} else {
							msgParse = &#039;&lt;p&gt;&lt;?php echo addslashes( sprintf( __( &#039;%s / %s item(s) could not be added due to blank title/invalid post type/invalid characters used in data.&#039;, &#039;geodirectory&#039; ), &#039;%s&#039;, &#039;%d&#039; ) );?&gt;&lt;/p&gt;&#039;;
						}
						msgParse = msgParse.replace(&quot;%s&quot;, invalid);
						msgParse = msgParse.replace(&quot;%d&quot;, total);
						gdMsg += msgParse;
					}

					if (images &gt; 0) {
						gdMsg += &#039;&lt;p&gt;&lt;?php echo addslashes( $upload_dir );?&gt;&lt;/p&gt;&#039;;
					}
					if ( ( updated &gt; 0 || created &gt; 0 ) &amp;&amp; type==&#039;post&#039; ) {
						gdMsg += &#039;&lt;p&gt;&lt;i class=&quot;fas fa-info-circle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; &lt;?php echo addslashes( sprintf( __( &#039;Visit GeoDirectory -&gt; Status -&gt; Tools -&gt; Term counts. Run that tool to update term counts after your import. Check more at %shere%s.&#039;, &#039;geodirectory&#039; ), &#039;&lt;a href=&quot;https://docs.wpgeodirectory.com/article/367-settings-overview-for-gd-status-tools&quot; target=&quot;_blank&quot;&gt;&#039;, &#039;&lt;/a&gt;&#039; ) ); ?&gt;&lt;/p&gt;&#039;;
					}
					gdMsg += &#039;&lt;p&gt;&lt;/p&gt;&#039;;
					jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;error&#039;).addClass(&#039;updated&#039;).html(gdMsg);
					jQuery(&#039;#gd-import-msg&#039;, cont).show();
					return;
				}



				jQuery(function($){

					var intIp;
					var intIc;

					jQuery(&quot;.gd-imex-pupload&quot;).on(&quot;click&quot;,function () {
						var $this = this;
						var $cont = jQuery($this).closest(&#039;.card-body&#039;);
						clearInterval(intIp);
						intIp = setInterval(function () {
							if (jQuery($cont).find(&#039;.gd-imex-file&#039;).val()) {
								jQuery($cont).find(&#039;.gd-imex-btns&#039;).show();
							}
						}, 1000);
					});

					jQuery(&quot;.gd-imex-cupload&quot;).on(&quot;click&quot;,function () {
						var $this = this;
						var $cont = jQuery($this).closest(&#039;.card-body&#039;);
						clearInterval(intIc);
						intIc = setInterval(function () {
							if (jQuery($cont).find(&#039;.gd-imex-file&#039;).val()) {
								jQuery($cont).find(&#039;.gd-imex-btns&#039;).show();
							}
						}, 1000);
					});
					
					$(&#039;#gd_ie_download_sample&#039;).on(&quot;click&quot;,function(e) {
						if ($(this).data(&#039;sample-csv&#039;)) {
							window.location.href = $(this).data(&#039;sample-csv&#039;);
							return false;
						}
					});

					jQuery(&#039;.gd-import-export .geodir_event_csv_download a&#039;).addClass(&#039;button-secondary&#039;);

					jQuery( &#039;.gd_progressbar&#039; ).each(function(){
						jQuery(this).progressbar({value:0});
					});

					var timer_posts;
					var pseconds;
					jQuery(&#039;#gd_ie_exposts_submit&#039;).on(&quot;click&quot;,function(){
						pseconds = 1;

						jQuery(&#039;.gd-export-listings-progress&#039;).show();

						var el = jQuery(this).closest(&#039;#gd_ie_ex_posts&#039;);
						var post_type = jQuery(el).find(&#039;#gd_post_type&#039;).val();
						if ( !post_type ) {
							jQuery(el).find(&#039;#gd_post_type&#039;).focus();
							return false;
						}
						window.clearInterval(timer_posts);

						jQuery(this).prop(&#039;disabled&#039;, true);

						timer_posts = window.setInterval( function() {
							jQuery(el).find(&quot;.gd_timer&quot;).gdposts_timer();
						}, 1000);

						var chunk_size = parseInt(jQuery(&#039;#gd_chunk_size&#039;, el).val());
						var total_posts = parseInt(jQuery(&#039;option:selected&#039;, jQuery(el).find(&#039;#gd_post_type&#039;)).attr(&#039;data-posts&#039;));
						chunk_size = chunk_size &lt; 50 || chunk_size &gt; 100000 ? 5000 : chunk_size;
						if (chunk_size &gt; total_posts) {
							chunk_size = total_posts;
						}
						var pages = Math.ceil( total_posts / chunk_size );

						var filters = &#039;&#039;;
						var v;
						jQuery(&#039;[name^=&quot;gd_imex[&quot;]&#039;, el).each(function() {
							v = jQuery(this).val();
							v = typeof v == &#039;string&#039; &amp;&amp; v !== &#039;&#039; ? v.trim() : &#039;&#039;;
							if (v !== &#039;&#039;) {
								filters += &#039;&amp;&#039; + jQuery(this).prop(&#039;name&#039;) + &#039;=&#039; + v;
							}
						});

						gd_process_export_posts(el, post_type, total_posts, chunk_size, pages, 1, filters, true);
						return false; // prevent submit
					});

					jQuery.fn.gdposts_timer = function() {
						pseconds++;
						jQuery(this).text( pseconds.toString().toHMS() );
					}

					var timer_cats;
					var cseconds;
					jQuery(&#039;#gd_ie_excats_submit&#039;).on(&quot;click&quot;,function(){
						cseconds = 1;

						jQuery(&#039;.gd-export-categories-progress&#039;).show();

						var el = jQuery(this).closest(&#039;.card-body&#039;);
						var post_type = jQuery(el).find(&#039;#gd_post_type&#039;).val();
						if ( !post_type ) {
							jQuery(el).find(&#039;#gd_post_type&#039;).focus();
							return false;
						}
						window.clearInterval(timer_cats);

						jQuery(this).prop(&#039;disabled&#039;, true);

						timer_cats = window.setInterval( function() {
							jQuery(el).find(&quot;.gd_timer&quot;).gdcats_timer();
						}, 1000);

						var chunk_size = parseInt(jQuery(&#039;#gd_chunk_size&#039;, el).val());
						var total_cats = parseInt(jQuery(&#039;option:selected&#039;, jQuery(el).find(&#039;#gd_post_type&#039;)).attr(&#039;data-cats&#039;));
						chunk_size = chunk_size &lt; 50 || chunk_size &gt; 100000 ? 5000 : chunk_size;
						if (chunk_size &gt; total_cats) {
							chunk_size = total_cats;
						}
						var pages = Math.ceil( total_cats / chunk_size );

						gd_process_export_cats(el, post_type, total_cats, chunk_size, pages, 1);
						return false;//prevent form submit
					});

					jQuery.fn.gdcats_timer = function() {
						cseconds++;
						jQuery(this).text( cseconds.toString().toHMS() );
					}

					String.prototype.toHMS = function () {
						var sec_num = parseInt(this, 10); // don&#039;t forget the second param
						var hours   = Math.floor(sec_num / 3600);
						var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
						var seconds = sec_num - (hours * 3600) - (minutes * 60);

						if (hours   &lt; 10) {hours   = &quot;0&quot;+hours;}
						if (minutes &lt; 10) {minutes = &quot;0&quot;+minutes;}
						if (seconds &lt; 10) {seconds = &quot;0&quot;+seconds;}
						var time    = hours+&#039;:&#039;+minutes+&#039;:&#039;+seconds;
						return time;
					}

					function gd_process_export_posts(el, post_type, total_posts, chunk_size, pages, page, filters, doFilter) {

						var attach = (typeof filters !== &#039;undefined&#039; &amp;&amp; filters) ? filters : &#039;&#039;;
						var getTotal = false;
						if (page &lt; 2) {
							if (typeof filters !== &#039;undefined&#039; &amp;&amp; filters &amp;&amp; doFilter) {
								getTotal = true;
								attach += &#039;&amp;_c=1&#039;;
								gd_progressbar(el, 0, &#039;&lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Preparing...&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
							} else {
								gd_progressbar(el, 0, &#039;0% (0 / &#039; + total_posts + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Exporting...&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
							}
							jQuery(el).find(&#039;#gd_timer&#039;).text(&#039;00:00:01&#039;);
							jQuery(&#039;#gd_ie_ex_files&#039;, el).html(&#039;&#039;);
						}

						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=export_posts&amp;_pt=&#039; + post_type + &#039;&amp;_n=&#039; + chunk_size + &#039;&amp;_nonce=&lt;?php echo $nonce;?&gt;&amp;_p=&#039; + page + attach,
							dataType : &#039;json&#039;,
							cache: false,
							beforeSend: function (jqXHR, settings) {},
							success: function( data ) {
								jQuery(el).find(&#039;input[type=&quot;submit&quot;]&#039;).prop(&#039;disabled&#039;, false);

								if (typeof data == &#039;object&#039;) {
									if (typeof data.success != &#039;undefined&#039; &amp;&amp; data.success == false) {
										gd_progressbar(el, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + data.data);
										window.clearInterval(timer_posts);
									} else {
										if (getTotal) {
											if (typeof data.total != &#039;undefined&#039; ) {
												total_posts = parseInt(data.total);
												if (chunk_size &gt; total_posts) {
													chunk_size = total_posts;
												}
												pages = Math.ceil( total_posts / chunk_size );

												return gd_process_export_posts(el, post_type, total_posts, chunk_size, pages, 1, filters);
											}
										} else {
											if (pages &lt; page || pages == page) {
												window.clearInterval(timer_posts);
												gd_progressbar(el, 100, &#039;100% (&#039; + total_posts + &#039; / &#039; + total_posts + &#039;) &lt;i class=&quot;fas fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Complete!&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
											} else {
												var percentage = Math.round(((page * chunk_size) / total_posts) * 100);
												percentage = percentage &gt; 100 ? 100 : percentage;
												gd_progressbar(el, percentage, &#039;&#039; + percentage + &#039;% (&#039; + ( page * chunk_size ) + &#039; / &#039; + total_posts + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Exporting...&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
											}
											if (typeof data.files != &#039;undefined&#039; &amp;&amp; jQuery(data.files).length ) {
												var obj_files = data.files;
												var files = &#039;&#039;;
												for (var i in data.files) {
													files += &#039;&lt;p&gt;&#039;+ obj_files[i].i +&#039; &lt;a download=&quot;&#039; + ((obj_files[i].u).replace(/^.*[\\\/]/, &#039;&#039;)) + &#039;&quot; class=&quot;gd-ie-file&quot; href=&quot;&#039; + obj_files[i].u + &#039;&quot; target=&quot;_blank&quot;&gt;&#039; + obj_files[i].u + &#039;&lt;/a&gt; (&#039; + obj_files[i].s + &#039;)&lt;/p&gt;&#039;;
												}
												jQuery(&#039;#gd_ie_ex_files&#039;, el).append(files);
												if (pages &gt; page) {
													return gd_process_export_posts(el, post_type, total_posts, chunk_size, pages, (page + 1));
												}
												return true;
											}
										}
									}
								}
							},
							error: function( data ) {
								jQuery(el).find(&#039;input[type=&quot;submit&quot;]&#039;).prop(&#039;disabled&#039;, false);
								window.clearInterval(timer_posts);
								return;
							},
							complete: function( jqXHR, textStatus  ) {
								return;
							}
						});
					}

					function gd_process_export_cats(el, post_type, total_cats, chunk_size, pages, page) {
						if (page &lt; 2) {
							gd_progressbar(el, 0, &#039;0% (0 / &#039; + total_cats + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Exporting...&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
							jQuery(el).find(&#039;#gd_timer&#039;).text(&#039;00:00:01&#039;);
							jQuery(&#039;#gd_ie_ex_files&#039;, el).html(&#039;&#039;);
						}

						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=export_cats&amp;_pt=&#039; + post_type + &#039;&amp;_n=&#039; + chunk_size + &#039;&amp;_nonce=&lt;?php echo $nonce;?&gt;&amp;_p=&#039; + page,
							dataType : &#039;json&#039;,
							cache: false,
							beforeSend: function (jqXHR, settings) {},
							success: function( data ) {
								jQuery(el).find(&#039;input[type=&quot;submit&quot;]&#039;).prop(&#039;disabled&#039;, false);

								if (typeof data == &#039;object&#039;) {
									if (typeof data.success != &#039;undefined&#039; &amp;&amp; data.success == false) {
										gd_progressbar(el, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + data.data);
										window.clearInterval(timer_cats);
									} else {
										if (pages &lt; page || pages == page) {
											window.clearInterval(timer_cats);
											gd_progressbar(el, 100, &#039;100% (&#039; + total_cats + &#039; / &#039; + total_cats + &#039;) &lt;i class=&quot;fas fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Complete!&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
										} else {
											var percentage = Math.round(((page * chunk_size) / total_cats) * 100);
											percentage = percentage &gt; 100 ? 100 : percentage;
											gd_progressbar(el, percentage, &#039;&#039; + percentage + &#039;% (&#039; + ( page * chunk_size ) + &#039; / &#039; + total_cats + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php esc_attr_e( &#039;Exporting...&#039;, &#039;geodirectory&#039; );?&gt;&#039;);
										}
										if (typeof data.files != &#039;undefined&#039; &amp;&amp; jQuery(data.files).length ) {
											var obj_files = data.files;
											var files = &#039;&#039;;
											for (var i in data.files) {
												files += &#039;&lt;p&gt;&#039;+ obj_files[i].i +&#039; &lt;a class=&quot;gd-ie-file&quot; download=&quot;&#039; + ((obj_files[i].u).replace(/^.*[\\\/]/, &#039;&#039;)) + &#039;&quot; href=&quot;&#039; + obj_files[i].u + &#039;&quot; target=&quot;_blank&quot;&gt;&#039; + obj_files[i].u + &#039;&lt;/a&gt; (&#039; + obj_files[i].s + &#039;)&lt;/p&gt;&#039;;
											}
											jQuery(&#039;#gd_ie_ex_files&#039;, el).append(files);
											if (pages &gt; page) {
												return gd_process_export_cats(el, post_type, total_cats, chunk_size, pages, (page + 1));
											}
											return true;
										}
									}
								}
							},
							error: function( data ) {
								jQuery(el).find(&#039;input[type=&quot;submit&quot;]&#039;).prop(&#039;disabled&#039;, false);
								window.clearInterval(timer_cats);
								return;
							},
							complete: function( jqXHR, textStatus  ) {
								return;
							}
						});
					}
					
					// Export
					var timer, vSec;
					jQuery(&#039;#gd_start_export&#039;).on(&#039;click&#039;, function(e) {
						geodir_start_export(this);
						e.preventDefault();
						return false;
					});
					$.fn.gdtimer = function(vSec) {
						$(this).text(vSec.toString().toHMS());
					}

					function geodir_start_export(el) {
						var $this, $parent, sExport, fields = &#039;&#039;, iPerPage;
						$this = $(el);
						jQuery(&#039;.gd-export-reviews-progress&#039;).show();
						$parent = $this.closest(&#039;.card-body&#039;);
						sExport = $this.data(&#039;export&#039;);
						iPerPage = parseInt($(&#039;#gd_chunk_size&#039;, $parent).val());
						if (!sExport) {
							return false;
						}
						vSec = 1;
						jQuery(&#039;[name^=&quot;gd_imex[&quot;]&#039;, $parent).each(function() {
							v = $(this).val();
							v = typeof v == &#039;string&#039; &amp;&amp; v !== &#039;&#039; ? v.trim() : &#039;&#039;;
							if (v != &#039;undefined&#039;) {
								fields += &#039;&amp;&#039; + $(this).prop(&#039;name&#039;) + &#039;=&#039; + v;
							}
						});
						$this.prop(&#039;disabled&#039;, true);
						window.clearInterval(timer);
						timer = window.setInterval(function() {
							vSec++;
							$(&#039;.gd_timer&#039;, $parent).gdtimer(vSec);
						}, 1000);
						
						gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Preparing export...&#039;, &#039;geodirectory&#039; ) ); ?&gt;&#039;);
						$(&#039;#gd_timer&#039;, $parent).text(&#039;00:00:01&#039;);
						$(&#039;#gd_ie_ex_files&#039;, $parent).html(&#039;&#039;);
						
						data = fields + &#039;&amp;_export=&#039; + sExport; 
						
						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=prepare_export&amp;_nonce=&lt;?php echo $nonce;?&gt;&#039; + data,
							dataType: &#039;json&#039;,
							cache: false,
							beforeSend: function(xhr, settings) {},
							success: function(res) {
								var err = true;
								if (typeof res == &#039;object&#039;) {
									if (res.total != &#039;undefined&#039;) {
										if ( parseInt(res.total) &gt; 0) {
											err = false;
											$this.data(&#039;total&#039;, res.total);
											gd_progressbar($parent, 0, &#039;0% (0 / &#039; + res.total + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Exporting...&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
											geodir_export($parent, sExport, fields, iPerPage, 1);
										} else {
											gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-info-circle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;No records to export.&#039;, &#039;geodirectory&#039; ) );?&gt;&#039;);
										}
									} else {
										if (typeof res.success != &#039;undefined&#039; &amp;&amp; res.success == false) {
											gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + res.data);
										}
									}
								}
								if (err) {
									$this.prop(&#039;disabled&#039;, false);
									window.clearInterval(timer);
								}
							},
							error: function(xhr, sStatus, oErr) {
								console.log(sStatus + &#039;: &#039; + oErr.message);
								$this.prop(&#039;disabled&#039;, false);
								gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + sStatus + &#039;: &#039; + xhr.responseText);
								window.clearInterval(timer);
								return;
							},
							complete: function(xhr, sStatus) {
								return;
							}
						});
					}

					function geodir_export($parent, sExport, fields, iPerPage, iPage) {
						var $submit, iTotal, iPages;
						$submit = $(&#039;input[type=&quot;submit&quot;]&#039;, $parent);
						iTotal = parseInt($submit.data(&#039;total&#039;));
						iPages = Math.ceil( iTotal / iPerPage );
						
						data = fields + &#039;&amp;_export=&#039; + sExport + &#039;&amp;_c=&#039; + iTotal + &#039;&amp;_n=&#039; + iPerPage + &#039;&amp;_p=&#039; + iPage; 
						
						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=export&amp;_nonce=&lt;?php echo $nonce;?&gt;&#039; + data,
							dataType: &#039;json&#039;,
							cache: false,
							beforeSend: function(xhr, settings) {},
							success: function(res) {
								$submit.prop(&#039;disabled&#039;, false);
								if (typeof res == &#039;object&#039;) {
									if (typeof res.success != &#039;undefined&#039; &amp;&amp; res.success == false) {
										gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + res.data);
										window.clearInterval(timer);
									} else {
										if (iPages &lt; iPage || iPages == iPage) {
											window.clearInterval(timer);
											gd_progressbar($parent, 100, &#039;100% (&#039; + iTotal + &#039; / &#039; + iTotal + &#039;) &lt;i class=&quot;fas fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php echo esc_attr( __( &#039;Complete!&#039;, &#039;geodirectory &#039; ) );?&gt;&#039;);
										} else {
											var percentage = Math.round(((iPage * iPerPage) / iTotal) * 100);
											percentage = percentage &gt; 100 ? 100 : percentage;
											gd_progressbar($parent, percentage, percentage + &#039;% (&#039; + (iPage * iPerPage) + &#039; / &#039; + iTotal + &#039;) &lt;i class=&quot;fas fa-sync fa-spin&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;?php esc_attr_e( &#039;Exporting...&#039;, &#039;geodirectory &#039; );?&gt;&#039;);
										}
										if (typeof res.files != &#039;undefined&#039; &amp;&amp; $(res.files).length) {
											var obj_files = res.files;
											var files = &#039;&#039;;
											for (var i in res.files) {
												files += &#039;&lt;p&gt;&#039; + obj_files[i].i + &#039; &lt;a class=&quot;gd-ie-file&quot; download=&quot;&#039; + ((obj_files[i].u).replace(/^.*[\\\/]/, &#039;&#039;)) + &#039;&quot; href=&quot;&#039; + obj_files[i].u + &#039;&quot; target=&quot;_blank&quot;&gt;&#039; + obj_files[i].u + &#039;&lt;/a&gt; (&#039; + obj_files[i].s + &#039;)&lt;/p&gt;&#039;;
											}
											$(&#039;#gd_ie_ex_files&#039;, $parent).append(files);
											if (iPages &gt; iPage) {
												return geodir_export($parent, sExport, fields, iPerPage, (iPage + 1));
											}
											return true;
										}
									}
								}
							},
							error: function(xhr, sStatus, oErr) {
								console.log(sStatus + &#039;: &#039; + oErr.message);
								$submit.prop(&#039;disabled&#039;, false);
								if (page &lt; 2) {
									gd_progressbar($parent, 0, &#039;&lt;i class=&quot;fas fa-exclamation-triangle&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&#039; + sStatus + &#039;: &#039; + xhr.responseText);
								}
								window.clearInterval(timer);
								return;
							},
							complete: function(xhr, sStatus) {
								return;
							}
						});
					}
				});

				function gd_imex_FinishImport(el, type) {
					if (type==&#039;post&#039;) {
						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=import_finish&amp;_pt=&#039; + type + &#039;&amp;_nonce=&lt;?php echo $nonce; ?&gt;&#039;,
							dataType : &#039;json&#039;,
							cache: false,
							success: function (data) {
								//import done
							}
						});
					}
				}

				function gd_imex_import_settings(el, type) {

					//alert(&#039;import&#039;);

					var cont = jQuery(el).closest(&#039;.card-body&#039;);
					var gd_prepared = jQuery(&#039;#gd_prepared&#039;, cont).val();
					var uploadedFile = jQuery(&#039;#gd_im_&#039; + type, cont).val();
					jQuery(&#039;gd-import-msg&#039;, cont).hide();
					if(gd_prepared == uploadedFile) {
						gd_imex_ContinueImport(el, type);
						jQuery(&#039;#gd_import_data&#039;, cont).attr(&#039;disabled&#039;, &#039;disabled&#039;);
					} else {
						jQuery.ajax({
							url: ajaxurl,
							type: &quot;POST&quot;,
							data: &#039;action=geodir_import_export&amp;task=import_settings&amp;_file=&#039; + uploadedFile + &#039;&amp;_nonce=&lt;?php echo $nonce;?&gt;&#039;,
							dataType: &#039;json&#039;,
							cache: false,
							success: function(data) {
								if(typeof data == &#039;object&#039;) {
									if(data.success) {
										jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;error&#039;).addClass(&#039;updated&#039;).html( data.data );
										jQuery(&#039;#gd-import-msg&#039;, cont).show();
									} else{
										jQuery(&#039;#gd-import-msg&#039;, cont).find(&#039;#message&#039;).removeClass(&#039;updated&#039;).addClass(&#039;error&#039;).html( data.data );
										jQuery(&#039;#gd-import-msg&#039;, cont).show();
									}
								}
							},
							error: function(errorThrown) {
								console.log(errorThrown);
							}
						});
					}
				}
				
			&lt;/script&gt;
			&lt;?php
		}
	}

endif;

return new GeoDir_Settings_Import_Export();
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 07:38 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652341136"></script>
    <script src="../js/search.js?updated=1652341136"></script>
</body>
</html>
