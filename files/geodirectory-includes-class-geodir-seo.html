<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652341136">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652341136">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpgeodirectory.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://ayecode.io/careers/" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-seo.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * GeoDirectory GeoDir_SEO.
 *
 * Adds meta info and titles to GD pages for SEO.
 *
 * @class    GeoDir_SEO
 * @package  GeoDirectory/Classes
 * @category Class
 * @author   AyeCode
 */
class GeoDir_SEO {

	// some global values
	public static $title = &#039;&#039;;
	public static $meta_title = &#039;&#039;;
	public static $meta_description = &#039;&#039;;

	public static $gd_page = &#039;&#039;;
	public static $doing_menu = false;


	/**
	 * Initiate the class.
     *
     * @since 2.0.0
	 */
	public static function init() {
		add_action( &#039;init&#039;,array(__CLASS__,&#039;maybe_run&#039;) );

		// maybe noindex empty archive pages
		add_action(&#039;wp_head&#039;, array(__CLASS__,&#039;maybe_noindex_empty_archives&#039;));
		add_filter( &#039;wpseo_frontend_presentation&#039;, array( __CLASS__, &#039;wpseo_frontend_presentation&#039; ), 11, 2 );
		add_filter(&#039;wpseo_breadcrumb_links&#039;, array(__CLASS__, &#039;breadcrumb_links&#039;));
		add_filter( &#039;wpseo_robots_array&#039;, array( __CLASS__, &#039;wpseo_robots_array&#039; ), 20, 2 );
		add_filter( &#039;get_post_metadata&#039;, array( __CLASS__, &#039;filter_post_metadata&#039; ), 99, 5 );
		add_filter( &#039;rank_math/frontend/breadcrumb/settings&#039;, array( __CLASS__, &#039;rank_math_frontend_breadcrumb_settings&#039; ), 20, 1 );
		add_filter( &#039;rank_math/frontend/breadcrumb/items&#039;, array( __CLASS__, &#039;rank_breadcrumb_links&#039; ), 10, 2 );
		add_filter( &#039;rank_math/frontend/breadcrumb/main_term&#039;, array( __CLASS__, &#039;rank_math_frontend_breadcrumb_main_term&#039; ), 20, 2 );

		add_filter( &#039;wpseo_exclude_from_sitemap_by_post_ids&#039;, array( __CLASS__, &#039;wpseo_exclude_from_sitemap_by_post_ids&#039; ), 20, 1 );
		if ( ! is_admin() ) {
			add_filter( &#039;page_link&#039;, array( __CLASS__, &#039;page_link&#039; ), 10, 3 );
		}

		add_action( &#039;template_redirect&#039;, array( __CLASS__, &#039;template_redirect&#039; ), 9999 );

		// WP Sitemaps
		add_filter( &#039;wp_sitemaps_posts_query_args&#039;, array( __CLASS__, &#039;wp_sitemaps_exclude_post_ids&#039; ), 20, 2 );

		add_action(&#039;wp_head&#039;, function() {
			if ( geodir_is_page( &#039;search&#039; ) ) {
				add_filter( &#039;wpseo_frontend_page_type_simple_page_id&#039;, array( __CLASS__ , &#039;wpseo_frontend_page_type_simple_page_id&#039; ), 10, 1 );
			}
		}, 0 );
		add_action(&#039;wp_head&#039;, function() {
			if ( geodir_is_page( &#039;search&#039; ) ) {
				remove_filter( &#039;wpseo_frontend_page_type_simple_page_id&#039;, array( __CLASS__ , &#039;wpseo_frontend_page_type_simple_page_id&#039; ), 10, 1 );
			}
		}, 99 );
	}

	/**
	 * If set to do so, add noindex tag to GD archive pages.
	 */
	public static function maybe_noindex_empty_archives(){
		if( geodir_get_option(&#039;noindex_archives&#039;) &amp;&amp; ( geodir_is_page(&#039;archive&#039;) || geodir_is_page(&#039;post_type&#039;) ) ){
			if(geodir_is_empty_archive() ){
				echo &#039;&lt;meta name=&quot;robots&quot; content=&quot;noindex&quot;&gt;&#039;;
			}
		}
	}

	public static function yoast_enabled() {
		global $geodir_options;

		return defined( &#039;WPSEO_VERSION&#039; ) &amp;&amp; ( ! isset( $geodir_options[&#039;wpseo_disable&#039;] ) || ( isset( $geodir_options[&#039;wpseo_disable&#039;] ) &amp;&amp; $geodir_options[&#039;wpseo_disable&#039;] == &#039;0&#039; ) ) ? true : false;
	}

	public static function rank_math_enabled() {
		global $geodir_options;

		return defined( &#039;RANK_MATH_VERSION&#039; ) &amp;&amp; ( ! isset( $geodir_options[&#039;rank_math_disable&#039;] ) || ( isset( $geodir_options[&#039;rank_math_disable&#039;] ) &amp;&amp; $geodir_options[&#039;rank_math_disable&#039;] == &#039;0&#039; ) ) ? true : false;
	}

	/**
	 * Check SEOPress options enabled or not.
	 *
	 * @since 2.2.7
	 *
	 * @return bool True if SEOPress is enabled else False.
	 */
	public static function seopress_enabled(){
		global $geodir_options;

		return function_exists( &#039;seopress_activation&#039; ) &amp;&amp; ( ! isset( $geodir_options[&#039;seopress_disable&#039;] ) || ( isset( $geodir_options[&#039;seopress_disable&#039;] ) &amp;&amp; $geodir_options[&#039;seopress_disable&#039;] == &#039;0&#039; ) ) ? true : false;
	}

	public static function maybe_run() {
		// Bail if we have a SEO plugin installed.
		if (
			self::yoast_enabled() // Don&#039;t run if active and not set to be disabled 
			|| self::rank_math_enabled() // Don&#039;t run if active and not set to be disabled 
			|| self::seopress_enabled() // SEOPress
			|| class_exists( &#039;All_in_One_SEO_Pack&#039; )  // don&#039;t run if active 
			|| is_admin()  // No need to run in wp-admin
		) {
			// Even if disabled we still need to replace title vars
			if ( ! is_admin() ) {
				// Set a global so we don&#039;t change the menu items titles
				add_filter( &#039;pre_wp_nav_menu&#039;, array( __CLASS__, &#039;set_menu_global&#039; ), 10, 2 );
				add_filter( &#039;wp_nav_menu&#039;, array( __CLASS__, &#039;unset_menu_global&#039; ) );

				// YOOtheme renders own menuwalker.
				if ( class_exists( &#039;YOOtheme\\Theme&#039; ) ) {
					add_filter( &#039;wp_nav_menu_items&#039;,array( __CLASS__, &#039;unset_menu_global&#039; ), 999, 1 );
				}

				if ( self::has_yoast_14() ) {
					add_filter( &#039;wpseo_twitter_title&#039;, array( __CLASS__, &#039;wpseo_twitter_title&#039; ), 10, 2 );
					add_filter( &#039;wpseo_title&#039;, array( __CLASS__, &#039;wpseo_title&#039; ), 20, 2 );
					add_filter( &#039;wpseo_metadesc&#039;, array( __CLASS__, &#039;wpseo_metadesc&#039; ), 20, 2 );

					add_filter( &#039;wpseo_opengraph_url&#039;, array( __CLASS__, &#039;wpseo_opengraph_url&#039; ), 20, 2 );
					add_filter( &#039;wpseo_add_opengraph_additional_images&#039;, array( __CLASS__, &#039;wpseo_opengraph_image&#039; ), 20, 1 );
					add_filter( &#039;wpseo_canonical&#039;, array( __CLASS__, &#039;wpseo_canonical&#039; ), 20, 2 );
					add_filter( &#039;wpseo_adjacent_rel_url&#039;, array( __CLASS__, &#039;wpseo_adjacent_rel_url&#039; ), 20, 3 );

					add_action( &#039;wpseo_register_extra_replacements&#039;, array( __CLASS__, &#039;wpseo_register_extra_replacements&#039; ), 20 );
				}

				// page title
				add_filter(&#039;the_title&#039;,array(__CLASS__,&#039;output_title&#039;),10,2);
				add_filter(&#039;get_the_archive_title&#039;,array(__CLASS__,&#039;output_title&#039;),10);

				// setup vars
				add_action( &#039;pre_get_document_title&#039;, array( __CLASS__, &#039;set_meta&#039; ), 9 );
			}

			if ( defined( &#039;RANK_MATH_VERSION&#039; ) ) {
				add_action( &#039;rank_math/vars/register_extra_replacements&#039;, array( __CLASS__, &#039;rank_math_vars_register_extra_replacements&#039; ), 20 );
			}

			return;
		}

		// Set a global so we don&#039;t change the menu items titles
		add_filter( &#039;pre_wp_nav_menu&#039;, array( __CLASS__, &#039;set_menu_global&#039; ), 10, 2 );
		add_filter( &#039;wp_nav_menu&#039;, array( __CLASS__, &#039;unset_menu_global&#039; ) );

		// YOOtheme renders own menuwalker.
		if ( class_exists( &#039;YOOtheme\\Theme&#039; ) ) {
			add_filter( &#039;wp_nav_menu_items&#039;,array( __CLASS__, &#039;unset_menu_global&#039; ), 999, 1 );
		}

		// meta title
		add_filter(&#039;wp_title&#039;, array(__CLASS__,&#039;output_meta_title&#039;),1000,2);
		add_filter(&#039;pre_get_document_title&#039;, array(__CLASS__,&#039;output_meta_title&#039;), 1000);

		// page title
		add_filter(&#039;the_title&#039;,array(__CLASS__,&#039;output_title&#039;),10,2);
		add_filter(&#039;get_the_archive_title&#039;,array(__CLASS__,&#039;output_title&#039;),10);

		// setup vars
		add_action(&#039;pre_get_document_title&#039;, array(__CLASS__,&#039;set_meta&#039;),9);

		// Meta title &amp; meta description
		if ( self::has_yoast() ) {
			// Yoast SEO v14.x
			if ( self::has_yoast_14() ) {
				add_filter( &#039;wpseo_twitter_title&#039;, array( __CLASS__, &#039;get_title&#039; ), 10, 1 );
				add_filter( &#039;wpseo_twitter_description&#039;, array( __CLASS__, &#039;get_description&#039; ), 10, 1 );
				add_filter( &#039;wpseo_opengraph_title&#039;, array( __CLASS__, &#039;get_title&#039; ), 10, 1 );
				add_filter( &#039;wpseo_opengraph_desc&#039;, array( __CLASS__, &#039;get_description&#039; ), 10, 1 );
				add_filter( &#039;wpseo_opengraph_url&#039;, array( __CLASS__, &#039;wpseo_opengraph_url&#039; ), 20, 2 );
				add_filter( &#039;wpseo_add_opengraph_additional_images&#039;, array( __CLASS__, &#039;wpseo_opengraph_image&#039; ), 20, 1 );
				add_filter( &#039;wpseo_canonical&#039;, array( __CLASS__, &#039;wpseo_canonical&#039; ), 20, 2 );
				add_filter( &#039;wpseo_adjacent_rel_url&#039;, array( __CLASS__, &#039;wpseo_adjacent_rel_url&#039; ), 20, 3 );
			}

			add_filter( &#039;wpseo_title&#039;, array( __CLASS__, &#039;get_title&#039; ), 10, 1 );
			add_filter( &#039;wpseo_metadesc&#039;, array( __CLASS__, &#039;get_description&#039; ), 10, 1 );
		} elseif ( defined( &#039;RANK_MATH_VERSION&#039; ) ) {
			add_filter( &#039;rank_math/frontend/description&#039;, array( __CLASS__,&#039;get_description&#039; ), 10, 1 );
			add_filter( &#039;rank_math/frontend/title&#039;, array( __CLASS__, &#039;get_title&#039; ), 10, 1 );
		} else {
			add_action( &#039;wp_head&#039;, array( __CLASS__, &#039;output_description&#039; ) );
		}
	}

	/**
	 * Set the global var when a menu is being output.
     *
     * @since 2.0.0
	 *
	 * @param string $menu Menu.
	 *
	 * @return string $menu
	 */
	public static function set_menu_global($menu,$args){
		if ( null === $menu ) {
			if ( empty( $args-&gt;menu ) &amp;&amp; ! empty( $args-&gt;theme_location ) &amp;&amp; ( $locations = get_nav_menu_locations() ) &amp;&amp; ! isset( $locations[ $args-&gt;theme_location ] ) ) {
				// Don&#039;t set $doing_menu for incorrect menu.
			} else {
				self::$doing_menu = true;
			}
		}

		return $menu;
	}

	/**
	 * Unset the global var when a menu has finished being output.
     *
     * @since 2.0.0
	 *
	 * @param string $menu Menu.
	 *
	 * @return string $menu
	 */
	public static function unset_menu_global($menu){
		self::$doing_menu = false;
		return $menu;
	}


	/**
	 * Output a page title.
     *
     * @since 2.0.0
	 *
	 * @param string $title Optional. Title. Default null.
	 * @param int $id Optional. ID. Default 0.
	 *
	 * @return string $title.
	 */
	public static function output_title( $title = &#039;&#039;, $id = 0 ) {
		global $wp_query,$gdecs_render_loop;

		// In some themes the object id is missing so we fix it
		$query_object_id = &#039;&#039;;

		if ( $id &amp;&amp; isset( $wp_query-&gt;post-&gt;ID ) &amp;&amp; geodir_is_geodir_page_id( $id ) ) {
			$query_object_id = $wp_query-&gt;post-&gt;ID;
		} elseif ( ! is_null( $wp_query ) ) {
			$query_object_id = get_queried_object_id();
		}

		if ( self::$title &amp;&amp; empty( $id ) &amp;&amp; ! self::$doing_menu ) {
			$title = self::$title;
		} elseif ( self::$title &amp;&amp; ! empty( $id ) &amp;&amp; $query_object_id == $id &amp;&amp; ! self::$doing_menu &amp;&amp; !$gdecs_render_loop) {
			$title = self::$title;
			/**
			 * Filter page title to replace variables.
			 *
			 * @param string $title The page title including variables.
			 * @param string $id The page id.
			 */
			$title = apply_filters( &#039;geodir_seo_title&#039;, __( $title, &#039;geodirectory&#039; ), $title, $id );
		}

		// Strip duplicate whitespace.
		if ( $title != &#039;&#039; ) {
			$title = normalize_whitespace( $title );
		}

		return $title;
	}

	/**
	 * Output a page meta title.
     *
     * @since 2.0.0
	 *
	 * @param string $title Optional. Title. Default null.
	 * @param string $sep Optional. Separator. Default null.
	 *
	 * @return mixed|void
	 */
	public static function output_meta_title( $title = &#039;&#039;, $sep = &#039;&#039; ) {
		if ( self::$meta_title ) {
			$title = self::$meta_title;
		}

		/**
		 * Filter page meta title to replace variables.
		 *
		 * @since 1.5.4
		 * @param string $title The page title including variables.
		 * @param string $gd_page The GeoDirectory page type if any.
		 * @param string $sep The title separator symbol.
		 */
		$title = apply_filters( &#039;geodir_seo_meta_title&#039;, __( $title, &#039;geodirectory&#039; ), self::$gd_page, $sep );

		// Strip duplicate whitespace.
		if ( $title != &#039;&#039; ) {
			$title = normalize_whitespace( $title );
		}

		return $title;
	}

	/**
	 * Get a page meta description.
	 *
	 * @since 2.0.0
	 */
	public static function get_description( $description = &#039;&#039; ) {
		$meta_description = self::$meta_description;

		if ( ! empty( $meta_description ) ) {
			$description = $meta_description;
		}

		// escape
		if ( ! empty( $description ) ) {
			$description = esc_attr( $description );
		}

		/**
		 * Filter SEO meta description.
		 *
		 * @since 1.0.0
		 *
		 * @param string $description Meta description.
		 */
		$description = apply_filters( &#039;geodir_seo_meta_description&#039;, $description, $meta_description );

		// Strip duplicate whitespace.
		if ( $description != &#039;&#039; ) {
			$description = normalize_whitespace( $description );
		}

		return $description;
	}

	/**
	 * Get a page meta title.
	 *
	 * @since 2.0.0
	 */
	public static function get_title( $title = &#039;&#039; ) {
		$meta_title= self::$meta_title;

		if ( ! empty( $meta_title ) ) {
			$title = $meta_title;
		}

		// escape
		if ( !empty( $title ) ) {
			$title = esc_attr( $title );
		}
		/**
		 * Filter SEO meta title.
		 *
		 * @param string $title Meta title.
		 */
		$title = apply_filters( &#039;geodir_seo_meta_title&#039;, $title, $meta_title );

		// Strip duplicate whitespace.
		if ( $title != &#039;&#039; ) {
			$title = normalize_whitespace( $title );
		}

		return $title;
	}

	/**
	 * Output a page meta description.
     *
     * @since 2.0.0
	 */
	public static function output_description(){
		$description = self::get_description();
		echo &#039;&lt;meta name=&quot;description&quot; content=&quot;&#039; . $description . &#039;&quot; /&gt;&#039;;
	}

	/**
	 * Set the title and meta info depending on the current page being visited.
     *
     * @since 2.0.0
	 */
	public static function set_meta() {
		$gd_settings = geodir_get_settings();

		if ( geodir_is_page( &#039;pt&#039; ) ) {
			self::$gd_page = &#039;pt&#039;;
			$post_type = geodir_get_current_posttype();
			$post_type_info = get_post_type_object( $post_type );

			if ( isset( $post_type_info-&gt;seo[&#039;title&#039;] ) &amp;&amp; ! empty( $post_type_info-&gt;seo[&#039;title&#039;] ) ) {
				self::$title = $post_type_info-&gt;seo[&#039;title&#039;];
			} else {
				self::$title = ! empty( $gd_settings[&#039;seo_cpt_title&#039;] ) ? $gd_settings[&#039;seo_cpt_title&#039;] : GeoDir_Defaults::seo_cpt_title();
			}

			if ( isset( $post_type_info-&gt;seo[&#039;meta_title&#039;] ) &amp;&amp; ! empty( $post_type_info-&gt;seo[&#039;meta_title&#039;] ) ) {
				self::$meta_title = $post_type_info-&gt;seo[&#039;meta_title&#039;];
			} else {
				self::$meta_title = ! empty( $gd_settings[&#039;seo_cpt_meta_title&#039;] ) ? $gd_settings[&#039;seo_cpt_meta_title&#039;] : GeoDir_Defaults::seo_cpt_meta_title();
			}

			if ( isset( $post_type_info-&gt;seo[&#039;meta_description&#039;] ) &amp;&amp; ! empty( $post_type_info-&gt;seo[&#039;meta_description&#039;] ) ) {
				self::$meta_description = $post_type_info-&gt;seo[&#039;meta_description&#039;];
			} else {
				self::$meta_description = ! empty( $gd_settings[&#039;seo_cpt_meta_description&#039;] ) ? $gd_settings[&#039;seo_cpt_meta_description&#039;] : GeoDir_Defaults::seo_cpt_meta_description();
			}
		} elseif ( geodir_is_page( &#039;archive&#039; ) ) {
			self::$gd_page = &#039;archive&#039;;
			$queried_object = get_queried_object();

			if ( isset( $queried_object-&gt;taxonomy ) &amp;&amp; geodir_taxonomy_type( $queried_object-&gt;taxonomy ) == &#039;category&#039; &amp;&amp; geodir_is_gd_taxonomy( $queried_object-&gt;taxonomy ) ) {
				self::$title = ! empty( $gd_settings[&#039;seo_cat_archive_title&#039;] ) ? $gd_settings[&#039;seo_cat_archive_title&#039;] : GeoDir_Defaults::seo_cat_archive_title();
				self::$meta_title = ! empty( $gd_settings[&#039;seo_cat_archive_meta_title&#039;] ) ? $gd_settings[&#039;seo_cat_archive_meta_title&#039;] : GeoDir_Defaults::seo_cat_archive_meta_title();
				self::$meta_description = ! empty( $gd_settings[&#039;seo_cat_archive_meta_description&#039;] ) ? $gd_settings[&#039;seo_cat_archive_meta_description&#039;] : GeoDir_Defaults::seo_cat_archive_meta_description();
			} elseif ( isset($queried_object-&gt;taxonomy ) &amp;&amp; geodir_taxonomy_type( $queried_object-&gt;taxonomy ) == &#039;tag&#039; &amp;&amp; geodir_is_gd_taxonomy( $queried_object-&gt;taxonomy ) ) {
				self::$title = ! empty( $gd_settings[&#039;seo_tag_archive_title&#039;] ) ? $gd_settings[&#039;seo_tag_archive_title&#039;] : GeoDir_Defaults::seo_tag_archive_title();
				self::$meta_title = ! empty( $gd_settings[&#039;seo_tag_archive_meta_title&#039;] ) ? $gd_settings[&#039;seo_tag_archive_meta_title&#039;] : GeoDir_Defaults::seo_tag_archive_meta_title();
				self::$meta_description = ! empty( $gd_settings[&#039;seo_tag_archive_meta_description&#039;] ) ? $gd_settings[&#039;seo_tag_archive_meta_description&#039;] : GeoDir_Defaults::seo_tag_archive_meta_description();
			}
		} elseif ( geodir_is_page( &#039;single&#039; ) ) {
			self::$gd_page = &#039;single&#039;;

			self::$title = ! empty( $gd_settings[&#039;seo_single_title&#039;] ) ? $gd_settings[&#039;seo_single_title&#039;] : GeoDir_Defaults::seo_single_title();
			self::$meta_title = ! empty( $gd_settings[&#039;seo_single_meta_title&#039;] ) ? $gd_settings[&#039;seo_single_meta_title&#039;] : GeoDir_Defaults::seo_single_meta_title();
			self::$meta_description = ! empty( $gd_settings[&#039;seo_single_meta_description&#039;] ) ? $gd_settings[&#039;seo_single_meta_description&#039;] : GeoDir_Defaults::seo_single_meta_description();
		} elseif ( geodir_is_page( &#039;location&#039; ) ) {
			self::$gd_page = &#039;location&#039;;

			self::$title = ! empty( $gd_settings[&#039;seo_location_title&#039;] ) ? $gd_settings[&#039;seo_location_title&#039;] : GeoDir_Defaults::seo_location_title();
			self::$meta_title = ! empty( $gd_settings[&#039;seo_location_meta_title&#039;] ) ? $gd_settings[&#039;seo_location_meta_title&#039;] : GeoDir_Defaults::seo_location_meta_title();
			self::$meta_description = ! empty( $gd_settings[&#039;seo_location_meta_description&#039;] ) ? $gd_settings[&#039;seo_location_meta_description&#039;] : GeoDir_Defaults::seo_location_meta_description();
		} elseif ( geodir_is_page( &#039;search&#039; ) ) {
			self::$gd_page = &#039;search&#039;;

			self::$title = ! empty( $gd_settings[&#039;seo_search_title&#039;] ) ? $gd_settings[&#039;seo_search_title&#039;] : GeoDir_Defaults::seo_search_title();
			self::$meta_title = ! empty( $gd_settings[&#039;seo_search_meta_title&#039;] ) ? $gd_settings[&#039;seo_search_meta_title&#039;] : GeoDir_Defaults::seo_search_meta_title();
			self::$meta_description = ! empty( $gd_settings[&#039;seo_search_meta_description&#039;] ) ? $gd_settings[&#039;seo_search_meta_description&#039;] : GeoDir_Defaults::seo_search_meta_description();
		} elseif ( geodir_is_page( &#039;add-listing&#039; ) ) {
			self::$gd_page = &#039;add-listing&#039;;

			if ( ! empty( $_REQUEST[&#039;pid&#039;] ) ) {
				self::$title = ! empty( $gd_settings[&#039;seo_add_listing_title_edit&#039;] ) ? $gd_settings[&#039;seo_add_listing_title_edit&#039;] : GeoDir_Defaults::seo_add_listing_title_edit();
			} else {
				self::$title = ! empty( $gd_settings[&#039;seo_add_listing_title&#039;] ) ? $gd_settings[&#039;seo_add_listing_title&#039;] : GeoDir_Defaults::seo_add_listing_title();
			}

			self::$meta_title = ! empty( $gd_settings[&#039;seo_add_listing_meta_title&#039;] ) ? $gd_settings[&#039;seo_add_listing_meta_title&#039;] : GeoDir_Defaults::seo_add_listing_meta_title();
			self::$meta_description = ! empty( $gd_settings[&#039;seo_add_listing_meta_description&#039;] ) ? $gd_settings[&#039;seo_add_listing_meta_description&#039;] : GeoDir_Defaults::seo_add_listing_meta_description();
		}

		if ( self::$title ) {
			self::$title = self::replace_variable( self::$title, self::$gd_page );
		}
		if ( self::$meta_title ) {
			self::$meta_title = self::replace_variable( self::$meta_title, self::$gd_page );
		}
		if ( self::$meta_description ) {
			self::$meta_description = self::replace_variable( self::$meta_description, self::$gd_page );
		}

		return self::$title;
	}

	/**
	 * Replace variables with values.
     *
     * @since 2.0.0
	 *
	 * @param string $string Optional. String. Default null.
	 * @param string $gd_page Optional. Geo directory page. Default null.
     *
     * @global object $post WordPress post object.
     * @global object $gd_post Geo directory post object.
	 *
	 * @return string $string.
	 */
	public static function replace_variable( $string = &#039;&#039;, $gd_page = &#039;&#039; ) {
		global $post, $gd_post;

		$post_type = geodir_get_current_posttype();

		// Private address
		$check_address = ( $gd_page == &#039;single&#039; || geodir_is_page( &#039;single&#039; ) ) &amp;&amp; ! empty( $gd_post ) &amp;&amp; GeoDir_Post_types::supports( $post_type, &#039;private_address&#039; ) ? true : false;

		/**
		 * Filter pre meta title.
		 *
		 * @since 2.0.0.76
		 *
		 * @param string $string Meta string.
		 * @param string $gd_page GeoDirectory page.
		 */
		$string = apply_filters( &#039;geodir_seo_pre_replace_variable&#039;, $string, $gd_page );

		if ( strpos( $string, &#039;%%sep%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%sep%%&quot;, self::separator(), $string );
		}

		if ( strpos( $string, &#039;%%title%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%title%%&quot;, $post-&gt;post_title, $string);
		}

		if ( strpos( $string, &#039;%%sitename%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%sitename%%&quot;, get_bloginfo( &#039;name&#039; ), $string );
		}

		if ( strpos( $string, &#039;%%sitedesc%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%sitedesc%%&quot;, get_bloginfo( &#039;description&#039; ), $string );
		}

		if ( strpos( $string, &#039;%%excerpt%%&#039; ) !== false ) {
			$excerpt_length = apply_filters( &#039;excerpt_length&#039;, 55 );
			$post_content = !empty($post-&gt;post_excerpt) ? strip_tags( $post-&gt;post_excerpt ) : &#039;&#039;;
			if(!$post_content){
				$post_content = !empty($post-&gt;post_content) ? strip_tags( wp_trim_words($post-&gt;post_content, $excerpt_length,&#039;&#039;) ) : &#039;&#039;;

			}
			$string = str_replace( &quot;%%excerpt%%&quot;,$post_content , $string );
		}

		if ( strpos( $string, &#039;%%id%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%id%%&quot;, absint($post-&gt;ID), $string );
		}

		// archive
		if ( strpos( $string, &#039;%%category%%&#039; ) !== false || strpos( $string, &#039;%%in_category%%&#039; ) !== false ) {
			$cat_name = &#039;&#039;;

			if ( $gd_page == &#039;single&#039; ) {
				if ( $gd_post-&gt;default_category ) {
					$cat      = get_term( $gd_post-&gt;default_category, $post-&gt;post_type . &#039;category&#039; );
					$cat_name = ( isset( $cat-&gt;name ) ) ? $cat-&gt;name : &#039;&#039;;
				}
			} else if ( $gd_page == &#039;archive&#039; ) {
				$queried_object = get_queried_object();
				if ( isset( $queried_object-&gt;name ) ) {
					$cat_name = $queried_object-&gt;name;
				}
			} else if ( $gd_page == &#039;search&#039; ) {
				$cat_name = self::get_searched_category_name( $post_type . &#039;category&#039; );
			}

			$in_cat_name = $cat_name ? wp_sprintf( _x( &#039;in %s&#039;, &#039;in category&#039;, &#039;geodirectory&#039; ), $cat_name ) : &#039;&#039;;

			$string = str_replace( &quot;%%category%%&quot;, $cat_name, $string );
			$string = str_replace( &quot;%%in_category%%&quot;, $in_cat_name, $string );
		}

		if ( strpos( $string, &#039;%%tag%%&#039; ) !== false ) {
			$cat_name = &#039;&#039;;

			if ( $gd_page == &#039;single&#039; ) {
				if ( $post-&gt;default_category ) {
					$cat      = get_term( $post-&gt;default_category, $post-&gt;post_type . &#039;category&#039; );
					$cat_name = ( isset( $cat-&gt;name ) ) ? $cat-&gt;name : &#039;&#039;;
				}
			} else if ( $gd_page == &#039;archive&#039; ) {
				$queried_object = get_queried_object();
				if ( isset( $queried_object-&gt;name ) ) {
					$cat_name = $queried_object-&gt;name;
				}
			}
			$string = str_replace( &quot;%%tag%%&quot;, $cat_name, $string );
		}

		// CPT
		if ( strpos( $string, &#039;%%pt_single%%&#039; ) !== false ) {
			if ( $post_type &amp;&amp; $singular_name = geodir_get_post_type_singular_label( $post_type ) ) {
				$string = str_replace( &quot;%%pt_single%%&quot;, __( $singular_name, &#039;geodirectory&#039; ), $string );
			}
		}

		if ( strpos( $string, &#039;%%pt_plural%%&#039; ) !== false ) {
			if ( $post_type &amp;&amp; $plural_name = geodir_get_post_type_plural_label( $post_type ) ) {
				$string = str_replace( &quot;%%pt_plural%%&quot;, __( $plural_name, &#039;geodirectory&#039; ), $string );
			}
		}

		// location variable
		$location_replace_vars = geodir_location_replace_vars();
		foreach($location_replace_vars as $lkey=&gt;$lval){
			if ( strpos( $string, $lkey ) !== false ) {
				$string = str_replace( $lkey, $lval, $string );
			}
		}

		// search
		$search_term = &#039;&#039;;
		if ( isset( $_REQUEST[&#039;s&#039;] ) ) {
			$search_term = esc_attr( $_REQUEST[&#039;s&#039;] );
			$search_term = str_replace( array( &quot;%E2%80%99&quot;, &quot;’&quot; ), array( &quot;%27&quot;, &quot;&#039;&quot; ), $search_term ); // apple suck
			$search_term = trim( stripslashes( $search_term ) );
		}

		// %%search_term%%
		if ( strpos( $string, &#039;%%search_term%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%search_term%%&quot;, $search_term, $string );
		}

		// %%for_search_term%%
		if ( strpos( $string, &#039;%%for_search_term%%&#039; ) !== false ) {
			$for_search_term = $search_term != &#039;&#039; ? wp_sprintf( __( &#039;for %s&#039;, &#039;geodirectory&#039; ), $search_term ) : &#039;&#039;;
		
			$string = str_replace( &quot;%%for_search_term%%&quot;, $for_search_term, $string );
		}

		$search_near_term = &#039;&#039;;
		$search_near = &#039;&#039;;
		if ( isset( $_REQUEST[&#039;snear&#039;] ) ) {
			$search_near_term = esc_attr( $_REQUEST[&#039;snear&#039;] );
			$search_near_term = str_replace( array( &quot;%E2%80%99&quot;, &quot;’&quot; ), array( &quot;%27&quot;, &quot;&#039;&quot; ), $search_near_term ); // apple suck
			$search_near_term = trim( stripslashes( $search_near_term ) );

			if ( $search_near_term != &#039;&#039; ) {
				$search_near = wp_sprintf( __( &#039;near %s&#039;, &#039;geodirectory&#039; ), $search_near_term );
			}
		}

		// %%search_near_term%%
		if ( strpos( $string, &#039;%%search_near_term%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%search_near_term%%&quot;, $search_near_term, $string );
		}

		// %%search_near%%
		if ( strpos( $string, &#039;%%search_near%%&#039; ) !== false ) {
			$string = str_replace( &quot;%%search_near%%&quot;, $search_near, $string );
		}

		// page numbers
		if ( strpos( $string, &#039;%%page%%&#039; ) !== false ) {
			$page  = geodir_title_meta_page( self::separator() );
			$string = str_replace( &quot;%%page%%&quot;, $page, $string );
		}
		if ( strpos( $string, &#039;%%pagenumber%%&#039; ) !== false ) {
			$pagenumber = geodir_title_meta_pagenumber();
			$string      = str_replace( &quot;%%pagenumber%%&quot;, $pagenumber, $string );
		}
		if ( strpos( $string, &#039;%%pagetotal%%&#039; ) !== false ) {
			$pagetotal = geodir_title_meta_pagetotal();
			$string     = str_replace( &quot;%%pagetotal%%&quot;, $pagetotal, $string );
		}
		if ( strpos( $string, &#039;%%postcount%%&#039; ) !== false ) {
			$postcount = geodir_title_meta_postcount();
			$string     = str_replace( &quot;%%postcount%%&quot;, $postcount, $string );
		}

		// let custom fields be used
		if ( strpos( $string, &#039;%%_&#039; ) !== false ) {
			$address_fields = geodir_post_meta_address_fields( $post_type );

			$matches_count = preg_match_all( &#039;/%%_[^%%]*%%/&#039;, $string, $matches );

			if ( $matches_count &amp;&amp; ! empty( $matches[0] ) ) {
				$matches = $matches[0];

				foreach ( $matches as $cf ) {
					$field_name = str_replace( array( &quot;%%_&quot;, &quot;%%&quot; ), &quot;&quot;, $cf );
					$cf_value = isset( $gd_post-&gt;{$field_name} ) ? $gd_post-&gt;{$field_name} : &#039;&#039;;

					// round rating
					if ( $cf_value &amp;&amp; $field_name == &#039;overall_rating&#039; ) {
						$cf_value = round($cf_value, 1);
					}

					// Private address
					if ( ! empty( $cf_value ) &amp;&amp; $check_address &amp;&amp; isset( $address_fields[ $field_name ] ) ) {
						$cf_value = geodir_post_address( $cf_value, $field_name, $gd_post, &#039;&#039; );
					}

					$string = str_replace( &quot;%%_{$field_name}%%&quot;, $cf_value, $string );
				}
			}
		}

		return apply_filters( &#039;geodir_replace_seo_vars&#039;, $string, $gd_page );
	}

	/**
	 * Returns an array of allowed variables and their descriptions.
     *
     * @since 2.0.0
	 *
	 * @param string $gd_page Optional. Geo directory page. Default null.
	 *
	 * @return array $vars.
	 */
	public static function variables( $gd_page = &#039;&#039; ) {
		$vars = array();

		// Generic
		if ( $gd_page != &#039;location_tags&#039; ) {
			$vars[&#039;%%title%%&#039;] = __( &#039;The current post title.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%sitename%%&#039;] = __( &#039;The site name from general settings: site title. &#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%sitedesc%%&#039;] = __( &#039;The site description from general settings: tagline.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%sep%%&#039;] = __( &#039;The separator mostly used in meta titles.&#039;, &#039;geodirectory&#039; );
		}

		if ( $gd_page != &#039;location_tags&#039; &amp;&amp; $gd_page != &#039;location&#039; ) {
			$vars[&#039;%%id%%&#039;] = __( &#039;The current post id.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%excerpt%%&#039;] = __( &#039;The current post excerpt.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%pt_single%%&#039;] = __( &#039;Post type singular name.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%pt_plural%%&#039;] = __( &#039;Post type plural name.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%category%%&#039;] = __( &#039;The current category name.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_category%%&#039;] = __( &#039;The current category name prefixed with `in` eg: in Attractions&#039;, &#039;geodirectory&#039; );
		}

		// Paging
		if ( $gd_page == &#039;search&#039; || $gd_page == &#039;pt&#039; || $gd_page == &#039;archive&#039; ) {
			$vars[&#039;%%page%%&#039;] = __( &#039;Current page number eg: page 2 of 4&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%pagetotal%%&#039;] = __( &#039;Total pages eg: 101&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%postcount%%&#039;] = __( &#039;Total post found eg: 10&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%pagenumber%%&#039;] = __( &#039;Current page number eg: 99&#039;, &#039;geodirectory&#039; );
		}

		// Search page only
		if ( $gd_page == &#039;search&#039; ) {
			$vars[&#039;%%search_term%%&#039;] = __( &#039;The currently used search for term.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%for_search_term%%&#039;] = __( &#039;The currently used search for term with `for`. Ex: for dinner.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%search_near%%&#039;] = __( &#039;The currently used search near term with `near`. Ex: near Philadelphia.&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%search_near_term%%&#039;] = __( &#039;The currently used search near term.&#039;, &#039;geodirectory&#039; );
		}

		// Location tags
		if ( ! $gd_page || $gd_page == &#039;location_tags&#039; || $gd_page == &#039;search&#039; || $gd_page == &#039;pt&#039; || $gd_page == &#039;archive&#039; || $gd_page == &#039;single&#039; || $gd_page == &#039;location&#039; ) {
			$vars[&#039;%%location%%&#039;] = __( &#039;The full current location eg: United States, Pennsylvania, Philadelphia&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%location_single%%&#039;] = __( &#039;The current viewing location type single name eg: Philadelphia&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_location%%&#039;] = __( &#039;The full current location prefixed with `in` eg: in United States, Pennsylvania, Philadelphia&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_location_single%%&#039;] = __( &#039;The current viewing location type single name prefixed with `in` eg: in Philadelphia&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%location_country%%&#039;] = __( &#039;The current viewing country eg: United States&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_location_country%%&#039;] = __( &#039;The current viewing country prefixed with `in` eg: in United States&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%location_region%%&#039;] = __( &#039;The current viewing region eg: Pennsylvania&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_location_region%%&#039;]= __( &#039;The current viewing region prefixed with `in` eg: in Pennsylvania&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%location_city%%&#039;] = __( &#039;The current viewing city eg: Philadelphia&#039;, &#039;geodirectory&#039; );
			$vars[&#039;%%in_location_city%%&#039;] = __( &#039;The current viewing city prefixed with `in` eg: in Philadelphia&#039;, &#039;geodirectory&#039; );
		}

		// Single page
		if ( $gd_page == &#039;single&#039; ) {
			$vars[&#039;%%_FIELD-KEY%%&#039;] = __( &#039;Show any custom field by using its field key prefixed with an _underscore. Ex: _phone.&#039;, &#039;geodirectory&#039; );
		}

		return apply_filters( &#039;geodir_seo_variables&#039;, $vars, $gd_page );
	}

    /**
     * Helper tags.
     *
     * @since 2.0.0
     *
     * @param string $page optional. Page. Default null.
     * @return string $output.
     */
	public static function helper_tags($page = &#039;&#039;){
		$output = &#039;&#039;;
		$variables = self::variables($page);
		if(!empty($variables)){
			$output .= &#039;&lt;ul class=&quot;geodir-helper-tags d-block clearfix&quot;&gt;&#039;;
			foreach($variables as $variable =&gt; $desc){
				$output .= &quot;&lt;li&gt;&lt;span class=&#039;geodir-helper-tag&#039; title=&#039;&quot;.__(&quot;Click to copy&quot;,&quot;geodirectory&quot;).&quot;&#039;&gt;&quot;.esc_attr($variable).&quot;&lt;/span&gt;&quot;.geodir_help_tip( $desc ).&quot;&lt;/li&gt;&quot;;
			}
			$output .= &#039;&lt;/ul&gt;&#039;;

		}

		return $output;
	}

	/**
     * Document title separator.
     *
     * @since 2.0.0.35
     *
     * @return string $sep.
     */
	public static function separator() {
		/**
		 * Filters the separator for the document title.
		 *
		 * @since 2.0.0.35
		 *
		 * @param string $sep Document title separator. Default &#039;-&#039;.
		 */
		return apply_filters( &#039;document_title_separator&#039;, &#039;-&#039; );
	}

	/**
	 * Filter Yoast breadcrumbs to add cat to details page.
	 *
	 * @param $crumbs
	 *
	 * @return mixed
	 */
    public static function breadcrumb_links($crumbs){

	    // maybe add category link to single page

        if ( geodir_is_page( &#039;detail&#039; ) || geodir_is_page( &#039;listing&#039; ) ) {
	        global $wp_query;
	        $breadcrumb = array();
	        $post_type   = geodir_get_current_posttype();
	        $category = !empty($wp_query-&gt;query_vars[$post_type.&quot;category&quot;]) ? $wp_query-&gt;query_vars[$post_type.&quot;category&quot;] : &#039;&#039;;
	        if($category){
		        $term  = get_term_by( &#039;slug&#039;, $category, $post_type.&quot;category&quot;);
		        if(!empty($term)){
			        $breadcrumb[][&#039;term&#039;] = $term;
		        }
	        }

	        $offset = apply_filters(&#039;wpseo_breadcrumb_links_offset&#039;, 2, $breadcrumb, $crumbs);
	        $length = apply_filters(&#039;wpseo_breadcrumb_links_length&#039;, 0, $breadcrumb, $crumbs);

	        if(!empty($breadcrumb) &amp;&amp; count($breadcrumb) &gt; 0 ){
		        array_splice( $crumbs, $offset, $length, $breadcrumb );
	        }

        }

        return $crumbs;
    }

	/**
	 * Filter Rank Math breadcrumbs settings to hide ancestors.
	 *
	 * @since 2.0.0.100
	 *
	 * @param array $settings Breadcrumbs settings.
	 * @return array Breadcrumbs settings
	 */
	public static function rank_math_frontend_breadcrumb_settings( $settings ) {
		if ( ! is_admin() &amp;&amp; geodir_is_geodir_page() ) {
			$settings[&#039;show_ancestors&#039;] = false;
		}

		return $settings;
	}

	/**
	 * Filter Rank Math breadcrumbs to add cat to details page.
	 *
	 * @param $crumbs
	 *
	 * @return mixed
	 */
	public static function rank_breadcrumb_links( $crumbs, $breadcrumbs = array() ) {
		global $wp_query, $gd_detail_breadcrumb;

		// Maybe add category link to single page
		if ( ( geodir_is_page( &#039;single&#039; ) || geodir_is_page( &#039;archive&#039; ) ) &amp;&amp; ! $gd_detail_breadcrumb ) {
			$post_type = geodir_get_current_posttype();
			$category = ! empty( $wp_query-&gt;query_vars[ $post_type . &quot;category&quot; ] ) ? $wp_query-&gt;query_vars[ $post_type . &quot;category&quot; ] : &#039;&#039;;

			$breadcrumb = array();
			if ( $category ) {
				$term  = get_term_by( &#039;slug&#039;, $category, $post_type . &quot;category&quot; );

				if ( ! empty( $term ) ) {
					$breadcrumb[]= array( $term-&gt;name, get_term_link( $term-&gt;slug, $post_type . &quot;category&quot; ) );
				}
			}

			if ( ! empty( $breadcrumb ) &amp;&amp; count( $breadcrumb ) &gt; 0 ) {
				$offset = RankMath\Helper::get_settings( &#039;general.breadcrumbs_home&#039; ) ? 2 : 1;
				$offset = apply_filters( &#039;rankmath_breadcrumb_links_offset&#039;, $offset, $breadcrumb, $crumbs );
				$length = apply_filters( &#039;rankmath_breadcrumb_links_length&#039;, 0, $breadcrumb, $crumbs );

				array_splice( $crumbs, $offset, $length, $breadcrumb );
			}
		}

		return $crumbs;
	}

	/**
	 * Filter Rank Math breadcrumb post main term.
	 *
	 * @since 2.0.0.97
	 *
	 * @global array $gd_post The post.
	 * @global bool $gd_detail_breadcrumb True if term is set in post breadcrumb.
	 *
	 * @param object $term Post main term.
	 * @param array $terms Post terms.
	 * @return object The post main term.
	 */
	public static function rank_math_frontend_breadcrumb_main_term( $term, $terms = array() ) {
		global $gd_post, $gd_detail_breadcrumb;

		if ( ! empty( $terms ) &amp;&amp; geodir_is_page( &#039;detail&#039; ) &amp;&amp; ! empty( $gd_post ) &amp;&amp; ! empty( $gd_post-&gt;default_category ) ) {
			foreach ( $terms as $_term ) {
				if ( $_term-&gt;term_id == $gd_post-&gt;default_category ) {
					$term = $_term;
					$gd_detail_breadcrumb = true;
				}
			}
		}

		return $term;
	}

	/**
	 * Filter link for GD Archive pages.
	 *
	 * @param string $link    The page&#039;s permalink.
	 * @param int    $post_id The ID of the page.
	 * @param bool   $sample  Is it a sample permalink.
	 *
	 * @return string
	 */
	public static function page_link( $link, $page_id, $sample ) {
		global $wp_query;
		$query_object_id = &#039;&#039;;
		if ( ! empty( $wp_query-&gt;post ) &amp;&amp; isset( $wp_query-&gt;post-&gt;ID ) &amp;&amp; geodir_is_geodir_page_id( $page_id ) ) {
			$query_object_id = $wp_query-&gt;post-&gt;ID;
		} elseif( !is_null($wp_query) ) {
			$query_object_id = get_queried_object_id();
		}

		if ( $query_object_id == $page_id &amp;&amp; ( geodir_is_page( &#039;post_type&#039; ) || geodir_is_page( &#039;archive&#039; ) || geodir_is_page( &#039;author&#039; ) ) ) {
			$link = &#039;#&#039;;
		}
		return $link;
	}

	/**
	 * Allow extending and modifying the posts to exclude from Yoast XML sitemap.
	 *
	 * @since 2.0.0.68
	 *
	 * @param array $posts_to_exclude The posts to exclude.
	 * @return array The posts to exclude.
	 */
	public static function wpseo_exclude_from_sitemap_by_post_ids( $excluded_posts_ids ) {
		if ( ! is_array( $excluded_posts_ids ) ) {
			$excluded_posts_ids = array();
		}

		$gd_excluded_posts_ids = self::get_noindex_page_ids();
		if ( ! empty( $gd_excluded_posts_ids ) &amp;&amp; is_array( $gd_excluded_posts_ids ) ) {
			$excluded_posts_ids = empty( $excluded_posts_ids ) ? $gd_excluded_posts_ids : array_merge( $excluded_posts_ids, $gd_excluded_posts_ids );
		}

		return $excluded_posts_ids;
	}
	
	/**
	 * Get nonindex page ids.
	 *
	 * @since 2.0.0.68
	 *
	 * @return array Array of page ids.
	 */
	public static function get_noindex_page_ids() {
		$page_ids = wp_cache_get( &#039;geodir_noindex_page_ids&#039;, &#039;geodir_noindex_page_ids&#039; );

		if ( $page_ids !== false ) {
			return $page_ids;
		}

		$page_ids = array();
		$page_ids[] = geodir_get_page_id( &#039;details&#039;, &#039;&#039;, false );
		$page_ids[] = geodir_get_page_id( &#039;archive&#039;, &#039;&#039;, false );
		$page_ids[] = geodir_get_page_id( &#039;archive_item&#039;, &#039;&#039;, false );

		$_page_ids = geodir_cpt_template_pages();
		if ( ! empty( $_page_ids ) &amp;&amp; is_array( $_page_ids ) ) {
			$page_ids = array_merge( $page_ids, $_page_ids );
		}

		$page_ids = apply_filters( &#039;geodir_get_noindex_page_ids&#039;, $page_ids );

		wp_cache_set( &#039;geodir_noindex_page_ids&#039;, $page_ids, &#039;geodir_noindex_page_ids&#039; );

		return $page_ids;
	}

	/**
	 * Setup Yoast SEO opengraph meta.
	 *
	 * @since 2.0.0.89
	 *
	 * @return void.
	 */
	public static function template_redirect() {
		if ( self::has_yoast() ) {
			// OpenGraph
			if ( ! self::has_yoast_14() ) {
				add_action( &#039;wpseo_opengraph&#039;, array( __CLASS__, &#039;wpseo_head_setup_meta&#039; ), 0 );
				add_action( &#039;wpseo_opengraph&#039;, array( __CLASS__, &#039;wpseo_head_unset_meta&#039; ), 99 );

				// Twitter
				if ( WPSEO_Options::get( &#039;twitter&#039; ) === true ) {
					add_action( &#039;wpseo_head&#039;, array( __CLASS__, &#039;wpseo_head_setup_meta&#039; ), 39 );
					add_action( &#039;wpseo_head&#039;, array( __CLASS__, &#039;wpseo_head_unset_meta&#039; ), 41 );
				}
			}
		}
	}

	/**
	 * Set Yoast SEO opengraph meta.
	 *
	 * @since 2.0.0.89
	 *
	 * @global bool|int $gd_has_filter_thumbnail_id Check whether filter set or not.
	 *
	 * @return void.
	 */
	public static function wpseo_head_setup_meta() {
		global $gd_has_filter_thumbnail_id;

		add_filter( &#039;wpseo_frontend_page_type_simple_page_id&#039;, array( __CLASS__ , &#039;wpseo_frontend_page_type_simple_page_id&#039; ), 10, 1 );

		if ( geodir_is_page( &#039;single&#039; ) &amp;&amp; ( $gd_has_filter_thumbnail_id = has_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Template_Loader&#039;, &#039;filter_thumbnail_id&#039; ) ) ) ) {
			remove_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Template_Loader&#039;, &#039;filter_thumbnail_id&#039; ), 10, 4 );
		}
	}

	/**
	 * Unset Yoast SEO opengraph meta.
	 *
	 * @since 2.0.0.89
	 *
	 * @global bool|int $gd_has_filter_thumbnail_id Check whether filter set or not.
	 *
	 * @return void.
	 */
	public static function wpseo_head_unset_meta() {
		global $gd_has_filter_thumbnail_id;

		remove_filter( &#039;wpseo_frontend_page_type_simple_page_id&#039;, array( __CLASS__ , &#039;wpseo_frontend_page_type_simple_page_id&#039; ), 10, 1 );

		if ( geodir_is_page( &#039;single&#039; ) &amp;&amp; $gd_has_filter_thumbnail_id &amp;&amp; ! has_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Template_Loader&#039;, &#039;filter_thumbnail_id&#039; ) ) ) {
			add_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Template_Loader&#039;, &#039;filter_thumbnail_id&#039; ), 10, 4 );

			$gd_has_filter_thumbnail_id = false;
		}
	}

	/**
	 * Filter Yoast SEO simple page id.
	 *
	 * @since 2.0.0.89
	 *
	 * @param int $page_id The page id.
	 * @return int Filtered page id.
	 */
	public static function wpseo_frontend_page_type_simple_page_id( $page_id ) {
		if ( ( geodir_is_page( &#039;post_type&#039; ) || geodir_is_page( &#039;archive&#039; ) || geodir_is_page( &#039;search&#039; ) || geodir_is_page( &#039;single&#039; ) ) &amp;&amp; ! is_tax() &amp;&amp; ( $_page_id = (int) GeoDir_Compatibility::gd_page_id() ) ) {
			$page_id = $_page_id;
		}

		return $page_id;
	}

	/**
	 * Check Yoast SEO is installed or not.
	 *
	 * @since 2.0.0.91
	 *
	 * @return bool True if Yoast SEO is installed else false.
	 */
	public static function has_yoast() {
		return defined( &#039;WPSEO_VERSION&#039; );
	}

	/**
	 * Check Yoast SEO v14.x installed or not.
	 *
	 * @since 2.0.0.91
	 *
	 * @return bool True if Yoast SEO v14.x is installed else false.
	 */
	public static function has_yoast_14() {
		return ( self::has_yoast() &amp;&amp; version_compare( WPSEO_VERSION, &#039;14.0&#039;, &#039;&gt;=&#039; ) );
	}

	/**
	 * Register GD variables for Yoast SEO extra replacements.
	 *
	 * @since 2.0.0.93
	 *
	 * @return void
	 */
	public static function wpseo_register_extra_replacements() {
		$pages = array( &#039;location&#039;, &#039;search&#039;, &#039;post_type&#039;, &#039;archive&#039;, &#039;add-listing&#039;, &#039;single&#039; );

		$variables = array();
		foreach ( $pages as $page ) {
			$_variables = GeoDir_SEO::variables( $page );

			if ( ! empty( $_variables ) ) {
				foreach ( $_variables as $var =&gt; $help ) {
					if ( empty( $variables[ $var ] ) ) {
						$variables[ $var ] = $help;
					}
				}
			}
		}

		// Custom fields
		$fields = geodir_post_custom_fields( &#039;&#039;, &#039;all&#039;, &#039;all&#039;, &#039;none&#039; );
		if ( ! empty( $fields ) ) {
			foreach( $fields as $field ) {
				if ( empty( $variables[ &#039;_&#039; . $field[&#039;htmlvar_name&#039;] ] ) ) {
					$variables[ &#039;_&#039; . $field[&#039;htmlvar_name&#039;] ] = __( stripslashes( $field[&#039;admin_title&#039;] ), &#039;geodirectory&#039; );
				}
			}
		}

		// Advance custom fields
		$advance_fields = geodir_post_meta_advance_fields();
		if ( ! empty( $advance_fields ) ) {
			foreach ( $advance_fields as $key =&gt; $field ) {
				if ( empty( $variables[ &#039;_&#039; . $key ] ) ) {
					$variables[ &#039;_&#039; . $key ] = __( stripslashes( $field[&#039;frontend_title&#039;] ), &#039;geodirectory&#039; );
				}
			}
		}

		$variables = apply_filters( &#039;geodir_wpseo_register_extra_replacements&#039;, $variables );

		$replacer = new WPSEO_Replace_Vars();

		foreach ( $variables as $var =&gt; $help ) {
			if ( is_string( $var ) &amp;&amp; $var !== &#039;&#039; ) {
				$var = trim( $var, &#039;%&#039; );

				if ( ! empty( $var ) ) {
					$var = &#039;_gd_&#039; . $var; // Add prefix to prevent conflict with Yoast default vars.

					if ( ! method_exists( $replacer, &#039;retrieve_&#039; . $var ) ) {
						wpseo_register_var_replacement( $var, array( __CLASS__, &#039;wpseo_replacement&#039; ), &#039;advanced&#039;, $help );
					}
				}
			}
		}
	}

	/**
	 * Register GD variables for Yoast SEO extra replacements.
	 *
	 * @since 2.0.0.93
	 *
	 * @param string $var Variable name.
	 * @param array $args Variable args.
	 * @return string Variable value.
	 */
	public static function wpseo_replacement( $var, $args ) {
		$var = strpos( $var, &#039;_gd_&#039; ) === 0 ? substr( $var, 4 ) : $var;

		return self::replace_variable( &#039;%%&#039; . $var . &#039;%%&#039;, self::$gd_page );
	}

	/**
	 * Filter Yoast SEO meta title.
	 *
	 * @since 2.0.0.93
	 *
	 * @param string $title Meta title.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Meta title.
	 */
	public static function wpseo_title( $title, $presentation = array() ) {
		if ( ! empty( $title ) || ! geodir_is_geodir_page() ) {
			return $title;
		}

		if ( geodir_is_page( &#039;archive&#039; ) ) {
			$queried_object = get_queried_object();

			if (  ! empty( $queried_object-&gt;term_id ) &amp;&amp; ! empty( $queried_object-&gt;taxonomy ) &amp;&amp; geodir_is_gd_taxonomy( $queried_object-&gt;taxonomy ) ) {
				if ( $_title = WPSEO_Taxonomy_Meta::get_term_meta( $queried_object-&gt;term_id, $queried_object-&gt;taxonomy, &#039;title&#039; ) ) {
					$title = $_title;
				} elseif ( $_title = WPSEO_Options::get( &#039;title-tax-&#039; . $queried_object-&gt;taxonomy ) ) {
					$title = $_title;
				}

				if ( strpos( $title, &#039;%%&#039; ) !== false ) {
					$title = wpseo_replace_vars( $title, $queried_object );
				}

				if ( strpos( $title, &#039;%%&#039; ) !== false ) {
					$title = self::replace_variable( $title, &#039;archive&#039; );
				}
			}
		}

		return $title;
	}

	/**
	 * Filter Yoast SEO meta description.
	 *
	 * @since 2.0.0.93
	 *
	 * @param string $meta_description Meta description.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Meta description.
	 */
	public static function wpseo_metadesc( $meta_description, $presentation = array() ) {
		if ( ! empty( $meta_description ) || ! geodir_is_geodir_page() ) {
			return $meta_description;
		}

		if ( geodir_is_page( &#039;archive&#039; ) ) {
			$queried_object = get_queried_object();

			if (  ! empty( $queried_object-&gt;term_id ) &amp;&amp; ! empty( $queried_object-&gt;taxonomy ) &amp;&amp; geodir_is_gd_taxonomy( $queried_object-&gt;taxonomy ) ) {
				if ( $_meta_description = WPSEO_Taxonomy_Meta::get_term_meta( $queried_object-&gt;term_id, $queried_object-&gt;taxonomy, &#039;desc&#039; ) ) {
					$meta_description = $_meta_description;
				} elseif ( $_meta_description = WPSEO_Options::get( &#039;metadesc-tax-&#039; . $queried_object-&gt;taxonomy ) ) {
					$meta_description = $_meta_description;
				}
			}

			if ( strpos( $meta_description, &#039;%%&#039; ) !== false ) {
				$meta_description = wpseo_replace_vars( $meta_description, $queried_object );
			}

			if ( strpos( $meta_description, &#039;%%&#039; ) !== false ) {
				$meta_description = self::replace_variable( $meta_description, &#039;archive&#039; );
			}
		}

		return $meta_description;
	}

	/**
	 * Filter Yoast SEO generated open graph URL.
	 *
	 * @since 2.0.0.91
	 *
	 * @param string $canonical The URL.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Filtered URL.
	 */
	public static function wpseo_opengraph_url( $canonical, $presentation ) {
		if ( $canonicals = self::get_canonicals() ) {
			if ( ! empty( $canonicals[&#039;canonical&#039;] ) ) {
				$canonical = $canonicals[&#039;canonical&#039;];
			}
		}

		return $canonical;
	}

	public static function wpseo_opengraph_image( $image_container ) {
		if ( ! geodir_is_geodir_page() ) {
			return;
		}

		if ( $image_container-&gt;has_images() ) {
			return;
		}

		if ( geodir_is_page( &#039;post_type&#039; ) ) {
			$post_type = geodir_get_current_posttype();

			if ( $post_type &amp;&amp; ( $post_type_obj = geodir_post_type_object( $post_type ) ) ) {
				if ( ! empty( $post_type_obj-&gt;default_image ) ) {
					$image_container-&gt;add_image_by_id( $post_type_obj-&gt;default_image );
				}
			}
		} elseif ( geodir_is_page( &#039;archive&#039; ) ) {
			$term = get_queried_object();

			if ( ! empty( $term-&gt;term_id ) &amp;&amp; ( $image = get_term_meta( $term-&gt;term_id, &#039;ct_cat_default_img&#039;, true ) ) ) {
				if ( ! empty( $image[&#039;id&#039;] ) ) {
					$image_container-&gt;add_image_by_id( $image[&#039;id&#039;] );
				}
			}
		}
	}

	/**
	 * Filter Yoast SEO generated canonical URL.
	 *
	 * @since 2.0.0.91
	 *
	 * @param string $canonical The URL.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Filtered URL.
	 */
	public static function wpseo_canonical( $canonical, $presentation ) {
		if ( $canonicals = self::get_canonicals() ) {
			if ( ! empty( $canonicals[&#039;canonical_paged&#039;] ) ) {
				$canonical = $canonicals[&#039;canonical_paged&#039;];
			}
		}

		return $canonical;
	}

	/**
	 * Filter the rel next/prev URL.
	 *
	 * @since 2.0.0.91
	 *
	 * @param string $rel The next/prev URL.
	 * @param string $type next or prev.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Filtered next/prev URL.
	 */
	public static function wpseo_adjacent_rel_url( $rel, $type, $presentation ) {
		if ( $rel &amp;&amp; $type &amp;&amp; ( $canonicals = self::get_canonicals() ) ) {
			if ( ! empty( $canonicals[&#039;canonical_&#039; . $type ] ) ) {
				$rel = $canonicals[&#039;canonical_&#039; . $type ];
			}
		}

		return $rel;
	}

	/**
	 * Filter the meta robots output array of Yoast SEO.
	 *
	 * @since 2.0.0.99
	 *
	 * @param array $robots The meta robots directives to be used.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return array The meta robots array.
	 */
	public static function wpseo_robots_array( $robots, $presentation ) {
		// Force to index single listing.
		if ( ! empty( $robots ) &amp;&amp; geodir_is_page( &#039;single&#039; ) ) {
			$robots[&#039;index&#039;] = &#039;index&#039;;
			$robots[&#039;follow&#039;] = &#039;follow&#039;;
		}

		return $robots;
	}

	/**
	 * Prevent using post type archive index model on term archive page.
	 *
	 * @since 2.0.0.102
	 *
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @param object $context The meta tags context.
	 * @return array Filtered presentation of an indexable.
	 */
	public static function wpseo_frontend_presentation( $presentation, $context ) {
		if ( geodir_is_geodir_page() &amp;&amp; is_tax() &amp;&amp; is_post_type_archive() &amp;&amp; geodir_is_page( &#039;archive&#039; ) ) {
			try {
				if ( ! empty( $presentation-&gt;model-&gt;object_id ) &amp;&amp; ! empty( $presentation-&gt;model-&gt;object_sub_type ) ) {
					$term = get_term( $presentation-&gt;model-&gt;object_id, $presentation-&gt;model-&gt;object_sub_type );

					if ( ! empty( $term ) &amp;&amp; ! is_wp_error( $term ) ) {
						$presentation-&gt;source = $term;
						$term_meta = WPSEO_Taxonomy_Meta::get_term_meta( $term, $term-&gt;taxonomy, null );

						if ( ! empty( $term_meta ) ) {
							$is_robots_noindex = null;

							if ( array_key_exists( &#039;wpseo_noindex&#039;, $term_meta ) ) {
								$value = $term_meta[&#039;wpseo_noindex&#039;];

								if ( $value === &#039;noindex&#039; ) {
									$is_robots_noindex = true;
								} elseif ( $value === &#039;index&#039; ) {
									$is_robots_noindex = false;
								} elseif ( $value == &#039;default&#039; ) {
									$is_robots_noindex = ! WPSEO_Options::get( &#039;noindex-tax-&#039; . $term-&gt;taxonomy, false ) ? false : true;
								}
							}
		
							$presentation-&gt;model-&gt;is_robots_noindex = $is_robots_noindex;
							$presentation-&gt;model-&gt;is_public = ( $presentation-&gt;model-&gt;is_robots_noindex === null ) ? null : ! $presentation-&gt;model-&gt;is_robots_noindex;
						}
					}
				}
			} catch ( Exception $e ) { }
		}

		return $presentation;
	}

	/**
	 * Yoast filter the Twitter title.
	 *
	 * @since 2.1.0.9
	 *
	 * @param string                 $title Twitter title.
	 * @param Indexable_Presentation $presentation The presentation of an indexable.
	 * @return string Filtered title.
	 */
	public static function wpseo_twitter_title( $title, $presentation ) {
		if ( geodir_is_page( &#039;search&#039; ) &amp;&amp; ! empty( $presentation ) ) {
			$title = isset( $presentation-&gt;model-&gt;twitter_title ) ? $presentation-&gt;model-&gt;twitter_title : &#039;&#039;;

			if ( strpos( $title, &#039;%%&#039; ) !== false ) {
				$title = wpseo_replace_vars( $title, get_post( (int) GeoDir_Compatibility::gd_page_id() ) );
			}

			if ( strpos( $title, &#039;%%&#039; ) !== false ) {
				$title = self::replace_variable( $title, &#039;search&#039; );
			}
		}
		return $title;
	}
	/**
	 * Filter the post meta data.
	 *
	 * @since 2.0.0.99
	 * @access public
	 *
	 * @param mixed  $value     The metadata value or an array
	 *                          of values depending on the value of `$single`. Default null.
	 * @param int    $object_id ID of the object metadata is for.
	 * @param string $meta_key  Metadata key.
	 * @param bool   $single    Whether to return only the first value of the specified `$meta_key`.
	 * @param string $meta_type Type of object metadata is for.
	 * @return mixed Post metadata value.
	 */
	public static function filter_post_metadata( $value, $object_id, $meta_key, $single = false, $meta_type = &#039;&#039; ) {
		global $geodir_post_meta_loop;
		
		if ( null === $value ) {
			return $value;
		}

		if ( defined( &#039;WPSEO_VERSION&#039; ) &amp;&amp; ! empty( $object_id ) &amp;&amp; ! is_admin() &amp;&amp; empty( $meta_key ) &amp;&amp; is_array( $value ) &amp;&amp; empty( $geodir_post_meta_loop ) &amp;&amp; geodir_is_gd_post_type( get_post_type( $object_id ) ) ) {
			$geodir_post_meta_loop = true;

			// Check &amp; remove filters
			$has_filter_1 = has_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Compatibility&#039;, &#039;dynamically_add_post_meta&#039; ) );
			if ( $has_filter_1 ) {
				remove_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Compatibility&#039;, &#039;dynamically_add_post_meta&#039; ) );
			}

			$has_filter_2 = has_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_SEO&#039;, &#039;filter_post_metadata&#039; ) );
			if ( $has_filter_2 ) {
				remove_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_SEO&#039;, &#039;filter_post_metadata&#039; ) );
			}

			$_value = get_post_custom( $object_id );

			if ( ! empty( $_value ) &amp;&amp; is_array( $_value ) ) {
				// Reserved post meta keys for single listing.
				$reserve_keys = array( &#039;_yoast_wpseo_content_score&#039;, &#039;_yoast_wpseo_linkdex&#039;, &#039;_yoast_wpseo_meta-robots-adv&#039;, &#039;_yoast_wpseo_meta-robots-nofollow&#039;, &#039;_yoast_wpseo_meta-robots-noindex&#039;, &#039;_yoast_wpseo_is_cornerstone&#039;, &#039;_yoast_wpseo_title&#039;, &#039;_yoast_wpseo_metadesc&#039; );

				// Remove template page post meta values.
				foreach ( $value as $key =&gt; $data ) {
					if ( in_array( $key, $reserve_keys ) ) {
						unset( $value[ $key ] );
					}
				}

				// Add single listing post meta values.
				foreach ( $_value as $key =&gt; $data ) {
					if ( in_array( $key, $reserve_keys ) ) {
						$value[ $key ] = $data;
					}
				}
			}

			$geodir_post_meta_loop = false;

			// Check &amp; add filters back.
			if ( $has_filter_1 ) {
				add_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_Compatibility&#039;, &#039;dynamically_add_post_meta&#039; ), 10, 4 );
			}

			if ( $has_filter_2 ) {
				add_filter( &#039;get_post_metadata&#039;, array( &#039;GeoDir_SEO&#039;, &#039;filter_post_metadata&#039; ), 99, 5 );
			}
		}

		return $value;
	}

	/**
	 * Get paged &amp; non paged canonical URLs for GD post type &amp; archive pages.
	 *
	 * @since 2.0.0.91
	 *
	 * @return array|NULL Array of URLs.
	 */
	public static function get_canonicals() {
		global $wp_rewrite;

		if ( ! geodir_is_geodir_page() ) {
			return NULL;
		}

		$canonicals = array();
		$canonical = &#039;&#039;;

		if ( geodir_is_page( &#039;pt&#039; ) ) {
			$post_type = geodir_get_current_posttype();

			$canonical = get_post_type_archive_link( $post_type );
		} elseif ( geodir_is_page( &#039;archive&#039; ) ) {
			$term = get_queried_object();

			if ( ! empty( $term ) &amp;&amp; ! empty( $term-&gt;taxonomy ) ) {
				$term_link = get_term_link( $term, $term-&gt;taxonomy );

				if ( ! is_wp_error( $term_link ) ) {
					$canonical = $term_link;
				}
			}
		}

		if ( $canonical ) {
			$canonical_paged = $canonical;
			$canonical_next = $canonical;
			$canonical_prev = $canonical;

			$paged = (int) get_query_var( &#039;paged&#039; );
			if ( $paged &lt; 1 ) {
				$paged = 1;
			}

			if ( ! $wp_rewrite-&gt;using_permalinks() ) {
				if ( $paged &gt; 1 ) {
					$canonical_paged = add_query_arg( &#039;paged&#039;, $paged, $canonical );

					if ( $paged &gt; 2 ) {
						$canonical_prev = add_query_arg( &#039;paged&#039;, ( $paged - 1 ), $canonical );
					}
				}

				$canonical_next = add_query_arg( &#039;paged&#039;, ( $paged + 1 ), $canonical );
			} else {
				if ( $paged &gt; 1 ) {
					$canonical_paged = user_trailingslashit( trailingslashit( $canonical ) . trailingslashit( $wp_rewrite-&gt;pagination_base ) . $paged );

					if ( $paged &gt; 2 ) {
						$canonical_prev = user_trailingslashit( trailingslashit( $canonical ) . trailingslashit( $wp_rewrite-&gt;pagination_base ) . ( $paged - 1 ) );
					}
				}

				$canonical_next = user_trailingslashit( trailingslashit( $canonical ) . trailingslashit( $wp_rewrite-&gt;pagination_base ) . ( $paged + 1 ) );
			}

			$canonicals = array(
				&#039;canonical&#039; =&gt; $canonical,
				&#039;canonical_paged&#039; =&gt; $canonical_paged,
				&#039;canonical_next&#039; =&gt; $canonical_next,
				&#039;canonical_prev&#039; =&gt; $canonical_prev
			);
		}

		return apply_filters( &#039;geodir_get_canonicals&#039;, $canonicals );
	}

	/**
	 * Exclude GD template pages from WP XML sitemaps.
	 *
	 * @since 2.0.0.99
	 *
	 * @param array  $args Array of WP_Query arguments.
	 * @param string $post_type Post type name.
	 * @return array The posts to exclude.
	 */
	public static function wp_sitemaps_exclude_post_ids( $args, $post_type ) {
		if ( &#039;page&#039; === $post_type ) {
			// GD template page ids.
			$page_ids = self::get_noindex_page_ids();

			if ( ! empty( $page_ids ) ) {
				$post_not_in = ! empty( $args[&#039;post__not_in&#039;] ) &amp;&amp; is_array( $args[&#039;post__not_in&#039;] ) ? array_merge( $args[&#039;post__not_in&#039;], $page_ids ) : $page_ids;

				$args[&#039;post__not_in&#039;] = $post_not_in;
			}
		}

		return $args;
	}

	/**
	 * Get searched category names.
	 *
	 * @since 2.0.0.100
	 *
	 * @param string $taxonomy Category taxonomy. Default empty.
	 * @return string Category names.
	 */
	public static function get_searched_category_name( $taxonomy = &#039;&#039; ) {
		$category_names = &#039;&#039;;

		if ( empty( $_REQUEST[&#039;spost_category&#039;] ) ) {
			return $category_names;
		}

		$post_category = is_array( $_REQUEST[&#039;spost_category&#039;] ) ? array_map( &#039;absint&#039;, $_REQUEST[&#039;spost_category&#039;] ) : array( absint( $_REQUEST[&#039;spost_category&#039;] ) );
		$_category_names = array();

		if ( ! empty( $post_category ) ) {
			$taxonomy = $taxonomy ? $taxonomy : geodir_get_current_posttype() . &#039;category&#039;;

			foreach ( $post_category as $term_id ) {
				$term = get_term( $term_id, $taxonomy );

				if ( ! empty( $term ) &amp;&amp; ! is_wp_error( $term ) ) {
					$_category_names[] = $term-&gt;name;
				}
			}
		}

		if ( ! empty( $_category_names ) ) {
			$category_names = implode( &#039;, &#039;, $_category_names );
		}

		return apply_filters( &#039;geodir_get_searched_category_name&#039;, $category_names, $_category_names, $taxonomy );
	}

	/**
	 * Register GD variables for Rank Math SEO extra replacements.
	 *
	 * @since 2.1.0.14
	 *
	 * @return void
	 */
	public static function rank_math_vars_register_extra_replacements() {
		$pages = array( &#039;location&#039;, &#039;search&#039;, &#039;post_type&#039;, &#039;archive&#039;, &#039;add-listing&#039;, &#039;single&#039; );

		$variables = array();
		foreach ( $pages as $page ) {
			$_variables = GeoDir_SEO::variables( $page );

			if ( ! empty( $_variables ) ) {
				foreach ( $_variables as $var =&gt; $help ) {
					if ( empty( $variables[ $var ] ) ) {
						$variables[ $var ] = $help;
					}
				}
			}
		}

		// Custom fields
		$fields = geodir_post_custom_fields( &#039;&#039;, &#039;all&#039;, &#039;all&#039;, &#039;none&#039; );
		if ( ! empty( $fields ) ) {
			foreach( $fields as $field ) {
				if ( empty( $variables[ &#039;_&#039; . $field[&#039;htmlvar_name&#039;] ] ) ) {
					$variables[ &#039;_&#039; . $field[&#039;htmlvar_name&#039;] ] = __( stripslashes( $field[&#039;admin_title&#039;] ), &#039;geodirectory&#039; );
				}
			}
		}

		// Advance custom fields
		$advance_fields = geodir_post_meta_advance_fields();
		if ( ! empty( $advance_fields ) ) {
			foreach ( $advance_fields as $key =&gt; $field ) {
				if ( empty( $variables[ &#039;_&#039; . $key ] ) ) {
					$variables[ &#039;_&#039; . $key ] = __( stripslashes( $field[&#039;frontend_title&#039;] ), &#039;geodirectory&#039; );
				}
			}
		}

		$variables = apply_filters( &#039;geodir_rank_math_register_extra_replacements&#039;, $variables );

		foreach ( $variables as $var =&gt; $help ) {
			if ( is_string( $var ) &amp;&amp; $var !== &#039;&#039; ) {
				$var = trim( $var, &#039;%&#039; );

				if ( ! empty( $var ) ) {
					$var = &#039;_gd_&#039; . $var; // Add prefix to prevent conflict with Yoast default vars.

					rank_math_register_var_replacement(
						$var,
						array(
							&#039;name&#039;        =&gt; esc_html( $help ),
							&#039;description&#039; =&gt; esc_html( $help ),
							&#039;variable&#039;    =&gt; $var
						)
					);

					add_filter( &#039;rank_math/vars/&#039; . $var, array( __CLASS__, &#039;rank_math_replacement&#039; ), 20, 2 );
				}
			}
		}
	}

	/**
	 * Register GD variables for Ran Math SEO extra replacements.
	 *
	 * @since 2.1.0.14
	 *
	 * @param string $args Variable args.
	 * @param array $variable Variable model.
	 * @return string Variable value.
	 */
	public static function rank_math_replacement( $args, $variable = array() ) {
		$var = ! empty( $variable ) ? $variable-&gt;get_id() : &#039;&#039;;
		if ( empty( $var ) ) {
			return &#039;&#039;;
		}

		$var = strpos( $var, &#039;_gd_&#039; ) === 0 ? substr( $var, 4 ) : $var;

		return self::replace_variable( &#039;%%&#039; . $var . &#039;%%&#039;, self::$gd_page );
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 07:38 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652341136"></script>
    <script src="../js/search.js?updated=1652341136"></script>
</body>
</html>
