<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652337338">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652337338">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.png" alt="WPGeodirectory" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-elementor.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * GeoDirectory Elementor
 *
 * Adds compatibility for Elementor page builder.
 *
 * @author   AyeCode
 * @category Compatibility
 * @package  GeoDirectory
 * @since    2.0.0.41
 */
if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

class GeoDir_Elementor {

	/**
	 * Setup class.
	 *
	 * @since 2.0.0
	 */
	public static function init() {
		// add any extra scripts
		add_action( &#039;wp_enqueue_scripts&#039;, array( __CLASS__, &#039;enqueue_scripts&#039; ), 11 );
		add_filter( &#039;geodir_bypass_archive_item_template_content&#039;, array(
			__CLASS__,
			&#039;archive_item_template_content&#039;
		), 10, 3 );
		add_filter( &#039;elementor/utils/get_the_archive_title&#039;, array( __CLASS__, &#039;get_page_title&#039; ), 10, 1 );

		// ajax
		add_action( &#039;wp_ajax_elementor_ajax&#039;, array( __CLASS__, &#039;maybe_hijack_ajax&#039; ), 8 );

		// add templates
		add_action( &#039;option_elementor_remote_info_library&#039;, array( __CLASS__, &#039;add_gd_templates&#039; ), 10, 2 );

		// Dynamic content
		add_action( &#039;elementor/dynamic_tags/register_tags&#039;, array( __CLASS__, &#039;register_dynamic_content_tags&#039; ) );

		// fix image sizes
		add_filter( &#039;elementor/image_size/get_attachment_image_html&#039;, array(
			__CLASS__,
			&#039;maybe_fix_image_sizes&#039;
		), 10, 4 );

		add_filter( &#039;elementor/widget/render_content&#039;, array(
			__CLASS__,
			&#039;maybe_add_image_caption&#039;
		), 10, 2 );

		// clear cache
		add_action( &#039;save_post&#039;,  array( __CLASS__,&#039;clear_cache&#039;));


		add_filter(&#039;elementor/frontend/section/should_render&#039;, array( __CLASS__, &#039;maybe_hide_elements&#039; ), 10, 2 );
		add_filter(&#039;elementor/frontend/widget/should_render&#039;, array( __CLASS__, &#039;maybe_hide_elements&#039; ), 10, 2 );

		/*
		 * Elementor Pro features below here
		 */
		if(defined( &#039;ELEMENTOR_PRO_VERSION&#039; )){
			// doc template types
			add_action( &#039;elementor/documents/register&#039;, array( __CLASS__, &#039;register_template_types&#039; ) );

			// register template conditions
			add_action( &#039;elementor/theme/register_conditions&#039;, array( __CLASS__, &#039;register_template_conditions&#039; ) );

			// register skins
			add_action(&#039;elementor/widgets/widgets_registered&#039;,array( __CLASS__,&#039;add_archive_item_skins&#039;));

			add_action( &#039;elementor_pro/init&#039;, array( __CLASS__,&#039;register_pro_form_actions&#039;));

		}

		// Elementor 3
		if ( version_compare( ELEMENTOR_VERSION, &#039;3.0.0&#039;, &#039;&gt;=&#039; ) ) {
			add_action( &#039;elementor/frontend/section/before_render&#039;, array( __CLASS__,&#039;custom_skin_dynamic_style&#039; ), 11, 1 );
			add_action( &#039;elementor/frontend/column/before_render&#039;, array( __CLASS__,&#039;custom_skin_dynamic_style&#039; ), 11, 1 );
			add_action( &#039;elementor/frontend/widget/before_render&#039;, array( __CLASS__,&#039;custom_skin_dynamic_style&#039; ), 11, 1 );
			add_filter( &#039;elementor/elements/categories_registered&#039;, array( __CLASS__,&#039;add_elementor_widget_categories&#039; ), 1, 1  );
			add_filter( &#039;elementor/editor/localize_settings&#039;, array( __CLASS__,&#039;alter_widget_config&#039; ), 5, 1  );
		}
	}

	/**
	 * Force our widget to show for search and to be in our own category.
	 * 
	 * @param $config
	 *
	 * @return mixed
	 */
	public static function alter_widget_config( $config ){

		if ( ! empty( $config[&#039;initial_document&#039;][&#039;widgets&#039;] ) ) {
			foreach( $config[&#039;initial_document&#039;][&#039;widgets&#039;] as $key =&gt; $widget){
				if(substr( $key, 0, 13 ) === &quot;wp-widget-gd_&quot; || substr( $key, 0, 17 ) === &quot;wp-widget-geodir_&quot; ){
					$config[&#039;initial_document&#039;][&#039;widgets&#039;][$key][&#039;categories&#039;][] = &#039;geodirectory&#039;;
					$config[&#039;initial_document&#039;][&#039;widgets&#039;][$key][&#039;hide_on_search&#039;] = false;
					$config[&#039;initial_document&#039;][&#039;widgets&#039;][$key][&#039;icon&#039;] = &#039;eicon-globe&#039;; //@todo if no icons use on page then font-awesome is not loaded, wif we can fifure out how to force load we can use icons. &lt;i class=&quot;fas fa-globe-americas&quot;&gt;&lt;/i&gt;&lt;i class=&quot;fa-solid fa-earth-americas&quot;&gt;&lt;/i&gt;
				}
			}
		}



		return $config;
	}

	/**
	 * Add our own Category.
	 *
	 * @param $elements_manager
	 */
	public static function add_elementor_widget_categories( $elements_manager ) {

		$elements_manager-&gt;add_category(
			&#039;geodirectory&#039;,
			[
				&#039;title&#039; =&gt; esc_html__( &#039;GeoDirectory&#039;, &#039;geodirectory&#039; ),
				&#039;icon&#039; =&gt; &#039;fa fa-plug&#039;,
			]
		);

	}


	/**
	 * Clear any caches we use on post save hook.
	 */
	public static function clear_cache(){
		// clear the skin query cache
		wp_cache_delete(&quot;geodir_elementor_pro_skins&quot;);
	}

	/**
	 * Don&#039;t render elements if set not to do so.
	 *
	 * @param $should_render
	 * @param $section
	 *
	 * @return bool
	 */
	public static function maybe_hide_elements($should_render, $section){

		$dynamic_settings = $section-&gt;get_parsed_dynamic_settings();

		$class = &#039;&#039;;
		if(isset($dynamic_settings[&#039;_css_classes&#039;])){
			$class = $dynamic_settings[&#039;_css_classes&#039;];
		}elseif(isset($dynamic_settings[&#039;css_classes&#039;])){
			$class = $dynamic_settings[&#039;css_classes&#039;];
		}

		// remove if set to do so via class
		if( $class == &#039;elementor-hidden gd-dont-render&#039; ){
			$should_render = false;
		}


		return $should_render;
	}


	/**
	 * Register the form action for emailing the listing email.
	 */
	public static function register_pro_form_actions(){
		// Instantiate the action class
		$contact_action = new GeoDir_Elementor_Form_Contact();

		// Register the action with form widget
		\ElementorPro\Plugin::instance()-&gt;modules_manager-&gt;get_modules( &#039;forms&#039; )-&gt;add_form_action( $contact_action-&gt;get_name(), $contact_action );
	}

	public static function add_archive_item_skins(){

		require_once( GEODIRECTORY_PLUGIN_DIR . &#039;includes/elementor/class-geodir-elementor-skin-custom.php&#039; );

	}

	/**
	 * Register our own template conditions.
	 *
	 * @param Conditions_Manager $conditions_manager
	 */
	public static function register_template_conditions( $conditions_manager ) {
		// Single conditions
		$conditions_single = new GeoDir_Elementor_Template_Conditions_Single();
		$conditions_manager-&gt;get_condition( &#039;general&#039; )-&gt;register_sub_condition( $conditions_single );

		// Archive Conditions
		$conditions_archive = new GeoDir_Elementor_Template_Conditions_Archive();
		$conditions_manager-&gt;get_condition( &#039;general&#039; )-&gt;register_sub_condition( $conditions_archive );


		// Archive item, show message that no Conditions are needed.
		$conditions_archive_item = new GeoDir_Elementor_Template_Conditions_Archive_item();
		$conditions_manager-&gt;get_condition( &#039;general&#039; )-&gt;register_sub_condition( $conditions_archive_item );
	}

	/**
	 * Register our single and archive template types.
	 *
	 * @param $documents_manager
	 */
	public static function register_template_types($documents_manager){
		$docs_types = [
			&#039;geodirectory&#039; =&gt; &#039;GeoDir_Elementor_Template_Single&#039;,
			&#039;geodirectory-archive&#039; =&gt; &#039;GeoDir_Elementor_Template_Archive&#039;,
			&#039;geodirectory-archive-item&#039; =&gt; &#039;GeoDir_Elementor_Template_Archive_Item&#039;,
		];

		foreach ( $docs_types as $type =&gt; $class_name ) {
			$documents_manager-&gt;register_document_type( $type, $class_name );
		}
	}


	/**
	 * Add the image caption if present.
	 *
	 * @param string      $html The html content of the widget.
	 * @param Widget_Base $widget The widget.
	 *
	 * @return mixed Filterd the html content.
	 */
	public static function maybe_add_image_caption( $html, $widget ) {
		if ( geodir_is_page( &#039;single&#039; ) || geodir_is_page( &#039;archive&#039; ) ) {
			$type = $widget-&gt;get_name();
			if ($type  === &#039;image&#039;  ) {
				$settings = $widget-&gt;get_settings();

				if ( ! empty( $settings[&#039;__dynamic__&#039;][&#039;image&#039;] ) &amp;&amp; strpos( $settings[&#039;__dynamic__&#039;][&#039;image&#039;], &#039;name=&quot;gd-image&quot;&#039; ) !== false &amp;&amp; ! empty( $settings[&#039;caption_source&#039;] ) &amp;&amp; $settings[&#039;caption_source&#039;] == &#039;attachment&#039; ) {
					preg_match( &#039;~alt[ ]*=[ ]*[&quot;\&#039;](.*?)[&quot;\&#039;]~is&#039;, $html, $match );
					if ( ! empty( $match[1] ) ) {
						$html = str_replace( &#039;&gt;&lt;/figcaption&gt;&#039;, &#039;&gt;&#039; . esc_attr( $match[1] ) . &#039;&lt;/figcaption&gt;&#039;, $html );
					}
				}
			} elseif ( &#039;image-gallery&#039; === $type ) {
				$settings = $widget-&gt;get_settings();

				if ( ! empty( $settings[&#039;__dynamic__&#039;][&#039;wp_gallery&#039;] ) &amp;&amp; strpos( $settings[&#039;__dynamic__&#039;][&#039;wp_gallery&#039;], &#039;name=&quot;gd-gallery&quot;&#039; ) !== false ) {
					preg_match( &#039;~settings[ ]*=[ ]*[&quot;\&#039;](.*?)[&quot;\&#039;]~is&#039;, $settings[&#039;__dynamic__&#039;][&#039;wp_gallery&#039;], $match );
					if ( ! empty( $match[1] ) ) {
						$gallery_settings = json_decode( urldecode( $match[1] ) );
						if ( ! empty( $gallery_settings-&gt;key ) ) {
							global $gd_post;
							$key = esc_attr( $gallery_settings-&gt;key );

							$post_images = GeoDir_Media::get_attachments_by_type( $gd_post-&gt;ID, $key );

							if ( ! empty( $post_images ) ) {
								// render gallery
								$attr = array(
									&#039;columns&#039;       =&gt; $settings[&#039;gallery_columns&#039;],
									&#039;link&#039;          =&gt; $settings[&#039;gallery_link&#039;],
									&#039;size&#039;          =&gt; $settings[&#039;thumbnail_size&#039;],
									&#039;open_lightbox&#039; =&gt; $settings[&#039;open_lightbox&#039;],
								);

								$open_lightbox = isset( $settings[&#039;open_lightbox&#039;] ) ? $settings[&#039;open_lightbox&#039;] : false;

								$image_html = self::render_gallery( $attr, $post_images, $widget, $open_lightbox );
								if ( ! empty( $image_html ) ) {
									$html = &#039;&lt;div class=&quot;elementor-image-gallery&quot;&gt;&#039;;
									$html .= $image_html;
									$html .= &#039;&lt;/div&gt;&#039;;

								}

							}
						}
					}
				}

			}elseif($type  === &#039;gallery&#039;){
				$settings = $widget-&gt;get_settings();
				$gallery_type = isset($settings[&#039;gallery_type&#039;]) ? $settings[&#039;gallery_type&#039;] : &#039;&#039;;
				$is_gd_gallery = false;
				if ( $gallery_type == &#039;single&#039; &amp;&amp; ! empty( $settings[&#039;__dynamic__&#039;][&#039;gallery&#039;] ) &amp;&amp; strpos( $settings[&#039;__dynamic__&#039;][&#039;gallery&#039;], &#039;name=&quot;gd-gallery&quot;&#039; ) !== false ) {
					$is_gd_gallery = true;

				}elseif( $gallery_type == &#039;multiple&#039; &amp;&amp; !empty($settings[&#039;galleries&#039;])){

					foreach($settings[&#039;galleries&#039;] as $gallery){

						if(! empty( $gallery[&#039;__dynamic__&#039;][&#039;multiple_gallery&#039;] ) &amp;&amp; strpos( $gallery[&#039;__dynamic__&#039;][&#039;multiple_gallery&#039;], &#039;name=&quot;gd-gallery&quot;&#039; ) !== false ){
							$is_gd_gallery = true;
						}
					}
				}

				if($is_gd_gallery){
					$html = self::render_pro_gallery( $widget,$settings );
				}

			}elseif($type  === &#039;image-carousel&#039;){
				$settings = $widget-&gt;get_settings();
				$is_gd_gallery = false;
				if ( ! empty( $settings[&#039;__dynamic__&#039;][&#039;carousel&#039;] ) &amp;&amp; strpos( $settings[&#039;__dynamic__&#039;][&#039;carousel&#039;], &#039;name=&quot;gd-gallery&quot;&#039; ) !== false ) {
					$is_gd_gallery = true;
				}
				if($is_gd_gallery){
					$html = self::render_pro_carousel( $widget,$settings );
				}

			}elseif($type  === &#039;icon-list&#039;){
				// remove icon list items that have fallback link of #hide
				$html = preg_replace(&#039;/&lt;li class=&quot;elementor-icon-list-item&quot; &gt;([\n\r\s]+)&lt;a href=&quot;#hide&quot;&gt;(.*?)&lt;\/li&gt;/ms&#039;, &#039;&#039;, $html);
				$html = preg_replace(&#039;/&lt;li class=&quot;elementor-icon-list-item&quot; &gt;([\n\r\s]+)&lt;span class=&quot;elementor-icon-list-icon&quot;&gt;([\n\r\s]+)&lt;i aria-hidden=&quot;true&quot; class=&quot;[a-z0-9 .\-]+&quot;&gt;&lt;\/i&gt;([\n\r\s]+)&lt;\/span&gt;([\n\r\s]+)&lt;span class=&quot;elementor-icon-list-text&quot;&gt;#hide&lt;\/span&gt;([\n\r\s]+)&lt;\/li&gt;/&#039;, &#039;&#039;, $html); // &lt; 3.0
				$html = preg_replace(&#039;/&lt;li class=&quot;elementor-icon-list-item&quot;&gt;([\n\r\s]+)&lt;span class=&quot;elementor-icon-list-icon&quot;&gt;([\n\r\s]+)&lt;i aria-hidden=&quot;true&quot; class=&quot;[a-z0-9 .\-]+&quot;&gt;&lt;\/i&gt;([\n\r\s]+)&lt;\/span&gt;([\n\r\s]+)&lt;span class=&quot;elementor-icon-list-text&quot;&gt;#hide&lt;\/span&gt;([\n\r\s]+)&lt;\/li&gt;/&#039;, &#039;&#039;, $html); // &gt; 3.0+
			}
		}

		// Replaces some encodes entities back to normal to prevent JavaScript errors.
		if ( ! empty( $html ) &amp;&amp; $widget-&gt;get_name() == &#039;text-editor&#039; &amp;&amp; strpos( $html, &#039;geodir-&#039; ) !== false &amp;&amp; strpos( $html, &#039;&lt;script&#039; ) !== false ) {
			$html = geodir_untexturize( $html );
		}

		return $html;
	}

	/**
	 * Render Elementor Pro carousel.
	 *
	 * @param $widget
	 * @param $settings
	 *
	 * @return string
	 */
	public static function render_pro_carousel($widget,$settings){
		global $gd_post;
		ob_start();

		$key = self::get_gallery_key($settings[&#039;__dynamic__&#039;][&#039;carousel&#039;]);
		$settings[&#039;slides&#039;] = GeoDir_Media::get_attachments_by_type( $gd_post-&gt;ID, $key );
		$slides_count = count( $settings[&#039;slides&#039;] );
		$link_to = !empty($settings[&#039;link_to&#039;]) &amp;&amp; $settings[&#039;link_to&#039;]!=&#039;none&#039; ? esc_attr($settings[&#039;link_to&#039;]) : &#039;&#039;;
		$caption_type = !empty($settings[&#039;caption_type&#039;]) ? esc_attr($settings[&#039;caption_type&#039;]) : &#039;&#039;;
		if(!empty($settings[&#039;slides&#039;])){
			?&gt;
			&lt;div class=&quot;elementor-image-carousel-wrapper swiper-container&quot; dir=&quot;ltr&quot;&gt;
				&lt;div class=&quot;elementor-image-carousel swiper-wrapper&quot;&gt;
						&lt;?php
						$widget-&gt;slide_prints_count = 0;
							foreach($settings[&#039;slides&#039;] as $slide){
								$widget-&gt;slide_prints_count++;
								$image_src = geodir_get_image_src( $slide, $settings[&#039;thumbnail_size&#039;] );



								?&gt;
								&lt;div class=&quot;swiper-slide&quot;&gt;
									&lt;?php
									if($link_to){
										if($link_to==&#039;file&#039;){
											$image_src_full = geodir_get_image_src( $slide, &#039;full&#039; );
											echo &#039;&lt;a data-elementor-open-lightbox=&quot;yes&quot; data-elementor-lightbox-slideshow=&quot;&#039;.$widget-&gt;get_id().&#039;&quot; data-elementor-lightbox-title=&quot;&#039;.esc_attr( stripslashes_deep( $slide-&gt;title ) ).&#039;&quot; data-elementor-lightbox-description=&quot;&#039;.esc_attr( stripslashes_deep( $slide-&gt;caption ) ).&#039;&quot; href=&quot;&#039;.$image_src_full .&#039;&quot;&gt;&#039;;
										}else{
											$href = isset($settings[&#039;link&#039;][&#039;url&#039;]) ? esc_url_raw($settings[&#039;link&#039;][&#039;url&#039;]) :&#039;&#039;;
											$link = &#039;&lt;a href=&quot;&#039;.$href .&#039;&quot; &#039;;
											if(isset($settings[&#039;link&#039;][&#039;nofollow&#039;]) &amp;&amp; $settings[&#039;link&#039;][&#039;nofollow&#039;]==&#039;on&#039;){
												$link .= &#039; target=&quot;_blank&quot; &#039;;
											}
											if(isset($settings[&#039;link&#039;][&#039;is_external&#039;]) &amp;&amp; $settings[&#039;link&#039;][&#039;is_external&#039;]==&#039;on&#039;){
												$link .= &#039; rel=&quot;nofollow&quot; &#039;;
											}
											$link .= &#039; &gt;&#039;;
											echo $link;
										}
									}
									?&gt;
									&lt;figure class=&quot;swiper-slide-inner&quot;&gt;
										&lt;img class=&quot;swiper-slide-image&quot;
										     src=&quot;&lt;?php echo esc_url_raw($image_src);?&gt;&quot;
										     alt=&quot;&quot;/&gt;
										&lt;?php
										if($caption_type == &#039;title&#039; || $caption_type==&#039;caption&#039;){
											$caption = $slide-&gt;{$caption_type};
											if($caption){
												echo &#039;&lt;figcaption class=&quot;elementor-image-carousel-caption&quot;&gt;&#039;.esc_attr($caption).&#039;&lt;/figcaption&gt;&#039;;
											}
										}

										?&gt;
									&lt;/figure&gt;
									&lt;?php
									if($link_to){
										echo &quot;&lt;/a&gt;&quot;;
									}
									?&gt;
								&lt;/div&gt;
								&lt;?php

							}
						?&gt;
					&lt;/div&gt;
					&lt;?php if ( 1 &lt; $slides_count ) : ?&gt;
						&lt;?php if ( !empty($settings[&#039;navigation&#039;]) &amp;&amp; $settings[&#039;navigation&#039;]!=&#039;none&#039;) : ?&gt;
							&lt;div class=&quot;swiper-pagination&quot;&gt;&lt;/div&gt;
						&lt;?php endif; ?&gt;
						&lt;?php if ( !empty($settings[&#039;navigation&#039;]) &amp;&amp; ( $settings[&#039;navigation&#039;]==&#039;both&#039; || $settings[&#039;navigation&#039;]==&#039;arrows&#039;)) : ?&gt;
							&lt;div class=&quot;elementor-swiper-button elementor-swiper-button-prev&quot;&gt;
								&lt;i class=&quot;eicon-chevron-left&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
								&lt;span class=&quot;elementor-screen-only&quot;&gt;&lt;?php _e( &#039;Previous&#039;, &#039;elementor-pro&#039; ); ?&gt;&lt;/span&gt;
							&lt;/div&gt;
							&lt;div class=&quot;elementor-swiper-button elementor-swiper-button-next&quot;&gt;
								&lt;i class=&quot;eicon-chevron-right&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
								&lt;span class=&quot;elementor-screen-only&quot;&gt;&lt;?php _e( &#039;Next&#039;, &#039;elementor-pro&#039; ); ?&gt;&lt;/span&gt;
							&lt;/div&gt;
						&lt;?php endif; ?&gt;
					&lt;?php endif; ?&gt;
			&lt;/div&gt;
			&lt;?php
		}


		return ob_get_clean();

	}

	/**
	 * Get the image field key from gallery info.
	 *
	 * @param $gallery
	 *
	 * @return string|void
	 */
	public static function get_gallery_key($gallery){
		$key = &#039;&#039;;

		preg_match( &#039;~settings[ ]*=[ ]*[&quot;\&#039;](.*?)[&quot;\&#039;]~is&#039;, $gallery, $match );
		if ( ! empty( $match[1] ) ) {
			$gallery_settings = json_decode( urldecode( $match[1] ) );
			if ( ! empty( $gallery_settings-&gt;key ) ) {
				$key = esc_attr( $gallery_settings-&gt;key );
			}
		}

		return $key;

	}

	/**
	 * Elementor pro gallery element re-render.
	 *
	 * @param $widget
	 * @param $settings
	 *
	 * @return string
	 */
	public static function render_pro_gallery($widget,$settings){
		global $gd_post;
		$is_multiple = &#039;multiple&#039; === $settings[&#039;gallery_type&#039;] &amp;&amp; ! empty( $settings[&#039;galleries&#039;] );

		$is_single = &#039;single&#039; === $settings[&#039;gallery_type&#039;] &amp;&amp; ! empty( $settings[&#039;gallery&#039;] );

		$has_description = ! empty( $settings[&#039;overlay_description&#039;] );

		$has_title = ! empty( $settings[&#039;overlay_title&#039;] );

		$has_animation = ! empty( $settings[&#039;image_hover_animation&#039;] ) || ! empty( $settings[&#039;content_hover_animation&#039;] ) || ! empty( $settings[&#039;background_overlay_hover_animation&#039;] );

		$gallery_item_tag = ! empty( $settings[&#039;link_to&#039;] ) ? &#039;a&#039; : &#039;div&#039;;

		$galleries = [];

		ob_start();

		if ( $is_multiple ) {
			$widget-&gt;add_render_attribute( &#039;titles-container&#039;, &#039;class&#039;, &#039;elementor-gallery__titles-container&#039; );

			if ( $settings[&#039;pointer&#039;] ) {
				$widget-&gt;add_render_attribute( &#039;titles-container&#039;, &#039;class&#039;, &#039;e--pointer-&#039; . $settings[&#039;pointer&#039;] );

				foreach ( $settings as $key =&gt; $value ) {
					if ( 0 === strpos( $key, &#039;animation&#039; ) &amp;&amp; $value ) {
						$widget-&gt;add_render_attribute( &#039;titles-container&#039;, &#039;class&#039;, &#039;e--animation-&#039; . $value );
						break;
					}
				}
			} ?&gt;
			&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;titles-container&#039; ); ?&gt;&gt;
				&lt;?php if ( $settings[&#039;show_all_galleries&#039;] ) { ?&gt;
					&lt;a data-gallery-index=&quot;all&quot; class=&quot;elementor-item elementor-gallery-title&quot;&gt;&lt;?php echo $settings[&#039;show_all_galleries_label&#039;]; ?&gt;&lt;/a&gt;
				&lt;?php } ?&gt;

				&lt;?php foreach ( $settings[&#039;galleries&#039;] as $index =&gt; $gallery ) :
					if ( ! $gallery[&#039;__dynamic__&#039;] ) {
						continue;
					}
					$key = self::get_gallery_key($gallery[&#039;__dynamic__&#039;][&#039;multiple_gallery&#039;]);
					$galleries[] = GeoDir_Media::get_attachments_by_type( $gd_post-&gt;ID, $key );
					?&gt;
					&lt;a data-gallery-index=&quot;&lt;?php echo $index; ?&gt;&quot; class=&quot;elementor-item elementor-gallery-title&quot;&gt;&lt;?php echo $gallery[&#039;gallery_title&#039;]; ?&gt;&lt;/a&gt;
					&lt;?php
				endforeach; ?&gt;
			&lt;/div&gt;
			&lt;?php
		} elseif ( $is_single ) {
			$key = self::get_gallery_key($settings[&#039;__dynamic__&#039;][&#039;gallery&#039;]);
			$galleries[0] = GeoDir_Media::get_attachments_by_type( $gd_post-&gt;ID, $key );
		} elseif ( \ElementorPro\Plugin::elementor()-&gt;editor-&gt;is_edit_mode() ) { ?&gt;
			&lt;i class=&quot;elementor-widget-empty-icon eicon-gallery-justified&quot;&gt;&lt;/i&gt;
		&lt;?php }

		$widget-&gt;add_render_attribute( &#039;gallery_container&#039;, &#039;class&#039;, &#039;elementor-gallery__container&#039; );

		if ( $has_title || $has_description ) {
			$widget-&gt;add_render_attribute( &#039;gallery_item_content&#039;, &#039;class&#039;, &#039;elementor-gallery-item__content&#039; );

			if ( $has_title ) {
				$widget-&gt;add_render_attribute( &#039;gallery_item_title&#039;, &#039;class&#039;, &#039;elementor-gallery-item__title&#039; );
			}

			if ( $has_description ) {
				$widget-&gt;add_render_attribute( &#039;gallery_item_description&#039;, &#039;class&#039;, &#039;elementor-gallery-item__description&#039; );
			}
		}

		$widget-&gt;add_render_attribute( &#039;gallery_item_background_overlay&#039;, [ &#039;class&#039; =&gt; &#039;elementor-gallery-item__overlay&#039; ] );

		$gallery_items = [];
		$all_items = [];
		$thumbnail_size = $settings[&#039;thumbnail_image_size&#039;];
		foreach ( $galleries as $gallery_index =&gt; $gallery ) {
			foreach ( $gallery as $index =&gt; $item ) {
//				if ( in_array( $item[&#039;id&#039;], array_keys( $gallery_items ), true ) ) {
//					$gallery_items[ $item[&#039;id&#039;] ][] = $gallery_index;
//				} else {
//					$gallery_items[ $item[&#039;id&#039;] ] = [ $gallery_index ];
//				}

//				$gallery_items[] = $item;
				$gallery_items[$item-&gt;ID] = $gallery_index;
				$all_items[$item-&gt;ID] = $item;

			}
		}

//		echo &#039;###&#039;;print_r($gallery_items);exit;

		if ( &#039;random&#039; === $settings[&#039;order_by&#039;] ) {
			$shuffled_items = [];
			$keys = array_keys( $gallery_items );
			shuffle( $keys );
			foreach ( $keys as $key ) {
				$shuffled_items[ $key ] = $gallery_items[ $key ];
			}
			$gallery_items = $shuffled_items;
		}

		if ( ! empty( $galleries ) ) { ?&gt;
		&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_container&#039; ); ?&gt;&gt;
			&lt;?php
			foreach ( $gallery_items as $id =&gt; $tags ) :
				$tags = array($tags);
				$item = $all_items[$id];
				$unique_index = $id; //$gallery_index . &#039;_&#039; . $index;
				$img_src      = geodir_get_image_src( $item, $thumbnail_size );
//				$img_src      = geodir_get_image_src( $item, &#039;full&#039; );
				if ( ! $img_src ) {
					continue;
				}

				$image_meta = isset( $item-&gt;metadata ) ? maybe_unserialize( $item-&gt;metadata ) : &#039;&#039;;

//				print_r($image_meta);

				$attributes = array(
					&#039;data-elementor-lightbox-description&#039; =&gt; stripslashes_deep( $item-&gt;caption ),
//					&#039;title&#039; =&gt; $item-&gt;title,
//					&#039;alt&#039; =&gt; $item-&gt;caption,
					&#039;data-elementor-lightbox-title&#039; =&gt; stripslashes_deep( $item-&gt;title ),
				);

//				$image_data = [
//					&#039;alt&#039; =&gt; get_post_meta( $attachment-&gt;ID, &#039;_wp_attachment_image_alt&#039;, true ),
//					&#039;caption&#039; =&gt; $attachment-&gt;post_excerpt,
//					&#039;description&#039; =&gt; $attachment-&gt;post_content,
//					&#039;title&#039; =&gt; $attachment-&gt;post_title,
//				];

//				$attachment = get_post( $id );
				$image_data = [
					&#039;alt&#039; =&gt; stripslashes_deep( $item-&gt;caption ),
					&#039;media&#039; =&gt; geodir_get_image_src( $item, &#039;full&#039; ),
					&#039;src&#039; =&gt; $img_src,
					&#039;width&#039; =&gt; !empty($image_meta[&#039;sizes&#039;][$thumbnail_size][&#039;width&#039;]) ? $image_meta[&#039;sizes&#039;][$thumbnail_size][&#039;width&#039;] : $image_meta[&#039;width&#039;],
					&#039;height&#039; =&gt; !empty($image_meta[&#039;sizes&#039;][$thumbnail_size][&#039;height&#039;]) ? $image_meta[&#039;sizes&#039;][$thumbnail_size][&#039;height&#039;] : $image_meta[&#039;height&#039;],
					&#039;caption&#039; =&gt;stripslashes_deep(  $item-&gt;caption ),
					&#039;description&#039; =&gt; stripslashes_deep( $item-&gt;caption ),
					&#039;title&#039; =&gt; stripslashes_deep( $item-&gt;title ),
				];

				$widget-&gt;add_render_attribute( &#039;gallery_item_&#039; . $unique_index, [
					&#039;class&#039; =&gt; [
						&#039;e-gallery-item&#039;,
						&#039;elementor-gallery-item&#039;,
					],
				] );

				if ( $has_animation ) {
					$widget-&gt;add_render_attribute( &#039;gallery_item_&#039; . $unique_index, [ &#039;class&#039; =&gt; &#039;elementor-animated-content&#039; ] );
				}

				if ( $is_multiple ) {
					$widget-&gt;add_render_attribute( &#039;gallery_item_&#039; . $unique_index, [ &#039;data-e-gallery-tags&#039; =&gt; implode( &#039;,&#039;, $tags ) ] );
				}

				if ( &#039;a&#039; === $gallery_item_tag ) {
					if ( &#039;file&#039; === $settings[&#039;link_to&#039;] ) {
						$href = $image_data[&#039;media&#039;];

						$widget-&gt;add_render_attribute( &#039;gallery_item_&#039; . $unique_index, [
							&#039;href&#039; =&gt; $href,
						] );

//						$widget-&gt;add_lightbox_data_attributes( &#039;gallery_item_&#039; . $unique_index, null, &#039;yes&#039;, &#039;all-&#039; . $widget-&gt;get_id() );
						$widget-&gt;add_render_attribute( &#039;gallery_item_&#039; . $unique_index, $attributes, null );
					} elseif ( &#039;custom&#039; === $settings[&#039;link_to&#039;] ) {
						$widget-&gt;add_link_attributes( &#039;gallery_item_&#039; . $unique_index, $settings[&#039;url&#039;] );
					}
				}

				$widget-&gt;add_render_attribute( &#039;gallery_item_image_&#039; . $unique_index,
					[
						&#039;class&#039; =&gt; [
							&#039;e-gallery-image&#039;,
							&#039;elementor-gallery-item__image&#039;,
						],
						&#039;data-thumbnail&#039; =&gt; $image_data[&#039;src&#039;],
						&#039;data-width&#039; =&gt; $image_data[&#039;width&#039;],
						&#039;data-height&#039; =&gt; $image_data[&#039;height&#039;],
						&#039;alt&#039; =&gt; $image_data[&#039;alt&#039;],
					]
				);?&gt;
				&lt;&lt;?php echo $gallery_item_tag; ?&gt; &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_&#039; . $unique_index ); ?&gt;&gt;
				&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_image_&#039; . $unique_index ); ?&gt; &gt;&lt;/div&gt;
				&lt;?php if ( ! empty( $settings[&#039;overlay_background&#039;] ) ) : ?&gt;
				&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_background_overlay&#039; ); ?&gt;&gt;&lt;/div&gt;
			&lt;?php endif; ?&gt;
				&lt;?php if ( $has_title || $has_description ) : ?&gt;
				&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_content&#039; ); ?&gt;&gt;
					&lt;?php if ( $has_title ) :
						$title = $image_data[ $settings[&#039;overlay_title&#039;] ];
						if ( ! empty( $title ) ) : ?&gt;
							&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_title&#039; ); ?&gt;&gt;&lt;?php echo $title; ?&gt;&lt;/div&gt;
						&lt;?php endif;
					endif;
					if ( $has_description ) :
						$description = $image_data[ $settings[&#039;overlay_description&#039;] ];
						if ( ! empty( $description ) ) :?&gt;
							&lt;div &lt;?php echo $widget-&gt;get_render_attribute_string( &#039;gallery_item_description&#039; ); ?&gt;&gt;&lt;?php echo $description; ?&gt;&lt;/div&gt;
						&lt;?php endif;
					endif; ?&gt;
				&lt;/div&gt;
			&lt;?php endif; ?&gt;
				&lt;/&lt;?php echo $gallery_item_tag; ?&gt;&gt;
			&lt;?php endforeach;
			//endforeach; ?&gt;
			&lt;/div&gt;
		&lt;?php }

		return ob_get_clean();
	}

		/**
	 * Render the WP Gallery with our own images.
	 *
	 * @param $attr
	 * @param $attachments
	 * @param $widget
	 * @param bool $open_lightbox
	 *
	 * @return mixed|string|void
	 */
	public static function render_gallery( $attr, $attachments, $widget, $open_lightbox = false ) {
		$post = get_post();

		static $instance = 0;
		$instance ++;


		$html5 = current_theme_supports( &#039;html5&#039;, &#039;gallery&#039; );
		$atts  = shortcode_atts(
			array(
				&#039;order&#039;      =&gt; &#039;ASC&#039;,
				&#039;orderby&#039;    =&gt; &#039;menu_order ID&#039;,
				&#039;id&#039;         =&gt; $post ? $post-&gt;ID : 0,
				&#039;itemtag&#039;    =&gt; $html5 ? &#039;figure&#039; : &#039;dl&#039;,
				&#039;icontag&#039;    =&gt; $html5 ? &#039;div&#039; : &#039;dt&#039;,
				&#039;captiontag&#039; =&gt; $html5 ? &#039;figcaption&#039; : &#039;dd&#039;,
				&#039;columns&#039;    =&gt; 3,
				&#039;size&#039;       =&gt; &#039;thumbnail&#039;,
				&#039;include&#039;    =&gt; &#039;&#039;,
				&#039;exclude&#039;    =&gt; &#039;&#039;,
				&#039;link&#039;       =&gt; &#039;&#039;,
			),
			$attr,
			&#039;gallery&#039;
		);

		$id = intval( $atts[&#039;id&#039;] );

		if ( empty( $attachments ) ) {
			return &#039;&#039;;
		}


		$itemtag    = tag_escape( $atts[&#039;itemtag&#039;] );
		$captiontag = tag_escape( $atts[&#039;captiontag&#039;] );
		$icontag    = tag_escape( $atts[&#039;icontag&#039;] );
		$valid_tags = wp_kses_allowed_html( &#039;post&#039; );
		if ( ! isset( $valid_tags[ $itemtag ] ) ) {
			$itemtag = &#039;dl&#039;;
		}
		if ( ! isset( $valid_tags[ $captiontag ] ) ) {
			$captiontag = &#039;dd&#039;;
		}
		if ( ! isset( $valid_tags[ $icontag ] ) ) {
			$icontag = &#039;dt&#039;;
		}

		$columns   = intval( $atts[&#039;columns&#039;] );
		$itemwidth = $columns &gt; 0 ? floor( 100 / $columns ) : 100;
		$float     = is_rtl() ? &#039;right&#039; : &#039;left&#039;;

		$selector = &quot;gallery-{$instance}&quot;;

		$gallery_style = &#039;&#039;;

		/**
		 * Filters whether to print default gallery styles.
		 *
		 * @since 3.1.0
		 *
		 * @param bool $print Whether to print default gallery styles.
		 *                    Defaults to false if the theme supports HTML5 galleries.
		 *                    Otherwise, defaults to true.
		 */
		if ( apply_filters( &#039;use_default_gallery_style&#039;, ! $html5 ) ) {
			$type_attr = current_theme_supports( &#039;html5&#039;, &#039;style&#039; ) ? &#039;&#039; : &#039; type=&quot;text/css&quot;&#039;;

			$gallery_style = &quot;
		&lt;style{$type_attr}&gt;
			#{$selector} {
				margin: auto;
			}
			#{$selector} .gallery-item {
				float: {$float};
				margin-top: 10px;
				text-align: center;
				width: {$itemwidth}%;
			}
			#{$selector} img {
				border: 2px solid #cfcfcf;
			}
			#{$selector} .gallery-caption {
				margin-left: 0;
			}
			/* see gallery_shortcode() in wp-includes/media.php */
		&lt;/style&gt;\n\t\t&quot;;
		}

		$size_class  = sanitize_html_class( $atts[&#039;size&#039;] );
		$gallery_div = &quot;&lt;div id=&#039;$selector&#039; class=&#039;gallery galleryid-{$id} gallery-columns-{$columns} gallery-size-{$size_class}&#039;&gt;&quot;;

		/**
		 * Filters the default gallery shortcode CSS styles.
		 *
		 * @since 2.5.0
		 *
		 * @param string $gallery_style Default CSS styles and opening HTML div container
		 *                              for the gallery shortcode output.
		 */
		$output = apply_filters( &#039;gallery_style&#039;, $gallery_style . $gallery_div );

		$i = 0;


		foreach ( $attachments as $id =&gt; $attachment ) {

			$attr = ( trim( $attachment-&gt;caption ) ) ? array( &#039;aria-describedby&#039; =&gt; &quot;$selector-$id&quot; ) : &#039;&#039;;

			$img_tag = geodir_get_image_tag( $attachment, $atts[&#039;size&#039;] );

			// elementor attributes

			$image_output = $img_tag;

			if ( ! empty( $atts[&#039;link&#039;] ) &amp;&amp; &#039;file&#039; === $atts[&#039;link&#039;] ) {
				$img_src      = geodir_get_image_src( $attachment, &#039;full&#039; );
				$image_output = &quot;&lt;a href=&#039;$img_src&#039;&gt;&quot; . $image_output . &quot;&lt;/a&gt;&quot;;
			}

			// maybe add lightbox
			$image_output = $widget-&gt;add_lightbox_data_to_image_link( $image_output, null );

			if ( $open_lightbox ) {
				$img_title = isset( $attachment-&gt;title ) ? esc_attr( stripslashes_deep( $attachment-&gt;title ) ) : &#039;&#039;;
				$widget-&gt;add_render_attribute( &#039;link&#039;, &#039;data-elementor-lightbox-title&#039;, $img_title );


				$img_desc = isset( $attachment-&gt;caption ) ? esc_attr( $attachment-&gt;caption ) : &#039;&#039;;
				$widget-&gt;add_render_attribute( &#039;link&#039;, &#039;data-elementor-lightbox-description&#039;, stripslashes_deep( $img_desc ) );

				$image_output = $widget-&gt;add_lightbox_data_to_image_link( $image_output, null );
			}

			$image_meta = isset( $attachment-&gt;metadata ) ? maybe_unserialize( $attachment-&gt;metadata ) : &#039;&#039;;

			$orientation = &#039;&#039;;

			if ( isset( $image_meta[&#039;height&#039;], $image_meta[&#039;width&#039;] ) ) {
				$orientation = ( $image_meta[&#039;height&#039;] &gt; $image_meta[&#039;width&#039;] ) ? &#039;portrait&#039; : &#039;landscape&#039;;
			}

			$output .= &quot;&lt;{$itemtag} class=&#039;gallery-item&#039;&gt;&quot;;
			$output .= &quot;
			&lt;{$icontag} class=&#039;gallery-icon {$orientation}&#039;&gt;
				$image_output
			&lt;/{$icontag}&gt;&quot;;

			if ( $captiontag &amp;&amp; trim( $attachment-&gt;caption ) ) {
				$output .= &quot;
				&lt;{$captiontag} class=&#039;wp-caption-text gallery-caption&#039; id=&#039;$selector-$id&#039;&gt;
				&quot; . wptexturize( stripslashes_deep( $attachment-&gt;caption ) ) . &quot;
				&lt;/{$captiontag}&gt;&quot;;
			}

			$output .= &quot;&lt;/{$itemtag}&gt;&quot;;

			if ( ! $html5 &amp;&amp; $columns &gt; 0 &amp;&amp; ++ $i % $columns === 0 ) {
				$output .= &#039;&lt;br style=&quot;clear: both&quot; /&gt;&#039;;
			}
		}

		if ( ! $html5 &amp;&amp; $columns &gt; 0 &amp;&amp; $i % $columns !== 0 ) {
			$output .= &quot;
			&lt;br style=&#039;clear: both&#039; /&gt;&quot;;
		}

		$output .= &quot;
		&lt;/div&gt;\n&quot;;

		return $output;
	}

	/**
	 * Add title and alt to GD images.
	 *
	 * @param $html
	 * @param $settings
	 * @param string $image_size_key
	 * @param string $image_key
	 *
	 * @return mixed
	 */
	public static function maybe_fix_image_sizes( $html, $settings, $image_size_key = &#039;&#039;, $image_key = &#039;&#039; ) {

		if ( ! empty( $settings[&#039;image_size&#039;] ) &amp;&amp; $settings[&#039;image_size&#039;] != &#039;full&#039; &amp;&amp; ! empty( $settings[&#039;image&#039;][&#039;gd-id&#039;] ) ) {
			global $gd_post;
			$image_src   = $settings[&#039;image&#039;][&#039;url&#039;];
			$image_key   = $settings[&#039;image&#039;][&#039;gd-key&#039;];
			$post_images = GeoDir_Media::get_attachments_by_type( $gd_post-&gt;ID, $image_key, 1 );

			if ( ! empty( $post_images ) ) {
				$image   = $post_images[0];
				$size    = $settings[&#039;image_size&#039;];
				$img_src = geodir_get_image_src( $image, $size );

				// replace image
				if ( $img_src ) {
					$html = str_replace( $image_src, $img_src, $html );
				}

				// title
				if ( ! empty( $image-&gt;title ) ) {
					$html = str_replace( &#039;title=&quot;&quot;&#039;, &#039;title=&quot;&#039; . esc_attr( stripslashes_deep( $image-&gt;title ) ) . &#039;&quot;&#039;, $html );
				}

				// Alt text
				if ( ! empty( $settings[&#039;caption_source&#039;] ) &amp;&amp; $settings[&#039;caption_source&#039;] == &#039;attachment&#039; &amp;&amp; ! empty( $image-&gt;caption ) ) {
					$html = str_replace( &#039;alt=&quot;&quot;&#039;, &#039;alt=&quot;&#039; . esc_attr( stripslashes_deep( $image-&gt;caption ) ) . &#039;&quot;&#039;, $html );
				}
			}

		} elseif ( ! empty( $settings[&#039;image&#039;][&#039;gd-url&#039;] ) ) {
			$image_size = ! empty( $settings[&#039;image_size&#039;] ) ? esc_attr( $settings[&#039;image_size&#039;] ) : &#039;&#039;;

			if ( $image_size ) {
				$html          = str_replace( array( &#039;&amp;amp;w=&#039;, &#039;&amp;amp;h=&#039;, &#039;&amp;amp;vpw=&#039;, &#039;&amp;amp;vph=&#039;, &#039;&amp;amp;requeue=&#039; ), array( &#039;&amp;w=&#039;, &#039;&amp;h=&#039;, &#039;&amp;vpw=&#039;, &#039;&amp;vph=&#039;, &#039;&amp;requeue=&#039; ), $html );
				$image_sizes   = \Elementor\Group_Control_Image_Size::get_all_image_sizes();
				$image_src     = $settings[&#039;image&#039;][&#039;url&#039;];
				$image_url_src = $settings[&#039;image&#039;][&#039;gd-url&#039;];

				if ( $image_size == &#039;custom&#039; &amp;&amp; ! empty( $settings[&#039;image_custom_dimension&#039;][&#039;width&#039;] ) ) {
					$width         = ! empty( $settings[&#039;image_custom_dimension&#039;][&#039;width&#039;] ) ? absint( $settings[&#039;image_custom_dimension&#039;][&#039;width&#039;] ) : 1024;
					$height        = ! empty( $settings[&#039;image_custom_dimension&#039;][&#039;height&#039;] ) ? absint( $settings[&#039;image_custom_dimension&#039;][&#039;height&#039;] ) : $width;
					$new_image_url = geodir_get_screenshot( $image_url_src, array( &#039;w&#039; =&gt; $width, &#039;h&#039; =&gt; $height, &#039;image&#039; =&gt; true ) );
					$html          = str_replace( $image_src, $new_image_url, $html );
				} elseif ( isset( $image_sizes[ $image_size ] ) ) {
					$width         = ! empty( $image_sizes[ $image_size ][&#039;width&#039;] ) ? absint( $image_sizes[ $image_size ][&#039;width&#039;] ) : 1024;
					$height        = ! empty( $image_sizes[ $image_size ][&#039;height&#039;] ) ? absint( $image_sizes[ $image_size ][&#039;height&#039;] ) : $width;
					$new_image_url = geodir_get_screenshot( $image_url_src, array( &#039;w&#039; =&gt; $width, &#039;h&#039; =&gt; $height, &#039;image&#039; =&gt; true ) );
					$html          = str_replace( $image_src, $new_image_url, $html );
				}
			}
		}

		return $html;
	}

	/**
	 * Register dynamic content tags to use in elementor fields.
	 *
	 * @param $dynamic_tags
	 */
	public static function register_dynamic_content_tags( $dynamic_tags ) {
		// In our Dynamic Tag we use a group named request-variables so we need
		// To register that group as well before the tag
		\Elementor\Plugin::$instance-&gt;dynamic_tags-&gt;register_group( &#039;geodirectory&#039;, [
			&#039;title&#039; =&gt; &#039;GeoDirectory&#039;
		] );

		$tag_classes = array(
			&#039;GeoDir_Elementor_Tag_Text&#039;,
			&#039;GeoDir_Elementor_Tag_URL&#039;,
			&#039;GeoDir_Elementor_Tag_Image&#039;,
			&#039;GeoDir_Elementor_Tag_Gallery&#039;,
			&#039;GeoDir_Elementor_Tag_Number&#039;,
			&#039;GeoDir_Elementor_Tag_Color&#039;,
			&#039;GeoDir_Elementor_Tag_CSS_Class&#039;,
		);

		// Finally register the tag
		foreach ( $tag_classes as $tag_class ) {
			$dynamic_tags-&gt;register_tag( $tag_class );
		}

	}


	/**
	 * Add GD template options to Elementor template directory.
	 *
	 * @param $value
	 * @param $option
	 *
	 * @return mixed
	 */
	public static function add_gd_templates( $value, $option ) {

//		print_r($value);exit;
		// add our own templates
		if ( ! empty( $value[&#039;templates&#039;] ) ) {

			$default_templates = $value[&#039;templates&#039;];
			$templates         = array();

			// Add block categories
			if(!empty($value[&#039;types_data&#039;][&#039;block&#039;][&#039;categories&#039;])){
				$value[&#039;types_data&#039;][&#039;block&#039;][&#039;categories&#039;][] = &quot;directory archive item&quot;;
				$value[&#039;types_data&#039;][&#039;block&#039;][&#039;categories&#039;][] = &quot;directory archive&quot;;
				$value[&#039;types_data&#039;][&#039;block&#039;][&#039;categories&#039;][] = &quot;directory single&quot;;
			}

			// Add popup categories
			if(!empty($value[&#039;types_data&#039;][&#039;popup&#039;][&#039;categories&#039;])){
				$value[&#039;types_data&#039;][&#039;popup&#039;][&#039;categories&#039;][] = &quot;directory&quot;;
			}


			// Get remote templates
			$templates = self::get_remote_templates();

			if(!empty($templates)){
				$value[&#039;templates&#039;] = $templates + $default_templates;
			}


		}
//		print_r($value);exit;
		return $value;
	}

	/**
	 * In some cases we need to hijack the Elementor AJAX to return our own values.
	 */
	public static function maybe_hijack_ajax() {
		if ( ! empty( $_POST[&#039;actions&#039;] ) ) {
			$actions = json_decode( stripslashes( $_POST[&#039;actions&#039;] ), true );
			if ( empty( $actions ) ) {
				// json_decode fails sometimes when request parameters are encoded.
				$actions = json_decode( stripslashes( html_entity_decode( $_POST[&#039;actions&#039;] ) ), true );
			}

			if ( ! empty( $actions ) ) {
				foreach ( $actions as $key =&gt; $action ) {
					if ( ! empty( $action[&#039;action&#039;] ) &amp;&amp; $action[&#039;action&#039;] == &#039;get_template_data&#039; &amp;&amp; substr( $key, 0, 8 ) === &quot;ayecode-&quot; ) {
						self::handle_template_ajax_request( $key );
					}elseif( ! empty( $action[&#039;action&#039;] ) &amp;&amp; $action[&#039;action&#039;] == &#039;get_library_data&#039; &amp;&amp; !empty($action[&#039;data&#039;][&#039;sync&#039;]) ){
						// delete template cache if set to refresh
						delete_transient( &#039;geodir_elementor_templates&#039; );
					}
				}
			}
		}
	}

	/**
	 * Get latest templates via API call.
	 *
	 * @return array|mixed
	 */
	public static function get_remote_templates(){

		// Cache
		$cache = get_transient( &#039;geodir_elementor_templates&#039; );
		if ( false !== $cache ) {
			return $cache;
		}

		$data = array();
		$url = &quot;https://wpgeodirectory.com/dummy/elementor/&quot;;

		$response = wp_remote_get($url);

		if ( is_array( $response ) &amp;&amp; wp_remote_retrieve_response_code( $response ) == &#039;200&#039; ) {
			$data = json_decode(wp_remote_retrieve_body( $response ),true);
		}

		set_transient( &#039;geodir_elementor_templates&#039;,$data, 24 * HOUR_IN_SECONDS );

		return $data;
	}

	/**
	 * Get our own template JSON when requested via AJAX.
	 *
	 * @param $key
	 */
	public static function handle_template_ajax_request( $key ) {
		// security
		check_ajax_referer( &#039;elementor_ajax&#039;, &#039;_nonce&#039; );
		if ( ! current_user_can( &#039;manage_options&#039; ) ) {
			wp_die( - 1 );
		}
		$data = array();
		$base_url = &quot;https://wpgeodirectory.com/dummy/elementor/&quot;;
		$key_parts = explode(&quot;-&quot;,$key);
		$route = $key_parts[1].&quot;/&quot;;
		unset($key_parts[0]);
		unset($key_parts[1]);
		$route .= implode(&quot;-&quot;,$key_parts).&quot;.json&quot;;

		if($route){
			$url = $base_url.$route;
			$response = wp_remote_get($url);

			if ( is_array( $response ) &amp;&amp; wp_remote_retrieve_response_code( $response ) == &#039;200&#039; ) {
				$data = json_decode(wp_remote_retrieve_body( $response ),true);
			}
		}


		if(!empty($data)){
			$content = self::template_response( $data, $key );
			wp_send_json_success( $content );
		}else{
			wp_send_json_error(__(&#039;Could not retrieve template.&#039;,&#039;geodirectory&#039;));
		}
		exit;

	}

	/**
	 * The AJAX template response needs to be wrapped correctly.
	 *
	 * @param $data
	 * @param $key
	 *
	 * @return array
	 */
	public static function template_response( $data, $key ) {

		$response = array();

		if ( ! empty( $data[&#039;content&#039;] ) ) {
			$response[&#039;responses&#039;][ $key ] = array(
				&#039;success&#039; =&gt; true,
				&#039;code&#039;    =&gt; 200,
				&#039;data&#039;    =&gt; array( &#039;content&#039; =&gt; $data[&#039;content&#039;] )
			);
		}

		return $response;
	}

	/**
	 * Allow to filter the archive item template content if being edited by elementor.
	 *
	 * @param $content
	 * @param $original_content
	 * @param $page_id
	 *
	 * @return mixed
	 */
	public static function archive_item_template_content( $content, $original_content, $page_id ) {

		if ( ! $original_content &amp;&amp; $page_id &amp;&amp; self::is_elementor( $page_id ) ) {
			$original_content = $content = \Elementor\Plugin::$instance-&gt;frontend-&gt;get_builder_content_for_display( $page_id );
		} else {
			$original_content = $content;
		}

		return $original_content;
	}

	/**
	 * Check if a page is being edited by elementor.
	 *
	 * @return bool
	 */
	public static function is_elementor( $post_id ) {
		return \Elementor\Plugin::$instance-&gt;db-&gt;is_built_with_elementor( $post_id );
	}

	/**
	 * Add the flex slider JS if in preview.
	 */
	public static function enqueue_scripts() {
		if ( self::is_elementor_preview() ) {
			GeoDir_Frontend_Scripts::enqueue_script( &#039;jquery-flexslider&#039; );
		}
	}

	/**
	 * Check if we are currently in an Elementor preview.
	 *
	 * @return bool
	 */
	public static function is_elementor_preview() {
		return isset( $_REQUEST[&#039;elementor-preview&#039;] ) ? true : false;
	}

	/**
	 * Check if a GD archive override is in place.
	 *
	 * @param string $template
	 *
	 * @return bool
	 */
	public static function is_template_override( $template = &#039;&#039; ) {
		$result    = false;
		$type      = &#039;&#039;;
		$page_type = &#039;&#039;;
		$post_type = &#039;&#039;;

		// set post_type
		if ( geodir_is_page( &#039;post_type&#039; ) || geodir_is_page( &#039;archive&#039; ) ) {
			$post_type = geodir_get_current_posttype();

			if( geodir_is_page( &#039;author&#039; ) ){
				$type = &#039;author&#039;;
			}elseif ( geodir_is_page( &#039;post_type&#039; ) ) {
				$type = $post_type . &quot;_archive&quot;;
			} elseif ( $tax = get_query_var( &#039;taxonomy&#039; ) ) {
				$type = $tax;
			}
			$page_type = &#039;archive&#039;;
		} elseif ( geodir_is_page( &#039;single&#039; ) ) {
			$type      = geodir_get_current_posttype();
			$page_type = &#039;single&#039;;
		} elseif ( geodir_is_page( &#039;search&#039; ) ) {
			$type      = &#039;search&#039;;
			$post_type = geodir_get_current_posttype();
			$page_type = &#039;archive&#039;;
		}

		if ( $type &amp;&amp; $conditions = get_option( &#039;elementor_pro_theme_builder_conditions&#039; ) ) {
			if ( $page_type == &#039;archive&#039; &amp;&amp; ! empty( $conditions[&#039;archive&#039;] ) ) {
				foreach ( $conditions[&#039;archive&#039;] as $archive_conditions ) {
					foreach ( $archive_conditions as $archive_condition ) {
						if (
							$archive_condition == &#039;include/geodirectory_archive&#039; // all archives
							|| stripos( strrev( $archive_condition ), strrev( $type ) ) === 0 // all search
							|| stripos( strrev( $archive_condition ), strrev( $type.&quot;_&quot;.$post_type ) ) === 0 // cpt search
						) {
							$result = true;
							break 2;
						}
					}
				}
			} elseif ( $page_type == &#039;single&#039; &amp;&amp; ! empty( $conditions[&#039;single&#039;] ) ) {
				foreach ( $conditions[&#039;single&#039;] as $archive_conditions ) {
					foreach ( $archive_conditions as $archive_condition ) {
						if ( stripos( strrev( $archive_condition ), strrev( $type ) ) === 0 ) {
							$result = true;
							break 2;
						}
					}
				}
			}
		}

		return $result;
	}

	/**
	 * Check the current output is inside a elementor preview.
	 *
	 * @since 2.0.58
	 * @return bool
	 */
	public static function is_elementor_view() {
		$result = false;
		if ( isset( $_REQUEST[&#039;elementor-preview&#039;] ) || ( is_admin() &amp;&amp; isset( $_REQUEST[&#039;action&#039;] ) &amp;&amp; $_REQUEST[&#039;action&#039;] == &#039;elementor&#039; ) || ( isset( $_REQUEST[&#039;action&#039;] ) &amp;&amp; $_REQUEST[&#039;action&#039;] == &#039;elementor_ajax&#039; ) ) {
			$result = true;
		}

		return $result;
	}

	/**
	 * Filter the archive title element.
	 *
	 * @since 2.0.0.71
	 *
	 * @param string $page_title The page title.
	 *
	 * @return string Filtered page title.
	 */
	public static function get_page_title( $page_title ) {
		$title = GeoDir_SEO::set_meta();

		if ( $title ) {
			$page_title = $title;
		}

		return $page_title;
	}


	/**
	 * Get the list of GD Archive item template skins.
	 * 
	 * @return array|bool|mixed
	 */
	public static function get_elementor_pro_skins(){
		global $wpdb;

		$cache = wp_cache_get(&quot;geodir_elementor_pro_skins&quot;);
		if($cache !== false){
			return $cache;
		}

		$templates = $wpdb-&gt;get_results(
			&quot;SELECT $wpdb-&gt;term_relationships.object_id as ID, $wpdb-&gt;posts.post_title as post_title FROM $wpdb-&gt;term_relationships
						INNER JOIN $wpdb-&gt;term_taxonomy ON
							$wpdb-&gt;term_relationships.term_taxonomy_id=$wpdb-&gt;term_taxonomy.term_taxonomy_id
						INNER JOIN $wpdb-&gt;terms ON 
							$wpdb-&gt;term_taxonomy.term_id=$wpdb-&gt;terms.term_id AND $wpdb-&gt;terms.slug=&#039;geodirectory-archive-item&#039;
						INNER JOIN $wpdb-&gt;posts ON
							$wpdb-&gt;term_relationships.object_id=$wpdb-&gt;posts.ID
          WHERE  $wpdb-&gt;posts.post_status=&#039;publish&#039;&quot;
		);
		$options = [ 0 =&gt; &#039;Select a template&#039; ];
		foreach ( $templates as $template ) {
			$options[ $template-&gt;ID ] = $template-&gt;post_title;
		}

		wp_cache_set(&quot;geodir_elementor_pro_skins&quot;,$options);

		return $options;
	}

	public static function custom_skin_dynamic_style( \Elementor\Element_Base $element ) {
		global $gdecs_render_loop;

		if ( ! $gdecs_render_loop ) {
			return; // only act inside loop
		}

		list ( $PostID, $LoopID ) = explode( &quot;,&quot;, $gdecs_render_loop );

		$ElementID = $element-&gt;get_ID();

		$dynamic_settings = $element-&gt;get_settings( &#039;__dynamic__&#039; );
		$all_controls = $element-&gt;get_controls();
		if ( empty( $dynamic_settings ) &amp;&amp; empty( $all_controls ) ) {
			return;
		}

		$all_controls = isset( $all_controls ) ? $all_controls : [];
		$dynamic_settings = isset( $dynamic_settings ) ? $dynamic_settings : [];
		$controls = array_intersect_key( $all_controls, $dynamic_settings );
		if ( empty( $controls ) ) {
			return;
		}

		self::custom_skin_recursive_unset( $dynamic_settings, &#039;link&#039; ); // We don&#039;t need the link options

		$settings = $element-&gt;parse_dynamic_settings( $dynamic_settings, $controls ); // @ &lt;- dirty fix for that fugly controls-stack.php  Illegal string offset &#039;url&#039; error
		if ( empty( $settings ) ) {
			return;
		}

		$element_wrapper = &quot;#post-{$PostID} .elementor-{$LoopID} .elementor-element.elementor-element-{$ElementID}&quot;;

		$css = &quot;&quot;;
		foreach ( $controls as $key =&gt; $control ) {
			if ( isset( $control[&quot;selectors&quot;] ) &amp;&amp; ! empty( $control[&quot;selectors&quot;] ) ) {
				foreach( $control[&quot;selectors&quot;] as $selector =&gt; $rules ) {
					if ( isset( $settings[ $key ] ) ) {
						$css.= self::custom_skin_parse_selector( $selector . &quot;{&quot; . $rules . &quot;}&quot;, $element_wrapper, $settings[ $key ] );
					}
				}
			}
		}

		if ( ! $css ) {
			return;
		}

		echo &#039;&lt;style type=&quot;text/css&quot;&gt;&#039; . $css . &#039;&lt;/style&gt;&#039;;
	}

	public static function custom_skin_clean_selector_value( $values ) {
		$interest = [ &quot;url&quot; ];

		if ( is_array( $values ) ) {
			foreach ( $values as $key =&gt; $value ) {
				if ( in_array( $key, $interest ) ) {
					return $value;
				}
			}
		}

		return $values;
	}

	public static function custom_skin_parse_selector( $selector, $wrapper, $value ) {
		$clean_value = self::custom_skin_clean_selector_value( $value );

		$selector = str_replace( &quot;{{WRAPPER}}&quot;, $wrapper, $selector );
		$selector = str_replace([ &quot;{{VALUE}}&quot;, &quot;{{URL}}&quot;, &quot;{{UNIT}}&quot; ], $clean_value, $selector );

		return $selector;
	}

	public static function custom_skin_recursive_unset( &amp;$array, $unwanted_key ) {
		if ( isset( $array[ $unwanted_key ] ) ) {
			unset( $array[ $unwanted_key ] );
		}

		if ( ! empty( $array ) ) {
			foreach ( $array as &amp;$value ) {
				if ( is_array( $value ) ) {
					self::custom_skin_recursive_unset( $value, $unwanted_key );
				}
			}
		}
	}
}</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 06:35 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652337338"></script>
    <script src="../js/search.js?updated=1652337338"></script>
</body>
</html>
