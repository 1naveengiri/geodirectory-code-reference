<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Geodirectory Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1652334990">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1652334990">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
                <li><a href="https://woocommerce.com/careers/?utm_source=woocommerce+core+code+reference&utm_medium=devdocs&utm_campaign=woo+careers" target="_blank">We're hiring!</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">Geodirectory Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/elementorpro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/elementorpro-modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Geodirectory.html"><abbr title="\Geodirectory">Geodirectory</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectory.html"><abbr title="\GeoDirectory">GeoDirectory</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/GeoDirectory-Templates.html"><abbr title="\GeoDirectory\Templates">Templates</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAbstracts.html"><abbr title="\GeoDirectoryAbstracts">GeoDirectoryAbstracts</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAPI.html"><abbr title="\GeoDirectoryAPI">GeoDirectoryAPI</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClasses.html"><abbr title="\GeoDirectoryClasses">GeoDirectoryClasses</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminFunctions.html"><abbr title="\GeoDirectoryAdminFunctions">GeoDirectoryAdminFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoruAdmin.html"><abbr title="\GeoDirectoruAdmin">GeoDirectoruAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdmin.html"><abbr title="\GeoDirectoryAdmin">GeoDirectoryAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirAdmin.html"><abbr title="\GeoDirAdmin">GeoDirAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectroyAdmin.html"><abbr title="\GeoDirectroyAdmin">GeoDirectroyAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminSystemStatus.html"><abbr title="\GeoDirectoryAdminSystemStatus">GeoDirectoryAdminSystemStatus</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminTools.html"><abbr title="\GeoDirectoryAdminTools">GeoDirectoryAdminTools</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryAdminWidgets.html"><abbr title="\GeoDirectoryAdminWidgets">GeoDirectoryAdminWidgets</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesEmails.html"><abbr title="\GeoDirectoryClassesEmails">GeoDirectoryClassesEmails</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryClassesData.html"><abbr title="\GeoDirectoryClassesData">GeoDirectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDIrectoryClassesData.html"><abbr title="\GeoDIrectoryClassesData">GeoDIrectoryClassesData</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/ElementorPro.html"><abbr title="\ElementorPro">ElementorPro</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/ElementorPro-Modules.html"><abbr title="\ElementorPro\Modules">Modules</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryFunctions.html"><abbr title="\GeoDirectoryFunctions">GeoDirectoryFunctions</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryparamarraytermsAnarrayoftermobjects.html"><abbr title="\GeoDirectoryparamarraytermsAnarrayoftermobjects">GeoDirectoryparamarraytermsAnarrayoftermobjects</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WP.html"><abbr title="\WP">WP</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WP-Background.html"><abbr title="\WP\Background">Background</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/GeoDirectoryTemplates.html"><abbr title="\GeoDirectoryTemplates">GeoDirectoryTemplates</abbr></a></h3>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-geodir-post-types.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Post Types
 *
 * Registers post types and taxonomies.
 *
 * @class     GeoDir_Post_types
 * @since     2.0.0
 * @package   GeoDirectory
 * @category  Class
 * @author    AyeCode
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * GeoDir_Post_types Class.
 */
class GeoDir_Post_types {

	/**
	 * Hook in methods.
	 */
	public static function init() {
		add_action( &#039;init&#039;, array( __CLASS__, &#039;register_taxonomies&#039; ), 5 );
		add_action( &#039;init&#039;, array( __CLASS__, &#039;register_post_types&#039; ), 5 );
		add_action( &#039;init&#039;, array( __CLASS__, &#039;register_post_status&#039; ), 9 );
		add_filter( &#039;rest_api_allowed_post_types&#039;, array( __CLASS__, &#039;rest_api_allowed_post_types&#039; ) );
		add_action( &#039;geodir_flush_rewrite_rules&#039;, array( __CLASS__, &#039;flush_rewrite_rules&#039; ) );

		// Prevent Gutenberg editing GD CPTs, we only allow editing of the template pages.
		if (version_compare($GLOBALS[&#039;wp_version&#039;], &#039;5.0-beta&#039;, &#039;&gt;&#039;)) {
			// WP &gt; 5 beta
			add_filter( &#039;use_block_editor_for_post_type&#039;, array( __CLASS__, &#039;disable_gutenberg&#039;), 101, 2 );
		} else {
			// WP &lt; 5 beta
			add_filter( &#039;gutenberg_can_edit_post_type&#039;, array( __CLASS__, &#039;disable_gutenberg&#039;), 101, 2 );
		}

		add_action( &#039;geodir_post_type_saved&#039;, &#039;geodir_reorder_post_types&#039;, 999 );

		add_filter( &#039;geodir_post_type_supports&#039;, array( __CLASS__, &#039;default_supports&#039; ), -10, 3 );
	}

	/**
	 * Disable Gutenberg for GD CPTs.
	 * 
	 * @param $is_enabled
	 * @param $post_type
	 *
	 * @return bool
	 */
	public static function disable_gutenberg($is_enabled, $post_type){
		if (in_array($post_type, geodir_get_posttypes())) {
			return false;
		}

		return $is_enabled;
	}

	/**
	 * Register core taxonomies.
     *
     * @since 2.0.0
	 */
	public static function register_taxonomies() {

		if ( ! is_blog_installed() ) {
			return;
		}

		if ( taxonomy_exists( &#039;gd_placecategory&#039; ) ) {
			return;
		}

		do_action( &#039;geodirectory_register_taxonomy&#039; );

		$taxonomies = self::get_taxonomy_defaults();

//		print_r($taxonomies );exit;
		// If custom taxonomies are present, register them
		if (is_array($taxonomies)) {
			// Sort taxonomies
			ksort($taxonomies);

			// Register taxonomies
			foreach ($taxonomies as $taxonomy =&gt; $args) {
				// Allow taxonomy names to be translated
				if (!empty($args[&#039;args&#039;][&#039;labels&#039;])) {
					foreach ($args[&#039;args&#039;][&#039;labels&#039;] as $key =&gt; $tax_label) {
						$args[&#039;args&#039;][&#039;labels&#039;][$key] = __($tax_label, &#039;geodirectory&#039;);
					}
				}

				//print_r($args[&#039;args&#039;]);

				register_taxonomy($taxonomy, $args[&#039;object_type&#039;], $args[&#039;args&#039;]);

				if (taxonomy_exists($taxonomy)) {
					register_taxonomy_for_object_type($taxonomy, $args[&#039;object_type&#039;]);
				}
			}
		}


		do_action( &#039;geodirectory_after_register_taxonomy&#039; );
	}

	/**
	 * Get the post type defaults.
     *
     * @since 2.0.0
	 */
	private static function get_post_type_defaults() {

		$post_types = geodir_get_option(&#039;post_types&#039;, array());
		if(empty($post_types)) {

			$listing_slug = &#039;places&#039;;


			$labels = array(
				&#039;name&#039;               =&gt; __( &#039;Places&#039;, &#039;geodirectory&#039; ),
				&#039;singular_name&#039;      =&gt; __( &#039;Place&#039;, &#039;geodirectory&#039; ),
				&#039;add_new&#039;            =&gt; __( &#039;Add New&#039;, &#039;geodirectory&#039; ),
				&#039;add_new_item&#039;       =&gt; __( &#039;Add New Place&#039;, &#039;geodirectory&#039; ),
				&#039;edit_item&#039;          =&gt; __( &#039;Edit Place&#039;, &#039;geodirectory&#039; ),
				&#039;new_item&#039;           =&gt; __( &#039;New Place&#039;, &#039;geodirectory&#039; ),
				&#039;view_item&#039;          =&gt; __( &#039;View Place&#039;, &#039;geodirectory&#039; ),
				&#039;search_items&#039;       =&gt; __( &#039;Search Places&#039;, &#039;geodirectory&#039; ),
				&#039;not_found&#039;          =&gt; __( &#039;No Place Found&#039;, &#039;geodirectory&#039; ),
				&#039;not_found_in_trash&#039; =&gt; __( &#039;No Place Found In Trash&#039;, &#039;geodirectory&#039; )
			);

			$place_default = array(
				&#039;labels&#039;          =&gt; $labels,
				&#039;can_export&#039;      =&gt; true,
				&#039;capability_type&#039; =&gt; &#039;post&#039;,
				&#039;description&#039;     =&gt; &#039;Place post type.&#039;,
				&#039;has_archive&#039;     =&gt; $listing_slug,
				&#039;hierarchical&#039;    =&gt; false,  // Hierarchical causes memory issues - WP loads all records!
				&#039;map_meta_cap&#039;    =&gt; true,
				&#039;menu_icon&#039;       =&gt; &#039;dashicons-location-alt&#039;,
				&#039;public&#039;          =&gt; true,
				&#039;query_var&#039;       =&gt; true,
				&#039;rewrite&#039;         =&gt; array(
					&#039;slug&#039;         =&gt; $listing_slug,
					&#039;with_front&#039;   =&gt; false,
					&#039;hierarchical&#039; =&gt; true,
					&#039;feeds&#039;        =&gt; true
				),
				&#039;supports&#039;        =&gt; array(
					&#039;title&#039;,
					&#039;editor&#039;,
					&#039;author&#039;,
					&#039;thumbnail&#039;,
					&#039;excerpt&#039;,
					&#039;custom-fields&#039;,
					&#039;comments&#039;,
					&#039;revisions&#039;,
//					&#039;post-formats&#039;
				),
				&#039;taxonomies&#039;      =&gt; array( &#039;gd_placecategory&#039;, &#039;gd_place_tags&#039; )
			);

			//Update custom post types
			$post_types[&#039;gd_place&#039;] = $place_default;
			geodir_update_option( &#039;post_types&#039;, $post_types );

		}
		
		return $post_types;

	}

	/**
	 * Get the taxonomy defaults.
     *
     * @since 2.0.0
	 */
	private static function get_taxonomy_defaults() {

		$taxonomies = geodir_get_option(&#039;taxonomies&#039;, array());
		$post_types = geodir_get_option(&#039;post_types&#039;, array());

//		print_r($post_types);exit;
		if(empty($taxonomies)){


			$listing_slug = isset($post_types[&#039;gd_place&#039;][&#039;rewrite&#039;][&#039;slug&#039;]) ? $post_types[&#039;gd_place&#039;][&#039;rewrite&#039;][&#039;slug&#039;] : &#039;places&#039;;
			$singular_name = isset($post_types[&#039;gd_place&#039;][&#039;labels&#039;][&#039;singular_name&#039;]) ? $post_types[&#039;gd_place&#039;][&#039;labels&#039;][&#039;singular_name&#039;] : &#039;Place&#039;;


			// Place tags
			$gd_placetags = array();
			$gd_placetags[&#039;object_type&#039;] = &#039;gd_place&#039;;
			$gd_placetags[&#039;listing_slug&#039;] = $listing_slug . &#039;/tags&#039;;
			$gd_placetags[&#039;args&#039;] = array(
				&#039;public&#039; =&gt; true,
				&#039;hierarchical&#039; =&gt; false,
				&#039;rewrite&#039; =&gt; array(&#039;slug&#039; =&gt; $listing_slug . &#039;/tags&#039;, &#039;with_front&#039; =&gt; false, &#039;hierarchical&#039; =&gt; true),
				&#039;query_var&#039; =&gt; true,

				&#039;labels&#039; =&gt; array(
					&#039;name&#039; =&gt; sprintf( __(&#039;%s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;singular_name&#039; =&gt; sprintf( __(&#039;%s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;search_items&#039; =&gt; sprintf( __(&#039;Search %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;popular_items&#039; =&gt; sprintf( __(&#039;Popular %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;all_items&#039; =&gt; sprintf( __(&#039;All %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;edit_item&#039; =&gt; sprintf( __(&#039;Edit %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;update_item&#039; =&gt; sprintf( __(&#039;Update %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;add_new_item&#039; =&gt; sprintf( __(&#039;Add New %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;new_item_name&#039; =&gt; sprintf( __(&#039;New %s Tag Name&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;add_or_remove_items&#039; =&gt; sprintf( __(&#039;Add or remove %s tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;choose_from_most_used&#039; =&gt; sprintf( __(&#039;Choose from the most used %s tags&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;separate_items_with_commas&#039; =&gt; sprintf( __(&#039;Separate %s tags with commas&#039;, &#039;geodirectory&#039;), $singular_name ),
				),
			);


			// Place Category
			$gd_placecategory = array();
			$gd_placecategory[&#039;object_type&#039;] = &#039;gd_place&#039;;
			$gd_placecategory[&#039;listing_slug&#039;] = $listing_slug;
			$gd_placecategory[&#039;args&#039;] = array(
				&#039;public&#039; =&gt; true,
				&#039;hierarchical&#039; =&gt; true,
				&#039;rewrite&#039; =&gt; array(&#039;slug&#039; =&gt; $listing_slug, &#039;with_front&#039; =&gt; false, &#039;hierarchical&#039; =&gt; true),
				&#039;query_var&#039; =&gt; true,
				&#039;labels&#039; =&gt; array(
					&#039;name&#039; =&gt; sprintf( __(&#039;%s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;singular_name&#039; =&gt; sprintf( __(&#039;%s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;search_items&#039; =&gt; sprintf( __(&#039;Search %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;popular_items&#039; =&gt; sprintf( __(&#039;Popular %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;all_items&#039; =&gt; sprintf( __(&#039;All %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;edit_item&#039; =&gt; sprintf( __(&#039;Edit %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;update_item&#039; =&gt; sprintf( __(&#039;Update %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;add_new_item&#039; =&gt; sprintf( __(&#039;Add New %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;new_item_name&#039; =&gt; sprintf( __(&#039;New %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
					&#039;add_or_remove_items&#039; =&gt; sprintf( __(&#039;Add or remove %s categories&#039;, &#039;geodirectory&#039;), $singular_name ),
				),
			);


			$taxonomies[&#039;gd_place_tags&#039;] = $gd_placetags;
			$taxonomies[&#039;gd_placecategory&#039;] = $gd_placecategory;
			geodir_update_option(&#039;taxonomies&#039;, $taxonomies);

		}


		// loop the taxonomies
		if(!empty($taxonomies)){
			$tag_slug = geodir_get_option(&#039;permalink_tag_base&#039;,&#039;tags&#039;);
			$cat_slug = geodir_get_option(&#039;permalink_category_base&#039;,&#039;category&#039;);
			foreach($taxonomies as $key =&gt; $taxonomy){

				// add capability to assign terms to any user, if not added then subscribers listings wont have terms
				$taxonomies[$key][&#039;args&#039;][&#039;capabilities&#039;][&#039;assign_terms&#039;] = &#039;read&#039;;

				// adjust rewrite rules _tags
				$listing_slug = isset($post_types[$taxonomy[&#039;object_type&#039;]][&#039;rewrite&#039;][&#039;slug&#039;]) ? $post_types[$taxonomy[&#039;object_type&#039;]][&#039;rewrite&#039;][&#039;slug&#039;] : &#039;places&#039;;
				if(stripos(strrev($key), &quot;sgat_&quot;) === 0){ // its a tag
					$taxonomies[$key][&#039;args&#039;][&#039;rewrite&#039;][&#039;slug&#039;] = $tag_slug ? $listing_slug.&#039;/&#039;.$tag_slug : $listing_slug;
				}else{// its a category
					$taxonomies[$key][&#039;args&#039;][&#039;rewrite&#039;][&#039;slug&#039;] = $cat_slug ? $listing_slug.&#039;/&#039;.$cat_slug : $listing_slug;
				}

				// Dynamically create the labels from the CPT labels
				$singular_name = isset($post_types[$taxonomy[&#039;object_type&#039;]][&#039;labels&#039;][&#039;singular_name&#039;]) ? $post_types[$taxonomy[&#039;object_type&#039;]][&#039;labels&#039;][&#039;singular_name&#039;] : &#039;Place&#039;;
				if(stripos(strrev($key), &quot;sgat_&quot;) === 0){ // its a tag
					$taxonomies[$key][&#039;args&#039;][&#039;labels&#039;] = array(
						&#039;name&#039; =&gt; sprintf( __(&#039;%s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;singular_name&#039; =&gt; sprintf( __(&#039;%s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;search_items&#039; =&gt; sprintf( __(&#039;Search %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;popular_items&#039; =&gt; sprintf( __(&#039;Popular %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;all_items&#039; =&gt; sprintf( __(&#039;All %s Tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;edit_item&#039; =&gt; sprintf( __(&#039;Edit %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;update_item&#039; =&gt; sprintf( __(&#039;Update %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;add_new_item&#039; =&gt; sprintf( __(&#039;Add New %s Tag&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;new_item_name&#039; =&gt; sprintf( __(&#039;New %s Tag Name&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;add_or_remove_items&#039; =&gt; sprintf( __(&#039;Add or remove %s tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;choose_from_most_used&#039; =&gt; sprintf( __(&#039;Choose from the most used %s tags&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;separate_items_with_commas&#039; =&gt; sprintf( __(&#039;Separate %s tags with commas&#039;, &#039;geodirectory&#039;), $singular_name ),
					);
				}else{// its a category
					$taxonomies[$key][&#039;args&#039;][&#039;labels&#039;] = array(
						&#039;name&#039; =&gt; sprintf( __(&#039;%s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;singular_name&#039; =&gt; sprintf( __(&#039;%s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;search_items&#039; =&gt; sprintf( __(&#039;Search %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;popular_items&#039; =&gt; sprintf( __(&#039;Popular %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;all_items&#039; =&gt; sprintf( __(&#039;All %s Categories&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;edit_item&#039; =&gt; sprintf( __(&#039;Edit %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;update_item&#039; =&gt; sprintf( __(&#039;Update %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;add_new_item&#039; =&gt; sprintf( __(&#039;Add New %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;new_item_name&#039; =&gt; sprintf( __(&#039;New %s Category&#039;, &#039;geodirectory&#039;), $singular_name ),
						&#039;add_or_remove_items&#039; =&gt; sprintf( __(&#039;Add or remove %s categories&#039;, &#039;geodirectory&#039;), $singular_name ),
					);
				}




			}
		}

		// add rewrite rules



		return $taxonomies;
	}

	/**
	 * Register core post types.
     *
     * @since 2.0.0
	 */
	public static function register_post_types() {
		if ( ! is_blog_installed() || post_type_exists( &#039;gd_place&#039; ) ) {
			return;
		}

		do_action( &#039;geodirectory_register_post_type&#039; );


		/**
		 * Get available custom posttypes and taxonomies and register them.
		 */
		_x(&#039;places&#039;, &#039;URL slug&#039;, &#039;geodirectory&#039;);

		$post_types = self::get_post_type_defaults();

		// Register each post type if array of data is returned
		if (is_array($post_types)):

			foreach ($post_types as $post_type =&gt; $args):

				if (!empty($args[&#039;rewrite&#039;][&#039;slug&#039;])) {
					$args[&#039;rewrite&#039;][&#039;slug&#039;] = apply_filters( &#039;geodir_post_type_rewrite_slug&#039;, $args[&#039;rewrite&#039;][&#039;slug&#039;], $post_type );
				}
				$args = stripslashes_deep($args);

				if (!empty($args[&#039;labels&#039;])) {
					foreach ($args[&#039;labels&#039;] as $key =&gt; $val) {
						$args[&#039;labels&#039;][$key] = __($val, &#039;geodirectory&#039;);// allow translation
					}
				}

				// force support post revisions
				$args[&#039;supports&#039;][] = &#039;revisions&#039;;

				// force to show above GD main menu item
				$args[&#039;show_ui&#039;] = true;
				$args[&#039;show_in_menu&#039;] = true;
				$listing_order = isset($args[&#039;listing_order&#039;]) ? $args[&#039;listing_order&#039;] : 1;
				$args[&#039;menu_position&#039;] = &quot;56.2&quot;. $listing_order ;

				/**
				 * Filter post type args.
				 *
				 * @since 1.0.0
				 * @param string $args Post type args.
				 * @param string $post_type The post type.
				 */
				$args = apply_filters(&#039;geodir_post_type_args&#039;, $args, $post_type);

				//print_r($args);

//				$args[&#039;template&#039;] = array(
//					array( &#039;core/columns&#039;, array(), array(
//						array( &#039;core/column&#039;, array(), array(
//							array( &#039;core/image&#039;, array() ),
//						) ),
//						array( &#039;core/column&#039;, array(), array(
//							array( &#039;core/paragraph&#039;, array(
//								&#039;placeholder&#039; =&gt; &#039;Add a inner paragraph&#039;
//							) ),
//						) ),
//					) )
//				);

				register_post_type($post_type, $args);

			endforeach;
		endif;


		do_action( &#039;geodirectory_after_register_post_type&#039; );
	}
	
	/**
	 * Register our custom post statuses, used for listing status.
     *
     * @since 2.0.0
	 */
	public static function register_post_status() {
		$listing_statuses = geodir_register_custom_statuses();

		foreach ( $listing_statuses as $listing_status =&gt; $values ) {
			register_post_status( $listing_status, $values );
		}
	}

	/**
	 * Flush rewrite rules.
     *
     * @since 2.0.0
	 */
	public static function flush_rewrite_rules() {
		flush_rewrite_rules();
	}


	/**
	 * Added product for Jetpack related posts.
     *
     * @since 2.0.0
	 *
	 * @param  array $post_types Post types.
	 * @return array $post_types.
	 */
	public static function rest_api_allowed_post_types( $post_types ) {
		$post_types[] = &#039;gd_place&#039;;

		return $post_types;
	}

	public static function sanitize_menu_icon( $icon ) {
		if ( empty( $icon ) ) {
			return NULL;
		}

		if ( strpos( $icon, &#039;dashicons-&#039; ) === false ) {
			$icon = &#039;dashicons-&#039; . $icon;
		}

		return $icon;
	}

	/**
	 * Check a post type&#039;s support for a given feature.
	 *
	 * @param string $post_type The post type being checked.
	 * @param string $feature   The feature being checked.
	 * @param bool $default     Default value.
	 * @return bool Whether the post type supports the given feature.
	 */
	public static function supports( $post_type, $feature, $default = true ) {
		return apply_filters( &#039;geodir_post_type_supports&#039;, $default, $post_type, $feature );
	}

	/**
	 * Set default post type&#039;s support for a given feature.
	 *
	 * @param bool $value       True if supports else False.
	 * @param string $post_type The post type being checked.
	 * @param string $feature   The feature being checked.
	 * @return bool Whether the post type supports the given feature.
	 */
	public static function default_supports( $value, $post_type, $feature ) {
		if ( ! is_scalar( $post_type ) ) {
			return $value;
		}

		$post_types = geodir_get_posttypes(&#039;array&#039;);

		switch ( $feature ) {
			case &#039;events&#039;:
				if(isset($post_types[$post_type]) &amp;&amp; isset($post_types[$post_type][&#039;supports_events&#039;]) &amp;&amp; $post_types[$post_type][&#039;supports_events&#039;]){
					$value = defined( &#039;GEODIR_EVENT_VERSION&#039; ) ? true : false;
				}else{
					$value = false;
				}
				break;
			case &#039;business_hours&#039;:
			case &#039;featured&#039;:
			case &#039;special_offers&#039;:
			case &#039;service_distance&#039;:
			case &#039;private_address&#039;:
				$cf = geodir_get_field_infoby( &#039;htmlvar_name&#039;, $feature, $post_type );
				if ( ! empty( $cf ) &amp;&amp; ! empty( $cf[&#039;is_active&#039;] ) ) {
					$value = true;
				} else {
					$value = false;
				}
				break;
			case &#039;comments&#039;:
				if ( isset( $post_types[ $post_type ] ) &amp;&amp; ! empty( $post_types[ $post_type ][ &#039;disable_comments&#039; ] ) ) {
					$value = false;
				}else{
					$value = true;
				}
				break;
			case &#039;single_review&#039;:
				if ( isset( $post_types[ $post_type ] ) &amp;&amp; ! empty( $post_types[ $post_type ][ &#039;single_review&#039; ] ) ) {
					$value = true;
				}else{
					$value = false;
				}
				break;
		}


		return $value;
	}

	/**
	 * Get the post type rewrite slug.
	 *
	 * @param string $post_type The post type being checked.
	 * @param object $post_type_obj   The post type object.
	 * @return string The post type slug.
	 */
	public static function get_rewrite_slug( $post_type, $post_type_obj = NULL ) {
		if ( empty( $post_type_obj ) || ! is_object( $post_type_obj ) ) {
			$post_type_obj = geodir_post_type_object( $post_type );
		}

		$slug = &#039;&#039;;
		if ( empty( $post_type_obj ) ) {
			return $slug;
		}

		if ( ! empty( $post_type_obj-&gt;rewrite ) ) {
			if ( is_array( $post_type_obj-&gt;rewrite ) &amp;&amp; ! empty( $post_type_obj-&gt;rewrite[&#039;slug&#039;] ) ) {
				$slug = trim( $post_type_obj-&gt;rewrite[&#039;slug&#039;], &#039;/&#039; );
			} else if ( is_object( $post_type_obj-&gt;rewrite ) &amp;&amp; ! empty( $post_type_obj-&gt;rewrite-&gt;slug ) ) {
				$slug = trim( $post_type_obj-&gt;rewrite-&gt;slug, &#039;/&#039; );
			}
		} else {
			if ( ! empty( $post_type_obj-&gt;has_archive ) ) {
				$slug = $post_type_obj-&gt;has_archive;
			} else if ( ! empty( $post_type_obj-&gt;name ) ) {
				$slug = $post_type_obj-&gt;name;
			}
		}

		return $slug;
	}

}
GeoDir_Post_types::init();</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Geodirectory Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on May 12th, 2022 at 05:56 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1652334990"></script>
    <script src="../js/search.js?updated=1652334990"></script>
</body>
</html>
